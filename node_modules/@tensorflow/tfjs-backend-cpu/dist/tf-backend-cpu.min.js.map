{"version":3,"file":"tf-backend-cpu.min.js","sources":["../../../../node_modules/tslib/tslib.es6.js","../../../../tfjs-backend-cpu/src/cpu_util.ts","../../../../tfjs-backend-cpu/src/backend_cpu.ts","../../../../tfjs-backend-cpu/src/kernels/Abs.ts","../../../../tfjs-backend-cpu/src/utils/binary_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Complex.ts","../../../../tfjs-backend-cpu/src/utils/zeros_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Identity.ts","../../../../tfjs-backend-cpu/src/kernels/Real.ts","../../../../tfjs-backend-cpu/src/kernels/Cast.ts","../../../../tfjs-backend-cpu/src/utils/binary_utils.ts","../../../../tfjs-backend-cpu/src/kernels/Add.ts","../../../../tfjs-backend-cpu/src/kernels/Bincount_impl.ts","../../../../tfjs-backend-cpu/src/utils/unary_impl.ts","../../../../tfjs-backend-cpu/src/utils/unary_utils.ts","../../../../tfjs-backend-cpu/src/kernels/Ceil.ts","../../../../tfjs-backend-cpu/src/kernels/Concat_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Equal.ts","../../../../tfjs-backend-cpu/src/kernels/Exp.ts","../../../../tfjs-backend-cpu/src/kernels/Expm1.ts","../../../../tfjs-backend-cpu/src/kernels/Floor.ts","../../../../tfjs-backend-cpu/src/kernels/GatherNd_Impl.ts","../../../../tfjs-backend-cpu/src/kernels/GatherV2_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Greater.ts","../../../../tfjs-backend-cpu/src/kernels/GreaterEqual.ts","../../../../tfjs-backend-cpu/src/kernels/Less.ts","../../../../tfjs-backend-cpu/src/kernels/LessEqual.ts","../../../../tfjs-backend-cpu/src/kernels/LinSpace_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Log.ts","../../../../tfjs-backend-cpu/src/kernels/Max_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Maximum.ts","../../../../tfjs-backend-cpu/src/kernels/Minimum.ts","../../../../tfjs-backend-cpu/src/kernels/Multiply.ts","../../../../tfjs-backend-cpu/src/kernels/Neg.ts","../../../../tfjs-backend-cpu/src/kernels/NotEqual.ts","../../../../tfjs-backend-cpu/src/kernels/Transpose_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Transpose.ts","../../../../tfjs-backend-cpu/src/kernels/Prod.ts","../../../../tfjs-backend-cpu/src/kernels/RaggedGather_impl.ts","../../../../tfjs-backend-cpu/src/kernels/RaggedTensorToTensor_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Range_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Rsqrt.ts","../../../../tfjs-backend-cpu/src/kernels/Scatter_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Sigmoid.ts","../../../../tfjs-backend-cpu/src/kernels/Slice.ts","../../../../tfjs-backend-cpu/src/kernels/SparseFillEmptyRows_impl.ts","../../../../tfjs-backend-cpu/src/kernels/SparseReshape_impl.ts","../../../../tfjs-backend-cpu/src/kernels/SparseSegmentReduction_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Sqrt.ts","../../../../tfjs-backend-cpu/src/kernels/SquaredDifference.ts","../../../../tfjs-backend-cpu/src/kernels/StridedSlice_impl.ts","../../../../tfjs-backend-cpu/src/kernels/StringNGrams_impl.ts","../../../../tfjs-backend-cpu/src/kernels/StringSplit_impl.ts","../../../../tfjs-backend-cpu/src/kernels/StringToHashBucketFast_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Sub.ts","../../../../tfjs-backend-cpu/src/kernels/Tile_impl.ts","../../../../tfjs-backend-cpu/src/kernels/TopK_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Unique_impl.ts","../../../../tfjs-backend-cpu/src/base.ts","../../../../tfjs-backend-cpu/src/kernels/Elu.ts","../../../../tfjs-backend-cpu/src/kernels/LeakyRelu.ts","../../../../tfjs-backend-cpu/src/kernels/Prelu.ts","../../../../tfjs-backend-cpu/src/kernels/Relu.ts","../../../../tfjs-backend-cpu/src/kernels/Relu6.ts","../../../../tfjs-backend-cpu/src/utils/fused_utils.ts","../../../../tfjs-backend-cpu/src/kernels/Reshape.ts","../../../../tfjs-backend-cpu/src/kernels/BatchMatMul.ts","../../../../tfjs-backend-cpu/src/kernels/_FusedMatMul.ts","../../../../tfjs-backend-cpu/src/kernels/Acos.ts","../../../../tfjs-backend-cpu/src/kernels/Acosh.ts","../../../../tfjs-backend-cpu/src/kernels/AddN.ts","../../../../tfjs-backend-cpu/src/kernels/All.ts","../../../../tfjs-backend-cpu/src/kernels/Any.ts","../../../../tfjs-backend-cpu/src/kernels/ArgMax.ts","../../../../tfjs-backend-cpu/src/kernels/ArgMin.ts","../../../../tfjs-backend-cpu/src/kernels/Asin.ts","../../../../tfjs-backend-cpu/src/kernels/Asinh.ts","../../../../tfjs-backend-cpu/src/kernels/Atan.ts","../../../../tfjs-backend-cpu/src/kernels/Atan2.ts","../../../../tfjs-backend-cpu/src/kernels/Atanh.ts","../../../../tfjs-backend-cpu/src/utils/pool_utils.ts","../../../../tfjs-backend-cpu/src/kernels/AvgPool.ts","../../../../tfjs-backend-cpu/src/kernels/AvgPool3D.ts","../../../../tfjs-backend-cpu/src/kernels/AvgPool3DGrad.ts","../../../../tfjs-backend-cpu/src/kernels/AvgPoolGrad.ts","../../../../tfjs-backend-cpu/src/kernels/BatchNorm.ts","../../../../tfjs-backend-cpu/src/kernels/BatchToSpaceND.ts","../../../../tfjs-backend-cpu/src/kernels/Bincount.ts","../../../../tfjs-backend-cpu/src/kernels/BroadcastArgs.ts","../../../../tfjs-backend-cpu/src/kernels/ClipByValue.ts","../../../../tfjs-backend-cpu/src/kernels/ComplexAbs.ts","../../../../tfjs-backend-cpu/src/kernels/Imag.ts","../../../../tfjs-backend-cpu/src/kernels/Concat.ts","../../../../tfjs-backend-cpu/src/kernels/Conv2D.ts","../../../../tfjs-backend-cpu/src/kernels/Conv2DBackpropFilter.ts","../../../../tfjs-backend-cpu/src/kernels/Conv2DBackpropInput.ts","../../../../tfjs-backend-cpu/src/kernels/Conv3D.ts","../../../../tfjs-backend-cpu/src/kernels/Conv3DBackpropFilterV2.ts","../../../../tfjs-backend-cpu/src/kernels/Conv3DBackpropInputV2.ts","../../../../tfjs-backend-cpu/src/kernels/Cos.ts","../../../../tfjs-backend-cpu/src/kernels/Cosh.ts","../../../../tfjs-backend-cpu/src/kernels/CropAndResize.ts","../../../../tfjs-backend-cpu/src/kernels/Cumprod.ts","../../../../tfjs-backend-cpu/src/kernels/Cumsum.ts","../../../../tfjs-backend-cpu/src/kernels/DenseBincount.ts","../../../../tfjs-backend-cpu/src/kernels/DepthToSpace.ts","../../../../tfjs-backend-cpu/src/kernels/DepthwiseConv2dNative.ts","../../../../tfjs-backend-cpu/src/kernels/DepthwiseConv2dNativeBackpropFilter.ts","../../../../tfjs-backend-cpu/src/kernels/DepthwiseConv2dNativeBackpropInput.ts","../../../../tfjs-backend-cpu/src/kernels/Diag.ts","../../../../tfjs-backend-cpu/src/kernels/Dilation2D.ts","../../../../tfjs-backend-cpu/src/kernels/Dilation2DBackpropFilter.ts","../../../../tfjs-backend-cpu/src/kernels/Dilation2DBackpropInput.ts","../../../../tfjs-backend-cpu/src/kernels/Sum.ts","../../../../tfjs-backend-cpu/src/kernels/Einsum.ts","../../../../tfjs-backend-cpu/src/kernels/EluGrad.ts","../../../../tfjs-backend-cpu/src/kernels/Erf.ts","../../../../tfjs-backend-cpu/src/kernels/ExpandDims.ts","../../../../tfjs-backend-cpu/src/kernels/RealDiv.ts","../../../../tfjs-backend-cpu/src/utils/fft_utils.ts","../../../../tfjs-backend-cpu/src/kernels/FFT.ts","../../../../tfjs-backend-cpu/src/kernels/Fill.ts","../../../../tfjs-backend-cpu/src/kernels/FlipLeftRight.ts","../../../../tfjs-backend-cpu/src/kernels/FloorDiv.ts","../../../../tfjs-backend-cpu/src/kernels/FusedConv2D.ts","../../../../tfjs-backend-cpu/src/kernels/FusedDepthwiseConv2D.ts","../../../../tfjs-backend-cpu/src/kernels/GatherNd.ts","../../../../tfjs-backend-cpu/src/kernels/GatherV2.ts","../../../../tfjs-backend-cpu/src/kernels/IFFT.ts","../../../../tfjs-backend-cpu/src/kernels/IsFinite.ts","../../../../tfjs-backend-cpu/src/kernels/IsInf.ts","../../../../tfjs-backend-cpu/src/kernels/IsNaN.ts","../../../../tfjs-backend-cpu/src/kernels/LinSpace.ts","../../../../tfjs-backend-cpu/src/kernels/Log1p.ts","../../../../tfjs-backend-cpu/src/kernels/LogicalAnd.ts","../../../../tfjs-backend-cpu/src/kernels/LogicalNot.ts","../../../../tfjs-backend-cpu/src/kernels/LogicalOr.ts","../../../../tfjs-backend-cpu/src/kernels/LRN.ts","../../../../tfjs-backend-cpu/src/kernels/LRNGrad.ts","../../../../tfjs-backend-cpu/src/kernels/Max.ts","../../../../tfjs-backend-cpu/src/kernels/MaxPool.ts","../../../../tfjs-backend-cpu/src/kernels/MaxPool3D.ts","../../../../tfjs-backend-cpu/src/kernels/MaxPool3DGrad.ts","../../../../tfjs-backend-cpu/src/kernels/MaxPoolGrad.ts","../../../../tfjs-backend-cpu/src/kernels/MaxPoolWithArgmax.ts","../../../../tfjs-backend-cpu/src/kernels/MaxPoolWithArgmax_impl.ts","../../../../tfjs-backend-cpu/src/kernels/Mean.ts","../../../../tfjs-backend-cpu/src/kernels/Min.ts","../../../../tfjs-backend-cpu/src/kernels/MirrorPad.ts","../../../../tfjs-backend-cpu/src/kernels/Mod.ts","../../../../tfjs-backend-cpu/src/kernels/Softmax.ts","../../../../tfjs-backend-cpu/src/kernels/Multinomial.ts","../../../../tfjs-backend-cpu/src/kernels/NonMaxSuppressionV3.ts","../../../../tfjs-backend-cpu/src/kernels/NonMaxSuppressionV4.ts","../../../../tfjs-backend-cpu/src/kernels/NonMaxSuppressionV5.ts","../../../../tfjs-backend-cpu/src/kernels/OneHot.ts","../../../../tfjs-backend-cpu/src/kernels/ZerosLike.ts","../../../../tfjs-backend-cpu/src/kernels/OnesLike.ts","../../../../tfjs-backend-cpu/src/kernels/Pack.ts","../../../../tfjs-backend-cpu/src/kernels/PadV2.ts","../../../../tfjs-backend-cpu/src/kernels/Pow.ts","../../../../tfjs-backend-cpu/src/kernels/RaggedGather.ts","../../../../tfjs-backend-cpu/src/kernels/RaggedTensorToTensor.ts","../../../../tfjs-backend-cpu/src/kernels/Range.ts","../../../../tfjs-backend-cpu/src/kernels/Reciprocal.ts","../../../../tfjs-backend-cpu/src/kernels/ResizeBilinear.ts","../../../../tfjs-backend-cpu/src/kernels/ResizeBilinearGrad.ts","../../../../tfjs-backend-cpu/src/kernels/ResizeNearestNeighbor.ts","../../../../tfjs-backend-cpu/src/kernels/ResizeNearestNeighborGrad.ts","../../../../tfjs-backend-cpu/src/kernels/Reverse.ts","../../../../tfjs-backend-cpu/src/kernels/RotateWithOffset.ts","../../../../tfjs-backend-cpu/src/kernels/Round.ts","../../../../tfjs-backend-cpu/src/kernels/ScatterNd.ts","../../../../tfjs-backend-cpu/src/kernels/SearchSorted_impl.ts","../../../../tfjs-backend-cpu/src/kernels/SearchSorted.ts","../../../../tfjs-backend-cpu/src/kernels/Select.ts","../../../../tfjs-backend-cpu/src/kernels/Selu.ts","../../../../tfjs-backend-cpu/src/kernels/Sign.ts","../../../../tfjs-backend-cpu/src/kernels/Sin.ts","../../../../tfjs-backend-cpu/src/kernels/Sinh.ts","../../../../tfjs-backend-cpu/src/kernels/Softplus.ts","../../../../tfjs-backend-cpu/src/kernels/SpaceToBatchND.ts","../../../../tfjs-backend-cpu/src/kernels/SparseFillEmptyRows.ts","../../../../tfjs-backend-cpu/src/kernels/SparseReshape.ts","../../../../tfjs-backend-cpu/src/kernels/SparseSegmentMean.ts","../../../../tfjs-backend-cpu/src/kernels/SparseSegmentSum.ts","../../../../tfjs-backend-cpu/src/kernels/SparseToDense.ts","../../../../tfjs-backend-cpu/src/kernels/SplitV.ts","../../../../tfjs-backend-cpu/src/kernels/Square.ts","../../../../tfjs-backend-cpu/src/kernels/Step.ts","../../../../tfjs-backend-cpu/src/kernels/StridedSlice.ts","../../../../tfjs-backend-cpu/src/kernels/StringNGrams.ts","../../../../tfjs-backend-cpu/src/kernels/StringSplit.ts","../../../../tfjs-backend-cpu/src/kernels/StringToHashBucketFast.ts","../../../../tfjs-backend-cpu/src/kernels/Tan.ts","../../../../tfjs-backend-cpu/src/kernels/Tanh.ts","../../../../tfjs-backend-cpu/src/kernels/Tile.ts","../../../../tfjs-backend-cpu/src/kernels/TopK.ts","../../../../tfjs-backend-cpu/src/kernels/Transform.ts","../../../../tfjs-backend-cpu/src/kernels/Unique.ts","../../../../tfjs-backend-cpu/src/kernels/Unpack.ts","../../../../tfjs-backend-cpu/src/kernels/UnsortedSegmentSum.ts","../../../../tfjs-backend-cpu/src/register_all_kernels.ts","../../../../tfjs-backend-cpu/src/version.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {TensorInfo, util} from '@tensorflow/tfjs-core';\n\nexport function assertNotComplex(\n    tensor: TensorInfo|TensorInfo[], opName: string): void {\n  if (!Array.isArray(tensor)) {\n    tensor = [tensor];\n  }\n  tensor.forEach(t => {\n    if (t != null) {\n      util.assert(\n          t.dtype !== 'complex64',\n          () => `${\n              opName} does not support complex64 tensors in the CPU backend.`);\n    }\n  });\n}\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, BackendTimingInfo, buffer, DataStorage, DataType, engine, env, kernel_impls, KernelBackend, Rank, ShapeMap, Tensor, Tensor2D, TensorBuffer, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nconst whereImpl = kernel_impls.whereImpl;\nimport {assertNotComplex} from './cpu_util';\n\ninterface DataId {}\n\nexport interface TensorData<D extends DataType> {\n  values?: backend_util.BackendValues;\n  dtype: D;\n  // For complex numbers, the real and imaginary parts are stored as their own\n  // individual tensors, with a parent joining the two with the\n  // complexTensorInfos field.\n  complexTensorInfos?: {real: TensorInfo, imag: TensorInfo};\n  // refCount keeps track of how many tensors reference it. Used for memory\n  // management.\n  refCount: number;\n}\n\nexport class MathBackendCPU extends KernelBackend {\n  public blockSize = 48;\n\n  data: DataStorage<TensorData<DataType>>;\n  private firstUse = true;\n  private static nextDataId = 0;\n  private nextDataId(): number {\n    return MathBackendCPU.nextDataId++;\n  }\n\n  constructor() {\n    super();\n    this.data = new DataStorage(this, engine());\n  }\n\n  write(values: backend_util.BackendValues, shape: number[], dtype: DataType):\n      DataId {\n    if (this.firstUse) {\n      this.firstUse = false;\n      if (env().get('IS_NODE')) {\n        backend_util.warn(\n            '\\n============================\\n' +\n            'Hi, looks like you are running TensorFlow.js in ' +\n            'Node.js. To speed things up dramatically, install our node ' +\n            'backend, visit https://github.com/tensorflow/tfjs-node for more details. ' +\n            '\\n============================');\n      }\n    }\n    const dataId = {id: this.nextDataId()};\n\n    this.data.set(dataId, {values, dtype, refCount: 1});\n\n    return dataId;\n  }\n\n  /**\n   * Create a data bucket in cpu backend.\n   * @param shape Shape of the `TensorInfo`.\n   * @param dtype DType of the `TensorInfo`.\n   * @param values The value of the `TensorInfo` stored as a flattened array.\n   */\n  makeTensorInfo(\n      shape: number[], dtype: DataType,\n      values?: backend_util.BackendValues|string[]): TensorInfo {\n    let outId;\n    if (dtype === 'string' && values != null && values.length > 0 &&\n        util.isString(values[0])) {\n      const encodedValues =\n          (values as {} as string[]).map(d => util.encodeString(d));\n\n      outId = this.write(encodedValues, shape, dtype);\n    } else {\n      outId = this.write(values as TypedArray, shape, dtype);\n    }\n\n    return {dataId: outId, shape, dtype};\n  }\n\n  /** Return refCount of a `TensorData`. */\n  refCount(dataId: DataId): number {\n    if (this.data.has(dataId)) {\n      const tensorData = this.data.get(dataId);\n      return tensorData.refCount;\n    }\n    return 0;\n  }\n\n  /** Increase refCount of a `TensorData`. */\n  incRef(dataId: DataId): void {\n    const tensorData = this.data.get(dataId);\n    tensorData.refCount++;\n  }\n\n  /** Decrease refCount of a `TensorData`. */\n  decRef(dataId: DataId): void {\n    if (this.data.has(dataId)) {\n      const tensorData = this.data.get(dataId);\n      tensorData.refCount--;\n    }\n  }\n\n  move(\n      dataId: DataId, values: backend_util.BackendValues, shape: number[],\n      dtype: DataType, refCount: number): void {\n    this.data.set(dataId, {values, dtype, refCount});\n  }\n\n  numDataIds(): number {\n    return this.data.numDataIds();\n  }\n\n  async read(dataId: DataId): Promise<backend_util.BackendValues> {\n    return this.readSync(dataId);\n  }\n  readSync(dataId: DataId): backend_util.BackendValues {\n    const {dtype, complexTensorInfos} = this.data.get(dataId);\n\n    if (dtype === 'complex64') {\n      const realValues =\n          this.readSync(complexTensorInfos.real.dataId) as Float32Array;\n      const imagValues =\n          this.readSync(complexTensorInfos.imag.dataId) as Float32Array;\n      return backend_util.mergeRealAndImagArrays(realValues, imagValues);\n    }\n\n    return this.data.get(dataId).values;\n  }\n\n  bufferSync<R extends Rank, D extends DataType>(t: TensorInfo):\n      TensorBuffer<R, D> {\n    const data = this.readSync(t.dataId);\n    if (t.dtype === 'string') {\n      try {\n        // Decode the bytes into string.\n        const strings = (data as Uint8Array[]).map(d => util.decodeString(d));\n        return buffer(t.shape as ShapeMap[R], t.dtype, strings) as\n            TensorBuffer<R, D>;\n      } catch {\n        throw new Error('Failed to decode encoded string bytes into utf-8');\n      }\n    }\n    return buffer(t.shape as ShapeMap[R], t.dtype, data as TypedArray) as\n        TensorBuffer<R, D>;\n  }\n\n  makeOutput<T extends Tensor>(\n      values: backend_util.BackendValues, shape: number[], dtype: DataType): T {\n    return engine().makeTensorFromTensorInfo(\n               this.makeTensorInfo(shape, dtype, values), this) as T;\n  }\n\n  /**\n   * Dispose the memory if the dataId has 0 refCount. Return true if the memory\n   * is released or memory is not managed in this backend, false if memory is\n   * not cleared.\n   * @param dataId\n   * @oaram force Optional, remove the data regardless of refCount\n   */\n  disposeData(dataId: DataId, force = false): boolean {\n    if (this.data.has(dataId)) {\n      this.data.get(dataId).refCount--;\n      if (!force && this.data.get(dataId).refCount > 0) {\n        return false;\n      }\n\n      const {complexTensorInfos} = this.data.get(dataId);\n\n      if (complexTensorInfos != null) {\n        this.disposeData(complexTensorInfos.real.dataId, true);\n        this.disposeData(complexTensorInfos.imag.dataId, true);\n      }\n\n      this.data.delete(dataId);\n    }\n    return true;\n  }\n\n  disposeIntermediateTensorInfo(tensorInfo: TensorInfo): void {\n    this.disposeData(tensorInfo.dataId);\n  }\n\n  async time(f: () => void): Promise<BackendTimingInfo> {\n    const start = util.now();\n    f();\n    const kernelMs = util.now() - start;\n    return {kernelMs};\n  }\n\n  memory() {\n    return {\n      // Unreliable due to automatic gc. The numbers above are cumulative.\n      unreliable: true,\n      reasons:\n          ['The reported memory is an upper bound. Due to automatic garbage ' +\n           'collection, the true allocated memory may be less.']\n    };\n  }\n\n  where(condition: Tensor): Tensor2D {\n    assertNotComplex([condition], 'where');\n\n    const condVals = this.readSync(condition.dataId) as TypedArray;\n    return whereImpl(condition.shape, condVals);\n  }\n\n  dispose() {}\n\n  floatPrecision(): 16|32 {\n    return 32;\n  }\n\n  /** Returns the smallest representable number.  */\n  epsilon(): number {\n    return super.epsilon();\n  }\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Abs, AbsInputs, KernelConfig, KernelFunc, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function simpleAbsImpl(vals: TypedArray): Float32Array {\n  const resultValues = new Float32Array(vals.length);\n  for (let i = 0; i < vals.length; ++i) {\n    resultValues[i] = Math.abs(vals[i]);\n  }\n  return resultValues;\n}\n\nexport const abs = (args: {inputs: AbsInputs, backend: MathBackendCPU}) => {\n  const {x} = args.inputs;\n  const cpuBackend = args.backend;\n\n  assertNotComplex(x, 'abs');\n\n  let resultValues = new Float32Array(util.sizeFromShape(x.shape));\n  const values = cpuBackend.data.get(x.dataId).values as TypedArray;\n  resultValues = simpleAbsImpl(values);\n\n  return cpuBackend.makeOutput(resultValues, x.shape, x.dtype);\n};\n\nexport const absConfig: KernelConfig = {\n  kernelName: Abs,\n  backendName: 'cpu',\n  kernelFunc: abs as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, DataType, DataValues, NumericDataType, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {SimpleBinaryKernelImpl, SimpleBinaryOperation} from './binary_types';\n\n/**\n * Template that creates implementation for binary ops. Supports broadcast.\n */\nexport function createSimpleBinaryKernelImpl(op: SimpleBinaryOperation):\n    SimpleBinaryKernelImpl {\n  return (aShape: number[], bShape: number[], aVals: DataValues,\n          bVals: DataValues, dtype: DataType): [TypedArray, number[]] => {\n    const newShape = backend_util.assertAndGetBroadcastShape(aShape, bShape);\n\n    const resultRank = newShape.length;\n    const resultStrides = util.computeStrides(newShape);\n    const resultSize = util.sizeFromShape(newShape);\n\n    const result =\n        util.getTypedArrayFromDType(dtype as NumericDataType, resultSize);\n\n    const aRank = aShape.length;\n    const bRank = bShape.length;\n\n    const aStrides = util.computeStrides(aShape);\n    const bStrides = util.computeStrides(bShape);\n\n    const aBroadcastDims = backend_util.getBroadcastDims(aShape, newShape);\n    const bBroadcastDims = backend_util.getBroadcastDims(bShape, newShape);\n\n    if (aBroadcastDims.length + bBroadcastDims.length === 0) {\n      for (let i = 0; i < result.length; ++i) {\n        result[i] = op(aVals[i % aVals.length], bVals[i % bVals.length]);\n      }\n    } else {\n      for (let i = 0; i < result.length; ++i) {\n        const loc = util.indexToLoc(i, resultRank, resultStrides);\n\n        const aLoc = loc.slice(-aRank);\n        aBroadcastDims.forEach(d => aLoc[d] = 0);\n        const aIndex = util.locToIndex(aLoc, aRank, aStrides);\n\n        const bLoc = loc.slice(-bRank);\n        bBroadcastDims.forEach(d => bLoc[d] = 0);\n        const bIndex = util.locToIndex(bLoc, bRank, bStrides);\n\n        result[i] = op(aVals[aIndex], bVals[bIndex]);\n      }\n    }\n\n    return [result, newShape];\n  };\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Complex, ComplexInputs, KernelConfig, KernelFunc, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport function complex(args: {inputs: ComplexInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {real, imag} = inputs;\n\n  const realVals = backend.data.get(real.dataId).values as TypedArray;\n  const imagVals = backend.data.get(imag.dataId).values as TypedArray;\n\n  const complexInfo = backend.makeTensorInfo(real.shape, 'complex64');\n\n  const complex = backend.data.get(complexInfo.dataId);\n\n  // The complex tensor owns the underlying real and imag tensorInfos, only the\n  // complex tensor tracks refCount, when complexData is disposed the\n  // underlying tensorData will be disposed.\n  complex.complexTensorInfos = {\n    real: backend.makeTensorInfo(real.shape, 'float32', realVals),\n    imag: backend.makeTensorInfo(imag.shape, 'float32', imagVals)\n  };\n\n  return complexInfo;\n}\n\nexport const complexConfig: KernelConfig = {\n  kernelName: Complex,\n  backendName: 'cpu',\n  kernelFunc: complex as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {DataType, TensorInfo, util} from '@tensorflow/tfjs-core';\nimport {MathBackendCPU} from '../backend_cpu';\nimport {complex} from '../kernels/Complex';\n\n/**\n * Generates a tensorInfo with all zeros value.\n * @param backend cpu backend.\n * @param shape Shape for the zeros tensor.\n * @param dtype Optional. If set, the result has this dtype.\n */\nexport function zeros(\n    backend: MathBackendCPU, shape: number[],\n    dtype: DataType = 'float32'): TensorInfo {\n  if (dtype === 'complex64') {\n    const real = zeros(backend, shape, 'float32');\n    const imag = zeros(backend, shape, 'float32');\n\n    return complex({inputs: {real, imag}, backend});\n  }\n\n  const values = util.makeZerosTypedArray(util.sizeFromShape(shape), dtype);\n\n  return backend.makeTensorInfo(shape, dtype, values);\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Identity, IdentityInputs, KernelConfig, KernelFunc, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport function identity(\n    args: {inputs: IdentityInputs, backend: MathBackendCPU}): TensorInfo {\n  const {inputs, backend} = args;\n  const {x} = inputs;\n\n  backend.incRef(x.dataId);\n\n  return {dataId: x.dataId, shape: x.shape, dtype: x.dtype};\n}\n\nexport const identityConfig: KernelConfig = {\n  kernelName: Identity,\n  backendName: 'cpu',\n  kernelFunc: identity as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, Real, RealInputs, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport function real(args: {inputs: RealInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {input} = inputs;\n\n  const real = backend.data.get(input.dataId).complexTensorInfos.real;\n  const realVal = backend.data.get(real.dataId).values;\n\n  // When complex tensor is disposed, its underlying parts will be disposed too.\n  // Make new tensor out of the real value of the complex. This makes sure the\n  // value is still accessible even if complex tensor is disposed.\n  return backend.makeTensorInfo(real.shape, real.dtype, realVal);\n}\n\nexport const realConfig: KernelConfig = {\n  kernelName: Real,\n  backendName: 'cpu',\n  kernelFunc: real as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport {Cast, CastAttrs, CastInputs, DataType, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {zeros} from '../utils/zeros_impl';\n\nimport {complex} from './Complex';\nimport {identity} from './Identity';\nimport {real} from './Real';\n\nexport function castImpl(\n    values: TypedArray, shape: number[], inputType: DataType,\n    dtype: DataType): [number[], DataType, TypedArray] {\n  if (dtype === 'int32') {\n    const resultValues = Int32Array.from(values);\n    return [shape, 'int32', resultValues];\n  }\n\n  if (dtype === 'bool') {\n    // This is essentially the result of notEqual(x, 0). We avoid using\n    // kernel notEqual to avoid circular dependency, i.e. binary_utils ->\n    // cast -> notEqual -> binary_utils.\n    const zero = util.toTypedArray([0], inputType);\n\n    const [resultData, resultShape] = createSimpleBinaryKernelImpl(\n        (a, b) => (a !== b) ? 1 : 0)(shape, [], values, zero, 'bool');\n\n    return [resultShape, 'bool', resultData];\n  }\n  throw new Error(`Error in Cast: failed to cast ${inputType} to ${dtype}`);\n}\n\nexport function cast(\n    args: {inputs: CastInputs, backend: MathBackendCPU, attrs: CastAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {dtype} = attrs;\n\n  // Casting to complex64.\n  if (dtype === 'complex64') {\n    if (x.dtype === 'complex64') {\n      return identity({inputs: {x}, backend});\n    }\n\n    const zerosTensorInfo = zeros(backend, x.shape, x.dtype);\n    const floatX = cast({inputs: {x}, backend, attrs: {dtype: 'float32'}});\n\n    const result =\n        complex({inputs: {real: floatX, imag: zerosTensorInfo}, backend});\n\n    backend.disposeIntermediateTensorInfo(zerosTensorInfo);\n    backend.disposeIntermediateTensorInfo(floatX);\n\n    return result;\n  }\n\n  // Casting from complex64\n  if (x.dtype === 'complex64') {\n    const realPart = real({inputs: {input: x}, backend});\n    const result = cast({inputs: {x: realPart}, backend, attrs: {dtype}});\n\n    backend.disposeIntermediateTensorInfo(realPart);\n\n    return result;\n  }\n\n  if (!util.hasEncodingLoss(x.dtype, dtype)) {\n    // We don't change the underlying data, since we cast to higher\n    // precision.\n    const result = identity({inputs: {x}, backend});\n    return {dataId: result.dataId, shape: result.shape, dtype};\n  }\n\n  const values = backend.data.get(x.dataId).values as TypedArray;\n  const [resultShape, resultType, resultData] =\n      castImpl(values, x.shape, x.dtype, dtype);\n  return backend.makeTensorInfo(resultShape, resultType, resultData);\n}\n\nexport const castConfig: KernelConfig = {\n  kernelName: Cast,\n  backendName: 'cpu',\n  kernelFunc: cast as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, BinaryInputs, DataType, KernelFunc, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {cast} from '../kernels/Cast';\nimport {complex} from '../kernels/Complex';\n\nimport {ComplexBinaryKernelImpl, ComplexBinaryOperation, SimpleBinaryKernelImpl} from './binary_types';\n\n/**\n * Template that creates a `KernelFunc` for binary ops.\n * @param name Kernel name.\n * @param binaryKernelImpl A `SimpleBinaryKernelImpl` for the kernel.\n * @param binaryKernelComplexImpl Optional. If exists, represents a\n *     `ComplexBinaryKernelImpl` for the kernel, will be used when input dtype\n *     is `complex64`.\n * @param dtype Optional. If set, the result has this dtype. Otherwise, the\n *     result has the same dtype as the first input. This is mainly used in\n *     comparison kernels, such as Equal, Less, Greater, etc.\n */\nexport function binaryKernelFunc(\n    name: string, simpleImpl: SimpleBinaryKernelImpl,\n    complexImpl?: ComplexBinaryKernelImpl, dtype?: DataType): KernelFunc {\n  if (complexImpl == null) {\n    return ({inputs, backend}) => {\n      const {a, b} = inputs as BinaryInputs;\n      const cpuBackend = backend as MathBackendCPU;\n\n      assertNotComplex([a, b], name);\n\n      const aVals = cpuBackend.data.get(a.dataId).values as TypedArray;\n      const bVals = cpuBackend.data.get(b.dataId).values as TypedArray;\n\n      const decodedAVals = a.dtype === 'string' ?\n          // tslint:disable-next-line: no-any\n          backend_util.fromUint8ToStringArray(aVals as any as Uint8Array[]) :\n          aVals;\n      const decodedBVals = a.dtype === 'string' ?\n          // tslint:disable-next-line: no-any\n          backend_util.fromUint8ToStringArray(bVals as any as Uint8Array[]) :\n          bVals;\n      const $dtype = dtype || a.dtype;\n\n      const [resultData, resultShape] =\n          simpleImpl(a.shape, b.shape, decodedAVals, decodedBVals, $dtype);\n\n      return cpuBackend.makeTensorInfo(resultShape, $dtype, resultData);\n    };\n  }\n\n  return ({inputs, backend}) => {\n    const {a, b} = inputs as BinaryInputs;\n    const cpuBackend = backend as MathBackendCPU;\n\n    if (a.dtype === 'complex64' || b.dtype === 'complex64') {\n      const $aComplex = cast(\n          {inputs: {x: a}, backend: cpuBackend, attrs: {dtype: 'complex64'}});\n\n      const $aComplexVals = cpuBackend.data.get($aComplex.dataId);\n\n      const aReal = $aComplexVals.complexTensorInfos.real;\n      const aImag = $aComplexVals.complexTensorInfos.imag;\n\n      const aRealVals =\n          cpuBackend.data.get(aReal.dataId).values as Float32Array;\n      const aImagVals =\n          cpuBackend.data.get(aImag.dataId).values as Float32Array;\n\n      const $bComplex = cast(\n          {inputs: {x: b}, backend: cpuBackend, attrs: {dtype: 'complex64'}});\n\n      const $bComplexVals = cpuBackend.data.get($bComplex.dataId);\n\n      const bReal = $bComplexVals.complexTensorInfos.real;\n      const bImag = $bComplexVals.complexTensorInfos.imag;\n\n      const bRealVals =\n          cpuBackend.data.get(bReal.dataId).values as Float32Array;\n      const bImagVals =\n          cpuBackend.data.get(bImag.dataId).values as Float32Array;\n\n      const [resultRealData, resultImagData, resultShape] = complexImpl(\n          a.shape, b.shape, aRealVals, aImagVals, bRealVals, bImagVals);\n\n      const resultReal =\n          cpuBackend.makeTensorInfo(resultShape, 'float32', resultRealData);\n\n      const resultImag =\n          cpuBackend.makeTensorInfo(resultShape, 'float32', resultImagData);\n\n      const result = complex(\n          {inputs: {real: resultReal, imag: resultImag}, backend: cpuBackend});\n\n      cpuBackend.disposeIntermediateTensorInfo($aComplex);\n      cpuBackend.disposeIntermediateTensorInfo($bComplex);\n      cpuBackend.disposeIntermediateTensorInfo(resultReal);\n      cpuBackend.disposeIntermediateTensorInfo(resultImag);\n\n      return result;\n    } else {\n      const aVals = cpuBackend.data.get(a.dataId).values as TypedArray;\n      const bVals = cpuBackend.data.get(b.dataId).values as TypedArray;\n\n      const $dtype = dtype || a.dtype;\n\n      const [resultData, resultShape] =\n          simpleImpl(a.shape, b.shape, aVals, bVals, $dtype);\n\n      return cpuBackend.makeTensorInfo(resultShape, $dtype, resultData);\n    }\n  };\n}\n\n/**\n * Template that creates the complex type implementation for binary ops.\n * Supports broadcast.\n */\nexport function createComplexBinaryKernelImpl(op: ComplexBinaryOperation):\n    ComplexBinaryKernelImpl {\n  return (aShape: number[], bShape: number[], aRealVals: Float32Array,\n          aImagVals: Float32Array, bRealVals: Float32Array,\n          bImagVals: Float32Array): [TypedArray, TypedArray, number[]] => {\n    const resultShape = backend_util.assertAndGetBroadcastShape(aShape, bShape);\n    const resultSize = util.sizeFromShape(resultShape);\n    const resultRank = resultShape.length;\n    const resultStrides = util.computeStrides(resultShape);\n\n    const resultRealVals = util.getTypedArrayFromDType('float32', resultSize);\n    const resultImagVals = util.getTypedArrayFromDType('float32', resultSize);\n\n    const aBroadcastDims = backend_util.getBroadcastDims(aShape, resultShape);\n    const bBroadcastDims = backend_util.getBroadcastDims(bShape, resultShape);\n\n    const aVals = backend_util.mergeRealAndImagArrays(aRealVals, aImagVals);\n    const bVals = backend_util.mergeRealAndImagArrays(bRealVals, bImagVals);\n\n    const aRank = aShape.length;\n    const aStrides = util.computeStrides(aShape);\n\n    const bRank = bShape.length;\n    const bStrides = util.computeStrides(bShape);\n\n    if (aBroadcastDims.length + bBroadcastDims.length === 0) {\n      for (let i = 0; i < resultRealVals.length; i++) {\n        const aIdx = i % aVals.length;\n        const bIdx = i % bVals.length;\n\n        const result =\n            op(aVals[aIdx * 2], aVals[aIdx * 2 + 1], bVals[bIdx * 2],\n               bVals[bIdx * 2 + 1]);\n\n        resultRealVals[i] = result.real;\n        resultImagVals[i] = result.imag;\n      }\n    } else {\n      for (let i = 0; i < resultRealVals.length; i++) {\n        const loc = util.indexToLoc(i, resultRank, resultStrides);\n\n        const aLoc = loc.slice(-aRank);\n        aBroadcastDims.forEach(d => aLoc[d] = 0);\n        const aIndex = util.locToIndex(aLoc, aRank, aStrides);\n\n        const bLoc = loc.slice(-bRank);\n        bBroadcastDims.forEach(d => bLoc[d] = 0);\n        const bIndex = util.locToIndex(bLoc, bRank, bStrides);\n\n        const opResult =\n            op(aVals[aIndex * 2], aVals[aIndex * 2 + 1], bVals[bIndex * 2],\n               bVals[bIndex * 2 + 1]);\n\n        resultRealVals[i] = opResult.real;\n        resultImagVals[i] = opResult.imag;\n      }\n    }\n    return [resultRealVals, resultImagVals, resultShape];\n  };\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Add, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc, createComplexBinaryKernelImpl} from '../utils/binary_utils';\n\nexport const addImpl =\n    createSimpleBinaryKernelImpl(((a: number, b: number) => a + b));\nexport const addComplexImpl =\n    createComplexBinaryKernelImpl(((aReal, aImag, bReal, bImag) => {\n      return {real: aReal + bReal, imag: aImag + bImag};\n    }));\n\nexport const add = binaryKernelFunc(Add, addImpl, addComplexImpl);\n\nexport const addConfig: KernelConfig = {\n  kernelName: Add,\n  backendName: 'cpu',\n  kernelFunc: add\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {buffer, DataType, Rank, TensorBuffer, TypedArray, util} from '@tensorflow/tfjs-core';\n\nexport function bincountImpl(\n    xVals: TypedArray, weightsVals: TypedArray, weightsDtype: DataType,\n    weightsShape: number[], size: number): TypedArray {\n  const weightsSize = util.sizeFromShape(weightsShape);\n  const outVals = util.makeZerosTypedArray(size, weightsDtype) as TypedArray;\n\n  for (let i = 0; i < xVals.length; i++) {\n    const value = xVals[i];\n    if (value < 0) {\n      throw new Error('Input x must be non-negative!');\n    }\n\n    if (value >= size) {\n      continue;\n    }\n\n    if (weightsSize > 0) {\n      outVals[value] += weightsVals[i];\n    } else {\n      outVals[value] += 1;\n    }\n  }\n\n  return outVals;\n}\n\nexport function bincountReduceImpl<R extends Rank>(\n    xBuf: TensorBuffer<R>, weightsBuf: TensorBuffer<R>, size: number,\n    binaryOutput = false): TensorBuffer<R> {\n  const numRows = xBuf.shape[0];\n  const numCols = xBuf.shape[1];\n\n  const outBuf = buffer([numRows, size], weightsBuf.dtype);\n\n  for (let i = 0; i < numRows; i++) {\n    for (let j = 0; j < numCols; j++) {\n      const value = xBuf.get(i, j);\n      if (value < 0) {\n        throw new Error('Input x must be non-negative!');\n      }\n\n      if (value >= size) {\n        continue;\n      }\n\n      if (binaryOutput) {\n        outBuf.set(1, i, value);\n      } else {\n        if (weightsBuf.size > 0) {\n          outBuf.set(outBuf.get(i, value) + weightsBuf.get(i, j), i, value);\n        } else {\n          outBuf.set(outBuf.get(i, value) + 1, i, value);\n        }\n      }\n    }\n  }\n\n  return outBuf as TensorBuffer<R>;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {NumericDataType, util} from '@tensorflow/tfjs-core';\n\nimport {SimpleUnaryImpl, SimpleUnaryOperation} from './unary_types';\n\n/**\n * Template that creates implementation for unary op.\n */\nexport function createSimpleUnaryImpl(op: SimpleUnaryOperation):\n    SimpleUnaryImpl {\n  return (values, dtype, attrs) => {\n    const newValues =\n        util.getTypedArrayFromDType(dtype as NumericDataType, values.length);\n    for (let i = 0; i < values.length; ++i) {\n      newValues[i] = op(values[i], attrs);\n    }\n    return newValues;\n  };\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {DataType, KernelFunc, TypedArray, UnaryInputs, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nimport {SimpleUnaryImpl, SimpleUnaryOperation} from './unary_types';\n\n/**\n * Template that creates a `KernelFunc` for unary ops.\n * @param name Kernel name.\n * @param op A `SimpleUnaryOperation` for the kernel.\n * @param dtype Optional. If set, the result has this dtype. Otherwise, the\n *     result has the same dtype as the input. This is mainly used in certain\n *     kernels that return bool type, such as isFinite, isInf, etc.\n */\nexport function unaryKernelFunc(\n    name: string, op: SimpleUnaryOperation, dtype?: DataType): KernelFunc {\n  return ({inputs, attrs, backend}) => {\n    const {x} = inputs as UnaryInputs;\n    assertNotComplex(x, name);\n    if (x.dtype === 'string' || dtype === 'string') {\n      throw new Error('unaryKernelFunc does not support string input/output');\n    }\n\n    const cpuBackend = backend as MathBackendCPU;\n    const values = cpuBackend.data.get(x.dataId).values as TypedArray;\n    const xSize = util.sizeFromShape(x.shape);\n    const $dtype = dtype || x.dtype;\n    const newValues = util.getArrayFromDType($dtype, xSize);\n    for (let i = 0; i < xSize; ++i) {\n      newValues[i] = op(values[i], attrs);\n    }\n    return cpuBackend.makeTensorInfo(x.shape, $dtype, newValues);\n  };\n}\n\n/**\n * Template that creates a `KernelFunc` for unary ops from the given\n * `SimpleUnaryImpl`..\n * @param name Kernel name.\n * @param unaryImpl A `SimpleUnaryImpl` that implements the op.\n * @param dtype Optional. If set, the result has this dtype. Otherwise, the\n *     result has the same dtype as the input. This is mainly used in certain\n *     kernels that return bool type, such as isFinite, isInf, etc.\n */\nexport function unaryKernelFuncFromImpl(\n    name: string, unaryImpl: SimpleUnaryImpl, dtype?: DataType): KernelFunc {\n  return ({inputs, attrs, backend}) => {\n    const {x} = inputs as UnaryInputs;\n    assertNotComplex(x, name);\n    if (x.dtype === 'string' || dtype === 'string') {\n      throw new Error('unaryKernelFunc does not support string input/output');\n    }\n\n    const cpuBackend = backend as MathBackendCPU;\n    const values = cpuBackend.data.get(x.dataId).values as TypedArray;\n    const $dtype = dtype || x.dtype;\n    const newValues = unaryImpl(values, $dtype, attrs);\n    return cpuBackend.makeTensorInfo(x.shape, $dtype, newValues);\n  };\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Ceil, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {createSimpleUnaryImpl} from '../utils/unary_impl';\nimport {unaryKernelFuncFromImpl} from '../utils/unary_utils';\n\nexport const ceilImpl = createSimpleUnaryImpl((xi) => Math.ceil(xi));\nexport const ceil = unaryKernelFuncFromImpl(Ceil, ceilImpl);\n\nexport const ceilConfig: KernelConfig = {\n  kernelName: Ceil,\n  backendName: 'cpu',\n  kernelFunc: ceil,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, BackendValues, DataType, TypedArray, util} from '@tensorflow/tfjs-core';\n\nexport function concatImpl(\n    inputs: Array<{vals: BackendValues, shape: number[]}>, outShape: number[],\n    dtype: DataType, simplyConcat: boolean): TypedArray|string[] {\n  const outVals = util.getArrayFromDType(dtype, util.sizeFromShape(outShape));\n\n  if (simplyConcat && dtype !== 'string') {\n    // Use built-in TypedArray.set() method for speed.\n    let offset = 0;\n    inputs.forEach(input => {\n      const size = util.sizeFromShape(input.shape);\n\n      (outVals as TypedArray).set(input.vals as TypedArray, offset);\n      offset += size;\n    });\n  } else {\n    let colOffset = 0;\n\n    inputs.forEach(input => {\n      const decodedData = dtype === 'string' ?\n          backend_util.fromUint8ToStringArray(input.vals as Uint8Array[]) :\n          input.vals as TypedArray;\n\n      let tIdx = 0;\n\n      for (let row = 0; row < input.shape[0]; ++row) {\n        const resIdx = row * outShape[1] + colOffset;\n        for (let col = 0; col < input.shape[1]; ++col) {\n          outVals[resIdx + col] = decodedData[tIdx++];\n        }\n      }\n\n      colOffset += input.shape[1];\n    });\n  }\n\n  return outVals;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Equal, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const equalImpl =\n    createSimpleBinaryKernelImpl((a: number, b: number) => (a === b) ? 1 : 0);\nexport const equal =\n    binaryKernelFunc(Equal, equalImpl, null /* complexImpl */, 'bool');\n\nexport const equalConfig: KernelConfig = {\n  kernelName: Equal,\n  backendName: 'cpu',\n  kernelFunc: equal\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Exp, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {createSimpleUnaryImpl} from '../utils/unary_impl';\nimport {unaryKernelFuncFromImpl} from '../utils/unary_utils';\n\nexport const expImpl = createSimpleUnaryImpl((xi) => Math.exp(xi));\nexport const exp = unaryKernelFuncFromImpl(Exp, expImpl, 'float32');\n\nexport const expConfig: KernelConfig = {\n  kernelName: Exp,\n  backendName: 'cpu',\n  kernelFunc: exp,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Expm1, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {createSimpleUnaryImpl} from '../utils/unary_impl';\nimport {unaryKernelFuncFromImpl} from '../utils/unary_utils';\n\nexport const expm1Impl = createSimpleUnaryImpl((xi) => Math.expm1(xi));\nexport const expm1 = unaryKernelFuncFromImpl(Expm1, expm1Impl);\n\nexport const expm1Config: KernelConfig = {\n  kernelName: Expm1,\n  backendName: 'cpu',\n  kernelFunc: expm1,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Floor, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {createSimpleUnaryImpl} from '../utils/unary_impl';\nimport {unaryKernelFuncFromImpl} from '../utils/unary_utils';\n\nexport const floorImpl = createSimpleUnaryImpl((xi) => Math.floor(xi));\nexport const floor = unaryKernelFuncFromImpl(Floor, floorImpl);\n\nexport const floorConfig: KernelConfig = {\n  kernelName: Floor,\n  backendName: 'cpu',\n  kernelFunc: floor,\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {buffer, DataType, Rank, TensorBuffer, TypedArray} from '@tensorflow/tfjs-core';\n\nexport function gatherNdImpl<R extends Rank>(\n    indicesData: TypedArray, paramsBuf: TensorBuffer<R>, dtype: DataType,\n    numSlices: number, sliceRank: number, sliceSize: number, strides: number[],\n    paramsShape: number[], paramsSize: number): TensorBuffer<R> {\n  const outBuf = buffer([numSlices, sliceSize], dtype);\n\n  for (let i = 0; i < numSlices; i++) {\n    const index = [];\n    let flattenIndex = 0;\n    for (let j = 0; j < sliceRank; j++) {\n      const dim = indicesData[i * sliceRank + j];\n      flattenIndex += dim * strides[j];\n      index.push(dim);\n    }\n    if (flattenIndex < 0 || flattenIndex >= paramsSize / sliceSize) {\n      throw new Error(\n          `Invalid indices: ${index} does not index into ${paramsShape}`);\n    }\n\n    for (let k = 0; k < sliceSize; k++) {\n      outBuf.values[i * sliceSize + k] =\n          paramsBuf.get(...paramsBuf.indexToLoc(flattenIndex * sliceSize + k));\n    }\n  }\n\n  return outBuf as TensorBuffer<R>;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {buffer, DataType, Rank, TensorBuffer} from '@tensorflow/tfjs-core';\n\nexport function gatherV2Impl<R extends Rank, D extends DataType>(\n    xBuf: TensorBuffer<R, D>, indicesBuf: TensorBuffer<R, D>,\n    flattenOutputShape: number[]): TensorBuffer<R, D> {\n  const outBuf = buffer(flattenOutputShape, xBuf.dtype);\n  for (let i = 0; i < outBuf.size; ++i) {\n    const newLoc = outBuf.indexToLoc(i);\n\n    const originalLoc: number[] = newLoc.slice();\n    const batchIdx = originalLoc[0];\n    const indicesIdx = originalLoc[2];\n    const indicesIndex = indicesBuf.locToIndex([batchIdx, indicesIdx]);\n    originalLoc[2] = indicesBuf.values[indicesIndex] as number;\n\n    const originalIndex = xBuf.locToIndex(originalLoc);\n\n    if (0 <= originalIndex && originalIndex < xBuf.values.length) {\n      outBuf.values[i] = xBuf.values[originalIndex];\n    } // Else, index is out of bounds, so leave the default zero val in outBuf.\n  }\n\n  return outBuf as TensorBuffer<R, D>;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Greater, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const greaterImpl =\n    createSimpleBinaryKernelImpl((a: number, b: number) => (a > b) ? 1 : 0);\nexport const greater =\n    binaryKernelFunc(Greater, greaterImpl, null /* complexImpl */, 'bool');\n\nexport const greaterConfig: KernelConfig = {\n  kernelName: Greater,\n  backendName: 'cpu',\n  kernelFunc: greater\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {GreaterEqual, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const greaterEqualImpl =\n    createSimpleBinaryKernelImpl((a: number, b: number) => (a >= b) ? 1 : 0);\nexport const greaterEqual = binaryKernelFunc(\n    GreaterEqual, greaterEqualImpl, null /* complexImpl */, 'bool');\n\nexport const greaterEqualConfig: KernelConfig = {\n  kernelName: GreaterEqual,\n  backendName: 'cpu',\n  kernelFunc: greaterEqual\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Less} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const lessImpl =\n    createSimpleBinaryKernelImpl((a: number, b: number) => (a < b) ? 1 : 0);\nexport const less =\n    binaryKernelFunc(Less, lessImpl, null /* complexImpl */, 'bool');\n\nexport const lessConfig: KernelConfig = {\n  kernelName: Less,\n  backendName: 'cpu',\n  kernelFunc: less\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, LessEqual} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const lessEqualImpl =\n    createSimpleBinaryKernelImpl((a: number, b: number) => (a <= b) ? 1 : 0);\nexport const lessEqual =\n    binaryKernelFunc(LessEqual, lessEqualImpl, null /* complexImpl */, 'bool');\n\nexport const lessEqualConfig: KernelConfig = {\n  kernelName: LessEqual,\n  backendName: 'cpu',\n  kernelFunc: lessEqual\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {TypedArray, util} from '@tensorflow/tfjs-core';\n\nexport function linSpaceImpl(\n    start: number, stop: number, num: number): TypedArray {\n  const step = (stop - start) / (num - 1);\n\n  const values = util.makeZerosTypedArray(num, 'float32');\n  values[0] = start;\n  for (let i = 1; i < values.length; i++) {\n    values[i] = values[i - 1] + step;\n  }\n\n  return values;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Log} from '@tensorflow/tfjs-core';\n\nimport {createSimpleUnaryImpl} from '../utils/unary_impl';\nimport {unaryKernelFuncFromImpl} from '../utils/unary_utils';\n\nexport const logImpl = createSimpleUnaryImpl((xi) => Math.log(xi));\nexport const log = unaryKernelFuncFromImpl(Log, logImpl);\n\nexport const logConfig: KernelConfig = {\n  kernelName: Log,\n  backendName: 'cpu',\n  kernelFunc: log,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {DataType, NumericDataType, TypedArray, util} from '@tensorflow/tfjs-core';\n\nexport function maxImpl(\n    aVals: TypedArray, reduceSize: number, outShape: number[],\n    dtype: DataType): TypedArray {\n  const vals = util.getTypedArrayFromDType(\n      dtype as NumericDataType, util.sizeFromShape(outShape));\n\n  for (let i = 0; i < vals.length; ++i) {\n    const offset = i * reduceSize;\n    let max = aVals[offset];\n    for (let j = 0; j < reduceSize; ++j) {\n      const value = aVals[offset + j];\n      if (Number.isNaN(value) ||\n          value > max) {  // comparison with NaN always return false\n        max = value;\n      }\n    }\n    vals[i] = max;\n  }\n  return vals;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Maximum} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const maximumImpl = createSimpleBinaryKernelImpl(\n    ((aValue, bValue) => Math.max(aValue as number, bValue as number)));\nexport const maximum = binaryKernelFunc(Maximum, maximumImpl);\n\nexport const maximumConfig: KernelConfig = {\n  kernelName: Maximum,\n  backendName: 'cpu',\n  kernelFunc: maximum\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Minimum} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const minimumImpl = createSimpleBinaryKernelImpl(\n    ((aValue, bValue) => Math.min(aValue as number, bValue as number)));\nexport const minimum = binaryKernelFunc(Minimum, minimumImpl);\n\nexport const minimumConfig: KernelConfig = {\n  kernelName: Minimum,\n  backendName: 'cpu',\n  kernelFunc: minimum\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Multiply} from '@tensorflow/tfjs-core';\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc, createComplexBinaryKernelImpl} from '../utils/binary_utils';\n\nexport const multiplyImpl = createSimpleBinaryKernelImpl(\n    ((aValue: number, bValue: number) => aValue * bValue));\nexport const multiplyComplexImpl =\n    createComplexBinaryKernelImpl(((aReal, aImag, bReal, bImag) => {\n      return {\n        real: aReal * bReal - aImag * bImag,\n        imag: aReal * bImag + aImag * bReal\n      };\n    }));\n\nexport const multiply =\n    binaryKernelFunc(Multiply, multiplyImpl, multiplyComplexImpl);\n\nexport const multiplyConfig: KernelConfig = {\n  kernelName: Multiply,\n  backendName: 'cpu',\n  kernelFunc: multiply\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {DataType, KernelConfig, KernelFunc, Neg, TensorInfo, TypedArray, UnaryInputs, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {multiplyImpl} from './Multiply';\n\nexport function negImpl(xVals: TypedArray, xShape: number[], xDtype: DataType):\n    [TypedArray, number[]] {\n  const minusOne =\n      util.createScalarValue(-1 as {} as 'float32', xDtype) as TypedArray;\n  return multiplyImpl([], xShape, minusOne, xVals, xDtype);\n}\n\nexport function neg(args: {inputs: UnaryInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {x} = inputs;\n\n  assertNotComplex(x, 'neg');\n\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const [res, newShape] = negImpl(xVals, x.shape, x.dtype);\n\n  return backend.makeTensorInfo(newShape, x.dtype, res);\n}\n\nexport const negConfig: KernelConfig = {\n  kernelName: Neg,\n  backendName: 'cpu',\n  kernelFunc: neg as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, NotEqual} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const notEqualImpl =\n    createSimpleBinaryKernelImpl(((a, b) => (a !== b) ? 1 : 0));\nexport const notEqual =\n    binaryKernelFunc(NotEqual, notEqualImpl, null /* complexOp */, 'bool');\n\nexport const notEqualConfig: KernelConfig = {\n  kernelName: NotEqual,\n  backendName: 'cpu',\n  kernelFunc: notEqual\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {DataType, NumericDataType, TypedArray} from '@tensorflow/tfjs-core';\nimport {util} from '@tensorflow/tfjs-core';\n\nexport function transposeImpl(\n    xVals: TypedArray, xShape: number[], dtype: DataType, perm: number[],\n    newShape: number[]): TypedArray {\n  const xRank = xShape.length;\n  const xSize = util.sizeFromShape(xShape);\n  const xStrides = util.computeStrides(xShape);\n  const newStrides = util.computeStrides(newShape);\n\n  const result = util.getTypedArrayFromDType(\n      dtype as NumericDataType, util.sizeFromShape(newShape));\n\n  for (let i = 0; i < xSize; ++i) {\n    const loc = util.indexToLoc(i, xRank, xStrides);\n\n    // Permute location.\n    const newLoc: number[] = new Array(loc.length);\n    for (let i = 0; i < newLoc.length; i++) {\n      newLoc[i] = loc[perm[i]];\n    }\n\n    const newIndex = util.locToIndex(newLoc, xRank, newStrides);\n    result[newIndex] = xVals[i];\n  }\n  return result;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, TensorInfo, Transpose, TransposeAttrs, TransposeInputs, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nimport {transposeImpl} from './Transpose_impl';\n\nexport function transpose(args: {\n  inputs: TransposeInputs,\n  attrs: TransposeAttrs,\n  backend: MathBackendCPU\n}): TensorInfo {\n  const {inputs, attrs, backend} = args;\n  const {x} = inputs;\n  const {perm} = attrs;\n\n  assertNotComplex(x, 'transpose');\n\n  const xRank = x.shape.length;\n\n  const newShape: number[] = new Array(xRank);\n  for (let i = 0; i < newShape.length; i++) {\n    newShape[i] = x.shape[perm[i]];\n  }\n\n  const values = backend.data.get(x.dataId).values as TypedArray;\n  const result = transposeImpl(values, x.shape, x.dtype, perm, newShape);\n\n  const dataId = backend.write(result, newShape, x.dtype);\n  return {dataId, shape: newShape, dtype: x.dtype};\n}\n\nexport const transposeConfig: KernelConfig = {\n  kernelName: Transpose,\n  backendName: 'cpu',\n  kernelFunc: transpose as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, DataType, KernelConfig, KernelFunc, Prod, ProdAttrs, ProdInputs, TensorInfo, TypedArray, upcastType, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {transpose} from './Transpose';\n\nexport function prodImpl(\n    xShape: number[], xDtype: DataType, xVals: TypedArray,\n    reductionAxes: number[]):\n    {outVals: TypedArray, outShape: number[], outDtype: DataType} {\n  const [outShape, reduceShape] =\n      backend_util.computeOutAndReduceShapes(xShape, reductionAxes);\n  const outDtype = upcastType(xDtype, 'int32');\n  const outVals = util.makeZerosTypedArray(\n                      util.sizeFromShape(outShape), outDtype) as TypedArray;\n  const reduceSize = util.sizeFromShape(reduceShape);\n\n  for (let i = 0; i < outVals.length; ++i) {\n    const offset = i * reduceSize;\n    let prod = 1;\n    for (let j = 0; j < reduceSize; ++j) {\n      prod *= xVals[offset + j];\n    }\n    outVals[i] = prod;\n  }\n\n  return {outVals, outShape, outDtype};\n}\n\nexport function prod(\n    args: {inputs: ProdInputs, backend: MathBackendCPU, attrs: ProdAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {axis, keepDims} = attrs;\n\n  assertNotComplex(x, 'prod');\n\n  const xRank = x.shape.length;\n  const axes = util.parseAxisParam(axis, x.shape);\n\n  const permutation = backend_util.getAxesPermutation(axes, xRank);\n  let reductionAxes = axes;\n  let permutedX = x;\n  const intermediateTensorInfos = [];\n  if (permutation != null) {\n    permutedX = transpose({inputs: {x}, backend, attrs: {perm: permutation}});\n    intermediateTensorInfos.push(permutedX);\n    reductionAxes = backend_util.getInnerMostAxes(reductionAxes.length, xRank);\n  }\n\n  const xVals = backend.data.get(permutedX.dataId).values as TypedArray;\n  const {outVals, outShape, outDtype} =\n      prodImpl(permutedX.shape, permutedX.dtype, xVals, reductionAxes);\n\n  let resultShape = outShape;\n  if (keepDims) {\n    resultShape = backend_util.expandShapeToKeepDim(outShape, axes);\n  }\n\n  intermediateTensorInfos.forEach(\n      t => backend.disposeIntermediateTensorInfo(t));\n\n  return backend.makeTensorInfo(resultShape, outDtype, outVals);\n}\n\nexport const prodConfig: KernelConfig = {\n  kernelName: Prod,\n  backendName: 'cpu',\n  kernelFunc: prod as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2022 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {DataType, TypedArray, util} from '@tensorflow/tfjs-core';\n\nfunction validateIndices(\n    indices: TypedArray, indicesShape: number[], numParams: number) {\n  indices.forEach((index: number, i: number) => {\n    if (index < 0 || index >= numParams) {\n      const locString =\n          util.indexToLoc(\n                  i, indicesShape.length, util.computeStrides(indicesShape))\n              .join(',');\n      throw new Error(\n          `indices[${locString}] = ${index} is not in [0, ${numParams})`);\n    }\n  });\n}\n\nfunction validateSplits(\n    paramsNestedSplits: TypedArray[], numParamsDenseValues: number) {\n  // Validate\n  for (let dim = 0; dim < paramsNestedSplits.length; ++dim) {\n    const splits = paramsNestedSplits[dim];\n    const lastSplit = (dim === paramsNestedSplits.length - 1) ?\n        numParamsDenseValues :\n        paramsNestedSplits[dim + 1].length;\n    if (splits.length === 0) {\n      throw new Error('Ragged splits may not be empty');\n    }\n    if (splits[0] < 0) {\n      throw new Error('Ragged splits must be non-negative');\n    }\n    if (splits[splits.length - 1] > lastSplit) {\n      throw new Error('Ragged splits must not point past values');\n    }\n    for (let i = 1; i < splits.length; ++i) {\n      if (splits[i - 1] > splits[i]) {\n        throw new Error('Ragged splits must be sorted in ascending order');\n      }\n    }\n  }\n}\n\n// Construct the `splits` output tensors, encoded using a nested vector.\n// Also find the slices of values that need to be copied, and store them\n// in `valueSlices`.  The total number of values that will be copied (which\n// we need for allocating the output values tensor) is stored in `numValues`.\nfunction makeSplits(\n    indices: TypedArray, indicesShape: number[],\n    paramsNestedSplits: TypedArray[], numParamsDenseValues: number) {\n  const valueSlices: Array<[number, number]> = [];\n  let numValues = 0;\n\n  const numSplits = indicesShape.length - 1 + paramsNestedSplits.length;\n  const outSplits = new Array(numSplits).fill(null).map(() => [0]);\n\n  validateSplits(paramsNestedSplits, numParamsDenseValues);\n\n  // Add `splits` that come from all but the last dimension of the dense\n  // Tensor `indices`.  In particular, for each dimension D, we add a\n  // splits tensor whose values are:\n  //   range(reduceProd(splits.shape[:D]) + 1) * splits.shape[D+1]\n  // E.g., if indices.shape=[2, 3, 4] then we will add splits tensors:\n  //   [0, 3, 6]                    # length=2+1, stride=3\n  //   [0, 4, 8, 12, 16, 20, 24]    # length=2*3+1, stride=4\n  let nrows = 1;\n  for (let dim = 0; dim < indicesShape.length - 1; ++dim) {\n    nrows *= indicesShape[dim];\n    const rowLength = indicesShape[dim + 1];\n    for (let i = 1; i < nrows + 1; ++i) {\n      outSplits[dim].push(i * rowLength);\n    }\n  }\n\n  // Add `splits` that come from `paramsNestedSplits`.  Starting with the\n  // outermost ragged dimension (i.e., the first `splits` tensor), we work\n  // our way in, finding the range of values that should be copied.  As we\n  // go, we update the output `splits` for each dimension with the appropriate\n  // values.  In particular, the *lengths* of the slices from `param_splits`\n  // should be copied to generate corresponding slice lengths in the output\n  // splits.  E.g., if we are copying a ragged row with length 4, then we\n  // should add a new split point to outSplits that is 4 greater than the\n  // previous split point in outSplits.\n  for (let i = 0; i < indices.length; ++i) {\n    let start = indices[i];\n    let limit = indices[i] + 1;\n\n    // Copy splits.\n    for (let dim = 0; dim < paramsNestedSplits.length; ++dim) {\n      const splits = paramsNestedSplits[dim];\n      const outDim = dim + indicesShape.length - 1;\n      if (outDim >= 0) {\n        const outSplitsOutDim = outSplits[outDim];\n        const delta =\n            outSplitsOutDim[outSplitsOutDim.length - 1] - splits[start];\n        for (let j = start; j < limit; ++j) {\n          outSplits[outDim].push(splits[j + 1] + delta);\n        }\n      }\n      start = splits[start];\n      limit = splits[limit];\n    }\n    if (limit !== start) {\n      valueSlices.push([start, limit]);\n      numValues += limit - start;\n    }\n  }\n\n  return {outSplits, valueSlices, numValues};\n}\n\nfunction getSplits(outSplits: number[][]) {\n  const splitsOut: TypedArray[] = [];\n  for (let i = 0; i < outSplits.length; ++i) {\n    const numSplits = outSplits[i].length;\n    const splits = util.getArrayFromDType('int32', numSplits) as TypedArray;\n    splitsOut.push(splits);\n\n    outSplits[i].forEach((value, j: number) => splits[j] = value);\n  }\n\n  return splitsOut;\n}\n\nfunction computeFlatOuterDims(orig: number[], numOutDims: number) {\n  const outDims = orig.slice(0, numOutDims);\n  while (outDims.length < numOutDims) {\n    outDims.push(1);\n  }\n\n  for (let inDim = numOutDims; inDim < orig.length; inDim++) {\n    outDims[numOutDims - 1] *= orig[inDim];\n  }\n\n  return outDims;\n}\n// For each slice in `(start, limit)` in `valueSlices`, append\n// `paramsDenseValues[start,...,limit] to `values`.  `valueSize` indicates\n// the number of scalars contained in each value paramsDenseValues[i].\nfunction writeValueSlices(\n    paramsDenseValues: TypedArray, paramsDenseValuesShape: number[],\n    valueSlices: Array<[number, number]>, valueSize: number, values: TypedArray,\n    valuesShape: number[]) {\n  const denseM = computeFlatOuterDims(paramsDenseValuesShape, 2)[1];\n  const valuesM = computeFlatOuterDims(valuesShape, 2)[1];\n\n  let outPos = 0;\n  for (const slice of valueSlices) {\n    for (let i = slice[0]; i < slice[1]; ++i) {\n      for (let j = 0; j < valueSize; ++j) {\n        values[outPos * valuesM + j] = paramsDenseValues[i * denseM + j];\n      }\n      ++outPos;\n    }\n  }\n}\n\nfunction getValues(\n    paramsDenseValues: TypedArray, paramsDenseValuesShape: number[],\n    paramsDenseValuesDType: DataType, valueSlices: Array<[number, number]>,\n    numValues: number): [TypedArray, number[]] {\n  const valuesShape = paramsDenseValuesShape.slice();\n  valuesShape[0] = numValues;\n\n  const valuesOut = util.getArrayFromDType(\n                        paramsDenseValuesDType,\n                        util.sizeFromShape(valuesShape)) as TypedArray;\n\n  const numElements = paramsDenseValues.length;\n  const valueSize =\n      numElements === 0 ? 0 : (numElements / paramsDenseValuesShape[0]);\n  writeValueSlices(\n      paramsDenseValues, paramsDenseValuesShape, valueSlices, valueSize,\n      valuesOut, valuesShape);\n\n  return [valuesOut, valuesShape];\n}\nexport function raggedGatherImpl(\n    paramsNestedSplits: TypedArray[], paramsNestedSplitsShapes: number[][],\n    paramsDenseValues: TypedArray, paramsDenseValuesShape: number[],\n    paramsDenseValuesDType: DataType, indices: TypedArray,\n    indicesShape: number[],\n    outputRaggedRank: number): [TypedArray[], TypedArray, number[]] {\n  if (paramsNestedSplits.length === 0) {\n    throw new Error('paramsNestedSplits must be non empty');\n  }\n\n  if (paramsNestedSplitsShapes[0].length === 0) {\n    throw new Error('Split tensors must not be scalars');\n  }\n  const numParams = paramsNestedSplitsShapes[0][0] - 1;\n  validateIndices(indices, indicesShape, numParams);\n\n  if (paramsDenseValuesShape.length === 0) {\n    throw new Error('params.rank must be nonzero');\n  }\n  const numParamsDenseValues = paramsDenseValuesShape[0];\n\n  // Calculate the `splits`, and store the value slices that we need to\n  // copy in `valueSlices`.\n  const {outSplits, valueSlices, numValues} = makeSplits(\n      indices, indicesShape, paramsNestedSplits, numParamsDenseValues);\n\n  // Write the output tensors.\n  const outputNestedSplits = getSplits(outSplits);\n  const outputDenseValues = getValues(\n      paramsDenseValues, paramsDenseValuesShape, paramsDenseValuesDType,\n      valueSlices, numValues);\n\n  return [outputNestedSplits, outputDenseValues[0], outputDenseValues[1]];\n}\n","/**\n * @license\n * Copyright 2022 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, broadcastTo, DataType, reshape, tidy, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport RowPartitionType = backend_util.RowPartitionType;\n// Based on\n// https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/ragged_tensor_to_tensor_op.cc\nclass RaggedTensorToTensorOp {\n  private readonly rowPartitionTypes: RowPartitionType[];\n  private readonly raggedRank: number;\n  constructor(\n      private shape: TypedArray, private shapeShape: number[],\n      private values: TypedArray, private valuesShape: number[],\n      private valuesDType: DataType, private defaultValue: TypedArray,\n      private defaultValueShape: number[],\n      private readonly rowPartitionValues: TypedArray[],\n      private readonly rowPartitionValuesShapes: number[][],\n      rowPartitionTypeStrings: string[]) {\n    this.rowPartitionTypes =\n        backend_util.getRowPartitionTypesHelper(rowPartitionTypeStrings);\n    this.raggedRank = backend_util.getRaggedRank(this.rowPartitionTypes);\n  }\n\n  private getRowPartitionTypeByDimension(dimension: number) {\n    if (this.rowPartitionTypes[0] === RowPartitionType.FIRST_DIM_SIZE) {\n      return this.rowPartitionTypes[dimension + 1];\n    } else {\n      return this.rowPartitionTypes[dimension];\n    }\n  }\n\n  // Returns the relationship between dimension and dimension + 1.\n  private getRowPartitionTensor(dimension: number) {\n    if (this.rowPartitionTypes[0] === RowPartitionType.FIRST_DIM_SIZE) {\n      return this.rowPartitionValues[dimension + 1];\n    } else {\n      return this.rowPartitionValues[dimension];\n    }\n  }\n\n  private getMaxWidth(dimension: number) {\n    const rowPartitionTensor = this.getRowPartitionTensor(dimension - 1);\n    switch (this.getRowPartitionTypeByDimension(dimension - 1)) {\n      case RowPartitionType.VALUE_ROWIDS:\n        return RaggedTensorToTensorOp.getMaxWidthValueRowID(rowPartitionTensor);\n      case RowPartitionType.ROW_SPLITS:\n        return RaggedTensorToTensorOp.getMaxWidthRowSplit(rowPartitionTensor);\n      default:\n        throw new Error(`Cannot handle partition type ${\n            RowPartitionType[this.getRowPartitionTypeByDimension(\n                dimension - 1)]}`);\n    }\n  }\n\n  static getMaxWidthRowSplit(rowSplit: TypedArray) {\n    const tensorLength = rowSplit.length;\n    if (tensorLength === 0 || tensorLength === 1) {\n      return 0;\n    }\n    let maxWidth = 0;\n    for (let i = 0; i < tensorLength - 1; ++i) {\n      const currentWidth = rowSplit[i + 1] - rowSplit[i];\n      if (currentWidth > maxWidth) {\n        maxWidth = currentWidth;\n      }\n    }\n    return maxWidth;\n  }\n\n  static getMaxWidthValueRowID(valueRowIds: TypedArray) {\n    const indexLength = valueRowIds.length;\n    if (indexLength === 0) {\n      return 0;\n    }\n    let firstEqualIndex = 0;\n    let firstEqualIndexValue = valueRowIds[0];\n    let maxWidth = 0;\n    for (let i = 1; i < indexLength; ++i) {\n      const value = valueRowIds[i];\n      if (value !== firstEqualIndexValue) {\n        firstEqualIndexValue = value;\n        maxWidth = Math.max(i - firstEqualIndex, maxWidth);\n        firstEqualIndex = i;\n      }\n    }\n    return Math.max(indexLength - firstEqualIndex, maxWidth);\n  }\n\n  private tensorShapeFromTensor(\n      t: TypedArray, tShape: number[], isPartial = true) {\n    if (tShape.length === 0) {\n      if (t[0] === -1) {\n        return [];\n      }\n      throw new Error(\n          `The only valid scalar shape tensor is the fully unknown shape specified as -1.`);\n    }\n    // MakePartialShape/MakeShapeHelper.\n    return makeShape(t, isPartial);\n  }\n\n  private calculateOutputSize(firstDim: number) {\n    const valueShape = this.valuesShape;\n    const defaultValueShape = this.defaultValueShape;\n\n    backend_util.validateDefaultValueShape(defaultValueShape, valueShape);\n\n    const shape = this.tensorShapeFromTensor(this.shape, this.shapeShape);\n    const outputShape = backend_util.combineRaggedTensorToTensorShapes(\n        this.raggedRank, shape, valueShape);\n\n    const result = outputShape;\n\n    if (result[0] < 0) {\n      result[0] = firstDim;\n    }\n    for (let i = 1; i <= this.raggedRank; ++i) {\n      if (result[i] < 0) {\n        result[i] = this.getMaxWidth(i);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * The outputIndex represents the index in the output tensor\n   * where the first element of a particular dimension would be written.\n   * If it is -1, it indicates that the index is out of scope.\n   * Example, given firstDimension = 10, firstDimensionOutput = 6,\n   * and outputIndexMultiplier = 100:\n   * result = [0 100 200 300 400 500 -1 -1 -1 -1]\n   * If firstDimensionOutput = 11 instead, then:\n   * result = [0 100 200 300 400 500 600 700 800 900]\n   */\n  private calculateFirstParentOutputIndex(\n      firstDimension: number, outputIndexMultiplier: number,\n      firstDimensionOutput: number) {\n    const minDimension = Math.min(firstDimension, firstDimensionOutput);\n    const result: number[] = [];\n    let currentOutputIndex = 0;\n    for (let i = 0; i < minDimension;\n         ++i, currentOutputIndex += outputIndexMultiplier) {\n      result.push(currentOutputIndex);\n    }\n    for (let i = minDimension; i < firstDimension; ++i) {\n      result.push(-1);\n    }\n    util.assert(\n        result.length === firstDimension,\n        () => 'Final length of result must be equal to firstDimension.');\n\n    return result;\n  }\n\n  private calculateOutputIndexRowSplit(\n      rowSplit: TypedArray, parentOutputIndex: number[],\n      outputIndexMultiplier: number, outputSize: number) {\n    const rowSplitSize = rowSplit.length;\n    const result: number[] = [];\n    for (let i = 0; i < rowSplitSize - 1; ++i) {\n      const rowLength = rowSplit[i + 1] - rowSplit[i];\n      let realLength = Math.min(outputSize, rowLength);\n      let parentOutputIndexCurrent = parentOutputIndex[i];\n\n      if (parentOutputIndexCurrent === -1) {\n        realLength = 0;\n      }\n      for (let j = 0; j < realLength; ++j) {\n        result.push(parentOutputIndexCurrent);\n        parentOutputIndexCurrent += outputIndexMultiplier;\n      }\n      for (let j = 0; j < rowLength - realLength; ++j) {\n        result.push(-1);\n      }\n    }\n    if (rowSplitSize > 0 && result.length !== rowSplit[rowSplitSize - 1]) {\n      throw new Error('Invalid row split size.');\n    }\n\n    return result;\n  }\n\n  // Calculate the output index of the first element of a list.\n  // The parentOutputIndex is the same computation for the previous list.\n  // -1 indicates an element or list that is out of range.\n  // The outputIndexMultiplier is the number of output indices one moves\n  // forward for each column.\n  // E.g., given:\n  // valueRowIds:[0 1 2 2 2 3 5 5 6]\n  // parentOutputIndex:[1000 1100 2000 2100 -1 3000 4000]\n  // outputIndexMultiplier: 10\n  // outputSize: 2\n  // You get:\n  // result = [1000 1100 2000 2010 -1 2100 -1 -1 3000]\n  // result[0] = parentOutputIndex[valueRowIds[0]]\n  // result[1] = parentOutputIndex[valueRowIds[1]]\n  // result[2] = parentOutputIndex[valueRowIds[2]]\n  // result[3] = parentOutputIndex[valueRowIds[2] + 10]\n  // result[4] = -1 because it is the third element the size is 2.\n  // result[5] = parentOutputIndex[valueRowIds[3]]\n  // result[6] = -1 because parentOutputIndex[valueRowIds[6]] == -1\n  // result[7] = -1 because parentOutputIndex[valueRowIds[6]] == -1\n  // result[8] = parentOutputIndex[valueRowIds[7]]\n  private calculateOutputIndexValueRowID(\n      valueRowIds: TypedArray, parentOutputIndex: number[],\n      outputIndexMultiplier: number, outputSize: number) {\n    const indexSize = valueRowIds.length;\n    const result: number[] = [];\n    if (indexSize === 0) {\n      return [];\n    }\n\n    let currentOutputColumn = 0;\n    let currentValueRowId = valueRowIds[0];\n\n    if (currentValueRowId >= parentOutputIndex.length) {\n      throw new Error(\n          `Got currentValueRowId=${currentValueRowId}, which is not less than ${\n              parentOutputIndex.length}`);\n    }\n\n    let currentOutputIndex = parentOutputIndex[currentValueRowId];\n    result.push(currentOutputIndex);\n    for (let i = 1; i < indexSize; ++i) {\n      const nextValueRowId = valueRowIds[i];\n      if (nextValueRowId === currentValueRowId) {\n        if (currentOutputIndex >= 0) {\n          ++currentOutputColumn;\n          if (currentOutputColumn < outputSize) {\n            currentOutputIndex += outputIndexMultiplier;\n          } else {\n            currentOutputIndex = -1;\n          }\n        }\n      } else {\n        currentOutputColumn = 0;\n        currentValueRowId = nextValueRowId;\n\n        if (nextValueRowId >= parentOutputIndex.length) {\n          throw new Error(\n              `Got nextValueRowId=${nextValueRowId} which is not less than ${\n                  parentOutputIndex.length}`);\n        }\n\n        currentOutputIndex = parentOutputIndex[nextValueRowId];\n      }\n      result.push(currentOutputIndex);\n    }\n\n    if (result.length !== valueRowIds.length) {\n      throw new Error('Invalid row ids.');\n    }\n\n    return result;\n  }\n\n  private calculateOutputIndex(\n      dimension: number, parentOutputIndex: number[],\n      outputIndexMultiplier: number, outputSize: number) {\n    const rowPartitionTensor = this.getRowPartitionTensor(dimension);\n    const partitionType = this.getRowPartitionTypeByDimension(dimension);\n    switch (partitionType) {\n      case RowPartitionType.VALUE_ROWIDS:\n        return this.calculateOutputIndexValueRowID(\n            rowPartitionTensor, parentOutputIndex, outputIndexMultiplier,\n            outputSize);\n      case RowPartitionType.ROW_SPLITS:\n        if (rowPartitionTensor.length - 1 > parentOutputIndex.length) {\n          throw new Error(`Row partition size is greater than output size: ${\n              rowPartitionTensor.length - 1} > ${parentOutputIndex.length}`);\n        }\n        return this.calculateOutputIndexRowSplit(\n            rowPartitionTensor, parentOutputIndex, outputIndexMultiplier,\n            outputSize);\n      default:\n        throw new Error(\n            `Unsupported partition type: ${RowPartitionType[partitionType]}`);\n    }\n  }\n\n  private getFirstDimensionSize() {\n    const firstPartitionTensor = this.rowPartitionValues[0];\n    if (this.rowPartitionTypes.length === 0) {\n      throw new Error('No row_partition_types given.');\n    }\n    const firstPartitionType = this.rowPartitionTypes[0];\n    switch (firstPartitionType) {\n      case RowPartitionType.FIRST_DIM_SIZE:\n        return firstPartitionTensor[0];\n      case RowPartitionType.VALUE_ROWIDS:\n        throw new Error('Cannot handle VALUE_ROWIDS in first dimension.');\n      case RowPartitionType.ROW_SPLITS:\n        return this.rowPartitionValuesShapes[0][0] - 1;\n      default:\n        throw new Error(\n            `Cannot handle type ${RowPartitionType[firstPartitionType]}`);\n    }\n  }\n\n  compute(): [number[], TypedArray] {\n    const firstPartitionTensor = this.rowPartitionValues[0];\n    if (firstPartitionTensor.length <= 0) {\n      throw new Error(\n          'Invalid first partition input. ' +\n          'Tensor requires at least one element.');\n    }\n    const firstDimension = this.getFirstDimensionSize();\n    const outputSize = this.calculateOutputSize(firstDimension);\n    const multiplier: number[] = new Array(this.raggedRank + 1);\n\n    multiplier[multiplier.length - 1] = 1;\n    for (let i = multiplier.length - 2; i >= 0; --i) {\n      multiplier[i] = multiplier[i + 1] * outputSize[i + 1];\n    }\n    // Full size of the tensor.\n    const outputShape: number[] = makeShape(outputSize, false);\n    const outputTensor =\n        util.getArrayFromDType(\n            this.valuesDType, util.sizeFromShape(outputShape)) as TypedArray;\n\n    const fullSize = multiplier[0] * outputSize[0];\n    if (fullSize > 0) {\n      let outputIndex = this.calculateFirstParentOutputIndex(\n          firstDimension, multiplier[0], outputSize[0]);\n      for (let i = 1; i <= this.raggedRank; ++i) {\n        const newOutputIndex = this.calculateOutputIndex(\n            i - 1, outputIndex, multiplier[i], outputSize[i]);\n        outputIndex = newOutputIndex;\n      }\n\n      this.setOutput(this.raggedRank, outputIndex, outputTensor, outputShape);\n    }\n\n    return [outputShape, outputTensor];\n  }\n  setOutput(\n      raggedRank: number, outputIndex: number[], outputTensor: TypedArray,\n      outputShape: number[]) {\n    if (outputTensor.length === 0) {\n      return;\n    }\n\n    const valuesBase = this.values;\n    const outputBase = outputTensor;\n\n    let elementShape = outputShape.slice();\n    elementShape = elementShape.slice(raggedRank + 1);\n    const valueElementSize = util.sizeFromShape(elementShape);\n    const outputIndexSize = outputIndex.length;\n\n    // Broadcast the default value to value_element_size.  (We can skip this\n    // if defaultValueTensor.size == 1, since we use fill when that's true.)\n    let defaultValue = this.defaultValue;\n    if (defaultValue.length !== valueElementSize && defaultValue.length !== 1) {\n      const srcShape = this.defaultValueShape;\n      tidy(() => {\n        const defaultValueTensor = reshape(defaultValue, srcShape);\n        const bCastDefault = broadcastTo(defaultValueTensor, elementShape);\n        defaultValue = bCastDefault.dataSync();\n      });\n    }\n\n    // Loop through the outputIndex array, finding contiguous regions that\n    // should be copied.  Once we find the end of a contiguous region, copy it\n    // and add any necessary padding (with defaultValue).\n    let srcStart = 0;  // Start of contiguous region (in values)\n    let dstStart = 0;  // Destination for contiguous region (in output)\n    let dstEnd = 0;    // Destination for contiguous region (in output)\n    for (let srcI = 0; srcI <= outputIndexSize; ++srcI) {\n      // dstI is the destination where the value at srcI should be copied.\n      let dstI = srcI < outputIndexSize ? outputIndex[srcI] : -1;\n\n      // If we're still in a contiguous region, then update dstEnd go to the\n      // next srcI.\n      if (dstI === dstEnd) {\n        ++dstEnd;\n        continue;\n      }\n\n      // We found the end of contiguous region.  This can be because we found\n      // a gap (dstI > dstEnd), or a source value that shouldn't be copied\n      // because it's out-of-bounds (dstI == -1), or the end of the tensor\n      // (dstI === -1).\n      if (dstStart < dstEnd) {\n        // Copy the contiguous region.\n        const src = valuesBase.subarray(srcStart * valueElementSize);\n        const dst = outputBase.subarray(dstStart * valueElementSize);\n        const nVals = (dstEnd - dstStart) * valueElementSize;\n        copyArray(dst, src, nVals);\n      }\n\n      // Add any necessary padding (w/ defaultValue).\n      if (srcI >= outputIndexSize) {\n        // We reached the end of values: pad to the end of output.\n        const outputSize = outputTensor.length;\n        dstI = Math.floor(outputSize / valueElementSize);\n      }\n      if (dstI > dstEnd) {\n        if (this.defaultValue.length === 1) {\n          outputBase\n              .subarray(dstEnd * valueElementSize, dstI * valueElementSize)\n              .fill(this.defaultValue[0]);\n          dstEnd = dstI;\n        } else {\n          while (dstI > dstEnd) {\n            const dst = outputBase.slice(dstEnd * valueElementSize);\n            copyArray(dst, defaultValue, valueElementSize);\n            ++dstEnd;\n          }\n        }\n      }\n\n      // Update indices.\n      if (dstI < 0) {\n        // srcI should be skipped -- leave it out of the contiguous region.\n        srcStart = srcI + 1;\n        dstStart = dstEnd;\n      } else {\n        // srcI should be copied -- include it in the contiguous region.\n        srcStart = srcI;\n        dstStart = dstEnd;\n        dstEnd = dstStart + 1;\n      }\n    }\n  }\n}\n\nfunction copyArray(dst: TypedArray, src: TypedArray, size: number) {\n  for (let i = 0; i < size; i++) {\n    dst[i] = src[i];\n  }\n}\n\nfunction makeShape(shape: number[]|TypedArray, isPartial: boolean) {\n  const out: number[] = [];\n  for (let dim of shape) {\n    if (dim < 0) {\n      if (!isPartial) {\n        throw new Error(`Dimension ${dim} must be >= 0`);\n      }\n      if (dim < -1) {\n        throw new Error(`Dimension ${dim} must be >= -1`);\n      }\n      dim = -1;\n    }\n    out.push(dim);\n  }\n\n  return out;\n}\n\nexport function raggedTensorToTensorImpl(\n    shape: TypedArray, shapesShape: number[], values: TypedArray,\n    valuesShape: number[], valuesDType: DataType, defaultValue: TypedArray,\n    defaultValueShape: number[], rowPartitionValues: TypedArray[],\n    rowPartitionValuesShapes: number[][],\n    rowPartitionTypes: string[]): [number[], TypedArray] {\n  return new RaggedTensorToTensorOp(\n             shape, shapesShape, values, valuesShape, valuesDType, defaultValue,\n             defaultValueShape, rowPartitionValues, rowPartitionValuesShapes,\n             rowPartitionTypes)\n      .compute();\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {DataTypeMap, util} from '@tensorflow/tfjs-core';\n\nexport function rangeImpl(\n    start: number, stop: number, step: number,\n    dtype: 'float32'|'int32'): DataTypeMap['float32' | 'int32'] {\n  const sameStartStop = start === stop;\n  const increasingRangeNegativeStep = start < stop && step < 0;\n  const decreasingRangePositiveStep = stop < start && step > 1;\n\n  if (sameStartStop || increasingRangeNegativeStep ||\n      decreasingRangePositiveStep) {\n    return util.makeZerosTypedArray(0, dtype);\n  }\n\n  const numElements = Math.abs(Math.ceil((stop - start) / step));\n  const values = util.makeZerosTypedArray(numElements, dtype);\n\n  if (stop < start && step === 1) {\n    // Auto adjust the step's sign if it hasn't been set\n    // (or was set to 1)\n    step = -1;\n  }\n\n  values[0] = start;\n  for (let i = 1; i < values.length; i++) {\n    values[i] = values[i - 1] + step;\n  }\n  return values;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Rsqrt} from '@tensorflow/tfjs-core';\n\nimport {createSimpleUnaryImpl} from '../utils/unary_impl';\nimport {unaryKernelFuncFromImpl} from '../utils/unary_utils';\n\nexport const rsqrtImpl = createSimpleUnaryImpl((xi) => 1 / Math.sqrt(xi));\nexport const rsqrt = unaryKernelFuncFromImpl(Rsqrt, rsqrtImpl);\n\nexport const rsqrtConfig: KernelConfig = {\n  kernelName: Rsqrt,\n  backendName: 'cpu',\n  kernelFunc: rsqrt,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport {buffer, Rank, ShapeMap, TensorBuffer, TypedArray} from '@tensorflow/tfjs-core';\n\ninterface DefaultValueTypeMap {\n  bool: boolean;\n  int32: number;\n  float32: number;\n  string: string;\n}\n\nexport function\nscatterImpl<R extends Rank, D extends 'float32'|'int32'|'bool'|'string'>(\n    indices: TensorBuffer<R, 'int32'>, updates: TensorBuffer<R, D>,\n    shape: number[], outputSize: number, sliceSize: number, numUpdates: number,\n    sliceRank: number, strides: number[], defaultValue: DefaultValueTypeMap[D],\n    sumDupeIndices: boolean): TensorBuffer<R, D> {\n  const flattenShape = [outputSize / sliceSize, sliceSize];\n\n  const indicesData = indices.values as TypedArray;\n  const updatesData = updates.values;\n\n  if (outputSize === 0) {\n    return buffer(shape as ShapeMap[R], updates.dtype);\n  }\n\n  const outBuf = buffer(flattenShape, updates.dtype);\n  if (typeof defaultValue === 'string') {\n    (outBuf.values as string[]).fill(defaultValue);\n  } else if (typeof defaultValue === 'number') {\n    (outBuf.values as TypedArray).fill(defaultValue);\n  } else if (typeof defaultValue === 'boolean') {\n    (outBuf.values as TypedArray).fill(+defaultValue);\n  }\n\n  for (let i = 0; i < numUpdates; i++) {\n    const index = [];\n    let flattenIndex = 0;\n    for (let j = 0; j < sliceRank; j++) {\n      const dim = indicesData[i * sliceRank + j];\n      index.push(dim);\n      flattenIndex += dim * strides[j];\n    }\n\n    if (flattenIndex < 0 || flattenIndex >= outputSize / sliceSize) {\n      throw new Error(`Invalid indices: ${index} does not index into ${shape}`);\n    }\n\n    for (let k = 0; k < sliceSize; k++) {\n      if (sumDupeIndices) {\n        (outBuf.values as TypedArray)[flattenIndex * sliceSize + k] +=\n            (updatesData as TypedArray)[i * sliceSize + k];\n      } else {\n        outBuf.values[flattenIndex * sliceSize + k] = updates.rank === 0 ?\n            updatesData[0] :\n            updatesData[i * sliceSize + k];\n      }\n    }\n  }\n\n  return outBuf as TensorBuffer<R, D>;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Sigmoid} from '@tensorflow/tfjs-core';\n\nimport {createSimpleUnaryImpl} from '../utils/unary_impl';\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const sigmoidImpl =\n    createSimpleUnaryImpl((xi) => 1 / (1 + Math.exp(-xi)));\nexport const sigmoid =\n    unaryKernelFunc(Sigmoid, (xi) => 1 / (1 + Math.exp(-xi)));\n\nexport const sigmoidConfig: KernelConfig = {\n  kernelName: Sigmoid,\n  backendName: 'cpu',\n  kernelFunc: sigmoid,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, BackendValues, buffer, DataType, KernelConfig, KernelFunc, Slice, slice_util, SliceAttrs, SliceInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function sliceImpl(\n    vals: BackendValues, begin: number[], size: number[], shape: number[],\n    dtype: DataType): BackendValues {\n  const isContinous = slice_util.isSliceContinous(shape, begin, size);\n  const length = util.sizeFromShape(size);\n  const xStrides = util.computeStrides(shape);\n\n  if (isContinous) {\n    const flatOffset = slice_util.computeFlatOffset(begin, xStrides);\n\n    if (dtype === 'string') {\n      return (vals as Uint8Array[]).slice(flatOffset, flatOffset + length);\n    }\n\n    return (vals as TypedArray).subarray(flatOffset, flatOffset + length);\n  }\n\n  const decodedData = dtype === 'string' ?\n      backend_util.fromUint8ToStringArray(vals as Uint8Array[]) :\n      vals as TypedArray;\n\n  const inBuf = buffer(shape, dtype, decodedData);\n  const outBuf = buffer(size, dtype);\n  for (let i = 0; i < outBuf.size; ++i) {\n    const outLoc = outBuf.indexToLoc(i);\n    const inLoc = outLoc.map((idx: number, j) => idx + begin[j]);\n    outBuf.set(inBuf.get(...inLoc), ...outLoc);\n  }\n\n  if (dtype === 'string') {\n    return backend_util.fromStringArrayToUint8(outBuf.values as string[]);\n  }\n  return outBuf.values as TypedArray;\n}\n\nexport function slice(\n    args: {inputs: SliceInputs, backend: MathBackendCPU, attrs: SliceAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {begin, size} = attrs;\n\n  assertNotComplex(x, 'slice');\n\n  const [$begin, $size] = slice_util.parseSliceParams(x, begin, size);\n  slice_util.assertParamsValid(x, $begin, $size);\n\n  const vals = backend.data.get(x.dataId).values;\n  const outVals = sliceImpl(vals, $begin, $size, x.shape, x.dtype);\n  return backend.makeTensorInfo($size, x.dtype, outVals);\n}\n\nexport const sliceConfig: KernelConfig = {\n  kernelName: Slice,\n  backendName: 'cpu',\n  kernelFunc: slice as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, DataType, TypedArray, util} from '@tensorflow/tfjs-core';\n\nexport function sparseFillEmptyRowsImpl(\n    indices: TypedArray, indicesShape: number[], indicesDType: DataType,\n    values: TypedArray, valuesDType: DataType, denseShape: TypedArray,\n    defaultValue: number):\n    [TypedArray, number[], TypedArray, boolean[], number[]] {\n  const indicesCount = indicesShape[0];\n  const denseRows = denseShape[0];\n\n  const emptyRowIndicator: boolean[] = new Array(denseRows);\n  const reverseIndexMap: number[] = new Array(indicesCount);\n\n  const rank = indicesShape[1];\n\n  if (denseRows === 0) {\n    if (indicesCount !== 0) {\n      throw new Error(\n          backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(\n              indicesCount));\n    }\n    const outputIndices = util.getArrayFromDType(indicesDType, 0) as TypedArray;\n    const outputValues = util.getArrayFromDType(valuesDType, 0) as TypedArray;\n    return [\n      outputIndices, [0, rank], outputValues, emptyRowIndicator, reverseIndexMap\n    ];\n  }\n\n  let rowsAreOrdered = true;\n  let lastIndicesRow = 0;\n  const csrOffset: number[] = new Array(denseRows).fill(0);\n\n  for (let i = 0; i < indicesCount; ++i) {\n    // indices is a 2d tensor with shape of [N, rank]\n    const row = indices[i * rank];\n    if (row < 0) {\n      throw new Error(\n          backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(i, row));\n    }\n    if (row >= denseRows) {\n      throw new Error(\n          backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(\n              i, row, denseRows));\n    }\n    ++csrOffset[row];\n    rowsAreOrdered = rowsAreOrdered && (row >= lastIndicesRow);\n    lastIndicesRow = row;\n  }\n\n  let allRowsFull = true;\n  for (let row = 0; row < denseRows; ++row) {\n    // csrOffset here describes the number of elements in this dense row\n    const rowEmpty = (csrOffset[row] === 0);\n    emptyRowIndicator[row] = rowEmpty;\n    allRowsFull = allRowsFull && !rowEmpty;\n    // In filled version, each row has at least one element.\n    csrOffset[row] = Math.max(csrOffset[row], 1);\n    // Update csrOffset to represent the number of elements up to and\n    // including denseRows + 1:\n    //  csrOffset[0] == #{elements of row 0}\n    //  csrOffset[1] == #{elements of row 1} + #{elements of row 0}\n    //  ..\n    //  csrOffset[i] == starting index for elements in row i + 1.\n    if (row > 0) {\n      csrOffset[row] += csrOffset[row - 1];\n    }\n  }\n\n  if (allRowsFull && rowsAreOrdered) {\n    const outputIndices: TypedArray = indices;\n    const outputValues: TypedArray = values;\n    for (let i = 0; i < indicesCount; ++i) {\n      reverseIndexMap[i] = i;\n    }\n    return [\n      outputIndices, [indicesCount, rank], outputValues, emptyRowIndicator,\n      reverseIndexMap\n    ];\n  } else {\n    const fullIndicesCount = csrOffset[denseRows - 1];\n    const outputIndices =\n        util.getArrayFromDType(indicesDType, fullIndicesCount * rank) as\n        TypedArray;\n    const outputValues =\n        util.getArrayFromDType(valuesDType, fullIndicesCount) as TypedArray;\n    const filledCount: number[] = new Array(denseRows).fill(0);\n\n    // Fill in values for rows that are not missing\n    for (let i = 0; i < indicesCount; ++i) {\n      // indices is a 2d tensor with shape of [N, rank]\n      const row = indices[i * rank];\n      const offset = filledCount[row];\n      const outputI = ((row === 0) ? 0 : csrOffset[row - 1]) + offset;\n      filledCount[row]++;  // Increment the filled count for this row.\n      for (let j = 0; j < rank; ++j) {\n        // indices and outputIndices are 2d tensors with shape of [N, rank]\n        outputIndices[outputI * rank + j] = indices[i * rank + j];\n      }\n      outputValues[outputI] = values[i];\n      // We'll need this reverse index map to backprop correctly.\n      reverseIndexMap[i] = outputI;\n    }\n\n    // Fill in values for rows that are missing\n    for (let row = 0; row < denseRows; ++row) {\n      const rowCount = filledCount[row];\n      if (rowCount === 0) {  // We haven't filled this row\n        const startingIndex = (row === 0) ? 0 : csrOffset[row - 1];\n        // Remaining index values were set to zero already.\n        // Just need to set the row index in the right location.\n        // outputIndices is a 2d tensor with shape of [N, rank]\n        outputIndices[startingIndex * rank + 0] = row;\n        for (let col = 1; col < rank; ++col) {\n          outputIndices[startingIndex * rank + col] = 0;\n        }\n        outputValues[startingIndex] = defaultValue;\n      }\n    }\n    return [\n      outputIndices, [fullIndicesCount, rank], outputValues, emptyRowIndicator,\n      reverseIndexMap\n    ];\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, DataType, TypedArray, util} from '@tensorflow/tfjs-core';\n\nexport function sparseReshapeImpl(\n    inputIndices: TypedArray, inputIndicesShape: number[], inputDType: DataType,\n    inputShape: number[],\n    targetShape: number[]): [TypedArray, number[], number[]] {\n  const denseSize = util.sizeFromShape(inputShape);\n  const nnz = inputIndicesShape[0];\n  const outputRank = targetShape.length;\n\n  // Compute the output shape. Determine product of specified dimensions, and\n  // find the index of the unspecified one.\n  const outputShape: number[] = [];\n  let product = 1;\n  let unknownIndex = -1;\n  for (let d = 0; d < outputRank; ++d) {\n    const size = targetShape[d];\n    if (size === -1) {\n      if (unknownIndex !== -1) {\n        throw new Error(\n            backend_util\n                .getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(\n                    unknownIndex, d));\n      }\n      unknownIndex = d;\n      outputShape.push(1);\n    } else {\n      if (size < 0) {\n        throw new Error(\n            backend_util.getSparseReshapeNegativeOutputDimErrorMessage(\n                d, size));\n      }\n      product *= size;\n      outputShape.push(size);\n    }\n  }\n  if (unknownIndex !== -1) {\n    if (product <= 0) {\n      throw new Error(\n          backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());\n    }\n    const missing = Math.trunc(denseSize / product);\n    if (product * missing !== denseSize) {\n      throw new Error(\n          backend_util.getSparseReshapeInputOutputMultipleErrorMessage(\n              inputShape, outputShape));\n    }\n\n    outputShape[unknownIndex] = missing;\n  }\n  const outputSize = util.sizeFromShape(outputShape);\n  if (outputSize !== denseSize) {\n    throw new Error(\n        backend_util.getSparseReshapeInputOutputMismatchErrorMessage(\n            inputShape, outputShape));\n  }\n\n  const inputRank = inputShape.length;\n  const inputStrides: number[] = [];\n  if (inputRank > 0) {\n    inputStrides[inputRank - 1] = 1;\n    for (let d = inputRank - 2; d >= 0; --d) {\n      inputStrides[d] = inputStrides[d + 1] * inputShape[d + 1];\n    }\n  }\n\n  const outputStrides: number[] = [];\n  if (outputRank > 0) {\n    outputStrides[outputRank - 1] = 1;\n    for (let d = outputRank - 2; d >= 0; --d) {\n      outputStrides[d] = outputStrides[d + 1] * outputShape[d + 1];\n    }\n  }\n\n  const newIndices =\n      util.getArrayFromDType(inputDType, nnz * outputRank) as TypedArray;\n  for (let i = 0; i < nnz; ++i) {\n    let id = 0;\n    for (let j = 0; j < inputRank; ++j) {\n      // inputIndices is a 2d tensor with shape of [nnz, inputRank]\n      id += inputIndices[i * inputRank + j] * inputStrides[j];\n    }\n    for (let j = 0; j < outputRank; ++j) {\n      // newIndices is a 2d tensor with shape of [nnz, outputRank]\n      newIndices[i * outputRank + j] = Math.trunc(id / outputStrides[j]);\n      id %= outputStrides[j];\n    }\n  }\n  return [newIndices, [nnz, outputRank], outputShape];\n}\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, DataType, TypedArray, util} from '@tensorflow/tfjs-core';\n\nexport function sparseSegmentReductionImpl(\n    input: TypedArray, inputShape: number[], inputDType: DataType,\n    indices: TypedArray, segmentIds: TypedArray, isMean = false,\n    defaultValue = 0): [TypedArray, number[]] {\n  const numIndices = indices.length;\n\n  // Flatten the array to two dimensions\n  const inputFlat: number[] = [inputShape[0], input.length / inputShape[0]];\n  const numCol = inputFlat[1];\n  // Note that the current implementation assumes that segmentIds values are\n  // sorted.\n  const lastSegmentIdPlusOne =\n      numIndices > 0 ? segmentIds[numIndices - 1] + 1 : 0;\n  const outputRows = lastSegmentIdPlusOne;\n\n  if (outputRows < 0) {\n    throw new Error(\n        backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());\n  }\n\n  const outputShape = inputShape.slice();\n  outputShape[0] = outputRows;\n\n  const outputLength =\n      outputShape.reduce((product, value) => product * value, 1);\n  // Output array is initialized with the value 0 by default.\n  const output = util.getArrayFromDType(inputDType, outputLength) as TypedArray;\n\n  // Note that we do not initialize the output buffer with a default value, so\n  // we need to explicitly set missing indices to the default value.\n  if (numIndices === 0) {\n    if (outputRows > 0) {\n      output.fill(defaultValue);\n    }\n    return [output, outputShape];\n  }\n\n  if (outputRows <= 0) {\n    throw new Error(\n        backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());\n  }\n\n  let start = 0, end = 1;\n  // Index from which the output is not initialized.\n  let uninitializedIndex = 0;\n  let outIndex = segmentIds[start];\n\n  while (true) {\n    // We initialize nextIndex to 0 to avoid may be uninitialized warning\n    let nextIndex = 0;\n    if (end < numIndices) {\n      nextIndex = segmentIds[end];\n      if (outIndex === nextIndex) {\n        ++end;\n        continue;\n      }\n      // We have a new segment here.  Verify that the segment ids are growing.\n      if (outIndex >= nextIndex) {\n        throw new Error(backend_util\n            .getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage());\n      }\n    }\n\n    if (outIndex < 0 || outIndex >= outputRows) {\n      throw new Error(\n          backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(\n              outIndex, outputRows));\n    }\n\n    // If there is a gap between two indices, we need to set that gap to the\n    // default value.\n    if (outIndex > uninitializedIndex) {\n      output.fill(defaultValue, uninitializedIndex * numCol, outIndex * numCol);\n    }\n\n    for (let i = start; i < end; ++i) {\n      const index = indices[i];\n      if (index < 0 || index >= inputFlat[0]) {\n        throw new Error(\n            backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(\n                i, indices[i], inputFlat[0]));\n      }\n      for (let j = 0; j < numCol; j++) {\n        output[outIndex * numCol + j] += input[index * numCol + j];\n      }\n    }\n\n    if (isMean) {\n      for (let j = 0; j < numCol; j++) {\n        output[outIndex * numCol + j] /= end - start;\n      }\n    }\n\n    start = end;\n    ++end;\n    uninitializedIndex = outIndex + 1;\n    outIndex = nextIndex;\n    if (end > numIndices) {\n      break;\n    }\n  }\n\n  // Fill the gap at the end with the default value.\n  if (uninitializedIndex < outputRows) {\n    output.fill(defaultValue, uninitializedIndex * numCol, outputRows * numCol);\n  }\n\n  return [output, outputShape];\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Sqrt} from '@tensorflow/tfjs-core';\n\nimport {createSimpleUnaryImpl} from '../utils/unary_impl';\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const sqrtImpl = createSimpleUnaryImpl((xi) => Math.sqrt(xi));\nexport const sqrt = unaryKernelFunc(Sqrt, (xi) => Math.sqrt(xi));\n\nexport const sqrtConfig: KernelConfig = {\n  kernelName: Sqrt,\n  backendName: 'cpu',\n  kernelFunc: sqrt,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, SquaredDifference} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const squaredDifferenceImpl =\n    createSimpleBinaryKernelImpl(((a: number, b: number) => {\n      const diff = a - b;\n      return diff * diff;\n    }));\nexport const squaredDifference =\n    binaryKernelFunc(SquaredDifference, squaredDifferenceImpl);\n\nexport const squaredDifferenceConfig: KernelConfig = {\n  kernelName: SquaredDifference,\n  backendName: 'cpu',\n  kernelFunc: squaredDifference\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {buffer, Rank, TensorBuffer} from '@tensorflow/tfjs-core';\n\nexport function stridedSliceImpl<R extends Rank>(\n    outShape: number[], xBuf: TensorBuffer<R>, strides: number[],\n    begin: number[]): TensorBuffer<R> {\n  const outBuf = buffer(outShape, xBuf.dtype);\n\n  for (let i = 0; i < outBuf.size; i++) {\n    const loc = outBuf.indexToLoc(i);\n\n    const newLoc: number[] = new Array(loc.length);\n    for (let j = 0; j < newLoc.length; j++) {\n      newLoc[j] = loc[j] * strides[j] + begin[j];\n    }\n    outBuf.set(xBuf.get(...newLoc), ...loc);\n  }\n\n  return outBuf as TensorBuffer<R>;\n}\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {util} from '@tensorflow/tfjs-core';\n\n/**\n * The StringNGramsOp class creates ngrams from ragged string data.\n * The constructor contains all attributes related to the operation such as\n * padding widths and strings, and the compute function can be used to\n * compute the ngrams for different ragged tensor inputs.\n */\nclass StringNGramsOp {\n  private separator: Uint8Array;\n  private nGramWidths: number[];\n  private padWidth: number;\n  private leftPad: Uint8Array;\n  private rightPad: Uint8Array;\n  private preserveShort: boolean;\n\n  constructor(\n      separator: string, nGramWidths: number[], leftPad: string,\n      rightPad: string, padWidth: number, preserveShortSequences: boolean) {\n    this.separator = util.encodeString(separator);\n    this.nGramWidths = nGramWidths;\n    this.leftPad = util.encodeString(leftPad);\n    this.rightPad = util.encodeString(rightPad);\n    this.padWidth = padWidth;\n    this.preserveShort = preserveShortSequences;\n  }\n\n  private getPadWidth(nGramWidth: number) {\n    // Ngrams can be padded with either a fixed pad width or a dynamic pad\n    // width depending on the 'padWidth' arg, but in no case should the padding\n    // ever be wider than 'nGramWidth' - 1.\n    return Math.min(\n        this.padWidth < 0 ? nGramWidth - 1 : this.padWidth, nGramWidth - 1);\n  }\n\n  private getNumNGrams(length: number, nGramWidth: number) {\n    const padWidth = this.getPadWidth(nGramWidth);\n    return Math.max(0, ((length + 2 * padWidth) - nGramWidth) + 1);\n  }\n\n  private createNGrams(\n      data: Uint8Array[], splitIndex: number, output: Uint8Array[],\n      outputStartIndex: number, numNGrams: number, nGramWidth: number) {\n    for (let nGramIndex = 0; nGramIndex < numNGrams; ++nGramIndex) {\n      const padWidth = this.getPadWidth(nGramWidth);\n      const leftPadding = Math.max(0, padWidth - nGramIndex);\n      const rightPadding =\n          Math.max(0, padWidth - (numNGrams - (nGramIndex + 1)));\n      const numTokens = nGramWidth - (leftPadding + rightPadding);\n      const dataStartIndex =\n          splitIndex + (leftPadding > 0 ? 0 : nGramIndex - padWidth);\n\n      // Calculate the total expected size of the nGram so we can reserve the\n      // correct amount of space in the string.\n      let nGramSize = 0;\n      // Size of the left padding.\n      nGramSize += leftPadding * this.leftPad.length;\n      // Size of the tokens.\n      for (let n = 0; n < numTokens; ++n) {\n        nGramSize += data[dataStartIndex + n].length;\n      }\n      // Size of the right padding.\n      nGramSize += rightPadding * this.rightPad.length;\n      // Size of the separators.\n      const numSeparators = leftPadding + rightPadding + numTokens - 1;\n      nGramSize += numSeparators * this.separator.length;\n\n      // Build the nGram.\n      output[outputStartIndex + nGramIndex] = new Uint8Array(nGramSize);\n      const nGram = output[outputStartIndex + nGramIndex];\n\n      let nextNGramIndex = 0;\n      const appendToNGram = (str: Uint8Array) =>\n          str.forEach((value) => nGram[nextNGramIndex++] = value);\n\n      for (let n = 0; n < leftPadding; ++n) {\n        appendToNGram(this.leftPad);\n        appendToNGram(this.separator);\n      }\n      // Only output first numTokens - 1 pairs of data and separator\n      for (let n = 0; n < numTokens - 1; ++n) {\n        appendToNGram(data[dataStartIndex + n]);\n        appendToNGram(this.separator);\n      }\n      // Handle case when there are no tokens or no right padding as these\n      // can result in consecutive separators.\n      if (numTokens > 0) {\n        // If we have tokens, then output last and then pair each separator\n        // with the right padding that follows, to ensure nGram ends either with\n        // the token or with the right pad.\n        appendToNGram(data[dataStartIndex + numTokens - 1]);\n        for (let n = 0; n < rightPadding; ++n) {\n          appendToNGram(this.separator);\n          appendToNGram(this.rightPad);\n        }\n      } else {\n        // If we don't have tokens, then the last item inserted into the nGram\n        // has been the separator from the left padding loop above. Hence,\n        // output right pad and separator and make sure to finish with a\n        // padding, not a separator.\n        for (let n = 0; n < rightPadding - 1; ++n) {\n          appendToNGram(this.rightPad);\n          appendToNGram(this.separator);\n        }\n        appendToNGram(this.rightPad);\n      }\n    }\n  }\n\n  // Data and splits together form the definition of the ragged tensor,\n  // where data is 1 dimensional and contains the values of the tensor\n  // and splits denotes the indices at which each row starts.\n  public compute(data: Uint8Array[], splits: Int32Array):\n      [Uint8Array[], Int32Array] {\n    // Validate that the splits are valid indices into data, only if there are\n    // splits specified.\n    const inputDataSize = data.length;\n    const splitsSize = splits.length;\n    if (splitsSize > 0) {\n      let prevSplit = splits[0];\n      if (prevSplit !== 0) {\n        throw new Error(`First split value must be 0, got ${prevSplit}`);\n      }\n      for (let i = 1; i < splitsSize; ++i) {\n        let validSplits = splits[i] >= prevSplit;\n        validSplits = validSplits && (splits[i] <= inputDataSize);\n        if (!validSplits) {\n          throw new Error(`Invalid split value ${splits[i]}, must be in [${\n              prevSplit}, ${inputDataSize}]`);\n        }\n        prevSplit = splits[i];\n      }\n      if (prevSplit !== inputDataSize) {\n        throw new Error(`Last split value must be data size. Expected ${\n            inputDataSize}, got ${prevSplit}`);\n      }\n    }\n\n    const numBatchItems = splitsSize - 1;\n    const nGramsSplits = util.getArrayFromDType('int32', splitsSize);\n    // If there is no data or size, return an empty ragged tensor.\n    if (inputDataSize === 0 || splitsSize === 0) {\n      const empty: Uint8Array[] = new Array(inputDataSize);\n      for (let i = 0; i <= numBatchItems; ++i) {\n        nGramsSplits[i] = 0;\n      }\n      return [empty, nGramsSplits];\n    }\n\n    nGramsSplits[0] = 0;\n    for (let i = 1; i <= numBatchItems; ++i) {\n      const length = splits[i] - splits[i - 1];\n      let numNGrams = 0;\n      this.nGramWidths.forEach((nGramWidth) => {\n        numNGrams += this.getNumNGrams(length, nGramWidth);\n      });\n      if (this.preserveShort && length > 0 && numNGrams === 0) {\n        numNGrams = 1;\n      }\n      nGramsSplits[i] = nGramsSplits[i - 1] + numNGrams;\n    }\n\n    const nGrams: Uint8Array[] = new Array(nGramsSplits[numBatchItems]);\n\n    for (let i = 0; i < numBatchItems; ++i) {\n      const splitIndex = splits[i];\n      let outputStartIdx = nGramsSplits[i];\n      this.nGramWidths.forEach((nGramWidth) => {\n        const length = splits[i + 1] - splits[i];\n        const numNGrams = this.getNumNGrams(length, nGramWidth);\n        this.createNGrams(\n            data, splitIndex, nGrams, outputStartIdx, numNGrams, nGramWidth);\n        outputStartIdx += numNGrams;\n      });\n      // If we're preserving short sequences, check to see if no sequence was\n      // generated by comparing the current output start idx to the original\n      // one (nGramSplitsdata). If no ngrams were generated, then they will\n      // be equal (since we increment outputStartIdx by numNGrams every\n      // time we create a set of ngrams.)\n      if (this.preserveShort && outputStartIdx === nGramsSplits[i]) {\n        const dataLength = splits[i + 1] - splits[i];\n        // One legitimate reason to not have any ngrams when this.preserveShort\n        // is true is if the sequence itself is empty. In that case, move on.\n        if (dataLength === 0) {\n          continue;\n        }\n        // We don't have to worry about dynamic padding sizes here: if padding\n        // was dynamic, every sequence would have had sufficient padding to\n        // generate at least one nGram.\n        const nGramWidth = dataLength + 2 * this.padWidth;\n        const numNGrams = 1;\n        this.createNGrams(\n            data, splitIndex, nGrams, outputStartIdx, numNGrams, nGramWidth);\n      }\n    }\n    return [nGrams, nGramsSplits];\n  }\n}\n\nexport function stringNGramsImpl(\n    data: Uint8Array[], dataSplits: Int32Array, separator: string,\n    nGramWidths: number[], leftPad: string, rightPad: string, padWidth: number,\n    preserveShortSequences: boolean): [Uint8Array[], Int32Array] {\n  return new StringNGramsOp(\n             separator, nGramWidths, leftPad, rightPad, padWidth,\n             preserveShortSequences)\n      .compute(data, dataSplits);\n}\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {TypedArray, util} from '@tensorflow/tfjs-core';\n\nfunction split(\n    str: Uint8Array, delimiters: Uint8Array, skipEmpty: boolean,\n    result: Uint8Array[]): void {\n  if (!str.length) {\n    return;\n  }\n  // When the delimiter is empty, the input is split into individual characters.\n  if (delimiters.length === 0) {\n    for (let i = 0; i < str.length; ++i) {\n      result.push(str.subarray(i, i + 1));\n    }\n    return;\n  }\n  // When there is one delimiter, the input is split only at that delimiter.\n  if (delimiters.length === 1) {\n    const delimiter = delimiters[0];\n    let f = str.indexOf(delimiter);\n    while (f !== -1) {\n      const token = str.subarray(0, f);\n      if (!skipEmpty || token.length !== 0) {\n        result.push(token);\n      }\n      str = str.subarray(f + 1);\n      f = str.indexOf(delimiter);\n    }\n    if (!skipEmpty || str.length !== 0) {\n      result.push(str);\n    }\n    return;\n  }\n  // When there are multiple delimiters, the input is split at every instance\n  // one of the delimiters appears.\n  let tokenStart = 0;\n  for (let i = 0; i < str.length + 1; i++) {\n    if ((i === str.length) || (delimiters.indexOf(str[i]) !== -1)) {\n      const token = str.subarray(tokenStart, i);\n      if (!skipEmpty || token.length !== 0) {\n        result.push(token);\n      }\n      tokenStart = i + 1;\n    }\n  }\n}\n\nexport function stringSplitImpl(\n    input: Uint8Array[], delimiter: Uint8Array,\n    skipEmpty: boolean): [TypedArray, Uint8Array[], [number, number]] {\n  const batchSize = input.length;\n\n  // Empty delimiter means split the input character by character.\n  const tokens: Uint8Array[] = [];\n\n  let outputSize = 0;\n  let maxNumEntries = 0;\n  const numIndices: number[] = new Array(batchSize);\n  for (let i = 0; i < batchSize; ++i) {\n    const prevTokensLength = tokens.length;\n    split(input[i], delimiter, skipEmpty, tokens);\n    const nEntries = tokens.length - prevTokensLength;\n    numIndices[i] = nEntries;\n    outputSize += nEntries;\n    maxNumEntries = Math.max(maxNumEntries, nEntries);\n  }\n\n  const indices = util.getArrayFromDType('int32', outputSize * 2) as TypedArray;\n  const values: Uint8Array[] = new Array(outputSize);\n  const shape: [number, number] = [batchSize, maxNumEntries];\n\n  let c = 0;\n  for (let i = 0; i < batchSize; ++i) {\n    for (let j = 0; j < numIndices[i]; ++j) {\n      // indices is a 2d tensor with shape of [outputSize, 2]\n      indices[c * 2] = i;\n      indices[c * 2 + 1] = j;\n      values[c] = tokens[c];\n      ++c;\n    }\n  }\n\n  return [indices, values, shape];\n}\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {TypedArray, util} from '@tensorflow/tfjs-core';\n\nexport function stringToHashBucketFastImpl(\n    input: Uint8Array[], numBuckets: number): TypedArray {\n  const output = util.getArrayFromDType('int32', input.length) as TypedArray;\n\n  for (let i = 0; i < input.length; ++i) {\n    output[i] =\n        util.fingerPrint64(input[i]).modulo(numBuckets).getLowBitsUnsigned();\n  }\n\n  return output;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Sub} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc, createComplexBinaryKernelImpl} from '../utils/binary_utils';\n\nexport const subImpl = createSimpleBinaryKernelImpl(\n    ((aValue: number, bValue: number) => aValue - bValue));\nexport const subComplexImpl =\n    createComplexBinaryKernelImpl(((aReal, aImag, bReal, bImag) => {\n      return {real: aReal - bReal, imag: aImag - bImag};\n    }));\nexport const sub = binaryKernelFunc(Sub, subImpl, subComplexImpl);\n\nexport const subConfig: KernelConfig = {\n  kernelName: Sub,\n  backendName: 'cpu',\n  kernelFunc: sub\n};\n","/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {buffer, DataType, Rank, TensorBuffer} from '@tensorflow/tfjs-core';\n\n/**\n * An implementation of the tile kernel shared between webgl and cpu for string\n * tensors only.\n */\n\nexport function tileImpl<R extends Rank>(\n    xBuf: TensorBuffer<R, DataType>,\n    reps: number[]): TensorBuffer<R, DataType> {\n  const newShape: number[] = new Array(xBuf.rank);\n  for (let i = 0; i < newShape.length; i++) {\n    newShape[i] = xBuf.shape[i] * reps[i];\n  }\n  const result = buffer(newShape, xBuf.dtype);\n  for (let i = 0; i < result.values.length; ++i) {\n    const newLoc = result.indexToLoc(i);\n\n    const originalLoc: number[] = new Array(xBuf.rank);\n    for (let j = 0; j < originalLoc.length; j++) {\n      originalLoc[j] = newLoc[j] % xBuf.shape[j];\n    }\n\n    const originalIndex = xBuf.locToIndex(originalLoc);\n\n    result.values[i] = xBuf.values[originalIndex];\n  }\n  return result as TensorBuffer<R, DataType>;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\n/** An implementation of the TopK kernel shared between webgl and cpu. */\n\nimport {buffer, NumericDataType, Rank, ShapeMap, Tensor, TensorBuffer, TypedArray, util} from '@tensorflow/tfjs-core';\n\ntype Pair = {\n  value: number,\n  index: number\n};\n\nconst comparePair = (a: Pair, b: Pair) => {\n  const valueDiff = b.value - a.value;\n  return valueDiff === 0 ? a.index - b.index : valueDiff;\n};\n\n/**\n * Partitions array where all elements smaller than the (k+1) smallest element\n * are found to the left of it, and all larger to the right of it.\n * Based on the Floyd-Rivest Algorithm, ref:\n * https://en.wikipedia.org/wiki/Floyd%E2%80%93Rivest_algorithm\n * @param array: Array to partition\n * @param left: Left index for the interval\n * @param right: Right index for the interval\n * @param k: Desired index value, where array[k] is the (k+1)th smallest element\n *           when left = 0\n */\nfunction select(array: Pair[], k: number, left = 0, right = array.length - 1) {\n  while (right > left) {\n    // Use select recursively to sample a smaller set of size s\n    // the arbitrary constants 600 and 0.5 are used in the original\n    // version to minimize execution time.\n    if (right - left > 600) {\n      const n = right - left + 1;\n      const i = k - left + 1;\n      const z = Math.log(n);\n      const s = 0.5 * Math.exp(2 * z / 3);\n      const sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * Math.sign(i - n / 2);\n      const newLeft = Math.max(left, Math.floor(k - i * s / n + sd));\n      const newRight = Math.min(right, Math.floor(k + (n - i) * s / n + sd));\n      select(array, k, newLeft, newRight);\n    }\n    // partition the elements between left and right around t\n    const t = array[k];\n    let i = left;\n    let j = right;\n\n    util.swap(array, left, k);\n\n    if (comparePair(array[right], t) > 0) {\n      util.swap(array, left, right);\n    }\n    while (i < j) {\n      util.swap(array, i, j);\n      i++;\n      j--;\n      while (comparePair(array[i], t) < 0) {\n        i = i + 1;\n      }\n      while (comparePair(array[j], t) > 0) {\n        j = j - 1;\n      }\n    }\n    if (comparePair(array[left], t) === 0) {\n      util.swap(array, left, j);\n    } else {\n      j = j + 1;\n      util.swap(array, j, right);\n    }\n    // Adjust left and right towards the boundaries of the subset\n    // containing the (k - left + 1)th smallest element.\n    if (j <= k) {\n      left = j + 1;\n    }\n    if (k <= j) {\n      right = j - 1;\n    }\n  }\n}\n\nexport function topKImpl<T extends Tensor, R extends Rank>(\n    x: TypedArray, xShape: number[], xDtype: NumericDataType, k: number,\n    sorted: boolean):\n    [TensorBuffer<R, NumericDataType>, TensorBuffer<R, 'int32'>] {\n  // Reshape into a 2d tensor [batch, lastDim] and compute topk along lastDim.\n  const lastDim = xShape[xShape.length - 1];\n  const [batch, size] = [x.length / lastDim, lastDim];\n  const allTopKVals = util.getTypedArrayFromDType(xDtype, batch * k);\n  const allTopKIndices = util.getTypedArrayFromDType('int32', batch * k);\n\n  for (let b = 0; b < batch; b++) {\n    const offset = b * size;\n    const vals = x.subarray(offset, offset + size);\n\n    let valAndInd: Pair[] = new Array(vals.length);\n    vals.forEach(\n        (value: number, index: number) => valAndInd[index] = {value, index});\n\n    if (k < valAndInd.length) {\n      select(valAndInd, k);\n      valAndInd = valAndInd.slice(0, k);\n    }\n\n    if (sorted) {\n      valAndInd.sort(comparePair);\n    }\n    \n    const outOffset = b * k;\n    const topKVals = allTopKVals.subarray(outOffset, outOffset + k);\n    const topKIndices = allTopKIndices.subarray(outOffset, outOffset + k);\n    for (let i = 0; i < k; i++) {\n      topKVals[i] = valAndInd[i].value;\n      topKIndices[i] = valAndInd[i].index;\n    }\n  }\n  // Reshape back to the original input shape, except that the last\n  // dimension is k.\n  const outputShape = xShape.slice();\n  outputShape[outputShape.length - 1] = k;\n\n  return [\n    buffer(outputShape as ShapeMap[R], xDtype, allTopKVals),\n    buffer(outputShape as ShapeMap[R], 'int32', allTopKIndices)\n  ];\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {BackendValues, DataType, TensorBuffer, TypedArray, util} from '@tensorflow/tfjs-core';\n\nexport function uniqueImpl(\n    values: BackendValues, axis: number, shape: number[], dtype: DataType): {\n  outputValues: BackendValues,\n  outputShape: number[],\n  indices: BackendValues\n} {\n  // Normalize and validate axis.\n  const $axis = util.parseAxisParam(axis, shape)[0];\n\n  // Calculate the new shape that is suitable for extracting data along the\n  // given axis.\n  //\n  // The rank is 3.\n  // The size of the 1st dimension is the size of all the axes < the given axis.\n  // The size of the 2nd dimension is the same as the size of the given axis.\n  // The size of the 3rd dimension is the size of all the axes > the given axis.\n  //\n  // For example, for a 4D tensor with shape=[2, 3, 5, 4] and axis=2, the\n  // newShape would be: [2*3, 5, 4].\n  //\n  // Note that this is not the final output shape. This will be the shape for an\n  // intermediate TensorBuffer (see inputBuffer below) to allow us to extract\n  // values along the given axis. To demonstrate how it works, consider the\n  // following example:\n  //\n  // Input: a 3D tensor, with shape [1, 2, 3]\n  // [\n  //   [\n  //      [1,2,3],\n  //      [4,5,6]\n  //   ]\n  // ]\n  // Axis: 2 (the last axis).\n  // Along axis 2, we expect to extract 3 tensors: [1,4], [2,5], [3,6].\n  //\n  // For this example, newShape would be: [2, 3, 1], where 2 is calculated from\n  // 1*2. The re-shaped data would look like:\n  //\n  // [\n  //   [\n  //     [1], [2], [3]\n  //   ],\n  //   [\n  //     [4], [5], [6]\n  //   ]\n  // ]\n  //\n  // Then, we can construct a 3-level nested loop by the following dimension\n  // order to extract the values along the axis (dimension1):\n  // i: dimension1       // 0,1,2 (newShape[1])\n  //   m: dimension0     // 0,1   (newShape[0])\n  //     n: dimension2   // 0     (newShape[2])\n  //\n  //                       m, i, n\n  //                      ---------\n  // Iteration 0: data at [0, 0, 0] => \"1\"\n  // Iteration 1: data at [1, 0, 0] => \"4\"\n  // We got [1,4].\n  // Iteration 2: data at [0, 1, 0] => \"2\"\n  // Iteration 3: data at [1, 1, 0] => \"5\"\n  // We got [2,5].\n  // Iteration 4: data at [0, 2, 0] => \"3\"\n  // Iteration 5: data at [1, 2, 0] => \"6\"\n  // We got [3,6].\n  const newShape = [1, shape[0], 1];\n  for (let i = 0; i < $axis; i++) {\n    newShape[0] *= shape[i];\n  }\n  newShape[1] = shape[$axis];\n  for (let i = $axis + 1; i < shape.length; i++) {\n    newShape[2] *= shape[i];\n  }\n\n  // A map from unique elements (their string representations) to their values\n  // in \"indices\" (below).\n  const uniqueElements: {[key: string]: number} = {};\n  // The indices of each unique element in the original tensor along the given\n  // axis. It is 1D and has the same size as the given axis.\n  const indices = new Int32Array(shape[$axis]);\n  // Create a buffer so we can easily extract value at a given location.\n  const inputBuffer = new TensorBuffer(newShape, dtype, values as TypedArray);\n  // The indices along the given axis that have unique elements. This is a\n  // de-duped version of \"indices\" above.\n  const uniqueIndices: number[] = [];\n  const is1DTensor = newShape[0] === 1 && newShape[2] === 1;\n  for (let i = 0; i < shape[$axis]; i++) {\n    // Extract values along the axis.\n    let element: string;\n    if (is1DTensor) {\n      // Fast path for 1D tensor input.\n      element = values[i].toString();\n    } else {\n      const axisValues = [];\n      for (let m = 0; m < newShape[0]; m++) {\n        for (let n = 0; n < newShape[2]; n++) {\n          axisValues.push(inputBuffer.get(m, i, n));\n        }\n      }\n      element = axisValues.join(',');\n    }\n\n    // Dedup and update various indices.\n    if (uniqueElements[element] !== undefined) {\n      indices[i] = uniqueElements[element];\n    } else {\n      const uniqueIndex = Object.keys(uniqueElements).length;\n      uniqueElements[element] = uniqueIndex;\n      indices[i] = uniqueIndex;\n      uniqueIndices.push(i);\n    }\n  }\n\n  // Now we know where each of the unique elements are located along the axis\n  // (uniqueIndices). Extract them from input buffer and store them in the\n  // output buffer.\n  const outputTmpShape = newShape.slice();\n  outputTmpShape[1] = Object.keys(uniqueElements).length;\n  const outputBuffer = new TensorBuffer(outputTmpShape, dtype);\n  uniqueIndices.forEach((uniqueElementIndex, i) => {\n    for (let m = 0; m < newShape[0]; m++) {\n      for (let n = 0; n < newShape[2]; n++) {\n        outputBuffer.set(inputBuffer.get(m, uniqueElementIndex, n), m, i, n);\n      }\n    }\n  });\n\n  // The output shape can be calculated from the input shape with the size of\n  // the given axis replaced by the number of unique elements along that axis.\n  const outputShape = shape.slice();\n  outputShape[$axis] = outputTmpShape[1];\n\n  return {\n    outputValues: outputBuffer.values as BackendValues,\n    outputShape,\n    indices,\n  };\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\n/*\n * base.ts contains all the exports from tfjs-backend-cpu\n * without auto-kernel registration\n */\nimport {registerBackend} from '@tensorflow/tfjs-core';\nimport {MathBackendCPU} from './backend_cpu';\nimport * as shared from './shared';\n\nexport {MathBackendCPU} from './backend_cpu';\nexport {version as version_cpu} from './version';\nexport {shared};\n\n// Side effects for default initialization of MathBackendCPU\nregisterBackend('cpu', () => new MathBackendCPU(), 1 /* priority */);\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Elu, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const elu =\n    unaryKernelFunc(Elu, (xi) => xi >= 0 ? xi : (Math.exp(xi) - 1));\n\nexport const eluConfig: KernelConfig = {\n  kernelName: Elu,\n  backendName: 'cpu',\n  kernelFunc: elu,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, LeakyRelu, LeakyReluAttrs, LeakyReluInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function leakyRelu(args: {\n  inputs: LeakyReluInputs,\n  backend: MathBackendCPU,\n  attrs: LeakyReluAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {alpha} = attrs;\n\n  assertNotComplex([x], 'leakyRelu');\n\n  const xSize = util.sizeFromShape(x.shape);\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const outVals = util.getTypedArrayFromDType('float32', xSize);\n\n  for (let i = 0; i < xVals.length; i++) {\n    outVals[i] = xVals[i] < 0 ? alpha * xVals[i] : xVals[i];\n  }\n\n  return backend.makeTensorInfo(x.shape, 'float32', outVals);\n}\n\nexport const leakyReluConfig: KernelConfig = {\n  kernelName: LeakyRelu,\n  backendName: 'cpu',\n  kernelFunc: leakyRelu as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Prelu, PreluInputs, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\n\nconst preluImpl = createSimpleBinaryKernelImpl(\n    (xValue: number, aValue: number) => xValue < 0 ? aValue * xValue : xValue);\n\nexport function prelu(args: {inputs: PreluInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {x, alpha} = inputs;\n\n  assertNotComplex([x, alpha], 'prelu');\n\n  const aVals = backend.data.get(x.dataId).values as TypedArray;\n  const bVals = backend.data.get(alpha.dataId).values as TypedArray;\n\n  const [resultData, resultShape] =\n      preluImpl(x.shape, alpha.shape, aVals, bVals, 'float32');\n\n  return backend.makeTensorInfo(resultShape, 'float32', resultData);\n}\n\nexport const preluConfig: KernelConfig = {\n  kernelName: Prelu,\n  backendName: 'cpu',\n  kernelFunc: prelu,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Relu} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const relu = unaryKernelFunc(Relu, (xi) => Math.max(0, xi));\n\nexport const reluConfig: KernelConfig = {\n  kernelName: Relu,\n  backendName: 'cpu',\n  kernelFunc: relu,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Relu6} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const relu6 =\n    unaryKernelFunc(Relu6, (xi) => Math.min(Math.max(0, xi), 6));\n\nexport const relu6Config: KernelConfig = {\n  kernelName: Relu6,\n  backendName: 'cpu',\n  kernelFunc: relu6,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {_FusedMatMul, _FusedMatMulAttrs, _FusedMatMulInputs, backend_util, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {elu} from '../kernels/Elu';\nimport {identity} from '../kernels/Identity';\nimport {leakyRelu} from '../kernels/LeakyRelu';\nimport {prelu} from '../kernels/Prelu';\nimport {relu} from '../kernels/Relu';\nimport {relu6} from '../kernels/Relu6';\nimport {sigmoid} from '../kernels/Sigmoid';\n\nexport function applyActivation(\n    backend: MathBackendCPU, x: TensorInfo, activation: backend_util.Activation,\n    preluActivationWeights?: TensorInfo, leakyreluAlpha?: number): TensorInfo {\n  if (activation === 'linear') {\n    return identity({inputs: {x}, backend});\n  } else if (activation === 'relu') {\n    return relu({inputs: {x}, backend}) as TensorInfo;\n  } else if (activation === 'elu') {\n    return elu({inputs: {x}, backend}) as TensorInfo;\n  } else if (activation === 'relu6') {\n    return relu6({inputs: {x}, backend}) as TensorInfo;\n  } else if (activation === 'prelu') {\n    return prelu({inputs: {x, alpha: preluActivationWeights}, backend});\n  } else if (activation === 'leakyrelu') {\n    return leakyRelu({inputs: {x}, backend, attrs: {alpha: leakyreluAlpha}});\n  } else if (activation === 'sigmoid') {\n    return sigmoid({inputs: {x}, backend}) as TensorInfo;\n  }\n  throw new Error(\n      `Activation ${activation} has not been implemented for the CPU backend.`);\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, Reshape, ReshapeAttrs, ReshapeInputs, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport function reshape(\n    args:\n        {inputs: ReshapeInputs, backend: MathBackendCPU, attrs: ReshapeAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {shape} = attrs;\n\n  const xSize = util.sizeFromShape(x.shape);\n  const $shape = util.inferFromImplicitShape(shape, xSize);\n  const $xSize = util.sizeFromShape($shape);\n\n  util.assert(\n      xSize === $xSize,\n      () => `The new shape (${$shape}) has ${$xSize} elements and the old ` +\n          `shape (${x.shape}) has ${xSize} elements. The new shape and old ` +\n          `shape must have the same number of elements.`);\n\n  backend.incRef(x.dataId);\n\n  const xData = backend.data.get(x.dataId);\n\n  if (xData.complexTensorInfos != null) {\n    const real = xData.complexTensorInfos.real;\n    const imag = xData.complexTensorInfos.imag;\n\n    real.shape = $shape;\n    imag.shape = $shape;\n  }\n\n  return {dataId: x.dataId, shape: $shape, dtype: x.dtype};\n}\n\nexport const reshapeConfig: KernelConfig = {\n  kernelName: Reshape,\n  backendName: 'cpu',\n  kernelFunc: reshape as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {BatchMatMul, BatchMatMulAttrs, BatchMatMulInputs, broadcast_util, buffer, KernelConfig, KernelFunc, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nimport {reshape} from './Reshape';\n\nexport function batchMatMul(args: {\n  inputs: BatchMatMulInputs,\n  attrs: BatchMatMulAttrs,\n  backend: MathBackendCPU\n}) {\n  const {inputs, backend, attrs} = args;\n  const {a, b} = inputs;\n  const {transposeA, transposeB} = attrs;\n\n  assertNotComplex([a, b], 'matMul');\n\n  const aRank = a.shape.length;\n  const bRank = b.shape.length;\n\n  const innerShapeA = transposeA ? a.shape[aRank - 2] : a.shape[aRank - 1];\n  const innerShapeB = transposeB ? b.shape[bRank - 1] : b.shape[bRank - 2];\n\n  const outerShapeA = transposeA ? a.shape[aRank - 1] : a.shape[aRank - 2];\n  const outerShapeB = transposeB ? b.shape[bRank - 2] : b.shape[bRank - 1];\n\n  const outerDimsA = a.shape.slice(0, -2);\n  const outerDimsB = b.shape.slice(0, -2);\n\n  const batchDimA = util.sizeFromShape(outerDimsA);\n  const batchDimB = util.sizeFromShape(outerDimsB);\n\n  const outShapeOuterDims = broadcast_util.assertAndGetBroadcastShape(\n      a.shape.slice(0, -2), b.shape.slice(0, -2));\n  const outShape = outShapeOuterDims.concat([outerShapeA, outerShapeB]);\n\n  util.assert(\n      innerShapeA === innerShapeB,\n      () => `Error in matMul: inner shapes (${innerShapeA}) and (` +\n          `${innerShapeB}) of Tensors with shapes ${a.shape} and ` +\n          `${b.shape} and transposeA=${transposeA}` +\n          ` and transposeB=${transposeB} must match.`);\n\n  const a3dShape = transposeA ? [batchDimA, innerShapeA, outerShapeA] :\n                                [batchDimA, outerShapeA, innerShapeA];\n  const b3dShape = transposeB ? [batchDimB, outerShapeB, innerShapeB] :\n                                [batchDimB, innerShapeB, outerShapeB];\n\n  // The rest of the implementation is designed to operate on rank-3 tensors\n  const a3d = reshape({inputs: {x: a}, backend, attrs: {shape: a3dShape}});\n  const b3d = reshape({inputs: {x: b}, backend, attrs: {shape: b3dShape}});\n\n  const sharedDim = transposeA ? a3d.shape[1] : a3d.shape[2];\n  const leftDim = transposeA ? a3d.shape[2] : a3d.shape[1];\n  const rightDim = transposeB ? b3d.shape[1] : b3d.shape[2];\n  const batchDim = Math.max(batchDimA, batchDimB);\n\n  const a3dValues = backend.data.get(a3d.dataId).values as TypedArray;\n  const b3dValues = backend.data.get(b3d.dataId).values as TypedArray;\n\n  const a3dStrides = util.computeStrides(a3d.shape);\n  const b3dStrides = util.computeStrides(b3d.shape);\n\n  const [aBatch, aOuterStep, aInnerStep] = transposeA ?\n      [a3dStrides[0], 1, a3dStrides[1]] :\n      [a3dStrides[0], a3dStrides[1], 1];\n  const [bInnerStep, bOuterStep, bBatch] = transposeB ?\n      [1, b3dStrides[1], b3dStrides[0]] :\n      [b3dStrides[1], 1, b3dStrides[0]];\n\n  const size = leftDim * rightDim;\n  const result = buffer([batchDim, leftDim, rightDim], a3d.dtype);\n\n  const resVals = result.values as TypedArray;\n  const blockSize = backend.blockSize;\n\n  for (let bi = 0; bi < batchDim; bi++) {\n    for (let i0 = 0; i0 < leftDim; i0 += blockSize) {\n      for (let j0 = 0; j0 < rightDim; j0 += blockSize) {\n        for (let k0 = 0; k0 < sharedDim; k0 += blockSize) {\n          // for when blockSize doesn't evenly divide the input\n          const iBlock = Math.min(i0 + blockSize, leftDim);\n          const jBlock = Math.min(j0 + blockSize, rightDim);\n          const kBlock = Math.min(k0 + blockSize, sharedDim);\n\n          for (let i = i0; i < iBlock; i++) {\n            for (let j = j0; j < jBlock; j++) {\n              let sum = 0.0;\n\n              for (let k = k0; k < kBlock; k++) {\n                const batchOffsetA = Math.min(bi, batchDimA - 1) * aBatch;\n                const batchOffsetB = Math.min(bi, batchDimB - 1) * bBatch;\n                const aVal =\n                    a3dValues[batchOffsetA + i * aOuterStep + k * aInnerStep];\n                const bVal =\n                    b3dValues[k * bInnerStep + j * bOuterStep + batchOffsetB];\n                sum += aVal * bVal;\n              }\n              resVals[bi * size + (i * rightDim + j)] += sum;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  backend.disposeIntermediateTensorInfo(a3d);\n  backend.disposeIntermediateTensorInfo(b3d);\n\n  // set correct shape on output.\n  return backend.makeTensorInfo(\n      outShape, result.dtype, result.values as TypedArray);\n}\n\nexport const batchMatMulConfig: KernelConfig = {\n  kernelName: BatchMatMul,\n  backendName: 'cpu',\n  kernelFunc: batchMatMul as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {_FusedMatMul, _FusedMatMulAttrs, _FusedMatMulInputs, KernelConfig, KernelFunc, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {applyActivation} from '../utils/fused_utils';\n\nimport {add} from './Add';\nimport {batchMatMul} from './BatchMatMul';\n\nexport function _fusedMatMul(args: {\n  inputs: _FusedMatMulInputs,\n  attrs: _FusedMatMulAttrs,\n  backend: MathBackendCPU\n}) {\n  const {inputs, backend, attrs} = args;\n  const {a, b, bias, preluActivationWeights} = inputs;\n  const {transposeA, transposeB, activation, leakyreluAlpha} = attrs;\n\n  let current;\n  let addRes;\n  let activationRes;\n\n  const intermediates: TensorInfo[] = [];\n\n  const matMulRes =\n      batchMatMul({inputs: {a, b}, attrs: {transposeA, transposeB}, backend});\n  current = matMulRes;\n\n  if (bias) {\n    addRes = add({inputs: {a: current, b: bias}, backend}) as TensorInfo;\n    intermediates.push(current);\n    current = addRes;\n  }\n  if (activation) {\n    activationRes = applyActivation(\n        backend, current, activation, preluActivationWeights, leakyreluAlpha);\n    intermediates.push(current);\n    current = activationRes;\n  }\n\n  for (const i of intermediates) {\n    backend.disposeIntermediateTensorInfo(i);\n  }\n\n  return current;\n}\n\nexport const _fusedMatMulConfig: KernelConfig = {\n  kernelName: _FusedMatMul,\n  backendName: 'cpu',\n  kernelFunc: _fusedMatMul as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Acos, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const acos = unaryKernelFunc(Acos, (xi) => Math.acos(xi));\n\nexport const acosConfig: KernelConfig = {\n  kernelName: Acos,\n  backendName: 'cpu',\n  kernelFunc: acos,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Acosh, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const acosh = unaryKernelFunc(Acosh, (xi) => Math.acosh(xi));\n\nexport const acoshConfig: KernelConfig = {\n  kernelName: Acosh,\n  backendName: 'cpu',\n  kernelFunc: acosh,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {AddN, AddNInputs, buffer, KernelConfig, KernelFunc, Tensor, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function addN(args: {inputs: AddNInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const tensors = inputs as Tensor[];\n\n  assertNotComplex(inputs, 'addN');\n\n  const vals =\n      tensors.map(t => backend.data.get(t.dataId).values as TypedArray);\n  const outBuf = buffer(tensors[0].shape, tensors[0].dtype as 'float32');\n  const outVals = outBuf.values;\n  for (let i = 0; i < tensors.length; i++) {\n    const currVals = vals[i];\n    for (let j = 0; j < outVals.length; j++) {\n      outVals[j] += currVals[j];\n    }\n  }\n\n  return backend.makeTensorInfo(outBuf.shape, outBuf.dtype, outBuf.values);\n}\n\nexport const addNConfig: KernelConfig = {\n  kernelName: AddN,\n  backendName: 'cpu',\n  kernelFunc: addN as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {All, AllAttrs, AllInputs, backend_util, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {reshape} from './Reshape';\nimport {transpose} from './Transpose';\n\nexport function all(\n    args: {inputs: AllInputs, backend: MathBackendCPU, attrs: AllAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {axis, keepDims} = attrs;\n\n  assertNotComplex(x, 'all');\n\n  const origAxes = util.parseAxisParam(axis, x.shape);\n  let axes = origAxes;\n  const permutedAxes = backend_util.getAxesPermutation(axes, x.shape.length);\n  let $x = x;\n  if (permutedAxes != null) {\n    $x = transpose({inputs: {x}, backend, attrs: {perm: permutedAxes}});\n    axes = backend_util.getInnerMostAxes(axes.length, x.shape.length);\n  }\n\n  backend_util.assertAxesAreInnerMostDims('all', axes, $x.shape.length);\n  const [outShape, reduceShape] =\n      backend_util.computeOutAndReduceShapes($x.shape, axes);\n  const reduceSize = util.sizeFromShape(reduceShape);\n  const vals = util.makeZerosTypedArray(util.sizeFromShape(outShape), $x.dtype);\n\n  const aVals = backend.data.get($x.dataId).values as TypedArray;\n  for (let i = 0; i < vals.length; ++i) {\n    const offset = i * reduceSize;\n    let all = aVals[offset];\n    for (let j = 0; j < reduceSize; ++j) {\n      const value = aVals[offset + j];\n      all = all && value;\n    }\n    vals[i] = all;\n  }\n\n  if (permutedAxes != null) {\n    backend.disposeIntermediateTensorInfo($x);\n  }\n\n  const result = backend.makeTensorInfo(outShape, $x.dtype, vals);\n\n  if (keepDims) {\n    const expandedShape = backend_util.expandShapeToKeepDim(outShape, origAxes);\n    const reshapedResult =\n        reshape({inputs: {x: result}, backend, attrs: {shape: expandedShape}});\n\n    backend.disposeIntermediateTensorInfo(result);\n\n    return reshapedResult;\n  }\n\n  return result;\n}\n\nexport const allConfig: KernelConfig = {\n  kernelName: All,\n  backendName: 'cpu',\n  kernelFunc: all as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Any, AnyAttrs, AnyInputs, backend_util, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {reshape} from './Reshape';\nimport {transpose} from './Transpose';\n\nexport function any(\n    args: {inputs: AnyInputs, backend: MathBackendCPU, attrs: AnyAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {axis, keepDims} = attrs;\n\n  assertNotComplex(x, 'any');\n\n  const origAxes = util.parseAxisParam(axis, x.shape);\n  let axes = origAxes;\n  const permutedAxes = backend_util.getAxesPermutation(axes, x.shape.length);\n  let $x = x;\n  if (permutedAxes != null) {\n    $x = transpose({inputs: {x}, backend, attrs: {perm: permutedAxes}});\n    axes = backend_util.getInnerMostAxes(axes.length, x.shape.length);\n  }\n\n  backend_util.assertAxesAreInnerMostDims('any', axes, $x.shape.length);\n  const [outShape, reduceShape] =\n      backend_util.computeOutAndReduceShapes($x.shape, axes);\n  const reduceSize = util.sizeFromShape(reduceShape);\n  const vals = util.makeZerosTypedArray(util.sizeFromShape(outShape), $x.dtype);\n\n  const aVals = backend.data.get($x.dataId).values as TypedArray;\n  for (let i = 0; i < vals.length; ++i) {\n    const offset = i * reduceSize;\n    let anyVal = aVals[offset];\n    for (let j = 0; j < reduceSize; ++j) {\n      const value = aVals[offset + j];\n      anyVal = anyVal || value;\n    }\n    vals[i] = anyVal;\n  }\n\n  if (permutedAxes != null) {\n    backend.disposeIntermediateTensorInfo($x);\n  }\n\n  const result = backend.makeTensorInfo(outShape, $x.dtype, vals);\n\n  if (keepDims) {\n    const expandedShape = backend_util.expandShapeToKeepDim(outShape, origAxes);\n    const reshapedResult =\n        reshape({inputs: {x: result}, backend, attrs: {shape: expandedShape}});\n\n    backend.disposeIntermediateTensorInfo(result);\n\n    return reshapedResult;\n  }\n\n  return result;\n}\n\nexport const anyConfig: KernelConfig = {\n  kernelName: Any,\n  backendName: 'cpu',\n  kernelFunc: any as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {ArgMax, ArgMaxAttrs, ArgMaxInputs, backend_util, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {transpose} from './Transpose';\n\nexport function argMax(\n    args: {inputs: ArgMaxInputs, backend: MathBackendCPU, attrs: ArgMaxAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {axis} = attrs;\n\n  assertNotComplex(x, 'argMax');\n\n  let axes = util.parseAxisParam(axis, x.shape);\n  const permutedAxes = backend_util.getAxesPermutation(axes, x.shape.length);\n  let $x = x;\n  const intermediateTensorInfos = [];\n  if (permutedAxes != null) {\n    $x = transpose({inputs: {x}, backend, attrs: {perm: permutedAxes}});\n    intermediateTensorInfos.push($x);\n    axes = backend_util.getInnerMostAxes(axes.length, $x.shape.length);\n  }\n\n  axes = [axes[0]];\n  backend_util.assertAxesAreInnerMostDims('argMax', axes, $x.shape.length);\n  const [outShape, reduceShape] =\n      backend_util.computeOutAndReduceShapes($x.shape, axes);\n\n  const outSize = util.sizeFromShape(outShape);\n  const vals = util.makeZerosTypedArray(outSize, 'int32');\n  const reduceSize = util.sizeFromShape(reduceShape);\n\n  const aVals = backend.data.get($x.dataId).values as TypedArray;\n  for (let i = 0; i < vals.length; ++i) {\n    const offset = i * reduceSize;\n    let max = aVals[offset];\n    let maxIndex = 0;\n    for (let j = 0; j < reduceSize; ++j) {\n      const value = aVals[offset + j];\n      if (value > max) {\n        max = value;\n        maxIndex = j;\n      }\n    }\n    vals[i] = maxIndex;\n  }\n\n  intermediateTensorInfos.forEach(\n      t => backend.disposeIntermediateTensorInfo(t));\n\n  return backend.makeTensorInfo(outShape, 'int32', vals);\n}\n\nexport const argMaxConfig: KernelConfig = {\n  kernelName: ArgMax,\n  backendName: 'cpu',\n  kernelFunc: argMax as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {ArgMin, ArgMinAttrs, ArgMinInputs, backend_util, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {transpose} from './Transpose';\n\nexport function argMin(\n    args: {inputs: ArgMinInputs, backend: MathBackendCPU, attrs: ArgMinAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {axis} = attrs;\n\n  assertNotComplex(x, 'argMin');\n\n  let axes = util.parseAxisParam(axis, x.shape);\n  const permutedAxes = backend_util.getAxesPermutation(axes, x.shape.length);\n  let $x = x;\n  const intermediateTensorInfos = [];\n  if (permutedAxes != null) {\n    $x = transpose({inputs: {x}, backend, attrs: {perm: permutedAxes}});\n    intermediateTensorInfos.push($x);\n    axes = backend_util.getInnerMostAxes(axes.length, $x.shape.length);\n  }\n\n  axes = [axes[0]];\n  backend_util.assertAxesAreInnerMostDims('argMin', axes, $x.shape.length);\n  const [outShape, reduceShape] =\n      backend_util.computeOutAndReduceShapes($x.shape, axes);\n\n  const outSize = util.sizeFromShape(outShape);\n  const vals = util.makeZerosTypedArray(outSize, 'int32');\n  const reduceSize = util.sizeFromShape(reduceShape);\n\n  const aVals = backend.data.get($x.dataId).values as TypedArray;\n  for (let i = 0; i < vals.length; ++i) {\n    const offset = i * reduceSize;\n    let min = aVals[offset];\n    let minIndex = 0;\n    for (let j = 0; j < reduceSize; ++j) {\n      const value = aVals[offset + j];\n      if (value < min) {\n        min = value;\n        minIndex = j;\n      }\n    }\n    vals[i] = minIndex;\n  }\n\n  intermediateTensorInfos.forEach(\n      t => backend.disposeIntermediateTensorInfo(t));\n\n  return backend.makeTensorInfo(outShape, 'int32', vals);\n}\n\nexport const argMinConfig: KernelConfig = {\n  kernelName: ArgMin,\n  backendName: 'cpu',\n  kernelFunc: argMin as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Asin, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const asin = unaryKernelFunc(Asin, (xi) => Math.asin(xi));\n\nexport const asinConfig: KernelConfig = {\n  kernelName: Asin,\n  backendName: 'cpu',\n  kernelFunc: asin,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Asinh, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const asinh = unaryKernelFunc(Asinh, (xi) => Math.asinh(xi));\n\nexport const asinhConfig: KernelConfig = {\n  kernelName: Asinh,\n  backendName: 'cpu',\n  kernelFunc: asinh,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Atan, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const atan = unaryKernelFunc(Atan, (xi) => Math.atan(xi));\n\nexport const atanConfig: KernelConfig = {\n  kernelName: Atan,\n  backendName: 'cpu',\n  kernelFunc: atan,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Atan2, KernelConfig} from '@tensorflow/tfjs-core';\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const atan2Impl = createSimpleBinaryKernelImpl(\n    (aValue, bValue) => Math.atan2(aValue as number, bValue as number));\n\nexport const atan2 = binaryKernelFunc(Atan2, atan2Impl);\n\nexport const atan2Config: KernelConfig = {\n  kernelName: Atan2,\n  backendName: 'cpu',\n  kernelFunc: atan2,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Atanh, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const atanh = unaryKernelFunc(Atanh, (xi) => Math.atanh(xi));\n\nexport const atanhConfig: KernelConfig = {\n  kernelName: Atanh,\n  backendName: 'cpu',\n  kernelFunc: atanh,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, buffer, DataType, Rank, TensorBuffer, TypedArray} from '@tensorflow/tfjs-core';\n\nexport function pool(\n    xValues: TypedArray, xShape: number[], dtype: DataType, strides: number[],\n    convInfo: backend_util.Conv2DInfo,\n    poolType: 'max'|'avg'): TensorBuffer<Rank, DataType> {\n  const strideHeight = convInfo.strideHeight;\n  const strideWidth = convInfo.strideWidth;\n  const dilationHeight = convInfo.dilationHeight;\n  const dilationWidth = convInfo.dilationWidth;\n  const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n  const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n  const padTop = convInfo.padInfo.top;\n  const padLeft = convInfo.padInfo.left;\n\n  const initialValue =\n      (poolType === 'max' ? Number.NEGATIVE_INFINITY :\n                            Number.POSITIVE_INFINITY);\n\n  const output = buffer(convInfo.outShape, dtype);\n  const outputVals = output.values;\n\n  const outputBatchStrides =\n      convInfo.outShape[1] * convInfo.outShape[2] * convInfo.outShape[3];\n  const outputRowStrides = convInfo.outShape[2] * convInfo.outShape[3];\n  const outputColStrides = convInfo.outShape[3];\n\n  for (let b = 0; b < convInfo.batchSize; ++b) {\n    const outputBatchOffset = b * outputBatchStrides;\n    const inputBatchOffset = b * strides[0];\n    for (let d = 0; d < convInfo.inChannels; ++d) {\n      for (let yR = 0; yR < convInfo.outHeight; ++yR) {\n        const xRCorner = yR * strideHeight - padTop;\n        const xRMin = Math.max(0, xRCorner);\n        const xRMax =\n            Math.min(convInfo.inHeight, effectiveFilterHeight + xRCorner);\n        const outputRowOffset = outputBatchOffset + yR * outputRowStrides;\n        for (let yC = 0; yC < convInfo.outWidth; ++yC) {\n          const xCCorner = yC * strideWidth - padLeft;\n          const xCMin = Math.max(0, xCCorner);\n          const xCMax =\n              Math.min(convInfo.inWidth, effectiveFilterWidth + xCCorner);\n          let minMaxValue = initialValue;\n          let avgValue = 0;\n          let count = 0;\n          for (let xR = xRMin; xR < xRMax; xR += dilationHeight) {\n            const xROffset = inputBatchOffset + xR * strides[1];\n            for (let xC = xCMin; xC < xCMax; xC += dilationWidth) {\n              const xCOffset = xROffset + xC * strides[2];\n              const pixel = xValues[xCOffset + d];\n              if ((poolType === 'max' && pixel > minMaxValue)) {\n                minMaxValue = pixel;\n              } else if (poolType === 'avg') {\n                avgValue += pixel;\n                count++;\n              }\n            }\n            if (isNaN(minMaxValue)) {\n              break;\n            }\n          }\n          const outputOffset = outputRowOffset + yC * outputColStrides + d;\n          outputVals[outputOffset] =\n              poolType === 'avg' ? avgValue / count : minMaxValue;\n        }\n      }\n    }\n  }\n  return output;\n}\n\nexport function maxPoolPositions(\n    xValues: TypedArray, xShape: number[], dtype: DataType,\n    convInfo: backend_util.Conv2DInfo, flattenPositions = false,\n    includeBatchInIndex = false): TensorBuffer<Rank, 'int32'> {\n  const maxPositions = buffer(convInfo.outShape, 'int32');\n  const strideHeight = convInfo.strideHeight;\n  const strideWidth = convInfo.strideWidth;\n  const dilationHeight = convInfo.dilationHeight;\n  const dilationWidth = convInfo.dilationWidth;\n  const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n  const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n  const padTop = convInfo.padInfo.top;\n  const padLeft = convInfo.padInfo.left;\n\n  const xBuf = buffer(xShape, dtype, xValues);\n  for (let b = 0; b < convInfo.batchSize; ++b) {\n    for (let d = 0; d < convInfo.inChannels; ++d) {\n      for (let yR = 0; yR < convInfo.outHeight; ++yR) {\n        const xRCorner = yR * strideHeight - padTop;\n        let xRMin = xRCorner;\n        while (xRMin < 0) {\n          xRMin += dilationHeight;\n        }\n        // const xRMin = Math.max(0, xRCorner);\n        const xRMax =\n            Math.min(convInfo.inHeight, effectiveFilterHeight + xRCorner);\n        for (let yC = 0; yC < convInfo.outWidth; ++yC) {\n          const xCCorner = yC * strideWidth - padLeft;\n          let xCMin = xCCorner;\n          while (xCMin < 0) {\n            xCMin += dilationWidth;\n          }\n          const xCMax =\n              Math.min(convInfo.inWidth, effectiveFilterWidth + xCCorner);\n          let maxValue = Number.NEGATIVE_INFINITY;\n          let maxPosition = -1;\n\n          for (let xR = xRMin; xR < xRMax; xR += dilationHeight) {\n            const wR = xR - xRCorner;\n            for (let xC = xCMin; xC < xCMax; xC += dilationWidth) {\n              const wC = xC - xCCorner;\n              const pixel = xBuf.get(b, xR, xC, d);\n              if (pixel > maxValue) {\n                maxValue = pixel as number;\n                if (flattenPositions) {\n                  maxPosition = includeBatchInIndex ?\n                      ((b * convInfo.inHeight + xR) * convInfo.inWidth + xC) *\n                              convInfo.inChannels +\n                          d :\n                      (xR * convInfo.inWidth + xC) * convInfo.inChannels + d;\n                } else {\n                  maxPosition = wR * effectiveFilterWidth + wC;\n                }\n              }\n            }\n          }\n          maxPositions.set(maxPosition, b, yR, yC, d);\n        }\n      }\n    }\n  }\n  return maxPositions;\n}\n\nexport function pool3d(\n    xValues: TypedArray, xShape: number[], dtype: DataType, strides: number[],\n    convInfo: backend_util.Conv3DInfo,\n    poolType: 'max'|'avg'): TensorBuffer<Rank, DataType> {\n  const strideDepth = convInfo.strideDepth;\n  const strideHeight = convInfo.strideHeight;\n  const strideWidth = convInfo.strideWidth;\n  const dilationDepth = convInfo.dilationDepth;\n  const dilationHeight = convInfo.dilationHeight;\n  const dilationWidth = convInfo.dilationWidth;\n  const effectiveFilterDepth = convInfo.effectiveFilterDepth;\n  const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n  const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n  const padFront = convInfo.padInfo.front;\n  const padTop = convInfo.padInfo.top;\n  const padLeft = convInfo.padInfo.left;\n\n  const initialValue =\n      (poolType === 'max' ? Number.NEGATIVE_INFINITY :\n                            Number.POSITIVE_INFINITY);\n\n  const output = buffer(convInfo.outShape, dtype);\n  const outputVals = output.values;\n\n  const outputBatchStrides = convInfo.outShape[1] * convInfo.outShape[2] *\n      convInfo.outShape[3] * convInfo.outShape[4];\n  const outputDepthStrides =\n      convInfo.outShape[2] * convInfo.outShape[3] * convInfo.outShape[4];\n  const outputRowStrides = convInfo.outShape[3] * convInfo.outShape[4];\n  const outputColStrides = convInfo.outShape[4];\n\n  for (let batch = 0; batch < convInfo.batchSize; ++batch) {\n    const outputBatchOffset = batch * outputBatchStrides;\n    const inputBatchOffset = batch * strides[0];\n    for (let channel = 0; channel < convInfo.inChannels; ++channel) {\n      for (let yDepth = 0; yDepth < convInfo.outDepth; ++yDepth) {\n        const xDepthCorner = yDepth * strideDepth - padFront;\n        let xDepthMin = xDepthCorner;\n        while (xDepthMin < 0) {\n          xDepthMin += dilationDepth;\n        }\n        const xDepthMax =\n            Math.min(convInfo.inDepth, effectiveFilterDepth + xDepthCorner);\n        const outputDepthOffset =\n            outputBatchOffset + yDepth * outputDepthStrides;\n        for (let yRow = 0; yRow < convInfo.outHeight; ++yRow) {\n          const xRowCorner = yRow * strideHeight - padTop;\n          let xRowMin = xRowCorner;\n          while (xRowMin < 0) {\n            xRowMin += dilationHeight;\n          }\n          const xRowMax =\n              Math.min(convInfo.inHeight, effectiveFilterHeight + xRowCorner);\n          const outputRowOffset = outputDepthOffset + yRow * outputRowStrides;\n          for (let yCol = 0; yCol < convInfo.outWidth; ++yCol) {\n            const xColCorner = yCol * strideWidth - padLeft;\n            let xColMin = xColCorner;\n            while (xColMin < 0) {\n              xColMin += dilationWidth;\n            }\n            const xColMax =\n                Math.min(convInfo.inWidth, effectiveFilterWidth + xColCorner);\n            // Shader code begins\n            const outputColOffset = outputRowOffset + yCol * outputColStrides;\n            let minMaxValue = initialValue;\n            let avgValue = 0;\n            let count = 0;\n            for (let xDepth = xDepthMin; xDepth < xDepthMax;\n                 xDepth += dilationDepth) {\n              const xDepthOffset = inputBatchOffset + xDepth * strides[1];\n              for (let xRow = xRowMin; xRow < xRowMax; xRow += dilationHeight) {\n                const xRowOffset = xDepthOffset + xRow * strides[2];\n                for (let xCol = xColMin; xCol < xColMax;\n                     xCol += dilationWidth) {\n                  const xColOffset = xRowOffset + xCol * strides[3];\n                  const pixel = xValues[xColOffset + channel];\n                  if ((poolType === 'max' && pixel > minMaxValue)) {\n                    minMaxValue = pixel;\n                  } else if (poolType === 'avg') {\n                    avgValue += pixel;\n                    count++;\n                  }\n                  if (isNaN(minMaxValue)) {\n                    break;\n                  }\n                }\n                if (isNaN(minMaxValue)) {\n                  break;\n                }\n              }\n              if (isNaN(minMaxValue)) {\n                break;\n              }\n            }\n            const outputOffset = outputColOffset + channel;\n            outputVals[outputOffset] =\n                poolType === 'avg' ? avgValue / count : minMaxValue;\n          }\n        }\n      }\n    }\n  }\n\n  return output;\n}\n\nexport function maxPool3dPositions(\n    xBuf: TensorBuffer<Rank, DataType>,\n    convInfo: backend_util.Conv3DInfo): TensorBuffer<Rank, DataType> {\n  const maxPositions = buffer(convInfo.outShape, 'int32');\n  const strideDepth = convInfo.strideDepth;\n  const strideHeight = convInfo.strideHeight;\n  const strideWidth = convInfo.strideWidth;\n  const dilationDepth = convInfo.dilationDepth;\n  const dilationHeight = convInfo.dilationHeight;\n  const dilationWidth = convInfo.dilationWidth;\n  const effectiveFilterDepth = convInfo.effectiveFilterDepth;\n  const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n  const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n  const padFront = convInfo.padInfo.front;\n  const padTop = convInfo.padInfo.top;\n  const padLeft = convInfo.padInfo.left;\n\n  for (let batch = 0; batch < convInfo.batchSize; ++batch) {\n    for (let channel = 0; channel < convInfo.inChannels; ++channel) {\n      for (let yDepth = 0; yDepth < convInfo.outDepth; ++yDepth) {\n        const xDepthCorner = yDepth * strideDepth - padFront;\n        let xDepthMin = xDepthCorner;\n        while (xDepthMin < 0) {\n          xDepthMin += dilationDepth;\n        }\n        const xDepthMax =\n            Math.min(convInfo.inDepth, effectiveFilterDepth + xDepthCorner);\n        for (let yRow = 0; yRow < convInfo.outHeight; ++yRow) {\n          const xRowCorner = yRow * strideHeight - padTop;\n          let xRowMin = xRowCorner;\n          while (xRowMin < 0) {\n            xRowMin += dilationHeight;\n          }\n          const xRowMax =\n              Math.min(convInfo.inHeight, effectiveFilterHeight + xRowCorner);\n          for (let yCol = 0; yCol < convInfo.outWidth; ++yCol) {\n            const xColCorner = yCol * strideWidth - padLeft;\n            let xColMin = xColCorner;\n            while (xColMin < 0) {\n              xColMin += dilationWidth;\n            }\n            const xColMax =\n                Math.min(convInfo.inWidth, effectiveFilterWidth + xColCorner);\n\n            // Shader code begins\n            let maxValue = Number.NEGATIVE_INFINITY;\n            let maxPosition = -1;\n\n            for (let xDepth = xDepthMin; xDepth < xDepthMax;\n                 xDepth += dilationDepth) {\n              const wDepth = xDepth - xDepthCorner;\n              for (let xRow = xRowMin; xRow < xRowMax; xRow += dilationHeight) {\n                const wRow = xRow - xRowCorner;\n                for (let xCol = xColMin; xCol < xColMax;\n                     xCol += dilationWidth) {\n                  const wCol = xCol - xColCorner;\n                  const pixel = xBuf.get(batch, xDepth, xRow, xCol, channel);\n                  if (pixel >= maxValue) {\n                    maxValue = pixel as number;\n                    maxPosition =\n                        wDepth * effectiveFilterHeight * effectiveFilterWidth +\n                        wRow * effectiveFilterHeight + wCol;\n                  }\n                }\n              }\n            }\n\n            maxPositions.set(maxPosition, batch, yDepth, yRow, yCol, channel);\n          }\n        }\n      }\n    }\n  }\n\n  return maxPositions;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport {AvgPool, AvgPoolAttrs, AvgPoolInputs, backend_util, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {pool} from '../utils/pool_utils';\nimport {identity} from './Identity';\n\nexport function avgPool(\n    args:\n        {inputs: AvgPoolInputs, backend: MathBackendCPU, attrs: AvgPoolAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  assertNotComplex(x, 'avgPool');\n  const {filterSize, strides, pad, dimRoundingMode} = attrs;\n  const dilations = 1;\n\n  util.assert(\n      backend_util.eitherStridesOrDilationsAreOne(strides, dilations),\n      () => 'Error in avgPool: Either strides or dilations must be 1. ' +\n          `Got strides ${strides} and dilations '${dilations}'`);\n\n  const convInfo = backend_util.computePool2DInfo(\n      x.shape as [number, number, number, number], filterSize, strides,\n      dilations, pad, dimRoundingMode);\n  let res: TensorInfo;\n\n  if (convInfo.filterWidth === 1 && convInfo.filterHeight === 1 &&\n      util.arraysEqual(convInfo.inShape, convInfo.outShape)) {\n    res = identity({inputs: {x}, backend});\n  } else {\n    const xValues = backend.data.get(x.dataId).values as TypedArray;\n    const strides = util.computeStrides(x.shape);\n    const buffer = pool(xValues, x.shape, x.dtype, strides, convInfo, 'avg');\n    res = backend.makeTensorInfo(\n        convInfo.outShape, x.dtype, buffer.values as TypedArray);\n  }\n  return res;\n}\n\nexport const avgPoolConfig: KernelConfig = {\n  kernelName: AvgPool,\n  backendName: 'cpu',\n  kernelFunc: avgPool as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {AvgPool3D, AvgPool3DAttrs, AvgPool3DInputs, backend_util, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {pool3d} from '../utils/pool_utils';\n\nexport function avgPool3D(args: {\n  inputs: AvgPool3DInputs,\n  backend: MathBackendCPU,\n  attrs: AvgPool3DAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {filterSize, strides, pad, dimRoundingMode, dataFormat} = attrs;\n\n  assertNotComplex(x, 'avgPool3d');\n\n  const convInfo = backend_util.computePool3DInfo(\n      x.shape as [number, number, number, number, number], filterSize, strides,\n      1 /* dilations */, pad, dimRoundingMode, dataFormat);\n\n  const xValues = backend.data.get(x.dataId).values as TypedArray;\n  const outBuf = pool3d(\n      xValues, x.shape, x.dtype, util.computeStrides(x.shape), convInfo, 'avg');\n\n  return backend.makeTensorInfo(outBuf.shape, 'float32', outBuf.values);\n}\n\nexport const avgPool3DConfig: KernelConfig = {\n  kernelName: AvgPool3D,\n  backendName: 'cpu',\n  kernelFunc: avgPool3D as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {AvgPool3DGrad, AvgPool3DGradAttrs, AvgPool3DGradInputs, backend_util, buffer, KernelConfig, KernelFunc, Rank, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function avgPool3DGrad(args: {\n  inputs: AvgPool3DGradInputs,\n  backend: MathBackendCPU,\n  attrs: AvgPool3DGradAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {dy, input} = inputs;\n  const {filterSize, strides, pad, dimRoundingMode} = attrs;\n\n  assertNotComplex([dy, input], 'avgPool3DGrad');\n\n  const convInfo = backend_util.computePool3DInfo(\n      input.shape as [number, number, number, number, number], filterSize,\n      strides, 1 /* dilations */, pad, dimRoundingMode);\n\n  const strideDepth = convInfo.strideDepth;\n  const strideHeight = convInfo.strideHeight;\n  const strideWidth = convInfo.strideWidth;\n  const filterDepth = convInfo.filterDepth;\n  const filterHeight = convInfo.filterHeight;\n  const filterWidth = convInfo.filterWidth;\n  const dilationDepth = convInfo.dilationDepth;\n  const dilationHeight = convInfo.dilationHeight;\n  const dilationWidth = convInfo.dilationWidth;\n  const effectiveFilterDepth = convInfo.effectiveFilterDepth;\n  const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n  const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n  const padFront = effectiveFilterDepth - 1 - convInfo.padInfo.front;\n  const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n  const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n  const dx = buffer(input.shape, 'float32');\n\n  const avgMultiplier = 1 / (filterDepth * filterHeight * filterWidth);\n\n  const dyBuf = backend.bufferSync<Rank, 'float32'>(dy);\n\n  for (let batch = 0; batch < convInfo.batchSize; ++batch) {\n    for (let channel = 0; channel < convInfo.inChannels; ++channel) {\n      for (let dxDepth = 0; dxDepth < convInfo.inDepth; ++dxDepth) {\n        for (let dxRow = 0; dxRow < convInfo.inHeight; ++dxRow) {\n          for (let dxCol = 0; dxCol < convInfo.inWidth; ++dxCol) {\n            // Shader code begins.\n            const dyDepthCorner = dxDepth - padFront;\n            const dyRowCorner = dxRow - padTop;\n            const dyColCorner = dxCol - padLeft;\n            let dotProd = 0;\n            for (let wDepth = 0; wDepth < effectiveFilterDepth;\n                 wDepth += dilationDepth) {\n              const dyDepth = (dyDepthCorner + wDepth) / strideDepth;\n              if (dyDepth < 0 || dyDepth >= convInfo.outDepth ||\n                  Math.floor(dyDepth) !== dyDepth) {\n                continue;\n              }\n              for (let wRow = 0; wRow < effectiveFilterHeight;\n                   wRow += dilationHeight) {\n                const dyRow = (dyRowCorner + wRow) / strideHeight;\n                if (dyRow < 0 || dyRow >= convInfo.outHeight ||\n                    Math.floor(dyRow) !== dyRow) {\n                  continue;\n                }\n                for (let wCol = 0; wCol < effectiveFilterWidth;\n                     wCol += dilationWidth) {\n                  const dyCol = (dyColCorner + wCol) / strideWidth;\n                  if (dyCol < 0 || dyCol >= convInfo.outWidth ||\n                      Math.floor(dyCol) !== dyCol) {\n                    continue;\n                  }\n\n                  const pixel =\n                      dyBuf.get(batch, dyDepth, dyRow, dyCol, channel);\n                  dotProd += pixel;\n                }\n              }\n            }\n            dx.set(\n                dotProd * avgMultiplier, batch, dxDepth, dxRow, dxCol, channel);\n          }\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(dx.shape, dx.dtype, dx.values);\n}\n\nexport const avgPool3DGradConfig: KernelConfig = {\n  kernelName: AvgPool3DGrad,\n  backendName: 'cpu',\n  kernelFunc: avgPool3DGrad as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport {AvgPoolGrad, AvgPoolGradAttrs, AvgPoolGradInputs, backend_util, buffer, KernelConfig, KernelFunc, Rank, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function avgPoolGrad(args: {\n  inputs: AvgPoolGradInputs,\n  backend: MathBackendCPU,\n  attrs: AvgPoolGradAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {dy, input} = inputs;\n  const x = input;\n  assertNotComplex([dy, input], 'avgPoolGrad');\n  const {filterSize, strides, pad} = attrs;\n\n  const convInfo = backend_util.computePool2DInfo(\n      x.shape as [number, number, number, number], filterSize, strides,\n      1 /* dilations */, pad);\n  const strideHeight = convInfo.strideHeight;\n  const strideWidth = convInfo.strideWidth;\n  const filterHeight = convInfo.filterHeight;\n  const filterWidth = convInfo.filterWidth;\n  const dilationHeight = convInfo.dilationHeight;\n  const dilationWidth = convInfo.dilationWidth;\n  const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n  const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n  const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n  const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n  const dx =\n      buffer<Rank.R4>(x.shape as [number, number, number, number], 'float32');\n\n  const avgMultiplier = 1 / (filterHeight * filterWidth);\n\n  const dyData = backend.data.get(dy.dataId).values as Float32Array;\n  const dyBuf = buffer<Rank.R4>(\n      dy.shape as [number, number, number, number], 'float32', dyData);\n\n  for (let b = 0; b < convInfo.batchSize; ++b) {\n    for (let d = 0; d < convInfo.inChannels; ++d) {\n      for (let dxR = 0; dxR < convInfo.inHeight; ++dxR) {\n        for (let dxC = 0; dxC < convInfo.inWidth; ++dxC) {\n          // Shader code begins.\n          const dyRCorner = dxR - padTop;\n          const dyCCorner = dxC - padLeft;\n          let dotProd = 0;\n          for (let wR = 0; wR < effectiveFilterHeight; wR += dilationHeight) {\n            const dyR = (dyRCorner + wR) / strideHeight;\n            if (dyR < 0 || dyR >= convInfo.outHeight ||\n                Math.floor(dyR) !== dyR) {\n              continue;\n            }\n            for (let wC = 0; wC < effectiveFilterWidth; wC += dilationWidth) {\n              const dyC = (dyCCorner + wC) / strideWidth;\n              if (dyC < 0 || dyC >= convInfo.outWidth ||\n                  Math.floor(dyC) !== dyC) {\n                continue;\n              }\n\n              const pixel = dyBuf.get(b, dyR, dyC, d);\n              dotProd += pixel;\n            }\n          }\n          dx.set(dotProd * avgMultiplier, b, dxR, dxC, d);\n        }\n      }\n    }\n  }\n  return backend.makeTensorInfo(dx.shape, dx.dtype, dx.values);\n}\n\nexport const avgPoolGradConfig: KernelConfig = {\n  kernelName: AvgPoolGrad,\n  backendName: 'cpu',\n  kernelFunc: avgPoolGrad as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {FusedBatchNorm, FusedBatchNormAttrs, FusedBatchNormInputs, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function batchNorm(args: {\n  inputs: FusedBatchNormInputs,\n  backend: MathBackendCPU,\n  attrs: FusedBatchNormAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, scale, offset, mean, variance} = inputs;\n\n  util.assert(\n      mean.shape.length === variance.shape.length,\n      () => 'Batch normalization gradient requires mean and variance to have ' +\n          'equal ranks.');\n  util.assert(\n      offset == null || mean.shape.length === offset.shape.length,\n      () => 'Batch normalization gradient requires mean and offset to have ' +\n          'equal ranks.');\n  util.assert(\n      scale == null || mean.shape.length === scale.shape.length,\n      () => 'Batch normalization gradient requires mean and scale to have ' +\n          'equal ranks.');\n\n  assertNotComplex([x, mean, variance, scale, offset], 'batchNorm');\n\n  let {varianceEpsilon} = attrs;\n  if (varianceEpsilon == null) {\n    varianceEpsilon = 0.001;\n  }\n\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const mVals = backend.data.get(mean.dataId).values as TypedArray;\n  const varVals = backend.data.get(variance.dataId).values as TypedArray;\n  const sVals = scale ? backend.data.get(scale.dataId).values as TypedArray :\n                        new Float32Array([1]);\n  const offVals = offset ?\n      backend.data.get(offset.dataId).values as TypedArray :\n      new Float32Array([0]);\n  const outVals = new Float32Array(xVals.length);\n\n  const offValsLength = offVals.length;\n  const sValsLength = sVals.length;\n  const varValsLength = varVals.length;\n  const mValsLength = mVals.length;\n\n  let offi = 0;\n  let mi = 0;\n  let si = 0;\n  let vi = 0;\n  for (let i = 0; i < xVals.length; ++i) {\n    outVals[i] = offVals[offi++] +\n        (xVals[i] - mVals[mi++]) * sVals[si++] /\n            Math.sqrt(varVals[vi++] + varianceEpsilon);\n    if (offi >= offValsLength) {\n      offi = 0;\n    }\n    if (mi >= mValsLength) {\n      mi = 0;\n    }\n    if (si >= sValsLength) {\n      si = 0;\n    }\n    if (vi >= varValsLength) {\n      vi = 0;\n    }\n  }\n  return backend.makeTensorInfo(x.shape, x.dtype, outVals);\n}\n\nexport const batchNormConfig: KernelConfig = {\n  kernelName: FusedBatchNorm,\n  backendName: 'cpu',\n  kernelFunc: batchNorm as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, BatchToSpaceND, BatchToSpaceNDAttrs, BatchToSpaceNDInputs, KernelConfig, KernelFunc, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {reshape} from './Reshape';\nimport {slice} from './Slice';\nimport {transpose} from './Transpose';\n\nexport function batchToSpaceND(args: {\n  inputs: BatchToSpaceNDInputs,\n  backend: MathBackendCPU,\n  attrs: BatchToSpaceNDAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {blockShape, crops} = attrs;\n\n  assertNotComplex([x], 'batchToSpaceND');\n\n  const prod = blockShape.reduce((a, b) => a * b);\n\n  const reshaped = backend_util.getReshaped(x.shape, blockShape, prod);\n  const permuted = backend_util.getPermuted(reshaped.length, blockShape.length);\n  const reshapedPermuted =\n      backend_util.getReshapedPermuted(x.shape, blockShape, prod);\n  const sliceBeginCoords =\n      backend_util.getSliceBeginCoords(crops, blockShape.length);\n  const sliceSize =\n      backend_util.getSliceSize(reshapedPermuted, crops, blockShape.length);\n\n  const xReshaped = reshape({inputs: {x}, backend, attrs: {shape: reshaped}});\n  const xTransposed =\n      transpose({inputs: {x: xReshaped}, backend, attrs: {perm: permuted}});\n  const xTransposedReshaped = reshape(\n      {inputs: {x: xTransposed}, backend, attrs: {shape: reshapedPermuted}});\n  const result = slice({\n    inputs: {x: xTransposedReshaped},\n    backend,\n    attrs: {begin: sliceBeginCoords, size: sliceSize}\n  });\n\n  backend.disposeIntermediateTensorInfo(xReshaped);\n  backend.disposeIntermediateTensorInfo(xTransposed);\n  backend.disposeIntermediateTensorInfo(xTransposedReshaped);\n\n  return result;\n}\n\nexport const batchToSpaceNDConfig: KernelConfig = {\n  kernelName: BatchToSpaceND,\n  backendName: 'cpu',\n  kernelFunc: batchToSpaceND as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Bincount, BincountAttrs, BincountInputs, KernelConfig, KernelFunc, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {bincountImpl} from './Bincount_impl';\n\nexport function bincount(args: {\n  inputs: BincountInputs,\n  backend: MathBackendCPU,\n  attrs: BincountAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, weights} = inputs;\n  const {size} = attrs;\n\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const weightsVals = backend.data.get(weights.dataId).values as TypedArray;\n\n  const outVals =\n      bincountImpl(xVals, weightsVals, weights.dtype, weights.shape, size);\n\n  return backend.makeTensorInfo([size], weights.dtype, outVals);\n}\n\nexport const bincountConfig: KernelConfig = {\n  kernelName: Bincount,\n  backendName: 'cpu',\n  kernelFunc: bincount as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, BroadcastArgs, BroadcastArgsInputs, KernelConfig, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport function broadcastArgs(args: {\n  inputs: BroadcastArgsInputs,\n  backend: MathBackendCPU,\n}): TensorInfo {\n  const {inputs, backend} = args;\n  const {s0, s1} = inputs;\n\n  const s0Vals = backend.data.get(s0.dataId).values as TypedArray;\n  const s1Vals = backend.data.get(s1.dataId).values as TypedArray;\n\n  const broadcastShape = backend_util.assertAndGetBroadcastShape(\n      Array.from(s0Vals), Array.from(s1Vals));\n\n  return backend.makeTensorInfo(\n      [broadcastShape.length], 'int32', Int32Array.from(broadcastShape));\n}\n\nexport const broadcastArgsConfig: KernelConfig = {\n  kernelName: BroadcastArgs,\n  backendName: 'cpu',\n  kernelFunc: broadcastArgs\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {ClipByValue, ClipByValueAttrs, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const clipByValue = unaryKernelFunc(ClipByValue, (xi, attrs) => {\n  const clipAttrs = attrs as {} as ClipByValueAttrs;\n  if (xi > clipAttrs.clipValueMax) {\n    return clipAttrs.clipValueMax;\n  }\n  return xi < clipAttrs.clipValueMin ? clipAttrs.clipValueMin : xi;\n});\n\nexport const clipByValueConfig: KernelConfig = {\n  kernelName: ClipByValue,\n  backendName: 'cpu',\n  kernelFunc: clipByValue,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {ComplexAbs, ComplexAbsInputs, KernelConfig, KernelFunc, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport const complexAbs =\n    (args: {inputs: ComplexAbsInputs, backend: MathBackendCPU}) => {\n      const {x} = args.inputs;\n      const cpuBackend = args.backend;\n      const resultValues = new Float32Array(util.sizeFromShape(x.shape));\n      const complexVals = cpuBackend.data.get(x.dataId);\n      const real = complexVals.complexTensorInfos.real;\n      const imag = complexVals.complexTensorInfos.imag;\n      const realVals = cpuBackend.data.get(real.dataId).values as Float32Array;\n      const imagVals = cpuBackend.data.get(imag.dataId).values as Float32Array;\n      for (let i = 0; i < realVals.length; i++) {\n        const real = realVals[i];\n        const imag = imagVals[i];\n        resultValues[i] = Math.hypot(real, imag);\n      }\n\n      return cpuBackend.makeOutput(resultValues, x.shape, 'float32');\n    };\n\nexport const complexAbsConfig: KernelConfig = {\n  kernelName: ComplexAbs,\n  backendName: 'cpu',\n  kernelFunc: complexAbs as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Imag, ImagInputs, KernelConfig, KernelFunc, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport function imag(args: {inputs: ImagInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {input} = inputs;\n\n  const imag = backend.data.get(input.dataId).complexTensorInfos.imag;\n  const imagVal = backend.data.get(imag.dataId).values;\n\n  // When complex tensor is disposed, its underlying parts will be disposed too.\n  // Make new tensor out of the imag value of the complex. This makes sure the\n  // value is still accessible even if complex tensor is disposed.\n  return backend.makeTensorInfo(imag.shape, imag.dtype, imagVal);\n}\n\nexport const imagConfig: KernelConfig = {\n  kernelName: Imag,\n  backendName: 'cpu',\n  kernelFunc: imag as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Concat, ConcatAttrs, ConcatInputs, KernelConfig, KernelFunc, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {complex} from './Complex';\nimport {concatImpl} from './Concat_impl';\nimport {identity} from './Identity';\nimport {imag} from './Imag';\nimport {real} from './Real';\nimport {reshape} from './Reshape';\n\nexport function concat(\n    args: {inputs: ConcatInputs, backend: MathBackendCPU, attrs: ConcatAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {axis} = attrs;\n\n  const $axis = util.parseAxisParam(axis, inputs[0].shape)[0];\n\n  const shapes = inputs.map(t => t.shape);\n  backend_util.assertParamsConsistent(shapes, $axis);\n\n  let outShape = backend_util.computeOutShape(inputs.map(t => t.shape), $axis);\n\n  if (util.sizeFromShape(outShape) === 0) {\n    return backend.makeTensorInfo(outShape, inputs[0].dtype, []);\n  }\n\n  // Keep only non-empty tensors (ignore tensors with 0 in their shape).\n  const $inputs = inputs.filter(t => util.sizeFromShape(t.shape) > 0);\n  if ($inputs.length === 1) {\n    return identity({inputs: {x: $inputs[0]}, backend});\n  }\n\n  if ($inputs[0].dtype === 'complex64') {\n    const reals = $inputs.map((t) => real({inputs: {input: t}, backend}));\n    const imags = $inputs.map((t) => imag({inputs: {input: t}, backend}));\n\n    const realConcated = concat({inputs: reals, backend, attrs: {axis: $axis}});\n    const imagConcated = concat({inputs: imags, backend, attrs: {axis: $axis}});\n\n    const result =\n        complex({inputs: {real: realConcated, imag: imagConcated}, backend});\n\n    reals.forEach(r => backend.disposeIntermediateTensorInfo(r));\n    imags.forEach(i => backend.disposeIntermediateTensorInfo(i));\n    backend.disposeIntermediateTensorInfo(realConcated);\n    backend.disposeIntermediateTensorInfo(imagConcated);\n\n    return result;\n  }\n\n  // Any concat of n-dimensional tensors across any axis can be reduced to\n  // a concatenation of two-dimensional tensors across the axis 1 by first\n  // partitioning the axes of the original tensors into those less than the\n  // axis to be concatenated and the rest. Then reshape the tensors\n  // into a two-dimensional tensor by collapsing these two sets of axes and\n  // concatenate the resulting matrices across the axis 1, finally reshaping\n  // the result to have the proper shape.\n  const inputs2D = $inputs.map(t => {\n    const innerSize = util.sizeFromShape(t.shape.slice($axis));\n    const shape = [-1, innerSize];\n    return reshape({inputs: {x: t}, backend, attrs: {shape}});\n  });\n\n  const inputsValShapes = inputs2D.map(t => {\n    return {vals: backend.data.get(t.dataId).values, shape: t.shape};\n  });\n\n  // Concats 2d tensors along axis=1.\n  outShape =\n      backend_util.computeOutShape(inputs2D.map(t => t.shape), 1 /* axis */);\n  const simplyConcat = inputs2D[0].shape[0] === 1;\n  const outVals =\n      concatImpl(inputsValShapes, outShape, inputs[0].dtype, simplyConcat);\n\n  const finalOutShape =\n      backend_util.computeOutShape($inputs.map(t => t.shape), $axis);\n\n  const outInfo =\n      backend.makeTensorInfo(finalOutShape, inputs[0].dtype, outVals);\n\n  inputs2D.forEach(t => backend.disposeIntermediateTensorInfo(t));\n\n  return outInfo;\n}\n\nexport const concatConfig: KernelConfig = {\n  kernelName: Concat,\n  backendName: 'cpu',\n  kernelFunc: concat as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Conv2D, Conv2DAttrs, Conv2DInputs, KernelConfig, KernelFunc, TensorBuffer, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function conv2D(\n    args: {inputs: Conv2DInputs, backend: MathBackendCPU, attrs: Conv2DAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, filter} = inputs;\n  const {strides, pad, dataFormat, dilations, dimRoundingMode} = attrs;\n\n  assertNotComplex([x, filter], 'conv2d');\n\n  const $dataFormat = backend_util.convertConv2DDataFormat(dataFormat);\n  const convInfo = backend_util.computeConv2DInfo(\n      x.shape as [number, number, number, number],\n      filter.shape as [number, number, number, number], strides, dilations, pad,\n      dimRoundingMode, false /* depthwise */, $dataFormat);\n\n  const filterHeight = convInfo.filterHeight;\n  const filterWidth = convInfo.filterWidth;\n  const dilationHeight = convInfo.dilationHeight;\n  const dilationWidth = convInfo.dilationWidth;\n  const padLeft = convInfo.padInfo.left;\n  const padTop = convInfo.padInfo.top;\n  const isChannelsLast = convInfo.dataFormat === 'channelsLast';\n\n  const y = new TensorBuffer(convInfo.outShape, x.dtype as 'float32');\n\n  const xStrides = util.computeStrides(x.shape);\n  const filterStrides = util.computeStrides(filter.shape);\n\n  const xBatchStride = xStrides[0];\n  const xRowStride = isChannelsLast ? xStrides[1] : xStrides[2];\n  const xColStride = isChannelsLast ? xStrides[2] : 1;\n  const xChannelStride = isChannelsLast ? 1 : xStrides[1];\n  const yBatchStride = y.strides[0];\n  const yRowStride = isChannelsLast ? y.strides[1] : y.strides[2];\n  const yColStride = isChannelsLast ? y.strides[2] : 1;\n  const yChannelStride = isChannelsLast ? 1 : y.strides[1];\n\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const wVals = backend.data.get(filter.dataId).values as TypedArray;\n  const yVals = y.values;\n\n  for (let b = 0; b < convInfo.batchSize; ++b) {\n    const xOffset1 = b * xBatchStride;\n    const yOffset1 = b * yBatchStride;\n    for (let yR = 0; yR < convInfo.outHeight; ++yR) {\n      const yOffset2 = yOffset1 + yR * yRowStride;\n      const xRCorner = yR * convInfo.strideHeight - padTop;\n      for (let wR = 0; wR < filterHeight; ++wR) {\n        const xR = xRCorner + wR * dilationHeight;\n        if (xR < 0 || xR >= convInfo.inHeight) {\n          continue;\n        }\n        const wOffset1 = wR * filterStrides[0];\n        const xOffset2 = xOffset1 + xR * xRowStride;\n        for (let yC = 0; yC < convInfo.outWidth; ++yC) {\n          const yOffset3 = yOffset2 + yC * yColStride;\n          const xCCorner = yC * convInfo.strideWidth - padLeft;\n          for (let wC = 0; wC < filterWidth; ++wC) {\n            const xC = xCCorner + wC * dilationWidth;\n            if (xC < 0 || xC >= convInfo.inWidth) {\n              continue;\n            }\n            const wOffset2 = wOffset1 + wC * filterStrides[1];\n            const xOffset3 = xOffset2 + xC * xColStride;\n            let wOffset3 = wOffset2;\n            for (let d1 = 0; d1 < convInfo.inChannels; ++d1) {\n              const xVal = xVals[xOffset3 + d1 * xChannelStride];\n              for (let d2 = 0; d2 < convInfo.outChannels; ++d2) {\n                yVals[yOffset3 + d2 * yChannelStride] +=\n                    xVal * wVals[wOffset3 + d2];\n              }\n              wOffset3 += convInfo.outChannels;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(y.shape, y.dtype, yVals);\n}\n\nexport const conv2DConfig: KernelConfig = {\n  kernelName: Conv2D,\n  backendName: 'cpu',\n  kernelFunc: conv2D as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Conv2DBackpropFilter, Conv2DBackpropFilterAttrs, Conv2DBackpropFilterInputs, KernelConfig, KernelFunc, TensorBuffer, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function conv2DBackpropFilter(args: {\n  inputs: Conv2DBackpropFilterInputs,\n  backend: MathBackendCPU,\n  attrs: Conv2DBackpropFilterAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, dy} = inputs;\n  const {strides, pad, dataFormat, dimRoundingMode, filterShape} = attrs;\n\n  assertNotComplex([x, dy], 'conv2dBackpropFilter');\n\n  const $dataFormat = backend_util.convertConv2DDataFormat(dataFormat);\n  const convInfo = backend_util.computeConv2DInfo(\n      x.shape as [number, number, number, number], filterShape, strides,\n      1 /* dilations */, pad, dimRoundingMode, false /* depthwise */,\n      $dataFormat);\n\n  const {strideHeight, strideWidth, filterHeight, filterWidth} = convInfo;\n  const isChannelsLast = convInfo.dataFormat === 'channelsLast';\n  const dW = new TensorBuffer(convInfo.filterShape, 'float32');\n\n  const leftPad = convInfo.padInfo.left;\n  const topPad = convInfo.padInfo.top;\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const dyVals = backend.data.get(dy.dataId).values as TypedArray;\n\n  const xBuf = new TensorBuffer(x.shape, x.dtype, xVals);\n  const dyBuf = new TensorBuffer(dy.shape, dy.dtype, dyVals);\n\n  for (let wR = 0; wR < filterHeight; ++wR) {\n    const yRMin = Math.max(0, Math.ceil((topPad - wR) / strideHeight));\n    const yRMax = Math.min(\n        convInfo.outHeight, (convInfo.inHeight + topPad - wR) / strideHeight);\n\n    for (let wC = 0; wC < filterWidth; ++wC) {\n      const yCMin = Math.max(0, Math.ceil((leftPad - wC) / strideWidth));\n      const yCMax = Math.min(\n          convInfo.outWidth, (convInfo.inWidth + leftPad - wC) / strideWidth);\n\n      for (let d1 = 0; d1 < convInfo.inChannels; ++d1) {\n        for (let d2 = 0; d2 < convInfo.outChannels; ++d2) {\n          let dotProd = 0;\n          for (let b = 0; b < convInfo.batchSize; ++b) {\n            for (let yR = yRMin; yR < yRMax; ++yR) {\n              const xR = wR + yR * strideHeight - topPad;\n              for (let yC = yCMin; yC < yCMax; ++yC) {\n                const xC = wC + yC * strideWidth - leftPad;\n                if (isChannelsLast) {\n                  dotProd += (xBuf.get(b, xR, xC, d1) as number) *\n                      (dyBuf.get(b, yR, yC, d2) as number);\n                } else {\n                  dotProd += (xBuf.get(b, d1, xR, xC) as number) *\n                      (dyBuf.get(b, d2, yR, yC) as number);\n                }\n              }\n            }\n          }\n          dW.set(dotProd, wR, wC, d1, d2);\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(dW.shape, dW.dtype, dW.values);\n}\n\nexport const conv2DBackpropFilterConfig: KernelConfig = {\n  kernelName: Conv2DBackpropFilter,\n  backendName: 'cpu',\n  kernelFunc: conv2DBackpropFilter as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Conv2DBackpropInput, Conv2DBackpropInputAttrs, Conv2DBackpropInputInputs, KernelConfig, KernelFunc, TensorBuffer, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function conv2DBackpropInput(args: {\n  inputs: Conv2DBackpropInputInputs,\n  backend: MathBackendCPU,\n  attrs: Conv2DBackpropInputAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {dy, filter} = inputs;\n  const {inputShape, strides, pad, dataFormat, dimRoundingMode} = attrs;\n\n  assertNotComplex([dy, filter], 'conv2dBackpropInput');\n\n  const filterStrides = util.computeStrides(filter.shape);\n  const dyStrides = util.computeStrides(dy.shape);\n\n  let $dataFormat = backend_util.convertConv2DDataFormat(dataFormat);\n  const convInfo = backend_util.computeConv2DInfo(\n      inputShape, filter.shape as [number, number, number, number], strides,\n      1 /* dilations */, pad, dimRoundingMode, false, $dataFormat);\n\n  const dx = new TensorBuffer(convInfo.inShape, 'float32');\n  const dxValues = dx.values;\n  const dyValues = backend.data.get(dy.dataId).values as TypedArray;\n  const fltValues = backend.data.get(filter.dataId).values as TypedArray;\n  const [fltS0, fltS1, fltS2] = filterStrides;\n  const {\n    batchSize,\n    filterHeight,\n    filterWidth,\n    inChannels,\n    inHeight,\n    inWidth,\n    outChannels,\n    outHeight,\n    outWidth,\n    strideHeight,\n    strideWidth\n  } = convInfo;\n  $dataFormat = convInfo.dataFormat;\n  const topPad = filterHeight - 1 - convInfo.padInfo.top;\n  const leftPad = filterWidth - 1 - convInfo.padInfo.left;\n\n  const isChannelsLast = $dataFormat === 'channelsLast';\n  const xBatchStride = dx.strides[0];\n  const xRowStride = isChannelsLast ? dx.strides[1] : dx.strides[2];\n  const xColStride = isChannelsLast ? dx.strides[2] : 1;\n  const xChannelStride = isChannelsLast ? 1 : dx.strides[1];\n  const yBatchStride = dyStrides[0];\n  const yRowStride = isChannelsLast ? dyStrides[1] : dyStrides[2];\n  const yColStride = isChannelsLast ? dyStrides[2] : 1;\n  const yChannelStride = isChannelsLast ? 1 : dyStrides[1];\n\n  for (let b = 0; b < batchSize; ++b) {\n    for (let d1 = 0; d1 < inChannels; ++d1) {\n      for (let xR = 0; xR < inHeight; ++xR) {\n        const xRCorner = xR - topPad;\n        const xRMin = Math.max(0, Math.ceil(xRCorner / strideHeight));\n        const yRMax =\n            Math.min(outHeight, (filterHeight + xRCorner) / strideHeight);\n\n        for (let xC = 0; xC < inWidth; ++xC) {\n          const xCCorner = xC - leftPad;\n          const xCMin = Math.max(0, Math.ceil(xCCorner / strideWidth));\n          const yCMax =\n              Math.min(outWidth, (filterWidth + xCCorner) / strideWidth);\n\n          let dotProd = 0;\n          for (let yR = xRMin; yR < yRMax; ++yR) {\n            const wR = yR * strideHeight - xRCorner;\n\n            for (let yC = xCMin; yC < yCMax; ++yC) {\n              const wC = yC * strideWidth - xCCorner;\n              const dyOffset =\n                  yBatchStride * b + yRowStride * yR + yColStride * yC;\n              const fltOffset = fltS0 * (filterHeight - 1 - wR) +\n                  fltS1 * (filterWidth - 1 - wC) + fltS2 * d1;\n\n              for (let d2 = 0; d2 < outChannels; ++d2) {\n                const pixel = dyValues[dyOffset + yChannelStride * d2];\n                const weight = fltValues[fltOffset + d2];\n                dotProd += pixel * weight;\n              }\n            }\n          }\n          const dxOffset = xBatchStride * b + xRowStride * xR +\n              xColStride * xC + xChannelStride * d1;\n          dxValues[dxOffset] = dotProd;\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(dx.shape, dx.dtype, dx.values);\n}\n\nexport const conv2DBackpropInputConfig: KernelConfig = {\n  kernelName: Conv2DBackpropInput,\n  backendName: 'cpu',\n  kernelFunc: conv2DBackpropInput as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Conv3D, Conv3DAttrs, Conv3DInputs, KernelConfig, KernelFunc, TensorBuffer, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function conv3D(\n    args: {inputs: Conv3DInputs, backend: MathBackendCPU, attrs: Conv3DAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, filter} = inputs;\n  const {strides, pad, dilations} = attrs;\n\n  assertNotComplex([x, filter], 'conv3d');\n\n  const convInfo = backend_util.computeConv3DInfo(\n      x.shape as [number, number, number, number, number],\n      filter.shape as [number, number, number, number, number], strides,\n      dilations, pad);\n\n  const {\n    filterDepth,\n    filterHeight,\n    filterWidth,\n    dilationDepth,\n    dilationHeight,\n    dilationWidth,\n    padInfo\n  } = convInfo;\n  const padFront = padInfo.front;\n  const padLeft = padInfo.left;\n  const padTop = padInfo.top;\n  const y = new TensorBuffer(convInfo.outShape, x.dtype as 'float32');\n\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const wVals = backend.data.get(filter.dataId).values as TypedArray;\n  const yVals = y.values;\n\n  const xStrides = util.computeStrides(x.shape);\n  const filterStrides = util.computeStrides(filter.shape);\n\n  for (let b = 0; b < convInfo.batchSize; ++b) {\n    const xOffset1 = b * xStrides[0];\n    const yOffset1 = b * y.strides[0];\n    for (let yF = 0; yF < convInfo.outDepth; ++yF) {\n      const yOffset2 = yOffset1 + yF * y.strides[1];\n      const xFCorner = yF * convInfo.strideDepth - padFront;\n      for (let wF = 0; wF < filterDepth; ++wF) {\n        const xF = xFCorner + wF * dilationDepth;\n        if (xF < 0 || xF >= convInfo.inDepth) {\n          continue;\n        }\n        const wOffset1 = wF * filterStrides[0];\n        const xOffset2 = xOffset1 + xF * xStrides[1];\n\n        for (let yR = 0; yR < convInfo.outHeight; ++yR) {\n          const yOffset3 = yOffset2 + yR * y.strides[2];\n          const xRCorner = yR * convInfo.strideHeight - padTop;\n          for (let wR = 0; wR < filterHeight; ++wR) {\n            const xR = xRCorner + wR * dilationHeight;\n            if (xR < 0 || xR >= convInfo.inHeight) {\n              continue;\n            }\n            const wOffset2 = wOffset1 + wR * filterStrides[1];\n            const xOffset3 = xOffset2 + xR * xStrides[2];\n            for (let yC = 0; yC < convInfo.outWidth; ++yC) {\n              const yOffset4 = yOffset3 + yC * convInfo.outChannels;\n              const xCCorner = yC * convInfo.strideWidth - padLeft;\n              for (let wC = 0; wC < filterWidth; ++wC) {\n                const xC = xCCorner + wC * dilationWidth;\n                if (xC < 0 || xC >= convInfo.inWidth) {\n                  continue;\n                }\n                const wOffset3 = wOffset2 + wC * filterStrides[2];\n                const xOffset4 = xOffset3 + xC * convInfo.inChannels;\n                let wOffset4 = wOffset3;\n                for (let d1 = 0; d1 < convInfo.inChannels; ++d1) {\n                  const xVal = xVals[xOffset4 + d1];\n                  for (let d2 = 0; d2 < convInfo.outChannels; ++d2) {\n                    yVals[yOffset4 + d2] += xVal * wVals[wOffset4 + d2];\n                  }\n                  wOffset4 += convInfo.outChannels;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(y.shape, y.dtype, y.values);\n}\n\nexport const conv3DConfig: KernelConfig = {\n  kernelName: Conv3D,\n  backendName: 'cpu',\n  kernelFunc: conv3D as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Conv3DBackpropFilterV2, Conv3DBackpropFilterV2Attrs, Conv3DBackpropFilterV2Inputs, KernelConfig, KernelFunc, TensorBuffer, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function conv3DBackpropFilterV2(args: {\n  inputs: Conv3DBackpropFilterV2Inputs,\n  backend: MathBackendCPU,\n  attrs: Conv3DBackpropFilterV2Attrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, dy} = inputs;\n  const {strides, pad, filterShape} = attrs;\n\n  assertNotComplex([x, dy], 'conv3dBackpropFilterV2');\n\n  const xStrides = util.computeStrides(x.shape);\n  const dyStrides = util.computeStrides(dy.shape);\n\n  const convInfo = backend_util.computeConv3DInfo(\n      x.shape as [number, number, number, number, number], filterShape, strides,\n      1 /* dilations */, pad);\n\n  const strideDepth = convInfo.strideDepth;\n  const strideHeight = convInfo.strideHeight;\n  const strideWidth = convInfo.strideWidth;\n  const filterDepth = convInfo.filterDepth;\n  const filterHeight = convInfo.filterHeight;\n  const filterWidth = convInfo.filterWidth;\n\n  const dw = new TensorBuffer(convInfo.filterShape, 'float32');\n  const dwValues = dw.values;\n  const [dwS0, dwS1, dwS2, dwS3] = dw.strides;\n  const dyValues = backend.data.get(dy.dataId).values as TypedArray;\n  const [dyS0, dyS1, dyS2, dyS3] = dyStrides;\n  const xValues = backend.data.get(x.dataId).values as TypedArray;\n  const [xS0, xS1, xS2, xS3] = xStrides;\n\n  const frontPad = convInfo.padInfo.front;\n  const leftPad = convInfo.padInfo.left;\n  const topPad = convInfo.padInfo.top;\n\n  for (let wF = 0; wF < filterDepth; ++wF) {\n    const yFMin = Math.max(0, Math.ceil((frontPad - wF) / strideDepth));\n    const yFMax = Math.min(\n        convInfo.outDepth, (convInfo.inDepth + frontPad - wF) / strideDepth);\n    const wOffset1 = wF * dwS0;\n\n    for (let wR = 0; wR < filterHeight; ++wR) {\n      const yRMin = Math.max(0, Math.ceil((topPad - wR) / strideHeight));\n      const yRMax = Math.min(\n          convInfo.outHeight, (convInfo.inHeight + topPad - wR) / strideHeight);\n      const wOffset2 = wR * dwS1 + wOffset1;\n\n      for (let wC = 0; wC < filterWidth; ++wC) {\n        const yCMin = Math.max(0, Math.ceil((leftPad - wC) / strideWidth));\n        const yCMax = Math.min(\n            convInfo.outWidth, (convInfo.inWidth + leftPad - wC) / strideWidth);\n        const wOffset3 = wC * dwS2 + wOffset2;\n\n        for (let d1 = 0; d1 < convInfo.inChannels; ++d1) {\n          const wOffset4 = d1 * dwS3 + wOffset3;\n\n          for (let d2 = 0; d2 < convInfo.outChannels; ++d2) {\n            let dotProd = 0;\n            for (let b = 0; b < convInfo.batchSize; ++b) {\n              const xOffset1 = b * xS0;\n              const yOffset1 = b * dyS0;\n\n              for (let yF = yFMin; yF < yFMax; ++yF) {\n                const xF = wF + yF * strideDepth - frontPad;\n                const xOffset2 = xF * xS1 + xOffset1;\n                const yOffset2 = yF * dyS1 + yOffset1;\n\n                for (let yR = yRMin; yR < yRMax; ++yR) {\n                  const xR = wR + yR * strideHeight - topPad;\n                  const xOffset3 = xR * xS2 + xOffset2;\n                  const yOffset3 = yR * dyS2 + yOffset2;\n\n                  for (let yC = yCMin; yC < yCMax; ++yC) {\n                    const xC = wC + yC * strideWidth - leftPad;\n                    const xOffset4 = xC * xS3 + xOffset3;\n                    const yOffset4 = yC * dyS3 + yOffset3;\n\n                    dotProd += xValues[xOffset4 + d1] * dyValues[yOffset4 + d2];\n                  }\n                }\n              }\n            }\n            dwValues[wOffset4 + d2] = dotProd;\n          }\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(dw.shape, dw.dtype, dw.values);\n}\n\nexport const conv3DBackpropFilterV2Config: KernelConfig = {\n  kernelName: Conv3DBackpropFilterV2,\n  backendName: 'cpu',\n  kernelFunc: conv3DBackpropFilterV2 as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Conv3DBackpropInputV2, Conv3DBackpropInputV2Attrs, Conv3DBackpropInputV2Inputs, KernelConfig, KernelFunc, TensorBuffer, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function conv3DBackpropInputV2(args: {\n  inputs: Conv3DBackpropInputV2Inputs,\n  backend: MathBackendCPU,\n  attrs: Conv3DBackpropInputV2Attrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {dy, filter} = inputs;\n  const {pad, strides, inputShape} = attrs;\n\n  assertNotComplex([dy], 'conv3dBackpropInputV2');\n\n  const dyStrides = util.computeStrides(dy.shape);\n  const filterStrides = util.computeStrides(filter.shape);\n\n  const convInfo = backend_util.computeConv3DInfo(\n      inputShape, filter.shape as [number, number, number, number, number],\n      strides, 1 /* dilations */, pad);\n\n  const dx = new TensorBuffer(convInfo.inShape, 'float32');\n  const dxValues = dx.values;\n  const [dxS0, dxS1, dxS2, dxS3] = dx.strides;\n  const dyValues = backend.data.get(dy.dataId).values as TypedArray;\n  const [dyS0, dyS1, dyS2, dyS3] = dyStrides;\n  const fltValues = backend.data.get(filter.dataId).values as TypedArray;\n  const [fltS0, fltS1, fltS2, fltS3] = filterStrides;\n  const {\n    batchSize,\n    filterDepth,\n    filterHeight,\n    filterWidth,\n    inChannels,\n    inDepth,\n    inHeight,\n    inWidth,\n    outChannels,\n    outDepth,\n    outHeight,\n    outWidth,\n    strideDepth,\n    strideHeight,\n    strideWidth\n  } = convInfo;\n  const frontPad = filterDepth - 1 - convInfo.padInfo.front;\n  const topPad = filterHeight - 1 - convInfo.padInfo.top;\n  const leftPad = filterWidth - 1 - convInfo.padInfo.left;\n\n  for (let b = 0; b < batchSize; ++b) {\n    for (let d1 = 0; d1 < inChannels; ++d1) {\n      // Frames of depth\n      for (let xF = 0; xF < inDepth; ++xF) {\n        const xFCorner = xF - frontPad;\n        const xFMin = Math.max(0, Math.ceil(xFCorner / strideDepth));\n        const yFMax =\n            Math.min(outDepth, (filterDepth + xFCorner) / strideDepth);\n\n        // Rows as per standard 2d matrix notation\n        for (let xR = 0; xR < inHeight; ++xR) {\n          const xRCorner = xR - topPad;\n          const xRMin = Math.max(0, Math.ceil(xRCorner / strideHeight));\n          const yRMax =\n              Math.min(outHeight, (filterHeight + xRCorner) / strideHeight);\n          // Columns as per standard 2d matrix notation\n          for (let xC = 0; xC < inWidth; ++xC) {\n            const xCCorner = xC - leftPad;\n            const xCMin = Math.max(0, Math.ceil(xCCorner / strideWidth));\n            const yCMax =\n                Math.min(outWidth, (filterWidth + xCCorner) / strideWidth);\n\n            let dotProd = 0;\n            for (let yF = xFMin; yF < yFMax; ++yF) {\n              const wF = yF * strideDepth - xFCorner;\n\n              for (let yR = xRMin; yR < yRMax; ++yR) {\n                const wR = yR * strideHeight - xRCorner;\n\n                for (let yC = xCMin; yC < yCMax; ++yC) {\n                  const wC = yC * strideWidth - xCCorner;\n                  const dyOffset = dyS0 * b + dyS1 * yF + dyS2 * yR + dyS3 * yC;\n                  const fltOffset = fltS0 * (filterDepth - 1 - wF) +\n                      fltS1 * (filterHeight - 1 - wR) +\n                      fltS2 * (filterWidth - 1 - wC) + fltS3 * d1;\n\n                  for (let d2 = 0; d2 < outChannels; ++d2) {\n                    const pixel = dyValues[dyOffset + d2];\n                    const weight = fltValues[fltOffset + d2];\n                    dotProd += pixel * weight;\n                  }\n                }\n              }\n            }\n            dxValues[dxS0 * b + dxS1 * xF + dxS2 * xR + dxS3 * xC + d1] =\n                dotProd;\n          }\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(dx.shape, dx.dtype, dx.values);\n}\n\nexport const conv3DBackpropInputV2Config: KernelConfig = {\n  kernelName: Conv3DBackpropInputV2,\n  backendName: 'cpu',\n  kernelFunc: conv3DBackpropInputV2 as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Cos, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const cos = unaryKernelFunc(Cos, (xi) => Math.cos(xi));\n\nexport const cosConfig: KernelConfig = {\n  kernelName: Cos,\n  backendName: 'cpu',\n  kernelFunc: cos,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Cosh, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const cosh = unaryKernelFunc(Cosh, (xi) => Math.cosh(xi));\n\nexport const coshConfig: KernelConfig = {\n  kernelName: Cosh,\n  backendName: 'cpu',\n  kernelFunc: cosh,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {buffer, CropAndResize, CropAndResizeAttrs, CropAndResizeInputs, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport function cropAndResize(args: {\n  inputs: CropAndResizeInputs,\n  backend: MathBackendCPU,\n  attrs: CropAndResizeAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {image, boxes, boxInd} = inputs;\n  const {cropSize, method, extrapolationValue} = attrs;\n\n  const [batch, imageHeight, imageWidth, numChannels] = image.shape;\n  const numBoxes = boxes.shape[0];\n\n  const [cropHeight, cropWidth] = cropSize;\n  const output =\n      buffer([numBoxes, cropHeight, cropWidth, numChannels], 'float32');\n\n  const boxVals = backend.data.get(boxes.dataId).values as TypedArray;\n  const boxIndVals = backend.data.get(boxInd.dataId).values as TypedArray;\n  const imageVals = backend.data.get(image.dataId).values as TypedArray;\n\n  const inStride =\n      util.computeStrides(image.shape);  // to calculate flat indexes into image\n  const outStride = util.computeStrides(\n      output.shape);  // to calculate flat indexes into output\n\n  // Reference implementation\n  // tslint:disable-next-line:max-line-length\n  // https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/crop_and_resize_op.cc\n  for (let b = 0; b < numBoxes; b++) {\n    const startInd = b * 4;\n    const y1 = boxVals[startInd];\n    const x1 = boxVals[startInd + 1];\n    const y2 = boxVals[startInd + 2];\n    const x2 = boxVals[startInd + 3];\n\n    const bInd: number = boxIndVals[b];\n    if (bInd >= batch) {\n      continue;\n    }\n\n    const heightScale =\n        (cropHeight > 1) ? (y2 - y1) * (imageHeight - 1) / (cropHeight - 1) : 0;\n    const widthScale =\n        (cropWidth > 1) ? (x2 - x1) * (imageWidth - 1) / (cropWidth - 1) : 0;\n\n    for (let y = 0; y < cropHeight; y++) {\n      const yInd: number = (cropHeight > 1) ?\n          y1 * (imageHeight - 1) + y * (heightScale) :\n          0.5 * (y1 + y2) * (imageHeight - 1);\n\n      if (yInd < 0 || yInd > imageHeight - 1) {\n        for (let x = 0; x < cropWidth; x++) {\n          for (let c = 0; c < numChannels; c++) {\n            const ind =\n                c + x * outStride[2] + y * outStride[1] + b * outStride[0];\n            output.values[ind] = extrapolationValue;\n          }\n        }\n        continue;\n      }\n\n      if (method === 'bilinear') {\n        const topInd = Math.floor(yInd);\n        const bottomInd = Math.ceil(yInd);\n        const yLerp = yInd - topInd;\n\n        for (let x = 0; x < cropWidth; x++) {\n          const xInd = (cropWidth > 1) ?\n              x1 * (imageWidth - 1) + x * widthScale :\n              0.5 * (x1 + x2) * (imageWidth - 1);\n\n          if (xInd < 0 || xInd > imageWidth - 1) {\n            for (let c = 0; c < numChannels; c++) {\n              const ind =\n                  c + x * outStride[2] + y * outStride[1] + b * outStride[0];\n              output.values[ind] = extrapolationValue;\n            }\n            continue;\n          }\n\n          const leftInd = Math.floor(xInd);\n          const rightInd = Math.ceil(xInd);\n          const xLerp = xInd - leftInd;\n\n          for (let c = 0; c < numChannels; c++) {\n            let ind = c + leftInd * inStride[2] + topInd * inStride[1] +\n                bInd * inStride[0];\n            const topLeft = imageVals[ind];\n\n            ind = c + rightInd * inStride[2] + topInd * inStride[1] +\n                bInd * inStride[0];\n            const topRight = imageVals[ind];\n\n            ind = c + leftInd * inStride[2] + bottomInd * inStride[1] +\n                bInd * inStride[0];\n            const bottomLeft = imageVals[ind];\n\n            ind = c + rightInd * inStride[2] + bottomInd * inStride[1] +\n                bInd * inStride[0];\n            const bottomRight = imageVals[ind];\n\n            const top = topLeft + (topRight - topLeft) * xLerp;\n            const bottom = bottomLeft + (bottomRight - bottomLeft) * xLerp;\n\n            ind = c + x * outStride[2] + y * outStride[1] + b * outStride[0];\n            output.values[ind] = top + ((bottom - top) * yLerp);\n          }\n        }\n      } else {  // method == \"nearest\"\n        for (let x = 0; x < cropWidth; ++x) {\n          const xInd = (cropWidth > 1) ?\n              x1 * (imageWidth - 1) + x * widthScale :\n              0.5 * (x1 + x2) * (imageWidth - 1);\n\n          if (xInd < 0 || xInd > imageWidth - 1) {\n            for (let c = 0; c < numChannels; c++) {\n              const ind =\n                  c + x * outStride[2] + y * outStride[1] + b * outStride[0];\n              output.values[ind] = extrapolationValue;\n            }\n            continue;\n          }\n\n          const closestX = Math.round(xInd);\n          const closestY = Math.round(yInd);\n          for (let c = 0; c < numChannels; c++) {\n            const inInd = c + closestX * inStride[2] + closestY * inStride[1] +\n                bInd * inStride[0];\n            const outInd =\n                c + x * outStride[2] + y * outStride[1] + b * outStride[0];\n            output.values[outInd] = imageVals[inInd];\n          }\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(output.shape, output.dtype, output.values);\n}\n\nexport const cropAndResizeConfig: KernelConfig = {\n  kernelName: CropAndResize,\n  backendName: 'cpu',\n  kernelFunc: cropAndResize as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2022 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Cumprod, CumprodAttrs, CumprodInputs, KernelConfig, KernelFunc, TensorInfo, TypedArray, upcastType, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {transpose} from './Transpose';\n\nexport function cumprod(\n    args: {inputs: CumprodInputs, backend: MathBackendCPU,\n           attrs: CumprodAttrs}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {axis, exclusive, reverse} = attrs;\n\n  assertNotComplex(x, 'cumprod');\n\n  const permutation = backend_util.getAxesPermutation([axis], x.shape.length);\n  let $x = x;\n  if (permutation != null) {\n    $x = transpose({inputs: {x}, backend, attrs: {perm: permutation}});\n  }\n  const permutedAxis = backend_util.getInnerMostAxes(1, x.shape.length)[0];\n\n  if (permutedAxis !== $x.shape.length - 1) {\n    throw new Error(\n        `backend.cumprod in CPU expects an inner-most ` +\n        `axis=${$x.shape.length - 1} but got axis=${permutedAxis}`);\n  }\n\n  const resultDtype = upcastType($x.dtype, 'int32');\n  const vals = util.makeOnesTypedArray(\n                   util.sizeFromShape($x.shape), resultDtype) as TypedArray;\n\n  const aVals = backend.data.get($x.dataId).values as TypedArray;\n  const finalDim = $x.shape[$x.shape.length - 1];\n  const indexAdjuster = reverse ?\n      (i: number, j: number) => i + finalDim - j - 1 :\n      (i: number, j: number) => i + j;\n  for (let i = 0; i < aVals.length; i += finalDim) {\n    for (let j = 0; j < finalDim; j++) {\n      const idx = indexAdjuster(i, j);\n      if (j === 0) {\n        vals[idx] = exclusive ? 1 : aVals[idx];\n      } else {\n        const prevIdx = indexAdjuster(i, j - 1);\n        vals[idx] = exclusive ? aVals[prevIdx] * vals[prevIdx] :\n                                aVals[idx] * vals[prevIdx];\n      }\n    }\n  }\n\n  const result = backend.makeTensorInfo($x.shape, resultDtype, vals);\n\n  if (permutation != null) {\n    const reversePermutation = backend_util.getUndoAxesPermutation(permutation);\n    const reverseTransposedResult = transpose(\n        {inputs: {x: result}, backend, attrs: {perm: reversePermutation}});\n\n    backend.disposeIntermediateTensorInfo(result);\n    backend.disposeIntermediateTensorInfo($x);\n\n    return reverseTransposedResult;\n  }\n\n  return result;\n}\n\nexport const cumprodConfig: KernelConfig = {\n  kernelName: Cumprod,\n  backendName: 'cpu',\n  kernelFunc: cumprod as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Cumsum, CumsumAttrs, CumsumInputs, KernelConfig, KernelFunc, TensorInfo, TypedArray, upcastType, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {transpose} from './Transpose';\n\nexport function cumsum(\n    args: {inputs: CumsumInputs, backend: MathBackendCPU, attrs: CumsumAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {axis, exclusive, reverse} = attrs;\n\n  assertNotComplex(x, 'cumsum');\n\n  const permutation = backend_util.getAxesPermutation([axis], x.shape.length);\n  let $x = x;\n  if (permutation != null) {\n    $x = transpose({inputs: {x}, backend, attrs: {perm: permutation}});\n  }\n  const permutedAxis = backend_util.getInnerMostAxes(1, x.shape.length)[0];\n\n  if (permutedAxis !== $x.shape.length - 1) {\n    throw new Error(\n        `backend.cumsum in CPU expects an inner-most ` +\n        `axis=${$x.shape.length - 1} but got axis=${permutedAxis}`);\n  }\n\n  const resultDtype = upcastType($x.dtype, 'int32');\n  const vals = util.makeZerosTypedArray(\n                   util.sizeFromShape($x.shape), resultDtype) as TypedArray;\n\n  const aVals = backend.data.get($x.dataId).values as TypedArray;\n  const finalDim = $x.shape[$x.shape.length - 1];\n  const indexAdjuster = reverse ?\n      (i: number, j: number) => i + finalDim - j - 1 :\n      (i: number, j: number) => i + j;\n  for (let i = 0; i < aVals.length; i += finalDim) {\n    for (let j = 0; j < finalDim; j++) {\n      const idx = indexAdjuster(i, j);\n      if (j === 0) {\n        vals[idx] = exclusive ? 0 : aVals[idx];\n      } else {\n        const prevIdx = indexAdjuster(i, j - 1);\n        vals[idx] = exclusive ? aVals[prevIdx] + vals[prevIdx] :\n                                aVals[idx] + vals[prevIdx];\n      }\n    }\n  }\n\n  const result = backend.makeTensorInfo($x.shape, resultDtype, vals);\n\n  if (permutation != null) {\n    const reversePermutation = backend_util.getUndoAxesPermutation(permutation);\n    const reverseTransposedResult = transpose(\n        {inputs: {x: result}, backend, attrs: {perm: reversePermutation}});\n\n    backend.disposeIntermediateTensorInfo(result);\n    backend.disposeIntermediateTensorInfo($x);\n\n    return reverseTransposedResult;\n  }\n\n  return result;\n}\n\nexport const cumsumConfig: KernelConfig = {\n  kernelName: Cumsum,\n  backendName: 'cpu',\n  kernelFunc: cumsum as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {DenseBincount, DenseBincountAttrs, DenseBincountInputs, KernelConfig, KernelFunc, Rank, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {bincountImpl, bincountReduceImpl} from './Bincount_impl';\n\nexport function denseBincount(args: {\n  inputs: DenseBincountInputs,\n  backend: MathBackendCPU,\n  attrs: DenseBincountAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, weights} = inputs;\n  const {size, binaryOutput} = attrs;\n\n  if (x.shape.length === 1) {\n    const xVals = backend.data.get(x.dataId).values as TypedArray;\n    const weightsVals = backend.data.get(weights.dataId).values as TypedArray;\n\n    const outVals =\n        bincountImpl(xVals, weightsVals, weights.dtype, weights.shape, size);\n\n    return backend.makeTensorInfo([size], weights.dtype, outVals);\n  } else if (x.shape.length === 2) {\n    const xBuf = backend.bufferSync<Rank, 'float32'>(x);\n    const weightsBuf = backend.bufferSync<Rank, 'float32'>(weights);\n\n    const outBuf = bincountReduceImpl(xBuf, weightsBuf, size, binaryOutput);\n\n    return backend.makeTensorInfo(outBuf.shape, weights.dtype, outBuf.values);\n  }\n\n  throw new Error(\n      `Error in denseBincount: input must be at most rank 2, but got rank` +\n      `${x.shape.length}.`);\n}\n\nexport const denseBincountConfig: KernelConfig = {\n  kernelName: DenseBincount,\n  backendName: 'cpu',\n  kernelFunc: denseBincount as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {DepthToSpace, DepthToSpaceAttrs, DepthToSpaceInputs, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport function depthToSpace(args: {\n  inputs: DepthToSpaceInputs,\n  backend: MathBackendCPU,\n  attrs: DepthToSpaceAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {blockSize, dataFormat} = attrs;\n\n  util.assert(\n      dataFormat === 'NHWC',\n      () => `Only NHWC dataFormat supported on CPU for depthToSpace. Got ${\n          dataFormat}`);\n\n  const batchSize = x.shape[0];\n  const inputHeight = x.shape[1];\n  const inputWidth = x.shape[2];\n  const inputDepth = x.shape[3];\n\n  const outputHeight = inputHeight * blockSize;\n  const outputWidth = inputWidth * blockSize;\n  const outputDepth = inputDepth / (blockSize * blockSize);\n\n  const xValues = backend.data.get(x.dataId).values as TypedArray;\n  const result =\n      new Float32Array(batchSize * outputHeight * outputWidth * outputDepth);\n\n  let outputIdx = 0;\n  for (let b = 0; b < batchSize; ++b) {\n    for (let h = 0; h < outputHeight; ++h) {\n      const inH = Math.floor(h / blockSize);\n      const offsetH = (h % blockSize);\n      for (let w = 0; w < outputWidth; ++w) {\n        const inW = Math.floor(w / blockSize);\n        const offsetW = (w % blockSize);\n        const offsetD = (offsetH * blockSize + offsetW) * outputDepth;\n        for (let d = 0; d < outputDepth; ++d) {\n          const inD = d + offsetD;\n          const inputIdx =\n              inD + inputDepth * (inW + inputWidth * (inH + inputHeight * b));\n          result[outputIdx++] = xValues[inputIdx];\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(\n      [batchSize, outputHeight, outputWidth, outputDepth], x.dtype, result);\n}\n\nexport const depthToSpaceConfig: KernelConfig = {\n  kernelName: DepthToSpace,\n  backendName: 'cpu',\n  kernelFunc: depthToSpace as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, DepthwiseConv2dNative, DepthwiseConv2dNativeAttrs, DepthwiseConv2dNativeInputs, KernelConfig, KernelFunc, TensorBuffer, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function depthwiseConv2dNative(args: {\n  inputs: DepthwiseConv2dNativeInputs,\n  backend: MathBackendCPU,\n  attrs: DepthwiseConv2dNativeAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, filter} = inputs;\n  const {strides, pad, dilations, dimRoundingMode} = attrs;\n\n  assertNotComplex([x, filter], 'depthwiseConv2DNative');\n\n  const xStrides = util.computeStrides(x.shape);\n  const filterStrides = util.computeStrides(filter.shape);\n\n  let $dilations = dilations;\n  if ($dilations == null) {\n    $dilations = [1, 1];\n  }\n\n  util.assert(\n      backend_util.eitherStridesOrDilationsAreOne(strides, $dilations),\n      () => 'Error in depthwiseConv2d: Either strides or dilations must be ' +\n          `1. Got strides ${strides} and dilations '${$dilations}'`);\n\n  const convInfo = backend_util.computeConv2DInfo(\n      x.shape as [number, number, number, number],\n      filter.shape as [number, number, number, number], strides, $dilations,\n      pad, dimRoundingMode, true /* depthwise */);\n\n  const {filterHeight, filterWidth, dilationHeight, dilationWidth, padInfo} =\n      convInfo;\n  const padLeft = padInfo.left;\n  const padTop = padInfo.top;\n  const chMul = convInfo.outChannels / convInfo.inChannels;\n  const y = new TensorBuffer(convInfo.outShape, x.dtype as 'float32');\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const wVals = backend.data.get(filter.dataId).values as TypedArray;\n  const yVals = y.values;\n\n  for (let b = 0; b < convInfo.batchSize; ++b) {\n    const xOffset1 = b * xStrides[0];\n    const yOffset1 = b * y.strides[0];\n    for (let yR = 0; yR < convInfo.outHeight; ++yR) {\n      const yOffset2 = yOffset1 + yR * y.strides[1];\n      const xRCorner = yR * convInfo.strideHeight - padTop;\n      for (let wR = 0; wR < filterHeight; ++wR) {\n        const xR = xRCorner + wR * dilationHeight;\n        if (xR < 0 || xR >= convInfo.inHeight) {\n          continue;\n        }\n        const wOffset1 = wR * filterStrides[0];\n        const xOffset2 = xOffset1 + xR * xStrides[1];\n        for (let yC = 0; yC < convInfo.outWidth; ++yC) {\n          const yOffset3 = yOffset2 + yC * y.strides[2];\n          const xCCorner = yC * convInfo.strideWidth - padLeft;\n          for (let wC = 0; wC < filterWidth; ++wC) {\n            const xC = xCCorner + wC * dilationWidth;\n            if (xC < 0 || xC >= convInfo.inWidth) {\n              continue;\n            }\n            const wOffset2 = wOffset1 + wC * filterStrides[1];\n            const xOffset3 = xOffset2 + xC * convInfo.inChannels;\n            let yOffset4 = yOffset3;\n            let wOffset3 = wOffset2;\n            for (let d1 = 0; d1 < convInfo.inChannels; ++d1) {\n              const xVal = xVals[xOffset3 + d1];\n              for (let q = 0; q < chMul; ++q) {\n                yVals[yOffset4 + q] += xVal * wVals[wOffset3 + q];\n              }\n              yOffset4 += chMul;\n              wOffset3 += chMul;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(y.shape, y.dtype, y.values);\n}\n\nexport const depthwiseConv2dNativeConfig: KernelConfig = {\n  kernelName: DepthwiseConv2dNative,\n  backendName: 'cpu',\n  kernelFunc: depthwiseConv2dNative as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, DepthwiseConv2dNativeBackpropFilter, DepthwiseConv2dNativeBackpropFilterAttrs, DepthwiseConv2dNativeBackpropFilterInputs, KernelConfig, KernelFunc, TensorBuffer, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function depthwiseConv2dNativeBackpropFilter(args: {\n  inputs: DepthwiseConv2dNativeBackpropFilterInputs,\n  backend: MathBackendCPU,\n  attrs: DepthwiseConv2dNativeBackpropFilterAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, dy} = inputs;\n  const {strides, dilations, pad, dimRoundingMode, filterShape} = attrs;\n\n  assertNotComplex([x, dy], 'depthwiseConv2dNativeBackpropFilter');\n\n  const convInfo = backend_util.computeConv2DInfo(\n      x.shape as [number, number, number, number], filterShape, strides,\n      dilations, pad, dimRoundingMode, true /* depthwise */);\n\n  const {strideHeight, strideWidth, filterHeight, filterWidth} = convInfo;\n\n  const dW = new TensorBuffer(convInfo.filterShape, 'float32');\n\n  const leftPad = convInfo.padInfo.left;\n  const topPad = convInfo.padInfo.top;\n  const chMul = convInfo.outChannels / convInfo.inChannels;\n\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const xBuf = new TensorBuffer(x.shape, x.dtype, xVals);\n  const dyVals = backend.data.get(dy.dataId).values as TypedArray;\n  const dyBuf = new TensorBuffer(dy.shape, dy.dtype, dyVals);\n  for (let wR = 0; wR < filterHeight; ++wR) {\n    const yRMin = Math.max(0, Math.ceil((topPad - wR) / strideHeight));\n    const yRMax = Math.min(\n        convInfo.outHeight, (convInfo.inHeight + topPad - wR) / strideHeight);\n\n    for (let wC = 0; wC < filterWidth; ++wC) {\n      const yCMin = Math.max(0, Math.ceil((leftPad - wC) / strideWidth));\n      const yCMax = Math.min(\n          convInfo.outWidth, (convInfo.inWidth + leftPad - wC) / strideWidth);\n\n      for (let d2 = 0; d2 < convInfo.outChannels; ++d2) {\n        const d1 = Math.trunc(d2 / chMul);\n        const dm = d2 % chMul;\n\n        let dotProd = 0;\n        for (let b = 0; b < convInfo.batchSize; ++b) {\n          for (let yR = yRMin; yR < yRMax; ++yR) {\n            const xR = wR + yR * strideHeight - topPad;\n            for (let yC = yCMin; yC < yCMax; ++yC) {\n              const xC = wC + yC * strideWidth - leftPad;\n              dotProd += (xBuf.get(b, xR, xC, d1) as number) *\n                  (dyBuf.get(b, yR, yC, d2) as number);\n            }\n          }\n        }\n        dW.set(dotProd, wR, wC, d1, dm);\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(dW.shape, dW.dtype, dW.values);\n}\n\nexport const depthwiseConv2dNativeBackpropFilterConfig: KernelConfig = {\n  kernelName: DepthwiseConv2dNativeBackpropFilter,\n  backendName: 'cpu',\n  kernelFunc: depthwiseConv2dNativeBackpropFilter as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, DepthwiseConv2dNativeBackpropInput, DepthwiseConv2dNativeBackpropInputAttrs, DepthwiseConv2dNativeBackpropInputInputs, KernelConfig, KernelFunc, TensorBuffer, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function depthwiseConv2dNativeBackpropInput(args: {\n  inputs: DepthwiseConv2dNativeBackpropInputInputs,\n  backend: MathBackendCPU,\n  attrs: DepthwiseConv2dNativeBackpropInputAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {dy, filter} = inputs;\n  const {strides, dilations, pad, dimRoundingMode, inputShape} = attrs;\n\n  assertNotComplex([dy, filter], 'depthwiseConv2DNativeBackpropInput');\n\n  const dyStrides = util.computeStrides(dy.shape);\n  const filterStrides = util.computeStrides(filter.shape);\n\n  const convInfo = backend_util.computeConv2DInfo(\n      inputShape, filter.shape as [number, number, number, number], strides,\n      dilations, pad, dimRoundingMode, true /* depthwise */);\n\n  const dx = new TensorBuffer(convInfo.inShape, 'float32');\n  const dxValues = dx.values;\n  const [dxS0, dxS1, dxS2] = dx.strides;\n  const dyValues = backend.data.get(dy.dataId).values as TypedArray;\n  const [dyS0, dyS1, dyS2] = dyStrides;\n  const fltValues = backend.data.get(filter.dataId).values as TypedArray;\n  const [fltS0, fltS1, fltS2] = filterStrides;\n  const {\n    batchSize,\n    filterHeight,\n    filterWidth,\n    inChannels,\n    inHeight,\n    inWidth,\n    outChannels,\n    outHeight,\n    outWidth,\n    strideHeight,\n    strideWidth\n  } = convInfo;\n  const topPad = filterHeight - 1 - convInfo.padInfo.top;\n  const leftPad = filterWidth - 1 - convInfo.padInfo.left;\n  const chMul = outChannels / inChannels;\n\n  for (let b = 0; b < batchSize; ++b) {\n    for (let d1 = 0; d1 < inChannels; ++d1) {\n      for (let xR = 0; xR < inHeight; ++xR) {\n        const xRCorner = xR - topPad;\n        const xRMin = Math.max(0, Math.ceil(xRCorner / strideHeight));\n        const yRMax =\n            Math.min(outHeight, (filterHeight + xRCorner) / strideHeight);\n\n        for (let xC = 0; xC < inWidth; ++xC) {\n          const xCCorner = xC - leftPad;\n          const xCMin = Math.max(0, Math.ceil(xCCorner / strideWidth));\n          const yCMax =\n              Math.min(outWidth, (filterWidth + xCCorner) / strideWidth);\n\n          let dotProd = 0;\n          for (let yR = xRMin; yR < yRMax; ++yR) {\n            const wR = yR * strideHeight - xRCorner;\n\n            for (let yC = xCMin; yC < yCMax; ++yC) {\n              const wC = yC * strideWidth - xCCorner;\n              const dyOffset = dyS0 * b + dyS1 * yR + dyS2 * yC;\n              const fltOffset = fltS0 * (filterHeight - 1 - wR) +\n                  fltS1 * (filterWidth - 1 - wC) + fltS2 * d1;\n\n              for (let dm = 0; dm < chMul; ++dm) {\n                const d2 = d1 * chMul + dm;\n                const pixel = dyValues[dyOffset + d2];\n                const weight = fltValues[fltOffset + dm];\n                dotProd += pixel * weight;\n              }\n            }\n          }\n          dxValues[dxS0 * b + dxS1 * xR + dxS2 * xC + d1] = dotProd;\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(dx.shape, dx.dtype, dx.values);\n}\n\nexport const depthwiseConv2dNativeBackpropInputConfig: KernelConfig = {\n  kernelName: DepthwiseConv2dNativeBackpropInput,\n  backendName: 'cpu',\n  kernelFunc: depthwiseConv2dNativeBackpropInput as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {buffer, Diag, DiagInputs, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport function diag(args: {inputs: DiagInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {x} = inputs;\n\n  const xSize = util.sizeFromShape(x.shape);\n\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const outBuf = buffer([xSize, xSize], x.dtype);\n  const vals = outBuf.values;\n  for (let i = 0; i < xVals.length; i++) {\n    vals[i * xSize + i] = xVals[i];\n  }\n\n  const outShape = [...x.shape, ...x.shape];\n\n  return backend.makeTensorInfo(outShape, outBuf.dtype, outBuf.values);\n}\n\nexport const diagConfig: KernelConfig = {\n  kernelName: Diag,\n  backendName: 'cpu',\n  kernelFunc: diag as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Dilation2D, Dilation2DAttrs, Dilation2DInputs, KernelConfig, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport const dilation2DConfig: KernelConfig = {\n  kernelName: Dilation2D,\n  backendName: 'cpu',\n  kernelFunc: ({inputs, backend, attrs}) => {\n    const {x, filter} = inputs as Dilation2DInputs;\n    const {strides, pad, dilations} = attrs as {} as Dilation2DAttrs;\n    const cpuBackend = backend as MathBackendCPU;\n\n    const xVals = cpuBackend.data.get(x.dataId).values as TypedArray;\n    const xRank = x.shape.length;\n\n    const filterVals = cpuBackend.data.get(filter.dataId).values as TypedArray;\n    const filterRank = filter.shape.length;\n\n    const {\n      batchSize,\n      inHeight,\n      inWidth,\n      inChannels,\n      outHeight,\n      outWidth,\n      padInfo,\n      strideHeight,\n      strideWidth,\n      filterHeight,\n      filterWidth,\n      dilationHeight,\n      dilationWidth,\n      outShape\n    } =\n        backend_util.computeDilation2DInfo(\n            x.shape as [number, number, number, number],\n            filter.shape as [number, number, number], strides, pad,\n            'NHWC' /* dataFormat */, dilations);\n\n    const outSize = util.sizeFromShape(outShape);\n    const outRank = outShape.length;\n    const outputVals = util.getArrayFromDType(x.dtype, outSize);\n\n    // Upsampling the input by fill in `dilation size - 1` values between each\n    // input value.\n    // This implementation follows the TF c++ implementation:\n    // https://github.com/tensorflow/tensorflow/blob/d9a3a849edc198e90172bc58eb293de457f9d986/tensorflow/core/kernels/dilation_ops.cc\n    for (let b = 0; b < batchSize; ++b) {\n      for (let hOut = 0; hOut < outHeight; ++hOut) {\n        const hBeg = hOut * strideHeight - padInfo.top;\n        for (let wOut = 0; wOut < outWidth; ++wOut) {\n          const wBeg = wOut * strideWidth - padInfo.left;\n          for (let d = 0; d < inChannels; ++d) {\n            let curVal = Number.MIN_SAFE_INTEGER;\n            for (let h = 0; h < filterHeight; ++h) {\n              const hIn = hBeg + h * dilationHeight;\n              if (hIn >= 0 && hIn < inHeight) {\n                for (let w = 0; w < filterWidth; ++w) {\n                  const wIn = wBeg + w * dilationWidth;\n                  if (wIn >= 0 && wIn < inWidth) {\n                    const xIndex = util.locToIndex(\n                        [b, hIn, wIn, d], xRank, util.computeStrides(x.shape));\n                    const filterIndex = util.locToIndex(\n                        [h, w, d], filterRank,\n                        util.computeStrides(filter.shape));\n                    const val = xVals[xIndex] + filterVals[filterIndex];\n                    if (val > curVal) {\n                      curVal = val;\n                    }\n                  }\n                }\n              }\n            }\n            const outputIndex = util.locToIndex(\n                [b, hOut, wOut, d], outRank, util.computeStrides(outShape));\n            outputVals[outputIndex] = curVal;\n          }\n        }\n      }\n    }\n\n    const dataId = cpuBackend.write(\n        util.toTypedArray(outputVals, x.dtype), outShape, x.dtype);\n\n    return {dataId, shape: outShape, dtype: x.dtype};\n  }\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Dilation2DAttrs, Dilation2DBackpropFilter, Tensor3D, Tensor4D, TypedArray, util} from '@tensorflow/tfjs-core';\nimport {KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport const dilation2DBackpropFilterConfig: KernelConfig = {\n  kernelName: Dilation2DBackpropFilter,\n  backendName: 'cpu',\n  kernelFunc: ({inputs, backend, attrs}) => {\n    const {x, filter, dy} =\n        inputs as {x: Tensor4D, filter: Tensor3D, dy: Tensor4D};\n    const {strides, pad, dilations} = attrs as {} as Dilation2DAttrs;\n    const cpuBackend = backend as MathBackendCPU;\n\n    const $x =\n        util.toNestedArray(\n            x.shape, cpuBackend.data.get(x.dataId).values as TypedArray) as\n        number[][][][];\n\n    const $filter = util.toNestedArray(\n                        filter.shape,\n                        cpuBackend.data.get(filter.dataId).values as\n                            TypedArray) as number[][][];\n\n    const {\n      batchSize,\n      inHeight,\n      inWidth,\n      inChannels,\n      outHeight,\n      outWidth,\n      padInfo,\n      strideHeight,\n      strideWidth,\n      filterHeight,\n      filterWidth,\n      dilationHeight,\n      dilationWidth,\n      outShape\n    } =\n        backend_util.computeDilation2DInfo(\n            x.shape as [number, number, number, number],\n            filter.shape as [number, number, number], strides, pad,\n            'NHWC' /* dataFormat */, dilations);\n\n    util.assert(\n        dy.rank === outShape.length,\n        () => `Error in ${Dilation2DBackpropFilter}, dy ` +\n            `must have the same rank as output ${outShape.length}, but got ` +\n            `${dy.rank}`);\n\n    const $dy =\n        util.toNestedArray(\n            outShape, cpuBackend.data.get(dy.dataId).values as TypedArray) as\n        number[][][][];\n\n    // The computed filter gradients has the same dimensions as the filter:\n    // [filterHeight, filterWidth, depth]\n    const gradients = util.makeZerosNestedTypedArray(\n                          filter.shape, filter.dtype) as number[][][];\n\n    // In the case of multiple argmax branches, we only back-propagate along the\n    // last branch, i.e., the one with largest value of `h * filter_cols + w`,\n    // similarly to the max-pooling backward routines.\n    // This implementation follows the TF c++ implementation:\n    // https://github.com/tensorflow/tensorflow/blob/d9a3a849edc198e90172bc58eb293de457f9d986/tensorflow/core/kernels/dilation_ops.cc\n    for (let b = 0; b < batchSize; ++b) {\n      for (let hOut = 0; hOut < outHeight; ++hOut) {\n        const hBeg = hOut * strideHeight - padInfo.top;\n        for (let wOut = 0; wOut < outWidth; ++wOut) {\n          const wBeg = wOut * strideWidth - padInfo.left;\n          for (let d = 0; d < inChannels; ++d) {\n            let curVal = Number.MIN_SAFE_INTEGER;\n            let hMax = 0;\n            let wMax = 0;\n            for (let h = 0; h < filterHeight; ++h) {\n              const hIn = hBeg + h * dilationHeight;\n              if (hIn >= 0 && hIn < inHeight) {\n                for (let w = 0; w < filterWidth; ++w) {\n                  const wIn = wBeg + w * dilationWidth;\n                  if (wIn >= 0 && wIn < inWidth) {\n                    const val = $x[b][hIn][wIn][d] + $filter[h][w][d];\n                    if (val > curVal) {\n                      curVal = val;\n                      hMax = h;\n                      wMax = w;\n                    }\n                  }\n                }\n              }\n            }\n            gradients[hMax][wMax][d] += $dy[b][hOut][wOut][d];\n          }\n        }\n      }\n    }\n\n    const dataId = cpuBackend.write(\n        util.toTypedArray(gradients, x.dtype), filter.shape, filter.dtype);\n\n    return {dataId, shape: filter.shape, dtype: filter.dtype};\n  }\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Dilation2DAttrs, Dilation2DBackpropInput, Tensor3D, Tensor4D, TypedArray, util} from '@tensorflow/tfjs-core';\nimport {KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport const dilation2DBackpropInputConfig: KernelConfig = {\n  kernelName: Dilation2DBackpropInput,\n  backendName: 'cpu',\n  kernelFunc: ({inputs, backend, attrs}) => {\n    const {x, filter, dy} =\n        inputs as {x: Tensor4D, filter: Tensor3D, dy: Tensor4D};\n    const {strides, pad, dilations} = attrs as {} as Dilation2DAttrs;\n    const cpuBackend = backend as MathBackendCPU;\n\n    const $x =\n        util.toNestedArray(\n            x.shape, cpuBackend.data.get(x.dataId).values as TypedArray) as\n        number[][][][];\n\n    const $filter = util.toNestedArray(\n                        filter.shape,\n                        cpuBackend.data.get(filter.dataId).values as\n                            TypedArray) as number[][][];\n\n    const {\n      batchSize,\n      inHeight,\n      inWidth,\n      inChannels,\n      outHeight,\n      outWidth,\n      padInfo,\n      strideHeight,\n      strideWidth,\n      filterHeight,\n      filterWidth,\n      dilationHeight,\n      dilationWidth,\n      outShape\n    } =\n        backend_util.computeDilation2DInfo(\n            x.shape as [number, number, number, number],\n            filter.shape as [number, number, number], strides, pad,\n            'NHWC' /* dataFormat */, dilations);\n\n    util.assert(\n        dy.rank === outShape.length,\n        () => `Error in ${Dilation2DBackpropInput}, dy ` +\n            `must have the same rank as output ${outShape.length}, but got ` +\n            `${dy.rank}`);\n\n    const $dy =\n        util.toNestedArray(\n            outShape, cpuBackend.data.get(dy.dataId).values as TypedArray) as\n        number[][][][];\n\n    // The computed gradients has the same dimensions as the input:\n    // [batch, inputHeight, inputCols, inChannel]\n    const gradients =\n        util.makeZerosNestedTypedArray(x.shape, x.dtype) as number[][][][];\n\n    // In the case of multiple argmax branches, we only back-propagate along the\n    // last branch, i.e., the one with largest value of `h * filter_cols + w`,\n    // similarly to the max-pooling backward routines.\n    // This implementation follows the TF c++ implementation:\n    // https://github.com/tensorflow/tensorflow/blob/d9a3a849edc198e90172bc58eb293de457f9d986/tensorflow/core/kernels/dilation_ops.cc\n    for (let b = 0; b < batchSize; ++b) {\n      for (let hOut = 0; hOut < outHeight; ++hOut) {\n        const hBeg = hOut * strideHeight - padInfo.top;\n        for (let wOut = 0; wOut < outWidth; ++wOut) {\n          const wBeg = wOut * strideWidth - padInfo.left;\n          for (let d = 0; d < inChannels; ++d) {\n            let curVal = Number.MIN_SAFE_INTEGER;\n            let hInMax = (hBeg < 0) ? 0 : hBeg;\n            let wInMax = (wBeg < 0) ? 0 : wBeg;\n            for (let h = 0; h < filterHeight; ++h) {\n              const hIn = hBeg + h * dilationHeight;\n              if (hIn >= 0 && hIn < inHeight) {\n                for (let w = 0; w < filterWidth; ++w) {\n                  const wIn = wBeg + w * dilationWidth;\n                  if (wIn >= 0 && wIn < inWidth) {\n                    const val = $x[b][hIn][wIn][d] + $filter[h][w][d];\n                    if (val > curVal) {\n                      curVal = val;\n                      hInMax = hIn;\n                      wInMax = wIn;\n                    }\n                  }\n                }\n              }\n            }\n            gradients[b][hInMax][wInMax][d] += $dy[b][hOut][wOut][d];\n          }\n        }\n      }\n    }\n\n    const dataId = cpuBackend.write(\n        util.toTypedArray(gradients, x.dtype), x.shape, x.dtype);\n\n    return {dataId, shape: x.shape, dtype: x.dtype};\n  }\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, KernelConfig, KernelFunc, Sum, SumAttrs, SumInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {zeros} from '../utils/zeros_impl';\nimport {cast} from './Cast';\nimport {identity} from './Identity';\nimport {reshape} from './Reshape';\nimport {transpose} from './Transpose';\n\nexport function sum(\n    args: {inputs: SumInputs, backend: MathBackendCPU, attrs: SumAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {axis, keepDims} = attrs;\n\n  assertNotComplex(x, 'sum');\n\n  let $x;\n  if (x.dtype === 'bool') {\n    $x = cast({inputs: {x}, backend, attrs: {dtype: 'int32'}});\n  } else {\n    $x = identity({inputs: {x}, backend});\n  }\n\n  const xRank = $x.shape.length;\n  const axes = util.parseAxisParam(axis, $x.shape);\n  const permutation = backend_util.getAxesPermutation(axes, xRank);\n\n  let reductionAxes = axes;\n  let permutedX = $x;\n  if (permutation != null) {\n    permutedX =\n        transpose({inputs: {x: $x}, backend, attrs: {perm: permutation}});\n    reductionAxes = backend_util.getInnerMostAxes(reductionAxes.length, xRank);\n  }\n\n  backend_util.assertAxesAreInnerMostDims(\n      'sum', reductionAxes, permutedX.shape.length);\n\n  const [outShape, reduceShape] =\n      backend_util.computeOutAndReduceShapes(permutedX.shape, reductionAxes);\n  const resultDtype = backend_util.upcastType(permutedX.dtype, 'int32');\n  let result = zeros(backend, outShape, resultDtype);\n  const reduceSize = util.sizeFromShape(reduceShape);\n  const vals = backend.data.get(result.dataId).values as TypedArray;\n\n  const aVals = backend.data.get(permutedX.dataId).values as TypedArray;\n  for (let i = 0; i < vals.length; ++i) {\n    const offset = i * reduceSize;\n    let sum = 0;\n    for (let j = 0; j < reduceSize; ++j) {\n      sum += aVals[offset + j];\n    }\n    vals[i] = sum;\n  }\n\n  if (keepDims) {\n    const newShape = backend_util.expandShapeToKeepDim(result.shape, axes);\n    const oldResult = result;\n    result = reshape({inputs: {x: result}, backend, attrs: {shape: newShape}});\n    backend.disposeIntermediateTensorInfo(oldResult);\n  }\n\n  backend.disposeIntermediateTensorInfo($x);\n\n  if (permutation != null) {\n    backend.disposeIntermediateTensorInfo(permutedX);\n  }\n\n  return result;\n}\n\nexport const sumConfig: KernelConfig = {\n  kernelName: Sum,\n  backendName: 'cpu',\n  kernelFunc: sum as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Einsum, EinsumAttrs, EinsumInputs, KernelConfig, KernelFunc, Tensor, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {multiply} from './Multiply';\nimport {reshape} from './Reshape';\nimport {sum} from './Sum';\nimport {transpose} from './Transpose';\n\nexport function einsum(\n    args: {inputs: EinsumInputs, backend: MathBackendCPU, attrs: EinsumAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {equation} = attrs;\n  const tensors = inputs as Tensor[];\n\n  const {allDims, summedDims, idDims} =\n      backend_util.decodeEinsumEquation(equation, tensors.length);\n  backend_util.checkEinsumDimSizes(allDims.length, idDims, tensors);\n  const {path, steps} = backend_util.getEinsumComputePath(summedDims, idDims);\n\n  const nSteps = steps.length;\n  let out: TensorInfo|null = null;\n  let numDimsRemaining = allDims.length;\n  const tensorsToDispose: TensorInfo[] = [];\n  for (let i = 0; i < nSteps; ++i) {\n    for (const idTerm of steps[i]) {\n      const {permutationIndices: perm, expandDims: dimsToExpand} =\n          backend_util.getEinsumPermutation(numDimsRemaining, idDims[idTerm]);\n      let x: TensorInfo;\n      if (backend_util.isIdentityPermutation(perm)) {\n        x = tensors[idTerm];\n      } else {\n        x = transpose({inputs: {x: tensors[idTerm]}, backend, attrs: {perm}});\n        tensorsToDispose.push(x);\n      }\n      const targetShape: number[] = x.shape.slice();\n      for (let k = 0; k < dimsToExpand.length; ++k) {\n        targetShape.splice(dimsToExpand[k], 0, 1);\n      }\n\n      if (!util.arraysEqual(x.shape, targetShape)) {\n        x = reshape({inputs: {x}, backend, attrs: {shape: targetShape}});\n        tensorsToDispose.push(x);\n      }\n      if (out === null) {\n        out = x;\n      } else {\n        // tslint:disable-next-line: no-unnecessary-type-assertion\n        out = multiply({inputs: {a: x, b: out}, backend}) as TensorInfo;\n        tensorsToDispose.push(out);\n      }\n    }\n    if (i < nSteps - 1) {\n      if (path[i] >= 0) {\n        out = sum({\n          inputs: {x: out},\n          backend,\n          attrs: {\n            axis: path[i] - (allDims.length - numDimsRemaining),\n            keepDims: false\n          }\n        });\n        tensorsToDispose.push(out);\n      }\n      numDimsRemaining--;\n    }\n  }\n\n  // Clean up intermediate tensors.\n  for (const tensorInfo of tensorsToDispose) {\n    if (tensorInfo === out) {\n      continue;\n    }\n    backend.disposeIntermediateTensorInfo(tensorInfo);\n  }\n\n  return out;\n}\n\nexport const einsumConfig: KernelConfig = {\n  kernelName: Einsum,\n  backendName: 'cpu',\n  kernelFunc: einsum as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {EluGrad, EluGradInputs, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function eluGrad(args: {inputs: EluGradInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {dy, y} = inputs;\n\n  assertNotComplex([dy, y], 'eluGrad');\n\n  const resultValues = new Float32Array(util.sizeFromShape(y.shape));\n  const values = backend.data.get(y.dataId).values as TypedArray;\n  const dyValues = backend.data.get(dy.dataId).values as TypedArray;\n  for (let i = 0; i < values.length; ++i) {\n    const v = values[i];\n    if (v >= 1) {\n      resultValues[i] = dyValues[i];\n    } else {\n      resultValues[i] = dyValues[i] * (v + 1);\n    }\n  }\n\n  return backend.makeTensorInfo(y.shape, 'float32', resultValues);\n}\n\nexport const eluGradConfig: KernelConfig = {\n  kernelName: EluGrad,\n  backendName: 'cpu',\n  kernelFunc: eluGrad as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Erf, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nconst p = backend_util.ERF_P;\nconst a1 = backend_util.ERF_A1;\nconst a2 = backend_util.ERF_A2;\nconst a3 = backend_util.ERF_A3;\nconst a4 = backend_util.ERF_A4;\nconst a5 = backend_util.ERF_A5;\n\nexport const erf = unaryKernelFunc(\n    Erf,\n    (xi) => {\n      const sign = Math.sign(xi);\n      const v = Math.abs(xi);\n      const t = 1.0 / (1.0 + p * v);\n      return sign *\n          (1.0 -\n           (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t *\n               Math.exp(-v * v));\n    },\n);\n\nexport const erfConfig: KernelConfig = {\n  kernelName: Erf,\n  backendName: 'cpu',\n  kernelFunc: erf,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {ExpandDims, ExpandDimsAttrs, ExpandDimsInputs, KernelConfig, KernelFunc, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {reshape} from './Reshape';\n\nexport function expandDims(args: {\n  inputs: ExpandDimsInputs,\n  backend: MathBackendCPU,\n  attrs: ExpandDimsAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {input} = inputs;\n  const {dim} = attrs;\n\n  const inputRank = input.shape.length;\n  const newShape = input.shape.slice();\n  let $dim = dim;\n  if (dim < 0) {\n    // Negative value is counted from the tail of rank.\n    util.assert(\n        -(inputRank + 1) <= dim,\n        () => `Axis must be in the interval [${- (inputRank + 1)}, ${\n            inputRank}]`);\n    $dim = inputRank + dim + 1;\n  }\n  newShape.splice($dim, 0, 1);\n\n  return reshape({inputs: {x: input}, backend, attrs: {shape: newShape}});\n}\n\nexport const expandDimsConfig: KernelConfig = {\n  kernelName: ExpandDims,\n  backendName: 'cpu',\n  kernelFunc: expandDims as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, RealDiv} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const realDivImpl =\n    createSimpleBinaryKernelImpl((a: number, b: number) => a / b);\nexport const div = binaryKernelFunc(RealDiv, realDivImpl);\n\nexport const realDivConfig: KernelConfig = {\n  kernelName: RealDiv,\n  backendName: 'cpu',\n  kernelFunc: div\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, Tensor, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {add} from '../kernels/Add';\nimport {complex} from '../kernels/Complex';\nimport {concat} from '../kernels/Concat';\nimport {identity} from '../kernels/Identity';\nimport {imag} from '../kernels/Imag';\nimport {multiply} from '../kernels/Multiply';\nimport {real} from '../kernels/Real';\nimport {realDivConfig} from '../kernels/RealDiv';\nimport {slice} from '../kernels/Slice';\nimport {sub} from '../kernels/Sub';\n\n/**\n * Calculate FFT of inner most elements of batch tensor.\n */\nexport function fftBatch(\n    input: TensorInfo, inverse: boolean,\n    cpuBackend: MathBackendCPU): TensorInfo {\n  const inputShape = input.shape;\n  const batch = inputShape[0];\n  const innerDim = inputShape[1];\n\n  const inputVals = cpuBackend.data.get(input.dataId);\n\n  const real2D = inputVals.complexTensorInfos.real;\n  const imag2D = inputVals.complexTensorInfos.imag;\n\n  // Collects real and imaginary values separately.\n  const resultShape = [batch, innerDim];\n  const resultSize = util.sizeFromShape(resultShape);\n  const resultReal = util.getTypedArrayFromDType('float32', resultSize);\n  const resultImag = util.getTypedArrayFromDType('float32', resultSize);\n\n  for (let b = 0; b < batch; b++) {\n    // TODO: Support slice ops for complex type.\n    const r = slice({\n      inputs: {x: real2D},\n      backend: cpuBackend,\n      attrs: {begin: [b, 0], size: [1, innerDim]}\n    });\n    const i = slice({\n      inputs: {x: imag2D},\n      backend: cpuBackend,\n      attrs: {begin: [b, 0], size: [1, innerDim]}\n    });\n\n    const input = complex({inputs: {real: r, imag: i}, backend: cpuBackend});\n\n    // Run FFT by batch element.\n    const {real, imag} = fftImpl(input, inverse, cpuBackend);\n    const res = backend_util.mergeRealAndImagArrays(real, imag);\n\n    for (let d = 0; d < innerDim; d++) {\n      const c = backend_util.getComplexWithIndex(res, d);\n      resultReal[b * innerDim + d] = c.real;\n      resultImag[b * innerDim + d] = c.imag;\n    }\n\n    cpuBackend.disposeIntermediateTensorInfo(r);\n    cpuBackend.disposeIntermediateTensorInfo(i);\n    cpuBackend.disposeIntermediateTensorInfo(input);\n  }\n\n  const $realInfo: TensorInfo =\n      cpuBackend.makeTensorInfo(resultShape, 'float32', resultReal);\n  const $imagInfo: TensorInfo =\n      cpuBackend.makeTensorInfo(resultShape, 'float32', resultImag);\n\n  const result = complex(\n      {inputs: {real: $realInfo, imag: $imagInfo}, backend: cpuBackend});\n\n  cpuBackend.disposeIntermediateTensorInfo($realInfo);\n  cpuBackend.disposeIntermediateTensorInfo($imagInfo);\n\n  return result;\n}\n\nexport function fftImpl(\n    input: TensorInfo, inverse: boolean,\n    cpuBackend: MathBackendCPU): {real: Float32Array, imag: Float32Array} {\n  const inputSize = util.sizeFromShape(input.shape);\n\n  const inputVals = cpuBackend.data.get(input.dataId);\n\n  const realVals =\n      cpuBackend.data.get(inputVals.complexTensorInfos.real.dataId).values as\n      Float32Array;\n\n  const imagVals =\n      cpuBackend.data.get(inputVals.complexTensorInfos.imag.dataId).values as\n      Float32Array;\n\n  if (isExponentOf2(inputSize)) {\n    const result =\n        fftRadix2(realVals, imagVals, inputSize, inverse, cpuBackend);\n\n    const resultShape = [input.shape[0], input.shape[1]];\n\n    if (inverse) {\n      const realInfo: TensorInfo =\n          cpuBackend.makeTensorInfo(resultShape, 'float32', result.real);\n      const imagInfo: TensorInfo =\n          cpuBackend.makeTensorInfo(resultShape, 'float32', result.imag);\n\n      const sizeInfo: TensorInfo = cpuBackend.makeTensorInfo(\n          [], 'float32',\n          util.createScalarValue(inputSize as {} as 'float32', 'float32'));\n      const sizeInfoCopy =\n          identity({inputs: {x: sizeInfo}, backend: cpuBackend});\n\n      const divRealInfo =\n          realDivConfig.kernelFunc(\n              {inputs: {a: realInfo, b: sizeInfo}, backend: cpuBackend}) as\n          TensorInfo;\n      const divImagInfo =\n          realDivConfig.kernelFunc(\n              {inputs: {a: imagInfo, b: sizeInfoCopy}, backend: cpuBackend}) as\n          TensorInfo;\n\n      const divRealVals =\n          cpuBackend.data.get(divRealInfo.dataId).values as Float32Array;\n      const divImagVals =\n          cpuBackend.data.get(divImagInfo.dataId).values as Float32Array;\n\n      cpuBackend.disposeIntermediateTensorInfo(realInfo);\n      cpuBackend.disposeIntermediateTensorInfo(imagInfo);\n      cpuBackend.disposeIntermediateTensorInfo(sizeInfo);\n      cpuBackend.disposeIntermediateTensorInfo(sizeInfoCopy);\n      cpuBackend.disposeIntermediateTensorInfo(divRealInfo);\n      cpuBackend.disposeIntermediateTensorInfo(divImagInfo);\n\n      return {real: divRealVals, imag: divImagVals};\n    }\n\n    return result;\n  } else {\n    const data = backend_util.mergeRealAndImagArrays(realVals, imagVals);\n\n    const rawOutput =\n        fourierTransformByMatmul(data, inputSize, inverse) as Float32Array;\n\n    return backend_util.splitRealAndImagArrays(rawOutput);\n  }\n}\n\nfunction isExponentOf2(size: number): boolean {\n  return (size & size - 1) === 0;\n}\n\n// FFT using Cooley-Tukey algorithm on radix 2 dimensional input.\nfunction fftRadix2(\n    realVals: Float32Array, imagVals: Float32Array, size: number,\n    inverse: boolean,\n    cpuBackend: MathBackendCPU): {real: Float32Array, imag: Float32Array} {\n  if (size === 1) {\n    return {real: realVals, imag: imagVals};\n  }\n\n  const data = backend_util.mergeRealAndImagArrays(realVals, imagVals);\n\n  const half = size / 2;\n\n  const evenComplex = backend_util.complexWithEvenIndex(data);\n\n  const evenRealVals = evenComplex.real;\n  const evenImagVals = evenComplex.imag;\n\n  const evenShape = [evenRealVals.length];\n\n  const evenRealInfo =\n      cpuBackend.makeTensorInfo(evenShape, 'float32', evenRealVals);\n  const evenImagInfo =\n      cpuBackend.makeTensorInfo(evenShape, 'float32', evenImagVals);\n\n  const evenTensorInfo = complex(\n      {inputs: {real: evenRealInfo, imag: evenImagInfo}, backend: cpuBackend});\n\n  const oddComplex = backend_util.complexWithOddIndex(data);\n\n  const oddRealVals = oddComplex.real;\n  const oddImagVals = oddComplex.imag;\n\n  const oddShape = [oddRealVals.length];\n\n  const oddRealInfo =\n      cpuBackend.makeTensorInfo(oddShape, 'float32', oddRealVals);\n  const oddImagInfo =\n      cpuBackend.makeTensorInfo(oddShape, 'float32', oddImagVals);\n\n  const oddTensorInfo = complex(\n      {inputs: {real: oddRealInfo, imag: oddImagInfo}, backend: cpuBackend});\n\n  // Recursive call for half part of original input.\n  const $evenComplex =\n      fftRadix2(evenRealVals, evenImagVals, half, inverse, cpuBackend);\n\n  const $evenRealVals = $evenComplex.real;\n  const $evenImagVals = $evenComplex.imag;\n\n  const $evenShape = [$evenRealVals.length];\n\n  const $evenRealInfo =\n      cpuBackend.makeTensorInfo($evenShape, 'float32', $evenRealVals);\n  const $evenImagInfo =\n      cpuBackend.makeTensorInfo($evenShape, 'float32', $evenImagVals);\n\n  const $evenTensorInfo = complex({\n    inputs: {real: $evenRealInfo, imag: $evenImagInfo},\n    backend: cpuBackend\n  });\n\n  const $oddComplex =\n      fftRadix2(oddRealVals, oddImagVals, half, inverse, cpuBackend);\n\n  const $oddRealVals = $oddComplex.real;\n  const $oddImagVals = $oddComplex.imag;\n\n  const $oddShape = [$oddRealVals.length];\n\n  const $oddRealInfo =\n      cpuBackend.makeTensorInfo($oddShape, 'float32', $oddRealVals);\n  const $oddImagInfo =\n      cpuBackend.makeTensorInfo($oddShape, 'float32', $oddImagVals);\n\n  const $oddTensorInfo = complex(\n      {inputs: {real: $oddRealInfo, imag: $oddImagInfo}, backend: cpuBackend});\n\n  const e = backend_util.exponents(size, inverse);\n  const eShape = [e.real.length];\n\n  const eRealInfo = cpuBackend.makeTensorInfo(eShape, 'float32', e.real);\n  const eImagInfo = cpuBackend.makeTensorInfo(eShape, 'float32', e.imag);\n\n  const complexInfo = complex(\n      {inputs: {real: eRealInfo, imag: eImagInfo}, backend: cpuBackend});\n\n  const exponentInfo =\n      multiply(\n          {inputs: {a: complexInfo, b: $oddTensorInfo}, backend: cpuBackend}) as\n      TensorInfo;\n\n  const addPart = add({\n                    inputs: {a: $evenTensorInfo, b: exponentInfo},\n                    backend: cpuBackend\n                  }) as TensorInfo;\n  const subPart = sub({\n                    inputs: {a: $evenTensorInfo, b: exponentInfo},\n                    backend: cpuBackend\n                  }) as TensorInfo;\n\n  const addPartReal = real({inputs: {input: addPart}, backend: cpuBackend});\n  const subPartReal = real({inputs: {input: subPart}, backend: cpuBackend});\n\n  const addPartImag = imag({inputs: {input: addPart}, backend: cpuBackend});\n  const subPartImag = imag({inputs: {input: subPart}, backend: cpuBackend});\n\n  const $real = concat({\n    inputs: [addPartReal as Tensor, subPartReal as Tensor],\n    backend: cpuBackend,\n    attrs: {axis: 0}\n  });\n  const $imag = concat({\n    inputs: [addPartImag as Tensor, subPartImag as Tensor],\n    backend: cpuBackend,\n    attrs: {axis: 0}\n  });\n\n  const $realVals = cpuBackend.data.get($real.dataId).values as Float32Array;\n  const $imagVals = cpuBackend.data.get($imag.dataId).values as Float32Array;\n\n  cpuBackend.disposeIntermediateTensorInfo(evenRealInfo);\n  cpuBackend.disposeIntermediateTensorInfo(evenImagInfo);\n  cpuBackend.disposeIntermediateTensorInfo(evenTensorInfo);\n  cpuBackend.disposeIntermediateTensorInfo(oddRealInfo);\n  cpuBackend.disposeIntermediateTensorInfo(oddImagInfo);\n  cpuBackend.disposeIntermediateTensorInfo(oddTensorInfo);\n  cpuBackend.disposeIntermediateTensorInfo($evenRealInfo);\n  cpuBackend.disposeIntermediateTensorInfo($evenImagInfo);\n  cpuBackend.disposeIntermediateTensorInfo($evenTensorInfo);\n  cpuBackend.disposeIntermediateTensorInfo($oddRealInfo);\n  cpuBackend.disposeIntermediateTensorInfo($oddImagInfo);\n  cpuBackend.disposeIntermediateTensorInfo($oddTensorInfo);\n  cpuBackend.disposeIntermediateTensorInfo(eRealInfo);\n  cpuBackend.disposeIntermediateTensorInfo(eImagInfo);\n  cpuBackend.disposeIntermediateTensorInfo(complexInfo);\n  cpuBackend.disposeIntermediateTensorInfo(exponentInfo);\n  cpuBackend.disposeIntermediateTensorInfo(addPart);\n  cpuBackend.disposeIntermediateTensorInfo(subPart);\n  cpuBackend.disposeIntermediateTensorInfo(addPartReal);\n  cpuBackend.disposeIntermediateTensorInfo(addPartImag);\n  cpuBackend.disposeIntermediateTensorInfo(subPartReal);\n  cpuBackend.disposeIntermediateTensorInfo(subPartImag);\n  cpuBackend.disposeIntermediateTensorInfo($real);\n  cpuBackend.disposeIntermediateTensorInfo($imag);\n\n  return {real: $realVals, imag: $imagVals};\n}\n\n// Calculate fourier transform by multplying sinusoid matrix.\nfunction fourierTransformByMatmul(\n    data: TypedArray, size: number, inverse: boolean): TypedArray {\n  const ret = new Float32Array(size * 2);\n  // TODO: Use matmul instead once it supports complex64 type.\n  for (let r = 0; r < size; r++) {\n    let real = 0.0;\n    let imag = 0.0;\n    for (let c = 0; c < size; c++) {\n      const e = backend_util.exponent(r * c, size, inverse);\n      const term = backend_util.getComplexWithIndex(data as Float32Array, c);\n      real += term.real * e.real - term.imag * e.imag;\n      imag += term.real * e.imag + term.imag * e.real;\n    }\n    if (inverse) {\n      real /= size;\n      imag /= size;\n    }\n    backend_util.assignToTypedArray(ret, real, imag, r);\n  }\n  return ret;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {FFT, FFTInputs, KernelConfig, KernelFunc, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {fftBatch} from '../utils/fft_utils';\nimport {reshape} from './Reshape';\n\nexport function fft(args: {inputs: FFTInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {input} = inputs;\n\n  const inputSize = util.sizeFromShape(input.shape);\n\n  // Collapse all outer dimensions to a single batch dimension.\n  const innerDimensionSize = input.shape[input.shape.length - 1];\n  const batch = inputSize / innerDimensionSize;\n\n  const input2D = reshape({\n    inputs: {x: input},\n    backend,\n    attrs: {shape: [batch, innerDimensionSize]}\n  });\n\n  const result = fftBatch(input2D, false, backend);\n\n  const resultReshaped =\n      reshape({inputs: {x: result}, backend, attrs: {shape: input.shape}});\n\n  backend.disposeIntermediateTensorInfo(input2D);\n  backend.disposeIntermediateTensorInfo(result);\n\n  return resultReshaped;\n}\n\nexport const fftConfig: KernelConfig = {\n  kernelName: FFT,\n  backendName: 'cpu',\n  kernelFunc: fft as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {DataType, DataValues, Fill, FillAttrs, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport function fill(args: {backend: MathBackendCPU, attrs: FillAttrs}):\n    TensorInfo {\n  const {backend, attrs} = args;\n  const {shape, value, dtype} = attrs;\n\n  const $dtype = dtype || util.inferDtype(value);\n  const values = util.getArrayFromDType($dtype, util.sizeFromShape(shape));\n  fillValues(values, value, $dtype);\n\n  return backend.makeTensorInfo(shape, $dtype, values);\n}\n\nexport const fillConfig: KernelConfig = {\n  kernelName: Fill,\n  backendName: 'cpu',\n  kernelFunc: fill as {} as KernelFunc\n};\n\nfunction fillValues(\n    values: DataValues, value: string|number, dtype: DataType): void {\n  if (dtype === 'string') {\n    (values as string[]).fill(value as string);\n  } else {\n    (values as TypedArray).fill(value as number);\n  }\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, NumericDataType, TypedArray} from '@tensorflow/tfjs-core';\nimport {FlipLeftRight, FlipLeftRightInputs, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport const flipLeftRightConfig: KernelConfig = {\n  kernelName: FlipLeftRight,\n  backendName: 'cpu',\n  kernelFunc: ({inputs, attrs, backend}) => {\n    const {image} = inputs as FlipLeftRightInputs;\n    const cpuBackend = backend as MathBackendCPU;\n\n    const output = util.getTypedArrayFromDType(\n        image.dtype as NumericDataType, util.sizeFromShape(image.shape));\n    const [batch, imageHeight, imageWidth, numChannels] = image.shape;\n\n    const imageVals = cpuBackend.data.get(image.dataId).values as TypedArray;\n\n    for (let batchIdx = 0; batchIdx < batch; batchIdx++) {\n      const batchOffset = batchIdx * imageWidth * imageHeight * numChannels;\n\n      for (let row = 0; row < imageHeight; row++) {\n        const rowOffset = row * (imageWidth * numChannels);\n\n        for (let col = 0; col < imageWidth; col++) {\n          const colOffset = col * numChannels;\n\n          for (let channel = 0; channel < numChannels; channel++) {\n            const coordX = Math.round(imageWidth - col - 1);\n            const outIdx = batchOffset + rowOffset + colOffset + channel;\n\n            let outputValue = imageVals[outIdx];\n            // If the coordinate position falls within the image boundaries...\n            if (coordX >= 0 && coordX < imageWidth) {\n              // set the output to the image value at the coordinate position.\n              const rotatedColOffset = coordX * numChannels;\n              const imageIdx =\n                  batchOffset + rowOffset + rotatedColOffset + channel;\n              outputValue = imageVals[imageIdx];\n            }\n            output[outIdx] = outputValue;\n          }\n        }\n      }\n    }\n\n    const dataId = cpuBackend.write(output, image.shape, image.dtype);\n    return {dataId, shape: image.shape, dtype: image.dtype};\n  }\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {FloorDiv, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const floorDivImpl =\n    createSimpleBinaryKernelImpl((a: number, b: number) => Math.floor(a / b));\nexport const floorDiv =\n    binaryKernelFunc(FloorDiv, floorDivImpl, null /* complexImpl */, 'int32');\n\nexport const floorDivConfig: KernelConfig = {\n  kernelName: FloorDiv,\n  backendName: 'cpu',\n  kernelFunc: floorDiv\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {FusedConv2D, FusedConv2DAttrs, FusedConv2DInputs, KernelConfig, KernelFunc, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {applyActivation} from '../utils/fused_utils';\nimport {add} from './Add';\nimport {conv2D} from './Conv2D';\nimport {reshape} from './Reshape';\n\nexport function fusedConv2D(args: {\n  inputs: FusedConv2DInputs,\n  backend: MathBackendCPU,\n  attrs: FusedConv2DAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, filter, bias, preluActivationWeights} = inputs;\n  const {\n    strides,\n    pad,\n    dataFormat,\n    dilations,\n    dimRoundingMode,\n    activation,\n    leakyreluAlpha\n  } = attrs;\n\n  let result = conv2D({\n    inputs: {x, filter},\n    backend,\n    attrs: {strides, pad, dataFormat, dilations, dimRoundingMode}\n  });\n\n  if (bias) {\n    const resultOld = result;\n    // For NCHW format, if bias is a 1-D tensor, it is supposed to be aligned\n    // to the channel of the conv2d's result; if the bias is a scalar, the\n    // bias_add is computed as if the bias was broadcasted to the shape of the\n    // conv2d's result.\n    if (dataFormat === 'NCHW' && bias.shape.length === 1 &&\n        bias.shape[0] !== 1) {\n      const reshapedBias = reshape(\n          {inputs: {x: bias}, backend, attrs: {shape: [bias.shape[0], 1, 1]}});\n      result =\n          add({inputs: {a: result, b: reshapedBias}, backend}) as TensorInfo;\n      backend.disposeIntermediateTensorInfo(reshapedBias);\n    } else {\n      // This condition handles NHWC and NCHW (scalar case). The only other case\n      // for NCHW (1D case) is handled above.\n      result = add({inputs: {a: result, b: bias}, backend}) as TensorInfo;\n    }\n    backend.disposeIntermediateTensorInfo(resultOld);\n  }\n\n  if (activation) {\n    const resultOld = result;\n    // For NCHW format, if PReLu activation weights is a 1-D tensor, it is\n    // supposed to be aligned with the channel of the conv2d's result. For other\n    // cases, whether NCHW or NHWC data format, the conv2d result is\n    // already aligned with the activation weights.\n    if (dataFormat === 'NCHW' && activation === 'prelu' &&\n        preluActivationWeights.shape.length === 1 &&\n        preluActivationWeights.shape[0] !== 1) {\n      const reshapedAlpha = reshape({\n        inputs: {x: preluActivationWeights},\n        backend,\n        attrs: {shape: [preluActivationWeights.shape[0], 1, 1]}\n      });\n      result = applyActivation(\n          backend, result, activation, reshapedAlpha, leakyreluAlpha);\n      backend.disposeIntermediateTensorInfo(reshapedAlpha);\n    } else {\n      result = applyActivation(\n          backend, result, activation, preluActivationWeights, leakyreluAlpha);\n    }\n    backend.disposeIntermediateTensorInfo(resultOld);\n  }\n\n  return result;\n}\n\nexport const fusedConv2DConfig: KernelConfig = {\n  kernelName: FusedConv2D,\n  backendName: 'cpu',\n  kernelFunc: fusedConv2D as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {FusedDepthwiseConv2D, FusedDepthwiseConv2DAttrs, FusedDepthwiseConv2DInputs, KernelConfig, KernelFunc, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {applyActivation} from '../utils/fused_utils';\nimport {add} from './Add';\nimport {depthwiseConv2dNative} from './DepthwiseConv2dNative';\n\nexport function fusedDepthwiseConv2D(args: {\n  inputs: FusedDepthwiseConv2DInputs,\n  backend: MathBackendCPU,\n  attrs: FusedDepthwiseConv2DAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, filter, bias, preluActivationWeights} = inputs;\n  const {\n    strides,\n    pad,\n    dataFormat,\n    dilations,\n    dimRoundingMode,\n    activation,\n    leakyreluAlpha\n  } = attrs;\n\n  let result = depthwiseConv2dNative({\n    inputs: {x, filter},\n    backend,\n    attrs: {strides, pad, dataFormat, dilations, dimRoundingMode}\n  });\n\n  if (bias) {\n    const oldResult = result;\n    result = add({inputs: {a: result, b: bias}, backend}) as TensorInfo;\n    backend.disposeIntermediateTensorInfo(oldResult);\n  }\n  if (activation) {\n    const oldResult = result;\n    result = applyActivation(\n        backend, result, activation, preluActivationWeights, leakyreluAlpha);\n    backend.disposeIntermediateTensorInfo(oldResult);\n  }\n\n  return result;\n}\n\nexport const fusedDepthwiseConv2DConfig: KernelConfig = {\n  kernelName: FusedDepthwiseConv2D,\n  backendName: 'cpu',\n  kernelFunc: fusedDepthwiseConv2D as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, GatherNd, GatherNdInputs, KernelConfig, KernelFunc, Rank, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {gatherNdImpl} from './GatherNd_Impl';\n\nexport function gatherNd(\n    args: {inputs: GatherNdInputs, backend: MathBackendCPU}): TensorInfo {\n  const {inputs, backend} = args;\n  const {params, indices} = inputs;\n\n  const paramsSize = util.sizeFromShape(params.shape);\n\n  const indicesShape = indices.shape;\n  const sliceRank = indicesShape[indicesShape.length - 1];\n\n  const [resultShape, numSlices, sliceSize, strides] =\n      backend_util.prepareAndValidate(params, indices);\n  if (numSlices === 0) {\n    return backend.makeTensorInfo(resultShape, params.dtype, []);\n  }\n\n  const indicesData = backend.data.get(indices.dataId).values as TypedArray;\n  const paramsBuf = backend.bufferSync<Rank, 'float32'>(params);\n  const outBuf = gatherNdImpl(\n      indicesData, paramsBuf, params.dtype, numSlices, sliceRank, sliceSize,\n      strides, params.shape, paramsSize);\n\n  return backend.makeTensorInfo(resultShape, params.dtype, outBuf.values);\n}\n\nexport const gatherNdConfig: KernelConfig = {\n  kernelName: GatherNd,\n  backendName: 'cpu',\n  kernelFunc: gatherNd as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, GatherV2, GatherV2Attrs, GatherV2Inputs, KernelConfig, KernelFunc, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {gatherV2Impl} from './GatherV2_impl';\nimport {reshape} from './Reshape';\n\nexport function gatherV2(args: {\n  inputs: GatherV2Inputs,\n  backend: MathBackendCPU,\n  attrs: GatherV2Attrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, indices} = inputs;\n  const {axis, batchDims} = attrs;\n\n  assertNotComplex([x, indices], 'gatherV2');\n\n  // Throw error when any index is out of bound.\n  const parsedAxis = util.parseAxisParam(axis, x.shape)[0];\n  const indicesVals = backend.data.get(indices.dataId).values as TypedArray;\n  const axisDim = x.shape[parsedAxis];\n  for (let i = 0; i < indicesVals.length; ++i) {\n    const index = indicesVals[i];\n    util.assert(\n        index <= axisDim - 1 && index >= 0,\n        () =>\n            `GatherV2: the index value ${index} is not in [0, ${axisDim - 1}]`);\n  }\n\n  let $batchDims = batchDims;\n\n  if (batchDims == null) {\n    $batchDims = 0;\n  }\n\n  const indicesSize = util.sizeFromShape(indices.shape);\n\n  const shapeInfo = backend_util.segment_util.collectGatherOpShapeInfo(\n      x, indices, parsedAxis, $batchDims);\n\n  const flattenX = reshape({\n    inputs: {x},\n    backend,\n    attrs: {\n      shape: [\n        shapeInfo.batchSize, shapeInfo.outerSize, shapeInfo.dimSize,\n        shapeInfo.sliceSize\n      ]\n    }\n  });\n\n  const flattenIndex = reshape({\n    inputs: {x: indices},\n    backend,\n    attrs: {shape: [shapeInfo.batchSize, indicesSize / shapeInfo.batchSize]}\n  });\n\n  const flattenOutputShape = [\n    shapeInfo.batchSize, shapeInfo.outerSize, indicesSize / shapeInfo.batchSize,\n    shapeInfo.sliceSize\n  ];\n\n  const indicesBuf = backend.bufferSync(flattenIndex);\n  const xBuf = backend.bufferSync(flattenX);\n  const outBuf = gatherV2Impl(xBuf, indicesBuf, flattenOutputShape);\n\n  backend.disposeIntermediateTensorInfo(flattenX);\n  backend.disposeIntermediateTensorInfo(flattenIndex);\n\n  return backend.makeTensorInfo(\n      shapeInfo.outputShape, outBuf.dtype, outBuf.values);\n}\n\nexport const gatherV2Config: KernelConfig = {\n  kernelName: GatherV2,\n  backendName: 'cpu',\n  kernelFunc: gatherV2 as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {IFFT, IFFTInputs, KernelConfig, KernelFunc, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {fftBatch} from '../utils/fft_utils';\nimport {reshape} from './Reshape';\n\nexport function ifft(args: {inputs: IFFTInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {input} = inputs;\n\n  const inputSize = util.sizeFromShape(input.shape);\n\n  // Collapse all outer dimensions to a single batch dimension.\n  const innerDimensionSize = input.shape[input.shape.length - 1];\n  const batch = inputSize / innerDimensionSize;\n\n  const input2D = reshape({\n    inputs: {x: input},\n    backend,\n    attrs: {shape: [batch, innerDimensionSize]}\n  });\n\n  const result = fftBatch(input2D, true, backend);\n\n  const resultReshaped =\n      reshape({inputs: {x: result}, backend, attrs: {shape: input.shape}});\n\n  backend.disposeIntermediateTensorInfo(input2D);\n  backend.disposeIntermediateTensorInfo(result);\n\n  return resultReshaped;\n}\n\nexport const ifftConfig: KernelConfig = {\n  kernelName: IFFT,\n  backendName: 'cpu',\n  kernelFunc: ifft as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {IsFinite, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const isFinite =\n    unaryKernelFunc(IsFinite, (xi) => Number.isFinite(xi) ? 1 : 0, 'bool');\n\nexport const isFiniteConfig: KernelConfig = {\n  kernelName: IsFinite,\n  backendName: 'cpu',\n  kernelFunc: isFinite,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {IsInf, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const isInf =\n    unaryKernelFunc(IsInf, (xi) => Math.abs(xi) === Infinity ? 1 : 0, 'bool');\n\nexport const isInfConfig: KernelConfig = {\n  kernelName: IsInf,\n  backendName: 'cpu',\n  kernelFunc: isInf,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {IsNan, KernelConfig} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const isNaN =\n    unaryKernelFunc(IsNan, (xi) => Number.isNaN(xi) ? 1 : 0, 'bool');\n\nexport const isNaNConfig: KernelConfig = {\n  kernelName: IsNan,\n  backendName: 'cpu',\n  kernelFunc: isNaN,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, LinSpace, LinSpaceAttrs, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {linSpaceImpl} from './LinSpace_impl';\n\nexport function linSpace(args: {backend: MathBackendCPU, attrs: LinSpaceAttrs}):\n    TensorInfo {\n  const {backend, attrs} = args;\n  const {start, stop, num} = attrs;\n\n  const outVals = linSpaceImpl(start, stop, num);\n\n  return backend.makeTensorInfo([outVals.length], 'float32', outVals);\n}\n\nexport const linSpaceConfig: KernelConfig = {\n  kernelName: LinSpace,\n  backendName: 'cpu',\n  kernelFunc: linSpace as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Log1p} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const log1p = unaryKernelFunc(Log1p, (xi) => Math.log1p(xi));\n\nexport const log1pConfig: KernelConfig = {\n  kernelName: Log1p,\n  backendName: 'cpu',\n  kernelFunc: log1p,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, LogicalAnd} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const logicalAndImpl =\n    createSimpleBinaryKernelImpl((a: number, b: number) => a && b);\nexport const logicalAnd = binaryKernelFunc(\n    LogicalAnd, logicalAndImpl, null /* complexImpl */, 'bool');\n\nexport const logicalAndConfig: KernelConfig = {\n  kernelName: LogicalAnd,\n  backendName: 'cpu',\n  kernelFunc: logicalAnd\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, LogicalNot} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const logicalNot =\n    unaryKernelFunc(LogicalNot, (xi) => xi ? 0 : 1, 'bool');\n\nexport const logicalNotConfig: KernelConfig = {\n  kernelName: LogicalNot,\n  backendName: 'cpu',\n  kernelFunc: logicalNot,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, LogicalOr} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const logicalOrImpl =\n    createSimpleBinaryKernelImpl((a: number, b: number) => a || b);\nexport const logicalOr =\n    binaryKernelFunc(LogicalOr, logicalOrImpl, null /* complexImpl */, 'bool');\n\nexport const logicalOrConfig: KernelConfig = {\n  kernelName: LogicalOr,\n  backendName: 'cpu',\n  kernelFunc: logicalOr\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, LRN, LRNAttrs, LRNInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function lRN(\n    args: {inputs: LRNInputs, backend: MathBackendCPU, attrs: LRNAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {depthRadius, bias, alpha, beta} = attrs;\n\n  assertNotComplex(x, 'LRN');\n\n  const channels = x.shape[3];\n  const maxD = channels - 1;\n  const xValues = backend.data.get(x.dataId).values as TypedArray;\n  const size = util.sizeFromShape(x.shape);\n  const result = new Float32Array(size);\n\n  function sumAcrossChannels(offset: number) {\n    const currentChannel = offset % channels;\n    let beginSumOffset =\n        offset - currentChannel + Math.max(0, currentChannel - depthRadius);\n    const endSumOffset =\n        offset - currentChannel + Math.min(currentChannel + depthRadius, maxD);\n\n    let sum = 0.0;\n    for (; beginSumOffset <= endSumOffset; beginSumOffset++) {\n      const z = xValues[beginSumOffset];\n      sum += z * z;\n    }\n    return sum;\n  }\n\n  for (let offset = 0; offset < size; offset++) {\n    const sum = sumAcrossChannels(offset);\n    const val = xValues[offset] * Math.pow(bias + alpha * sum, -beta);\n    result[offset] = val;\n  }\n\n  return backend.makeTensorInfo(x.shape, x.dtype, result);\n}\n\n// tslint:disable-next-line: variable-name\nexport const LRNConfig: KernelConfig = {\n  kernelName: LRN,\n  backendName: 'cpu',\n  kernelFunc: lRN as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, LRNGrad, LRNGradAttrs, LRNGradInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function lRNGrad(\n    args:\n        {inputs: LRNGradInputs, backend: MathBackendCPU, attrs: LRNGradAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, y, dy} = inputs;\n  const {depthRadius, bias, alpha, beta} = attrs;\n\n  assertNotComplex(dy, 'LRNGrad');\n\n  const dySize = util.sizeFromShape(dy.shape);\n\n  const channels = dy.shape[3];\n  const dyValues = backend.data.get(dy.dataId).values as TypedArray;\n  const xValues = backend.data.get(x.dataId).values as TypedArray;\n  const yValues = backend.data.get(y.dataId).values as TypedArray;\n  const result = new Float32Array(dySize);\n  const size = dySize;\n\n  for (let offset = 0; offset < size; offset++) {\n    const currentChannel = offset % channels;\n    const depthBegin =\n        (offset - currentChannel) + Math.max(0, currentChannel - depthRadius);\n    const depthEnd = (offset - currentChannel) +\n        Math.min(channels, currentChannel + depthRadius + 1);\n\n    let norm = 0;\n    for (let k = depthBegin; k < depthEnd; k++) {\n      norm += Math.pow(xValues[k], 2);\n    }\n    norm = alpha * norm + bias;\n\n    for (let k = depthBegin; k < depthEnd; k++) {\n      let dyi = -2 * alpha * beta * xValues[k] * yValues[offset] / norm;\n      if (offset === k) {\n        dyi += Math.pow(norm, -beta);\n      }\n      dyi *= dyValues[offset];\n      result[k] += dyi;\n    }\n  }\n\n  return backend.makeTensorInfo(dy.shape, x.dtype, result);\n}\n\n// tslint:disable-next-line: variable-name\nexport const LRNGradConfig: KernelConfig = {\n  kernelName: LRNGrad,\n  backendName: 'cpu',\n  kernelFunc: lRNGrad as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelFunc, Max, MaxAttrs, MaxInputs, TensorInfo} from '@tensorflow/tfjs-core';\nimport {backend_util, KernelConfig} from '@tensorflow/tfjs-core';\nimport {TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nimport {maxImpl} from './Max_impl';\nimport {transposeImpl} from './Transpose_impl';\n\nexport function max(\n    args: {inputs: MaxInputs, backend: MathBackendCPU, attrs: MaxAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {reductionIndices, keepDims} = attrs;\n  const cpuBackend = backend;\n  let xShape = x.shape;\n  const xRank = xShape.length;\n\n  const origAxes = util.parseAxisParam(reductionIndices, xShape);\n  let axes = origAxes;\n  const permutedAxes = backend_util.getAxesPermutation(axes, xRank);\n  let xVals = cpuBackend.data.get(x.dataId).values as TypedArray;\n  if (permutedAxes != null) {\n    const newShape: number[] = new Array(xRank);\n    for (let i = 0; i < newShape.length; i++) {\n      newShape[i] = xShape[permutedAxes[i]];\n    }\n\n    xVals = transposeImpl(xVals, xShape, x.dtype, permutedAxes, newShape);\n    axes = backend_util.getInnerMostAxes(axes.length, xRank);\n\n    xShape = newShape;\n  }\n\n  assertNotComplex(x, 'max');\n  backend_util.assertAxesAreInnerMostDims('max', axes, xRank);\n  const [maxOutShape, reduceShape] =\n      backend_util.computeOutAndReduceShapes(xShape, axes);\n\n  const reduceSize = util.sizeFromShape(reduceShape);\n\n  const result = maxImpl(xVals, reduceSize, maxOutShape, x.dtype);\n  const dataId = cpuBackend.write(result, maxOutShape, x.dtype);\n\n  let outShape = maxOutShape;\n  if (keepDims) {\n    // reshape\n    const newShape = backend_util.expandShapeToKeepDim(maxOutShape, origAxes);\n    outShape = newShape;\n  }\n\n  return {dataId, shape: outShape, dtype: x.dtype};\n}\n\nexport const maxConfig: KernelConfig = {\n  kernelName: Max,\n  backendName: 'cpu',\n  kernelFunc: max as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport {backend_util, KernelConfig, KernelFunc, MaxPool, MaxPoolAttrs, MaxPoolInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {pool} from '../utils/pool_utils';\nimport {identity} from './Identity';\n\nexport function maxPool(\n    args:\n        {inputs: MaxPoolInputs, backend: MathBackendCPU, attrs: MaxPoolAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  assertNotComplex(x, 'maxPool');\n  const {filterSize, strides, pad, dimRoundingMode} = attrs;\n  const dilations = 1;\n\n  util.assert(\n      backend_util.eitherStridesOrDilationsAreOne(strides, dilations),\n      () => 'Error in maxPool: Either strides or dilations must be 1. ' +\n          `Got strides ${strides} and dilations '${dilations}'`);\n\n  const convInfo = backend_util.computePool2DInfo(\n      x.shape as [number, number, number, number], filterSize, strides,\n      dilations, pad, dimRoundingMode);\n  let res: TensorInfo;\n\n  if (convInfo.filterWidth === 1 && convInfo.filterHeight === 1 &&\n      util.arraysEqual(convInfo.inShape, convInfo.outShape)) {\n    res = identity({inputs: {x}, backend});\n  } else {\n    const xValues = backend.data.get(x.dataId).values as TypedArray;\n    const strides = util.computeStrides(x.shape);\n    const buffer = pool(xValues, x.shape, x.dtype, strides, convInfo, 'max');\n    res = backend.makeTensorInfo(\n        convInfo.outShape, x.dtype, buffer.values as TypedArray);\n  }\n  return res;\n}\n\nexport const maxPoolConfig: KernelConfig = {\n  kernelName: MaxPool,\n  backendName: 'cpu',\n  kernelFunc: maxPool as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, KernelConfig, KernelFunc, MaxPool3D, MaxPool3DAttrs, MaxPool3DInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {pool3d} from '../utils/pool_utils';\n\nexport function maxPool3D(args: {\n  inputs: MaxPool3DInputs,\n  backend: MathBackendCPU,\n  attrs: MaxPool3DAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {filterSize, strides, pad, dimRoundingMode, dataFormat} = attrs;\n\n  assertNotComplex(x, 'maxPool3d');\n\n  const convInfo = backend_util.computePool3DInfo(\n      x.shape as [number, number, number, number, number], filterSize, strides,\n      1 /* dilations */, pad, dimRoundingMode, dataFormat);\n\n  const xValues = backend.data.get(x.dataId).values as TypedArray;\n  const outBuf = pool3d(\n      xValues, x.shape, x.dtype, util.computeStrides(x.shape), convInfo, 'max');\n\n  return backend.makeTensorInfo(outBuf.shape, 'float32', outBuf.values);\n}\n\nexport const maxPool3DConfig: KernelConfig = {\n  kernelName: MaxPool3D,\n  backendName: 'cpu',\n  kernelFunc: maxPool3D as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, buffer, KernelConfig, KernelFunc, MaxPool3DGrad, MaxPool3DGradAttrs, MaxPool3DGradInputs, Rank, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {maxPool3dPositions} from '../utils/pool_utils';\n\nexport function maxPool3DGrad(args: {\n  inputs: MaxPool3DGradInputs,\n  backend: MathBackendCPU,\n  attrs: MaxPool3DGradAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {dy, input} = inputs;\n  const {filterSize, strides, pad, dimRoundingMode} = attrs;\n\n  assertNotComplex([dy, input], 'maxPool3DGrad');\n\n  const convInfo = backend_util.computePool3DInfo(\n      input.shape as [number, number, number, number, number], filterSize,\n      strides, 1 /* dilations */, pad, dimRoundingMode);\n\n  const inputBuf = backend.bufferSync(input);\n  const maxPosBuf = maxPool3dPositions(inputBuf, convInfo);\n  const strideDepth = convInfo.strideDepth;\n  const strideHeight = convInfo.strideHeight;\n  const strideWidth = convInfo.strideWidth;\n  const dilationDepth = convInfo.dilationDepth;\n  const dilationHeight = convInfo.dilationHeight;\n  const dilationWidth = convInfo.dilationWidth;\n  const effectiveFilterDepth = convInfo.effectiveFilterDepth;\n  const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n  const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n  const padFront = effectiveFilterDepth - 1 - convInfo.padInfo.front;\n  const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n  const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n  const dx = buffer(input.shape, 'float32');\n\n  const dyBuf = backend.bufferSync<Rank, 'float32'>(dy);\n\n  for (let batch = 0; batch < convInfo.batchSize; ++batch) {\n    for (let channel = 0; channel < convInfo.inChannels; ++channel) {\n      for (let dxDepth = 0; dxDepth < convInfo.inDepth; ++dxDepth) {\n        for (let dxRow = 0; dxRow < convInfo.inHeight; ++dxRow) {\n          for (let dxCol = 0; dxCol < convInfo.inWidth; ++dxCol) {\n            // Shader code begins\n            const dyDepthCorner = dxDepth - padFront;\n            const dyRowCorner = dxRow - padTop;\n            const dyColCorner = dxCol - padLeft;\n            let dotProd = 0;\n            for (let wDepth = 0; wDepth < effectiveFilterDepth;\n                 wDepth += dilationDepth) {\n              const dyDepth = (dyDepthCorner + wDepth) / strideDepth;\n              if (dyDepth < 0 || dyDepth >= convInfo.outDepth ||\n                  Math.floor(dyDepth) !== dyDepth) {\n                continue;\n              }\n              for (let wRow = 0; wRow < effectiveFilterHeight;\n                   wRow += dilationHeight) {\n                const dyRow = (dyRowCorner + wRow) / strideHeight;\n                if (dyRow < 0 || dyRow >= convInfo.outHeight ||\n                    Math.floor(dyRow) !== dyRow) {\n                  continue;\n                }\n                for (let wCol = 0; wCol < effectiveFilterWidth;\n                     wCol += dilationWidth) {\n                  const dyCol = (dyColCorner + wCol) / strideWidth;\n                  if (dyCol < 0 || dyCol >= convInfo.outWidth ||\n                      Math.floor(dyCol) !== dyCol) {\n                    continue;\n                  }\n\n                  const maxPos = effectiveFilterDepth * effectiveFilterHeight *\n                          effectiveFilterWidth -\n                      1 -\n                      (maxPosBuf.get(batch, dyDepth, dyRow, dyCol, channel) as\n                       number);\n                  const curPos =\n                      wDepth * effectiveFilterHeight * effectiveFilterWidth +\n                      wRow * effectiveFilterWidth + wCol;\n\n                  const mask = maxPos === curPos ? 1 : 0;\n                  if (mask === 0) {\n                    continue;\n                  }\n\n                  const pixel =\n                      dyBuf.get(batch, dyDepth, dyRow, dyCol, channel);\n                  dotProd += pixel * mask;\n                }\n              }\n            }\n            dx.set(dotProd, batch, dxDepth, dxRow, dxCol, channel);\n          }\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(dx.shape, dx.dtype, dx.values);\n}\n\nexport const maxPool3DGradConfig: KernelConfig = {\n  kernelName: MaxPool3DGrad,\n  backendName: 'cpu',\n  kernelFunc: maxPool3DGrad as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport {backend_util, buffer, KernelConfig, KernelFunc, MaxPoolGrad, MaxPoolGradAttrs, MaxPoolGradInputs, Rank, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {maxPoolPositions} from '../utils/pool_utils';\n\nexport function maxPoolGrad(args: {\n  inputs: MaxPoolGradInputs,\n  backend: MathBackendCPU,\n  attrs: MaxPoolGradAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {dy, input, output} = inputs;\n  const x = input;\n  assertNotComplex([input, output], 'maxPoolGrad');\n  const {filterSize, strides, pad, dimRoundingMode} = attrs;\n\n  const convInfo = backend_util.computePool2DInfo(\n      x.shape as [number, number, number, number], filterSize, strides,\n      1 /* dilations */, pad, dimRoundingMode);\n  const xValues = backend.data.get(x.dataId).values as TypedArray;\n  const maxPosBuf = buffer(\n      convInfo.outShape, x.dtype,\n      maxPoolPositions(xValues, x.shape, x.dtype, convInfo).values);\n  const strideHeight = convInfo.strideHeight;\n  const strideWidth = convInfo.strideWidth;\n  const dilationHeight = convInfo.dilationHeight;\n  const dilationWidth = convInfo.dilationWidth;\n  const effectiveFilterHeight = convInfo.effectiveFilterHeight;\n  const effectiveFilterWidth = convInfo.effectiveFilterWidth;\n  const padLeft = effectiveFilterWidth - 1 - convInfo.padInfo.left;\n  const padTop = effectiveFilterHeight - 1 - convInfo.padInfo.top;\n  const dx =\n      buffer<Rank.R4>(x.shape as [number, number, number, number], 'float32');\n\n  const dyData = backend.data.get(dy.dataId).values as Float32Array;\n  const dyBuf = buffer<Rank.R4>(\n      dy.shape as [number, number, number, number], 'float32', dyData);\n\n  for (let b = 0; b < convInfo.batchSize; ++b) {\n    for (let d = 0; d < convInfo.inChannels; ++d) {\n      for (let dxR = 0; dxR < convInfo.inHeight; ++dxR) {\n        for (let dxC = 0; dxC < convInfo.inWidth; ++dxC) {\n          // Shader code begins.\n          const dyRCorner = dxR - padTop;\n          const dyCCorner = dxC - padLeft;\n          let dotProd = 0;\n          for (let wR = 0; wR < effectiveFilterHeight; wR += dilationHeight) {\n            const dyR = (dyRCorner + wR) / strideHeight;\n            if (dyR < 0 || dyR >= convInfo.outHeight ||\n                Math.floor(dyR) !== dyR) {\n              continue;\n            }\n            for (let wC = 0; wC < effectiveFilterWidth; wC += dilationWidth) {\n              const dyC = (dyCCorner + wC) / strideWidth;\n              if (dyC < 0 || dyC >= convInfo.outWidth ||\n                  Math.floor(dyC) !== dyC) {\n                continue;\n              }\n              const maxPos = effectiveFilterHeight * effectiveFilterWidth - 1 -\n                  (maxPosBuf.get(b, dyR, dyC, d) as number);\n              const curPos = wR * effectiveFilterWidth + wC;\n\n              const mask = maxPos === curPos ? 1 : 0;\n              if (mask === 0) {\n                continue;\n              }\n\n              const pixel = dyBuf.get(b, dyR, dyC, d);\n              dotProd += pixel * mask;\n            }\n          }\n          dx.set(dotProd, b, dxR, dxC, d);\n        }\n      }\n    }\n  }\n  return backend.makeTensorInfo(dx.shape, dx.dtype, dx.values);\n}\n\nexport const maxPoolGradConfig: KernelConfig = {\n  kernelName: MaxPoolGrad,\n  backendName: 'cpu',\n  kernelFunc: maxPoolGrad as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {MaxPoolWithArgmax, MaxPoolWithArgmaxAttrs, MaxPoolWithArgmaxInputs} from '@tensorflow/tfjs-core';\nimport {backend_util, KernelConfig, TypedArray} from '@tensorflow/tfjs-core';\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nimport {maxPoolWithArgmaxImpl} from './MaxPoolWithArgmax_impl';\n\nexport const maxPoolWithArgmaxConfig: KernelConfig = {\n  kernelName: MaxPoolWithArgmax,\n  backendName: 'cpu',\n  kernelFunc: ({inputs, attrs, backend}) => {\n    const {x} = inputs as MaxPoolWithArgmaxInputs;\n    const {filterSize, strides, pad, includeBatchInIndex} =\n        attrs as {} as MaxPoolWithArgmaxAttrs;\n    const cpuBackend = backend as MathBackendCPU;\n    assertNotComplex(x, 'MaxPoolWithArgmax');\n\n    const values = cpuBackend.data.get(x.dataId).values as TypedArray;\n    const convInfo = backend_util.computePool2DInfo(\n        x.shape as [number, number, number, number], filterSize, strides,\n        [1, 1], pad);\n    const [pooled, indexes] = maxPoolWithArgmaxImpl(\n        values, x.shape, x.dtype, includeBatchInIndex, convInfo);\n\n    const pooledDataId =\n        cpuBackend.write(pooled as Float32Array, convInfo.outShape, x.dtype);\n    const indexesDataId =\n        cpuBackend.write(indexes as Int32Array, convInfo.outShape, x.dtype);\n    return [\n      {dataId: pooledDataId, shape: convInfo.outShape, dtype: x.dtype},\n      {dataId: indexesDataId, shape: convInfo.outShape, dtype: 'int32'}\n    ];\n  }\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport {backend_util, DataType, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {maxPoolPositions, pool} from '../utils/pool_utils';\nexport function maxPoolWithArgmaxImpl(\n    xValues: TypedArray, xShape: number[], dtype: DataType,\n    includeBatchInIndex: boolean, convInfo: backend_util.Conv2DInfo) {\n  const strides = util.computeStrides(xShape);\n  const maxPools = pool(xValues, xShape, dtype, strides, convInfo, 'max');\n  const maxPositions = maxPoolPositions(\n      xValues, xShape, dtype, convInfo, true, includeBatchInIndex);\n\n  return [maxPools.values, maxPositions.values];\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, KernelConfig, KernelFunc, Mean, MeanAttrs, MeanInputs, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {cast} from './Cast';\nimport {div} from './RealDiv';\nimport {sum} from './Sum';\n\nexport function mean(\n    args: {inputs: MeanInputs, backend: MathBackendCPU, attrs: MeanAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {axis, keepDims} = attrs;\n\n  const axes = util.parseAxisParam(axis, x.shape);\n  const shapes = backend_util.computeOutAndReduceShapes(x.shape, axes);\n  const reduceShape = shapes[1];\n  const reduceSize = util.sizeFromShape(reduceShape);\n  const toDispose = [];\n  const reduceSizeScalar =\n      backend.makeTensorInfo([], 'float32', new Float32Array([reduceSize]));\n  toDispose.push(reduceSizeScalar);\n\n  const $x = cast({inputs: {x}, backend, attrs: {dtype: 'float32'}});\n  toDispose.push($x);\n\n  const res =\n      div({inputs: {a: $x, b: reduceSizeScalar}, backend}) as TensorInfo;\n  toDispose.push(res);\n\n  const result = sum({inputs: {x: res}, backend, attrs: {axis, keepDims}});\n\n  toDispose.forEach(t => backend.disposeIntermediateTensorInfo(t));\n\n  return result;\n}\n\nexport const meanConfig: KernelConfig = {\n  kernelName: Mean,\n  backendName: 'cpu',\n  kernelFunc: mean as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, KernelConfig, KernelFunc, Min, MinAttrs, MinInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {reshape} from './Reshape';\nimport {transpose} from './Transpose';\n\nexport function min(\n    args: {inputs: MinInputs, backend: MathBackendCPU, attrs: MinAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {axis, keepDims} = attrs;\n\n  assertNotComplex(x, 'min');\n\n  const origAxes = util.parseAxisParam(axis, x.shape);\n  let axes = origAxes;\n  const permutedAxes = backend_util.getAxesPermutation(axes, x.shape.length);\n  let $x = x;\n  if (permutedAxes != null) {\n    $x = transpose({inputs: {x}, backend, attrs: {perm: permutedAxes}});\n    axes = backend_util.getInnerMostAxes(axes.length, x.shape.length);\n  }\n\n  backend_util.assertAxesAreInnerMostDims('min', axes, $x.shape.length);\n  const [outShape, reduceShape] =\n      backend_util.computeOutAndReduceShapes($x.shape, axes);\n  const reduceSize = util.sizeFromShape(reduceShape);\n  const vals = util.makeZerosTypedArray(util.sizeFromShape(outShape), $x.dtype);\n\n  const aVals = backend.data.get($x.dataId).values as TypedArray;\n  for (let i = 0; i < vals.length; ++i) {\n    const offset = i * reduceSize;\n    let min = aVals[offset];\n    for (let j = 0; j < reduceSize; ++j) {\n      const value = aVals[offset + j];\n      if (Number.isNaN(value) ||\n          value < min) {  // comparison with NaN always return false\n        min = value;\n      }\n    }\n    vals[i] = min;\n  }\n\n  if (permutedAxes != null) {\n    backend.disposeIntermediateTensorInfo($x);\n  }\n\n  const result = backend.makeTensorInfo(outShape, $x.dtype, vals);\n\n  if (keepDims) {\n    const expandedShape = backend_util.expandShapeToKeepDim(outShape, origAxes);\n    const reshapedResult =\n        reshape({inputs: {x: result}, backend, attrs: {shape: expandedShape}});\n\n    backend.disposeIntermediateTensorInfo(result);\n\n    return reshapedResult;\n  }\n\n  return result;\n}\n\nexport const minConfig: KernelConfig = {\n  kernelName: Min,\n  backendName: 'cpu',\n  kernelFunc: min as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, MirrorPad, MirrorPadAttrs, MirrorPadInputs, NumericDataType, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function mirrorPad(args: {\n  inputs: MirrorPadInputs,\n  backend: MathBackendCPU,\n  attrs: MirrorPadAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {paddings, mode} = attrs;\n\n  assertNotComplex(x, 'mirrorPad');\n\n  const outShape = paddings.map(\n      (p, i) => p[0] /* beforePad */ + x.shape[i] + p[1] /* afterPad */);\n\n  const start = paddings.map(p => p[0]);\n  const end = paddings.map((p, i) => p[0] + x.shape[i]);\n  const offset = mode === 'reflect' ? 0 : 1;\n\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const xRank = x.shape.length;\n  const xStrides = util.computeStrides(x.shape);\n\n  const resultSize = util.sizeFromShape(outShape);\n  const resultRank = outShape.length;\n  const resultStrides = util.computeStrides(outShape);\n  const resVals =\n      util.getTypedArrayFromDType(x.dtype as NumericDataType, resultSize);\n\n  for (let i = 0; i < resultSize; i++) {\n    let coords = util.indexToLoc(i, resultRank, resultStrides);\n    for (let i = 0; i < resultRank; i++) {\n      if (coords[i] < start[i]) {\n        coords[i] = start[i] * 2 - coords[i] - offset;\n      } else if (coords[i] >= end[i]) {\n        coords[i] = (end[i] - 1) * 2 - coords[i] + offset;\n      }\n    }\n    coords = coords.map((c, i) => c - start[i]);\n\n    const inIndex = util.locToIndex(coords, xRank, xStrides);\n\n    resVals[i] = xVals[inIndex];\n  }\n\n  const outId = backend.write(resVals, outShape, x.dtype);\n\n  return {dataId: outId, shape: outShape, dtype: x.dtype};\n}\n\nexport const mirrorPadConfig: KernelConfig = {\n  kernelName: MirrorPad,\n  backendName: 'cpu',\n  kernelFunc: mirrorPad as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Mod} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const modImpl =\n    createSimpleBinaryKernelImpl(((aValue: number, bValue: number) => {\n      const rem = aValue % bValue;\n      if ((aValue < 0 && bValue < 0) || (aValue >= 0 && bValue >= 0)) {\n        return rem;\n      } else {\n        return (rem + bValue) % bValue;\n      }\n    }));\n\nexport const mod = binaryKernelFunc(Mod, modImpl);\n\nexport const modConfig: KernelConfig = {\n  kernelName: Mod,\n  backendName: 'cpu',\n  kernelFunc: mod\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, KernelConfig, KernelFunc, Softmax, SoftmaxAttrs, SoftmaxInputs, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {exp} from './Exp';\nimport {max} from './Max';\nimport {div} from './RealDiv';\nimport {reshape} from './Reshape';\nimport {sub} from './Sub';\nimport {sum} from './Sum';\n\nexport function softmax(\n    args:\n        {inputs: SoftmaxInputs, backend: MathBackendCPU, attrs: SoftmaxAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {logits} = inputs;\n  const {dim} = attrs;\n\n  const logitsRank = logits.shape.length;\n\n  let $dim = dim;\n  if ($dim === -1) {\n    $dim = logitsRank - 1;\n  }\n  if ($dim !== logitsRank - 1) {\n    throw Error(\n        'Softmax along a non-last dimension is not yet supported. ' +\n        `Logits was rank ${logitsRank} and dim was ${$dim}`);\n  }\n\n  const axes = util.parseAxisParam([$dim], logits.shape);\n  const maxLogit = max({\n    inputs: {x: logits},\n    backend,\n    attrs: {reductionIndices: axes, keepDims: false}\n  });\n  const expandedShape = backend_util.expandShapeToKeepDim(maxLogit.shape, axes);\n\n  const maxLogitReshaped =\n      reshape({inputs: {x: maxLogit}, backend, attrs: {shape: expandedShape}});\n  const a =\n      sub({inputs: {a: logits, b: maxLogitReshaped}, backend}) as TensorInfo;\n  const b = exp({inputs: {x: a}, backend}) as TensorInfo;\n  const sumExp =\n      sum({inputs: {x: b}, backend, attrs: {axis: axes, keepDims: false}});\n  const sumReshaped =\n      reshape({inputs: {x: sumExp}, backend, attrs: {shape: expandedShape}});\n\n  const result = div({inputs: {a: b, b: sumReshaped}, backend}) as TensorInfo;\n\n  backend.disposeIntermediateTensorInfo(maxLogit);\n  backend.disposeIntermediateTensorInfo(maxLogitReshaped);\n  backend.disposeIntermediateTensorInfo(a);\n  backend.disposeIntermediateTensorInfo(b);\n  backend.disposeIntermediateTensorInfo(sumExp);\n  backend.disposeIntermediateTensorInfo(sumReshaped);\n\n  return result;\n}\n\nexport const softmaxConfig: KernelConfig = {\n  kernelName: Softmax,\n  backendName: 'cpu',\n  kernelFunc: softmax as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, Multinomial, MultinomialAttrs, MultinomialInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\nimport * as seedrandom from 'seedrandom';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nimport {softmax} from './Softmax';\n\nexport function multinomial(args: {\n  inputs: MultinomialInputs,\n  backend: MathBackendCPU,\n  attrs: MultinomialAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {logits} = inputs;\n  const {numSamples, seed, normalized} = attrs;\n\n  assertNotComplex(logits, 'multinomial');\n\n  const probabilities = normalized ?\n      logits :\n      softmax({inputs: {logits}, backend, attrs: {dim: -1}});\n\n  const batchSize = probabilities.shape[0];\n  const numEvents = probabilities.shape[1];\n  const probVals = backend.data.get(probabilities.dataId).values as TypedArray;\n  const resShape = [batchSize, numSamples];\n  const resVals =\n      util.makeZerosTypedArray(util.sizeFromShape(resShape), 'int32');\n\n  for (let b = 0; b < batchSize; ++b) {\n    const offset = b * numEvents;\n    // The cdf won't include the last event. It will be implicit if no other\n    // event happened.\n    const cdf = new Float32Array(numEvents - 1);\n    cdf[0] = probVals[offset];\n    for (let event = 1; event < cdf.length; ++event) {\n      cdf[event] = cdf[event - 1] + probVals[offset + event];\n    }\n\n    const random = seedrandom.alea(seed.toString());\n    const outOffset = b * numSamples;\n    for (let sampleId = 0; sampleId < numSamples; ++sampleId) {\n      const r = random();\n\n      // Assume last event happened by default.\n      resVals[outOffset + sampleId] = cdf.length;\n\n      for (let event = 0; event < cdf.length; event++) {\n        if (r < cdf[event]) {\n          resVals[outOffset + sampleId] = event;\n          break;\n        }\n      }\n    }\n  }\n\n  if (!normalized) {\n    backend.disposeIntermediateTensorInfo(probabilities);\n  }\n\n  return backend.makeTensorInfo(resShape, 'int32', resVals);\n}\n\nexport const multinomialConfig: KernelConfig = {\n  kernelName: Multinomial,\n  backendName: 'cpu',\n  kernelFunc: multinomial as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {kernel_impls, KernelConfig, KernelFunc, NonMaxSuppressionV3, NonMaxSuppressionV3Attrs, NonMaxSuppressionV3Inputs, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nconst nonMaxSuppressionV3Impl = kernel_impls.nonMaxSuppressionV3Impl;\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function nonMaxSuppressionV3(args: {\n  inputs: NonMaxSuppressionV3Inputs,\n  backend: MathBackendCPU,\n  attrs: NonMaxSuppressionV3Attrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {boxes, scores} = inputs;\n  const {maxOutputSize, iouThreshold, scoreThreshold} = attrs;\n\n  assertNotComplex(boxes, 'NonMaxSuppression');\n\n  const boxesVals = backend.data.get(boxes.dataId).values as TypedArray;\n  const scoresVals = backend.data.get(scores.dataId).values as TypedArray;\n\n  const {selectedIndices} = nonMaxSuppressionV3Impl(\n      boxesVals, scoresVals, maxOutputSize, iouThreshold, scoreThreshold);\n\n  return backend.makeTensorInfo(\n      [selectedIndices.length], 'int32', new Int32Array(selectedIndices));\n}\n\nexport const nonMaxSuppressionV3Config: KernelConfig = {\n  kernelName: NonMaxSuppressionV3,\n  backendName: 'cpu',\n  kernelFunc: nonMaxSuppressionV3 as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {kernel_impls, KernelConfig, KernelFunc, NonMaxSuppressionV4, NonMaxSuppressionV4Attrs, NonMaxSuppressionV4Inputs, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nconst nonMaxSuppressionV4Impl = kernel_impls.nonMaxSuppressionV4Impl;\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function nonMaxSuppressionV4(args: {\n  inputs: NonMaxSuppressionV4Inputs,\n  backend: MathBackendCPU,\n  attrs: NonMaxSuppressionV4Attrs\n}): [TensorInfo, TensorInfo] {\n  const {inputs, backend, attrs} = args;\n  const {boxes, scores} = inputs;\n  const {maxOutputSize, iouThreshold, scoreThreshold, padToMaxOutputSize} =\n      attrs;\n\n  assertNotComplex(boxes, 'NonMaxSuppressionPadded');\n\n  const boxesVals = backend.data.get(boxes.dataId).values as TypedArray;\n  const scoresVals = backend.data.get(scores.dataId).values as TypedArray;\n\n  const {selectedIndices, validOutputs} = nonMaxSuppressionV4Impl(\n      boxesVals, scoresVals, maxOutputSize, iouThreshold, scoreThreshold,\n      padToMaxOutputSize);\n\n  return [\n    backend.makeTensorInfo(\n        [selectedIndices.length], 'int32', new Int32Array(selectedIndices)),\n    backend.makeTensorInfo([], 'int32', new Int32Array([validOutputs]))\n  ];\n}\nexport const nonMaxSuppressionV4Config: KernelConfig = {\n  kernelName: NonMaxSuppressionV4,\n  backendName: 'cpu',\n  kernelFunc: nonMaxSuppressionV4 as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {kernel_impls, KernelConfig, KernelFunc, NonMaxSuppressionV5, NonMaxSuppressionV5Attrs, NonMaxSuppressionV5Inputs, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nconst nonMaxSuppressionV5Impl = kernel_impls.nonMaxSuppressionV5Impl;\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function nonMaxSuppressionV5(args: {\n  inputs: NonMaxSuppressionV5Inputs,\n  backend: MathBackendCPU,\n  attrs: NonMaxSuppressionV5Attrs\n}): [TensorInfo, TensorInfo] {\n  const {inputs, backend, attrs} = args;\n  const {boxes, scores} = inputs;\n  const {maxOutputSize, iouThreshold, scoreThreshold, softNmsSigma} = attrs;\n\n  assertNotComplex(boxes, 'NonMaxSuppressionWithScore');\n\n  const boxesVals = backend.data.get(boxes.dataId).values as TypedArray;\n  const scoresVals = backend.data.get(scores.dataId).values as TypedArray;\n\n  const maxOutputSizeVal = maxOutputSize;\n  const iouThresholdVal = iouThreshold;\n  const scoreThresholdVal = scoreThreshold;\n  const softNmsSigmaVal = softNmsSigma;\n\n  const {selectedIndices, selectedScores} = nonMaxSuppressionV5Impl(\n      boxesVals, scoresVals, maxOutputSizeVal, iouThresholdVal,\n      scoreThresholdVal, softNmsSigmaVal);\n\n  return [\n    backend.makeTensorInfo(\n        [selectedIndices.length], 'int32', new Int32Array(selectedIndices)),\n    backend.makeTensorInfo(\n        [selectedScores.length], 'float32', new Float32Array(selectedScores))\n  ];\n}\n\nexport const nonMaxSuppressionV5Config: KernelConfig = {\n  kernelName: NonMaxSuppressionV5,\n  backendName: 'cpu',\n  kernelFunc: nonMaxSuppressionV5 as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, OneHot, OneHotAttrs, OneHotInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function oneHot(\n    args: {inputs: OneHotInputs, backend: MathBackendCPU, attrs: OneHotAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {indices} = inputs;\n  const {dtype, depth, onValue, offValue} = attrs;\n\n  assertNotComplex(indices, 'oneHot');\n\n  const indicesSize = util.sizeFromShape(indices.shape);\n\n  const res = new Float32Array(indicesSize * depth);\n  res.fill(offValue);\n  const indicesVal = backend.data.get(indices.dataId).values as TypedArray;\n\n  for (let event = 0; event < indicesSize; ++event) {\n    if (indicesVal[event] >= 0 && indicesVal[event] < depth) {\n      res[event * depth + indicesVal[event]] = onValue;\n    }\n  }\n\n  return backend.makeTensorInfo([...indices.shape, depth], dtype, res);\n}\n\nexport const oneHotConfig: KernelConfig = {\n  kernelName: OneHot,\n  backendName: 'cpu',\n  kernelFunc: oneHot as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, TensorInfo, ZerosLike, ZerosLikeInputs} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {complex} from './Complex';\nimport {fill} from './Fill';\nimport {imag} from './Imag';\nimport {real} from './Real';\n\nexport function zerosLike(\n    args: {inputs: ZerosLikeInputs, backend: MathBackendCPU}): TensorInfo {\n  const {inputs, backend} = args;\n  const {x} = inputs;\n\n  if (x.dtype === 'string') {\n    throw new Error('zerosLike is not supported for string tensors');\n  } else if (x.dtype === 'complex64') {\n    const realPart = real({inputs: {input: x}, backend});\n    const r = zerosLike({inputs: {x: realPart}, backend});\n    const imagPart = imag({inputs: {input: x}, backend});\n    const i = zerosLike({inputs: {x: imagPart}, backend});\n\n    const result = complex({inputs: {real: r, imag: i}, backend});\n\n    backend.disposeIntermediateTensorInfo(realPart);\n    backend.disposeIntermediateTensorInfo(r);\n    backend.disposeIntermediateTensorInfo(imagPart);\n    backend.disposeIntermediateTensorInfo(i);\n\n    return result;\n  } else {\n    return fill({backend, attrs: {shape: x.shape, value: 0, dtype: x.dtype}});\n  }\n}\n\nexport const zerosLikeConfig: KernelConfig = {\n  kernelName: ZerosLike,\n  backendName: 'cpu',\n  kernelFunc: zerosLike as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, OnesLike, OnesLikeInputs, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {complex} from './Complex';\nimport {fill} from './Fill';\nimport {imag} from './Imag';\nimport {real} from './Real';\nimport {zerosLike} from './ZerosLike';\n\nexport function onesLike(\n    args: {inputs: OnesLikeInputs, backend: MathBackendCPU}): TensorInfo {\n  const {inputs, backend} = args;\n  const {x} = inputs;\n\n  if (x.dtype === 'string') {\n    throw new Error('onesLike is not supported for string tensors');\n  } else if (x.dtype === 'complex64') {\n    const realPart = real({inputs: {input: x}, backend});\n    const r = onesLike({inputs: {x: realPart}, backend});\n    const imagPart = imag({inputs: {input: x}, backend});\n    const i = zerosLike({inputs: {x: imagPart}, backend});\n\n    const result = complex({inputs: {real: r, imag: i}, backend});\n\n    backend.disposeIntermediateTensorInfo(realPart);\n    backend.disposeIntermediateTensorInfo(r);\n    backend.disposeIntermediateTensorInfo(imagPart);\n    backend.disposeIntermediateTensorInfo(i);\n\n    return result;\n  } else {\n    return fill({backend, attrs: {shape: x.shape, value: 1, dtype: x.dtype}});\n  }\n}\n\nexport const onesLikeConfig: KernelConfig = {\n  kernelName: OnesLike,\n  backendName: 'cpu',\n  kernelFunc: onesLike as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, Pack, PackAttrs, PackInputs, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {concat} from './Concat';\nimport {expandDims} from './ExpandDims';\n\nexport function pack(\n    args: {inputs: PackInputs, backend: MathBackendCPU, attrs: PackAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {axis} = attrs;\n\n  if (inputs.length === 1) {\n    return expandDims(\n        {inputs: {input: inputs[0]}, backend, attrs: {dim: axis}});\n  }\n\n  const shape = inputs[0].shape;\n  const dtype = inputs[0].dtype;\n\n  inputs.forEach(t => {\n    util.assertShapesMatch(\n        shape, t.shape,\n        'All tensors passed to stack must have matching shapes');\n    util.assert(\n        dtype === t.dtype,\n        () => 'All tensors passed to stack must have matching dtypes');\n  });\n\n  const intermediateTensorInfos: TensorInfo[] = [];\n  const expandedTensors = inputs.map(t => {\n    const expandedT =\n        expandDims({inputs: {input: t}, backend, attrs: {dim: axis}});\n    intermediateTensorInfos.push(expandedT);\n    return expandedT;\n  });\n\n  const result = concat({inputs: expandedTensors, backend, attrs: {axis}});\n\n  intermediateTensorInfos.forEach(\n      t => backend.disposeIntermediateTensorInfo(t));\n\n  return result;\n}\n\nexport const packConfig: KernelConfig = {\n  kernelName: Pack,\n  backendName: 'cpu',\n  kernelFunc: pack as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, NumericDataType, PadV2, PadV2Attrs, PadV2Inputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function padV2(\n    args: {inputs: PadV2Inputs, backend: MathBackendCPU, attrs: PadV2Attrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {paddings, constantValue} = attrs;\n\n  assertNotComplex(x, 'pad');\n\n  const outShape = paddings.map(\n      (p, i) => p[0] /* beforePad */ + x.shape[i] + p[1] /* afterPad */);\n\n  const start = paddings.map(p => p[0]);\n\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const xSize = util.sizeFromShape(x.shape);\n  const xRank = x.shape.length;\n  const xStrides = util.computeStrides(x.shape);\n\n  const resultSize = util.sizeFromShape(outShape);\n  const resultRank = outShape.length;\n  const resultStrides = util.computeStrides(outShape);\n  const resVals =\n      util.getTypedArrayFromDType(x.dtype as NumericDataType, resultSize);\n\n  if (constantValue !== 0) {\n    resVals.fill(constantValue);\n  }\n\n  for (let i = 0; i < xSize; i++) {\n    const coords = util.indexToLoc(i, xRank, xStrides);\n    const outCoords = coords.map((c, i) => c + start[i]);\n    const outIndex = util.locToIndex(outCoords, resultRank, resultStrides);\n\n    resVals[outIndex] = xVals[i];\n  }\n\n  const outId = backend.write(resVals, outShape, x.dtype);\n\n  return {dataId: outId, shape: outShape, dtype: x.dtype};\n}\n\nexport const padV2Config: KernelConfig = {\n  kernelName: PadV2,\n  backendName: 'cpu',\n  kernelFunc: padV2 as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Pow} from '@tensorflow/tfjs-core';\n\nimport {createSimpleBinaryKernelImpl} from '../utils/binary_impl';\nimport {binaryKernelFunc} from '../utils/binary_utils';\n\nexport const powImpl =\n    createSimpleBinaryKernelImpl((a: number, b: number) => Math.pow(a, b));\nexport const pow = binaryKernelFunc(Pow, powImpl);\n\nexport const powConfig: KernelConfig = {\n  kernelName: Pow,\n  backendName: 'cpu',\n  kernelFunc: pow\n};\n","/**\n * @license\n * Copyright 2022 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, RaggedGather, RaggedGatherAttrs, RaggedGatherInputs, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {raggedGatherImpl} from './RaggedGather_impl';\n\nexport function raggedGather(args: {\n  inputs: RaggedGatherInputs,\n  backend: MathBackendCPU,\n  attrs: RaggedGatherAttrs\n}): TensorInfo[] {\n  const {inputs, backend, attrs} = args;\n  const {paramsNestedSplits, paramsDenseValues, indices} = inputs;\n  const {outputRaggedRank} = attrs;\n\n  const $paramsNestedSplits = paramsNestedSplits.map(\n      t => backend.data.get(t.dataId).values as TypedArray);\n  const $paramsNestedSplitsShapes = paramsNestedSplits.map(t => t.shape);\n  const $paramsDenseValues =\n      backend.data.get(paramsDenseValues.dataId).values as TypedArray;\n  const $indices = backend.data.get(indices.dataId).values as TypedArray;\n\n  const [outputNestedSplits, outputDenseValues, outputDenseValuesShape] =\n      raggedGatherImpl(\n          $paramsNestedSplits, $paramsNestedSplitsShapes, $paramsDenseValues,\n          paramsDenseValues.shape, paramsDenseValues.dtype, $indices,\n          indices.shape, outputRaggedRank);\n\n  const outputNestedSplitsTensors = outputNestedSplits.map(\n      (splits) => backend.makeTensorInfo([splits.length], 'int32', splits));\n\n  const outputDenseValuesTensor = backend.makeTensorInfo(\n      outputDenseValuesShape, paramsDenseValues.dtype, outputDenseValues);\n\n  return outputNestedSplitsTensors.concat([outputDenseValuesTensor]);\n}\n\nexport const raggedGatherConfig: KernelConfig = {\n  kernelName: RaggedGather,\n  backendName: 'cpu',\n  kernelFunc: raggedGather as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2022 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, RaggedTensorToTensor, RaggedTensorToTensorAttrs, RaggedTensorToTensorInputs, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {raggedTensorToTensorImpl} from './RaggedTensorToTensor_impl';\n\nexport function raggedTensorToTensor(args: {\n  inputs: RaggedTensorToTensorInputs,\n  backend: MathBackendCPU,\n  attrs: RaggedTensorToTensorAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {shape, values, defaultValue, rowPartitionTensors} = inputs;\n  const {rowPartitionTypes} = attrs;\n\n  const $shape = backend.data.get(shape.dataId).values as TypedArray;\n  const $values = backend.data.get(values.dataId).values as TypedArray;\n  const $defaultValue =\n      backend.data.get(defaultValue.dataId).values as TypedArray;\n  const $rowPartitionValues = rowPartitionTensors.map(\n      t => backend.data.get(t.dataId).values as TypedArray);\n  const rowPartitionValuesShapes = rowPartitionTensors.map(t => t.shape);\n\n  const [outputShape, output] = raggedTensorToTensorImpl(\n      $shape, shape.shape, $values, values.shape, values.dtype, $defaultValue,\n      defaultValue.shape, $rowPartitionValues, rowPartitionValuesShapes,\n      rowPartitionTypes);\n  return backend.makeTensorInfo(outputShape, values.dtype, output);\n}\n\nexport const raggedTensorToTensorConfig: KernelConfig = {\n  kernelName: RaggedTensorToTensor,\n  backendName: 'cpu',\n  kernelFunc: raggedTensorToTensor as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, Range, RangeAttrs, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {rangeImpl} from './Range_impl';\n\nexport function range(args: {backend: MathBackendCPU, attrs: RangeAttrs}):\n    TensorInfo {\n  const {backend, attrs} = args;\n  const {start, stop, dtype, step} = attrs;\n\n  const values = rangeImpl(start, stop, step, dtype);\n  return backend.makeTensorInfo([values.length], dtype, values);\n}\n\nexport const rangeConfig: KernelConfig = {\n  kernelName: Range,\n  backendName: 'cpu',\n  kernelFunc: range as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Reciprocal} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const reciprocal = unaryKernelFunc(Reciprocal, (xi) => 1 / xi);\n\nexport const reciprocalConfig: KernelConfig = {\n  kernelName: Reciprocal,\n  backendName: 'cpu',\n  kernelFunc: reciprocal,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, ResizeBilinear, ResizeBilinearAttrs, ResizeBilinearInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function resizeBilinear(args: {\n  inputs: ResizeBilinearInputs,\n  backend: MathBackendCPU,\n  attrs: ResizeBilinearAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {images} = inputs;\n  const {alignCorners, halfPixelCenters, size} = attrs;\n\n  assertNotComplex(images, 'resizeBilinear');\n\n  const imagesStrides = util.computeStrides(images.shape);\n  const [newHeight, newWidth] = size;\n\n  const [batch, oldHeight, oldWidth, numChannels] = images.shape;\n  const xValues = backend.data.get(images.dataId).values as TypedArray;\n  const result = new Float32Array(\n      util.sizeFromShape([batch, newHeight, newWidth, numChannels]));\n\n  const effectiveInputSize: [number, number] = [\n    (alignCorners && newHeight > 1) ? oldHeight - 1 : oldHeight,\n    (alignCorners && newWidth > 1) ? oldWidth - 1 : oldWidth\n  ];\n\n  const effectiveOutputSize: [number, number] = [\n    (alignCorners && newHeight > 1) ? newHeight - 1 : newHeight,\n    (alignCorners && newWidth > 1) ? newWidth - 1 : newWidth\n  ];\n  let outputIdx = 0;\n  const effectiveRowSizeRatio = effectiveInputSize[0] / effectiveOutputSize[0];\n  const effectiveColSizeRatio = effectiveInputSize[1] / effectiveOutputSize[1];\n  for (let b = 0; b < batch; b++) {\n    for (let r = 0; r < newHeight; r++) {\n      let sourceFracRow: number;\n      if (halfPixelCenters) {\n        sourceFracRow = effectiveRowSizeRatio * (r + 0.5) - 0.5;\n      } else {\n        sourceFracRow = effectiveRowSizeRatio * r;\n      }\n\n      const sourceRowFloor = Math.max(0, Math.floor(sourceFracRow));\n      const rowFrac = sourceFracRow - sourceRowFloor;\n      const sourceRowCeil = Math.min(oldHeight - 1, Math.ceil(sourceFracRow));\n      const topRowOffset =\n          b * imagesStrides[0] + sourceRowFloor * imagesStrides[1];\n      const botRowOffset =\n          b * imagesStrides[0] + sourceRowCeil * imagesStrides[1];\n      for (let c = 0; c < newWidth; c++) {\n        let sourceFracCol: number;\n        if (halfPixelCenters) {\n          sourceFracCol = effectiveColSizeRatio * (c + 0.5) - 0.5;\n        } else {\n          sourceFracCol = effectiveColSizeRatio * c;\n        }\n        const sourceColFloor = Math.max(0, Math.floor(sourceFracCol));\n        const colFrac = sourceFracCol - sourceColFloor;\n        const sourceColCeil = Math.min(oldWidth - 1, Math.ceil(sourceFracCol));\n        const topLeftOffest = topRowOffset + sourceColFloor * imagesStrides[2];\n        const botLeftOffset = botRowOffset + sourceColFloor * imagesStrides[2];\n        const topRightOffset = topRowOffset + sourceColCeil * imagesStrides[2];\n        const botRightOffest = botRowOffset + sourceColCeil * imagesStrides[2];\n        for (let d = 0; d < numChannels; d++) {\n          // Begin shader.\n\n          // Compute the fractional index of the source.\n          const topLeft = xValues[topLeftOffest + d];\n          const bottomLeft = xValues[botLeftOffset + d];\n          const topRight = xValues[topRightOffset + d];\n          const bottomRight = xValues[botRightOffest + d];\n\n          const top = topLeft + (topRight - topLeft) * colFrac;\n          const bottom = bottomLeft + (bottomRight - bottomLeft) * colFrac;\n          const newValue = top + (bottom - top) * rowFrac;\n\n          result[outputIdx++] = newValue;\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(\n      [batch, newHeight, newWidth, numChannels], 'float32', result);\n}\n\nexport const resizeBilinearConfig: KernelConfig = {\n  kernelName: ResizeBilinear,\n  backendName: 'cpu',\n  kernelFunc: resizeBilinear as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, ResizeBilinearGrad, ResizeBilinearGradAttrs, ResizeBilinearGradInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function resizeBilinearGrad(args: {\n  inputs: ResizeBilinearGradInputs,\n  backend: MathBackendCPU,\n  attrs: ResizeBilinearGradAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {images, dy} = inputs;\n  const {alignCorners} = attrs;\n\n  assertNotComplex([dy, images], 'resizeBilinearGrad');\n\n  const imagesStrides = util.computeStrides(images.shape);\n\n  const [batch, xHeight, xWidth, depth] = images.shape;\n  const [, yHeight, yWidth] = dy.shape;\n\n  const output = new Float32Array(batch * xHeight * xWidth * depth);\n\n  // In the backwards pass, we want to find the pixels that were generated\n  // for each pixel in the input image the forward pass and add the\n  // corresponding coefficient from dy to the gradient (with some\n  // interpolation).\n\n  const effectiveXSize: [number, number] = [\n    (alignCorners && yHeight > 1) ? xHeight - 1 : xHeight,\n    (alignCorners && yWidth > 1) ? xWidth - 1 : xWidth\n  ];\n\n  const effectiveYSize: [number, number] = [\n    (alignCorners && yHeight > 1) ? yHeight - 1 : yHeight,\n    (alignCorners && yWidth > 1) ? yWidth - 1 : yWidth\n  ];\n\n  const heightScale = effectiveXSize[0] / effectiveYSize[0];\n  const widthScale = effectiveXSize[1] / effectiveYSize[1];\n\n  // Reference implementation\n  // tslint:disable-next-line:max-line-length\n  // https://github.com/tensorflow/tensorflow/blob/3039375c86a5bbc9610c7725dcaa95d635f87ba2/tensorflow/core/kernels/resize_bilinear_op.cc#L275\n  const dyValues = backend.data.get(dy.dataId).values as TypedArray;\n  let offset = 0;\n  for (let b = 0; b < batch; b++) {\n    const bOffset = b * imagesStrides[0];\n    for (let r = 0; r < yHeight; r++) {\n      const dxR = r * heightScale;\n      const topDxRIndex = Math.floor(dxR);\n      const bottomDxRIndex = Math.min(Math.ceil(dxR), xHeight - 1);\n\n      const topDxROffset = bOffset + topDxRIndex * imagesStrides[1];\n      const bottomDxROffset = bOffset + bottomDxRIndex * imagesStrides[1];\n\n      const dxRLerp = dxR - topDxRIndex;\n      const inverseDxRLerp = 1.0 - dxRLerp;\n      for (let c = 0; c < yWidth; c++) {\n        const dxC = c * widthScale;\n        const leftDxCIndex = Math.floor(dxC);\n        const rightDxCIndex = Math.min(Math.ceil(dxC), xWidth - 1);\n        const dxCLerp = dxC - leftDxCIndex;\n        const inverseDxCLerp = 1.0 - dxCLerp;\n\n        const topLeftRCOffset = topDxROffset + leftDxCIndex * imagesStrides[2];\n        const topRightRCOffset =\n            topDxROffset + rightDxCIndex * imagesStrides[2];\n        const bottomLeftRCOffset =\n            bottomDxROffset + leftDxCIndex * imagesStrides[2];\n        const bottomRightRCOffset =\n            bottomDxROffset + rightDxCIndex * imagesStrides[2];\n\n        const inverseDxRLerpTimesInverseDxCLerp =\n            inverseDxRLerp * inverseDxCLerp;\n        const inverseDxRLerpTimesDxCLerp = inverseDxRLerp * dxCLerp;\n        const dxRLerpTimesInverseDxCLerp = dxRLerp * inverseDxCLerp;\n        const dxRLerpTimesDxCLerp = dxRLerp * dxCLerp;\n        for (let d = 0; d < depth; d++) {\n          const dyVal = dyValues[offset++];\n          output[topLeftRCOffset + d] +=\n              dyVal * inverseDxRLerpTimesInverseDxCLerp;\n          output[topRightRCOffset + d] += dyVal * inverseDxRLerpTimesDxCLerp;\n          output[bottomLeftRCOffset + d] += dyVal * dxRLerpTimesInverseDxCLerp;\n          output[bottomRightRCOffset + d] += dyVal * dxRLerpTimesDxCLerp;\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(\n      [batch, xWidth, xHeight, depth], 'float32', output);\n}\n\nexport const resizeBilinearGradConfig: KernelConfig = {\n  kernelName: ResizeBilinearGrad,\n  backendName: 'cpu',\n  kernelFunc: resizeBilinearGrad as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, ResizeNearestNeighbor, ResizeNearestNeighborAttrs, ResizeNearestNeighborInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function resizeNearestNeighbor(args: {\n  inputs: ResizeNearestNeighborInputs,\n  backend: MathBackendCPU,\n  attrs: ResizeNearestNeighborAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {images} = inputs;\n  const {alignCorners, halfPixelCenters, size} = attrs;\n\n  assertNotComplex(images, 'resizeNearestNeighbor');\n\n  const imagesStrides = util.computeStrides(images.shape);\n  const [newHeight, newWidth] = size;\n\n  const [batch, oldHeight, oldWidth, numChannels] = images.shape;\n  const xValues = backend.data.get(images.dataId).values as TypedArray;\n  const output = new Float32Array(batch * newHeight * newWidth * numChannels);\n\n  const effectiveInputSize: [number, number] = [\n    (alignCorners && newHeight > 1) ? oldHeight - 1 : oldHeight,\n    (alignCorners && newWidth > 1) ? oldWidth - 1 : oldWidth\n  ];\n\n  const effectiveOutputSize: [number, number] = [\n    (alignCorners && newHeight > 1) ? newHeight - 1 : newHeight,\n    (alignCorners && newWidth > 1) ? newWidth - 1 : newWidth\n  ];\n\n  const effectiveRowSizeRatio = effectiveInputSize[0] / effectiveOutputSize[0];\n  const effectiveColSizeRatio = effectiveInputSize[1] / effectiveOutputSize[1];\n\n  let outputOffset = 0;\n  for (let b = 0; b < batch; b++) {\n    const batchOffset = b * imagesStrides[0];\n    for (let r = 0; r < newHeight; r++) {\n      const sourceFracRow = halfPixelCenters ?\n          effectiveRowSizeRatio * (r + 0.5) :\n          effectiveRowSizeRatio * r;\n      let sourceNearestRow = Math.min(\n          oldHeight - 1,\n          alignCorners ? Math.round(sourceFracRow) : Math.floor(sourceFracRow));\n      if (halfPixelCenters) {\n        sourceNearestRow = Math.max(0, sourceNearestRow);\n      }\n      const rowOffset = batchOffset + sourceNearestRow * imagesStrides[1];\n      for (let c = 0; c < newWidth; c++) {\n        const sourceFracCol = halfPixelCenters ?\n            effectiveColSizeRatio * (c + 0.5) :\n            effectiveColSizeRatio * c;\n        let sourceNearestCol = Math.min(\n            oldWidth - 1,\n            alignCorners ? Math.round(sourceFracCol) :\n                           Math.floor(sourceFracCol));\n        if (halfPixelCenters) {\n          sourceNearestCol = Math.max(0, sourceNearestCol);\n        }\n        const colOffset = rowOffset + sourceNearestCol * imagesStrides[2];\n        for (let d = 0; d < numChannels; d++) {\n          // Begin shader.\n          // Compute the fractional index of the source.\n          const newVal = xValues[colOffset + d];\n          output[outputOffset++] = newVal;\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(\n      [batch, newHeight, newWidth, numChannels], images.dtype, output);\n}\n\nexport const resizeNearestNeighborConfig: KernelConfig = {\n  kernelName: ResizeNearestNeighbor,\n  backendName: 'cpu',\n  kernelFunc: resizeNearestNeighbor as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, ResizeNearestNeighborGrad, ResizeNearestNeighborGradAttrs, ResizeNearestNeighborGradInputs, TensorInfo, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function resizeNearestNeighborGrad(args: {\n  inputs: ResizeNearestNeighborGradInputs,\n  backend: MathBackendCPU,\n  attrs: ResizeNearestNeighborGradAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {images, dy} = inputs;\n  const {alignCorners} = attrs;\n\n  assertNotComplex([dy, images], 'resizeNearestNeighborGrad');\n\n  const imagesStrides = util.computeStrides(images.shape);\n  const dyStrides = util.computeStrides(dy.shape);\n  const [batch, xHeight, xWidth, depth] = images.shape;\n  const [, yHeight, yWidth] = dy.shape;\n\n  const output = new Float32Array(batch * xHeight * xWidth * depth);\n  const dyValues = backend.data.get(dy.dataId).values as TypedArray;\n\n  // In the backwards pass, we want to find the pixels that were generated\n  // for each pixel in the input image the forward pass\n\n  const effectiveXSize: [number, number] = [\n    (alignCorners && yHeight > 1) ? xHeight - 1 : xHeight,\n    (alignCorners && yWidth > 1) ? xWidth - 1 : xWidth\n  ];\n\n  const effectiveYSize: [number, number] = [\n    (alignCorners && yHeight > 1) ? yHeight - 1 : yHeight,\n    (alignCorners && yWidth > 1) ? yWidth - 1 : yWidth\n  ];\n\n  const heightScale = effectiveXSize[0] / effectiveYSize[0];\n  const widthScale = effectiveXSize[1] / effectiveYSize[1];\n\n  const invHeightScale = 1 / heightScale;\n  const invWidthScale = 1 / widthScale;\n\n  // This defines the size of the window of values around a particular\n  // index in dy that we want to search for contributions to dx.\n  const winHeight = (Math.ceil(invHeightScale) * 2) + 2;\n  const winWidth = (Math.ceil(invWidthScale) * 2) + 2;\n\n  // Loop over the output space.\n  for (let b = 0; b < batch; b++) {\n    const batchOffset = b * imagesStrides[0];\n    for (let r = 0; r < xHeight; r++) {\n      const rowOffset = batchOffset + r * imagesStrides[1];\n\n      // Compute bounds for where in dy we will look\n      const startRLerp = Math.floor(r * invHeightScale);\n      const startDyR = Math.floor(startRLerp - (winHeight / 2));\n      for (let c = 0; c < xWidth; c++) {\n        const colOffset = rowOffset + c * imagesStrides[2];\n\n        // Compute bounds for where in dy we will look\n        const startCLerp = Math.floor(c * invWidthScale);\n        const startDyC = Math.floor(startCLerp - (winWidth / 2));\n\n        for (let d = 0; d < depth; d++) {\n          let accum = 0;\n          // loop over dy\n\n          for (let dyRIndex = 0; dyRIndex < winHeight; dyRIndex++) {\n            const dyR = dyRIndex + startDyR;\n            // Guard against the window exceeding the bounds of dy\n            if (dyR < 0 || dyR >= yHeight) {\n              continue;\n            }\n\n            const dyROffset = batchOffset + dyR * dyStrides[1];\n            const sourceFracRow = dyR * heightScale;\n            const sourceNearestRow = Math.min(\n                xHeight - 1,\n                alignCorners ? Math.round(sourceFracRow) :\n                               Math.floor(sourceFracRow));\n            if (r !== sourceNearestRow) {\n              continue;\n            }\n            for (let dyCIndex = 0; dyCIndex < winWidth; dyCIndex++) {\n              const dyC = dyCIndex + startDyC;\n              // Guard against the window exceeding the bounds of dy\n              if (dyC < 0 || dyC >= yWidth) {\n                continue;\n              }\n\n              const dyCOffset = dyROffset + dyC * dyStrides[2];\n              const sourceFracCol = dyC * widthScale;\n              const sourceNearestCol = Math.min(\n                  xWidth - 1,\n                  alignCorners ? Math.round(sourceFracCol) :\n                                 Math.floor(sourceFracCol));\n\n              if (c === sourceNearestCol) {\n                accum += dyValues[dyCOffset + d];\n              }\n            }\n          }\n          output[colOffset + d] = accum;\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(images.shape, images.dtype, output);\n}\n\nexport const resizeNearestNeighborGradConfig: KernelConfig = {\n  kernelName: ResizeNearestNeighborGrad,\n  backendName: 'cpu',\n  kernelFunc: resizeNearestNeighborGrad as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, Reverse, ReverseAttrs, ReverseInputs, TensorBuffer, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {identity} from './Identity';\n\nexport function reverse(\n    args:\n        {inputs: ReverseInputs, backend: MathBackendCPU, attrs: ReverseAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {dims} = attrs;\n\n  assertNotComplex(x, 'reverse');\n\n  const xRank = x.shape.length;\n\n  const $dims = util.parseAxisParam(dims, x.shape);\n  if (xRank === 0) {\n    return identity({inputs: {x}, backend});\n  }\n\n  const outBuf = new TensorBuffer(x.shape, x.dtype);\n  const xBuf = backend.bufferSync(x);\n\n  for (let i = 0; i < outBuf.size; i++) {\n    const outLoc = outBuf.indexToLoc(i);\n    const inLoc = outLoc.slice();\n    $dims.forEach(d => inLoc[d] = x.shape[d] - 1 - inLoc[d]);\n    outBuf.set(xBuf.get(...inLoc), ...outLoc);\n  }\n\n  return backend.makeTensorInfo(outBuf.shape, outBuf.dtype, outBuf.values);\n}\n\nexport const reverseConfig: KernelConfig = {\n  kernelName: Reverse,\n  backendName: 'cpu',\n  kernelFunc: reverse as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, NumericDataType, TypedArray} from '@tensorflow/tfjs-core';\nimport {backend_util, RotateWithOffset, RotateWithOffsetAttrs, RotateWithOffsetInputs, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport const rotateWithOffsetConfig: KernelConfig = {\n  kernelName: RotateWithOffset,\n  backendName: 'cpu',\n  kernelFunc: ({inputs, attrs, backend}) => {\n    const {image} = inputs as RotateWithOffsetInputs;\n    const {radians, fillValue, center} = attrs as {} as RotateWithOffsetAttrs;\n    const cpuBackend = backend as MathBackendCPU;\n\n    const output = util.getTypedArrayFromDType(\n        image.dtype as NumericDataType, util.sizeFromShape(image.shape));\n    const [batch, imageHeight, imageWidth, numChannels] = image.shape;\n\n    const [centerX, centerY] =\n        backend_util.getImageCenter(center, imageHeight, imageWidth);\n    const fullOpacityValue = 255;\n\n    const sinFactor = Math.sin(radians);\n    const cosFactor = Math.cos(radians);\n    const imageVals = cpuBackend.data.get(image.dataId).values as TypedArray;\n\n    for (let batchIdx = 0; batchIdx < batch; batchIdx++) {\n      const batchOffset = batchIdx * imageWidth * imageHeight * numChannels;\n\n      for (let row = 0; row < imageHeight; row++) {\n        const rowOffset = row * (imageWidth * numChannels);\n\n        for (let col = 0; col < imageWidth; col++) {\n          const colOffset = col * numChannels;\n\n          for (let channel = 0; channel < numChannels; channel++) {\n            const coords = [batch, row, col, channel];\n\n            const x = coords[2];\n            const y = coords[1];\n\n            // coordX/coordY are the result of rotating and translating x/y.\n            let coordX = (x - centerX) * cosFactor - (y - centerY) * sinFactor;\n            let coordY = (x - centerX) * sinFactor + (y - centerY) * cosFactor;\n            coordX = Math.round(coordX + centerX);\n            coordY = Math.round(coordY + centerY);\n\n            let outputValue = fillValue;\n            if (typeof fillValue !== 'number') {\n              if (channel === 3) {\n                outputValue = fullOpacityValue;\n              } else {\n                outputValue = fillValue[channel];\n              }\n            }\n\n            // If the coordinate position falls within the image boundaries...\n            if (coordX >= 0 && coordX < imageWidth && coordY >= 0 &&\n                coordY < imageHeight) {\n              // set the output to the image value at the coordinate position.\n              const rotatedRowOffset = coordY * (imageWidth * numChannels);\n              const rotatedColOffset = coordX * numChannels;\n              const imageIdx =\n                  batchOffset + rotatedRowOffset + rotatedColOffset + channel;\n              outputValue = imageVals[imageIdx];\n            }\n\n            const outIdx = batchOffset + rowOffset + colOffset + channel;\n            output[outIdx] = outputValue as number;\n          }\n        }\n      }\n    }\n\n    const dataId = cpuBackend.write(output, image.shape, image.dtype);\n    return {dataId, shape: image.shape, dtype: image.dtype};\n  }\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Round} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const round = unaryKernelFunc(Round, (xi) => {\n  // The algorithm is based on banker's rounding.\n  const base = Math.floor(xi);\n  if (xi - base < 0.5) {\n    return Math.floor(xi);\n  } else if (xi - base > 0.5) {\n    return Math.ceil(xi);\n  } else {\n    if (base % 2.0 === 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n});\n\nexport const roundConfig: KernelConfig = {\n  kernelName: Round,\n  backendName: 'cpu',\n  kernelFunc: round,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, KernelConfig, KernelFunc, Rank, ScatterNd, ScatterNdAttrs, ScatterNdInputs, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {scatterImpl} from './Scatter_impl';\n\nexport function scatterNd(args: {\n  inputs: ScatterNdInputs,\n  backend: MathBackendCPU,\n  attrs: ScatterNdAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {indices, updates} = inputs;\n  const {shape} = attrs;\n\n  const {sliceRank, numUpdates, sliceSize, strides, outputSize} =\n      backend_util.calculateShapes(updates, indices, shape);\n  const sumDupeIndices = true;\n\n  const indicesBuf = backend.bufferSync<Rank, 'int32'>(indices);\n  const updatesBuf = backend.bufferSync<Rank, 'int32'|'float32'>(updates);\n\n  const outBuf = scatterImpl(\n      indicesBuf, updatesBuf, shape, outputSize, sliceSize, numUpdates,\n      sliceRank, strides, 0 /* defaultValue */, sumDupeIndices);\n\n  return backend.makeTensorInfo(shape, outBuf.dtype, outBuf.values);\n}\n\nexport const scatterNdConfig: KernelConfig = {\n  kernelName: ScatterNd,\n  backendName: 'cpu',\n  kernelFunc: scatterNd as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2022 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {TypedArray, util} from '@tensorflow/tfjs-core';\n\nfunction lowerBound(array: TypedArray, value: number) {\n  let left = 0;\n  let right = array.length;\n  let mid = 0;\n  while (left < right) {\n    mid = Math.floor((left + right) / 2);\n    if (array[mid] < value) {\n      left = mid + 1;\n    } else {\n      right = mid;\n    }\n  }\n  return right;\n}\n\nfunction upperBound(array: TypedArray, value: number) {\n  let left = 0;\n  let right = array.length;\n  let mid = 0;\n  while (left < right) {\n    mid = Math.floor((left + right) / 2);\n    if (array[mid] <= value) {\n      left = mid + 1;\n    } else {\n      right = mid;\n    }\n  }\n  return right;\n}\n\nexport function searchSortedImpl(\n    sortedInputs: TypedArray, values: TypedArray, batchSize: number,\n    numInputs: number, numValues: number, side: 'left'|'right'): TypedArray {\n  const output =\n      util.getArrayFromDType('int32', batchSize * numValues) as TypedArray;\n  for (let b = 0; b < batchSize; ++b) {\n    const sortedInputsSlice =\n        sortedInputs.slice(b * numInputs, (b + 1) * numInputs);\n    const outputOffset = b * numValues;\n    for (let i = 0; i < numValues; ++i) {\n      output[outputOffset + i] = side === 'left' ?\n          lowerBound(sortedInputsSlice, values[i + outputOffset]) :\n          upperBound(sortedInputsSlice, values[i + outputOffset]);\n    }\n  }\n  return output;\n}\n","/**\n * @license\n * Copyright 2022 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, SearchSorted, SearchSortedAttrs, SearchSortedInputs, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {searchSortedImpl} from './SearchSorted_impl';\n\nexport function searchSorted(args: {\n  inputs: SearchSortedInputs,\n  backend: MathBackendCPU,\n  attrs: SearchSortedAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {sortedSequence, values} = inputs;\n  const {side} = attrs;\n\n  const $sortedSequence =\n      backend.data.get(sortedSequence.dataId).values as TypedArray;\n  const $values = backend.data.get(values.dataId).values as TypedArray;\n\n  const output = searchSortedImpl(\n      $sortedSequence, $values, sortedSequence.shape[0],\n      sortedSequence.shape[1], values.shape[1], side);\n  return backend.makeTensorInfo(values.shape, 'int32', output);\n}\n\nexport const searchSortedConfig: KernelConfig = {\n  kernelName: SearchSorted,\n  backendName: 'cpu',\n  kernelFunc: searchSorted as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, Select, SelectInputs, TensorInfo, TypedArray, upcastType, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport function select(args: {inputs: SelectInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {condition, t, e} = inputs;\n\n  assertNotComplex([condition, t, e], 'select');\n  const conditionRank = condition.shape.length;\n\n  const values = backend.data.get(condition.dataId).values as TypedArray;\n  const tValues = backend.data.get(t.dataId).values as TypedArray;\n  const eValues = backend.data.get(e.dataId).values as TypedArray;\n  const resultDtype = upcastType(t.dtype, e.dtype);\n  const newValues =\n      util.makeZerosTypedArray(util.sizeFromShape(t.shape), resultDtype);\n\n  let index = 0;\n  const offset =\n      conditionRank === 0 || conditionRank > 1 || t.shape.length === 1 ?\n      1 :\n      util.sizeFromShape(t.shape.slice(1));\n\n  for (let i = 0; i < values.length; i++) {\n    for (let j = 0; j < offset; j++) {\n      if (values[i] === 1) {\n        newValues[index++] = tValues[i];\n      } else {\n        newValues[index++] = eValues[i];\n      }\n    }\n  }\n\n  return backend.makeTensorInfo(t.shape, resultDtype, newValues);\n}\n\nexport const selectConfig: KernelConfig = {\n  kernelName: Select,\n  backendName: 'cpu',\n  kernelFunc: select as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, KernelConfig, Selu} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nconst scaleAlpha = backend_util.SELU_SCALEALPHA;\nconst scale = backend_util.SELU_SCALE;\n\nexport const selu = unaryKernelFunc(Selu, (xi) => {\n  if (xi >= 0) {\n    return scale * xi;\n  } else {\n    return scaleAlpha * (Math.exp(xi) - 1);\n  }\n});\n\nexport const seluConfig: KernelConfig = {\n  kernelName: Selu,\n  backendName: 'cpu',\n  kernelFunc: selu,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Sign} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const sign = unaryKernelFunc(Sign, (xi) => {\n  if (xi < 0) {\n    return -1;\n  } else if (xi > 0) {\n    return 1;\n  } else {\n    return 0;\n  }\n});\n\nexport const signConfig: KernelConfig = {\n  kernelName: Sign,\n  backendName: 'cpu',\n  kernelFunc: sign,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Sin} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const sin = unaryKernelFunc(Sin, (xi) => Math.sin(xi));\n\nexport const sinConfig: KernelConfig = {\n  kernelName: Sin,\n  backendName: 'cpu',\n  kernelFunc: sin,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Sinh} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const sinh = unaryKernelFunc(Sinh, (xi) => Math.sinh(xi));\n\nexport const sinhConfig: KernelConfig = {\n  kernelName: Sinh,\n  backendName: 'cpu',\n  kernelFunc: sinh,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Softplus} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\n// mirrors the implementation of tf.nn.softplus: https://goo.gl/vkcvwX\n\n// epsilon is the difference between 1.0 and the next representable float.\n// For a single precision 32 bit float this should be 2^-23, see:\n// https://math.byu.edu/~schow/work/IEEEFloatingPoint.htm\nconst epsilon = 1.1920928955078125e-7;\nconst threshold = Math.log(epsilon) + 2.0;\n\nexport const softplus = unaryKernelFunc(Softplus, (xi) => {\n  // Value above which exp(x) may overflow, but softplus(x) == x\n  // is within machine epsilon.\n  const tooLarge = xi > -threshold;\n\n  // Value below which exp(x) may underflow, but softplus(x) == exp(x)\n  // is within machine epsilon.\n  const tooSmall = xi < threshold;\n\n  const expX = Math.exp(xi);\n  let result;\n\n  if (tooSmall) {\n    result = expX;\n  } else if (tooLarge) {\n    result = xi;\n  } else {\n    result = Math.log(1.0 + expX);\n  }\n  return result;\n});\n\nexport const softplusConfig: KernelConfig = {\n  kernelName: Softplus,\n  backendName: 'cpu',\n  kernelFunc: softplus,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, KernelConfig, KernelFunc, ReshapeAttrs, ReshapeInputs, SpaceToBatchND, SpaceToBatchNDAttrs, SpaceToBatchNDInputs, TensorInfo, TransposeAttrs, TransposeInputs, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nimport {padV2Config} from './PadV2';\nimport {reshape} from './Reshape';\nimport {transpose} from './Transpose';\n\nexport function spaceToBatchND(args: {\n  inputs: SpaceToBatchNDInputs,\n  backend: MathBackendCPU,\n  attrs: SpaceToBatchNDAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {blockShape, paddings} = attrs;\n\n  assertNotComplex([x], 'spaceToBatchND');\n\n  const prod = util.sizeFromShape(blockShape);\n\n  const completePaddings: Array<[number, number]> = [[0, 0]];\n  completePaddings.push(...(paddings as Array<[number, number]>));\n\n  for (let i = 1 + blockShape.length; i < x.shape.length; ++i) {\n    completePaddings.push([0, 0]);\n  }\n\n  const paddedX = padV2Config.kernelFunc({\n    inputs: {x},\n    backend,\n    attrs: {paddings: completePaddings, constantValue: 0}\n  }) as TensorInfo;\n\n  const reshapedPaddedShape =\n      backend_util.getReshaped(paddedX.shape, blockShape, prod, false);\n\n  const permutedReshapedPaddedPermutation = backend_util.getPermuted(\n      reshapedPaddedShape.length, blockShape.length, false);\n\n  const flattenShape =\n      backend_util.getReshapedPermuted(paddedX.shape, blockShape, prod, false);\n\n  const reshapeInputs: ReshapeInputs = {x: paddedX};\n  const reshapeAttrs: ReshapeAttrs = {shape: reshapedPaddedShape};\n  const paddedXReshaped =\n      reshape({inputs: reshapeInputs, backend, attrs: reshapeAttrs});\n\n  const transposeInputs: TransposeInputs = {x: paddedXReshaped};\n  const transposeAttrs:\n      TransposeAttrs = {perm: permutedReshapedPaddedPermutation};\n  const paddedXT =\n      transpose({inputs: transposeInputs, backend, attrs: transposeAttrs});\n\n  const resultReshapeInputs: ReshapeInputs = {x: paddedXT};\n  const resultReshapeAttrs: ReshapeAttrs = {shape: flattenShape};\n  const result = reshape(\n      {inputs: resultReshapeInputs, backend, attrs: resultReshapeAttrs});\n\n  backend.disposeIntermediateTensorInfo(paddedX);\n  backend.disposeIntermediateTensorInfo(paddedXReshaped);\n  backend.disposeIntermediateTensorInfo(paddedXT);\n\n  return result;\n}\n\nexport const spaceToBatchNDConfig: KernelConfig = {\n  kernelName: SpaceToBatchND,\n  backendName: 'cpu',\n  kernelFunc: spaceToBatchND as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, SparseFillEmptyRows, SparseFillEmptyRowsInputs, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {sparseFillEmptyRowsImpl} from './SparseFillEmptyRows_impl';\n\nexport function sparseFillEmptyRows(args: {\n  inputs: SparseFillEmptyRowsInputs,\n  backend: MathBackendCPU\n}): [TensorInfo, TensorInfo, TensorInfo, TensorInfo] {\n  const {inputs, backend} = args;\n  const {indices, values, denseShape, defaultValue} = inputs;\n  if (denseShape.shape.length !== 1) {\n    throw new Error(`Dense shape must be a vector, saw:\n        ${denseShape.shape}`);\n  }\n  if (indices.shape.length !== 2) {\n    throw new Error(`Indices must be a matrix, saw:\n        ${indices.shape}`);\n  }\n  if (values.shape.length !== 1) {\n    throw new Error(`Values must be a vector, saw:\n        ${values.shape}`);\n  }\n  if (defaultValue.shape.length !== 0) {\n    throw new Error(`Default value must be a scalar, saw:\n        ${defaultValue.shape}`);\n  }\n\n  const $indices = backend.data.get(indices.dataId).values as TypedArray;\n  const $values = backend.data.get(values.dataId).values as TypedArray;\n  const $denseShape = backend.data.get(denseShape.dataId).values as TypedArray;\n  const $defaultValue =\n      backend.data.get(defaultValue.dataId).values[0] as number;\n\n  const [outputIndices, outputIndicesShape, outputValues,\n         emptyRowIndicator, reverseIndexMap] =\n      sparseFillEmptyRowsImpl(\n          $indices, indices.shape, indices.dtype, $values, values.dtype,\n          $denseShape, $defaultValue);\n  return [\n    backend.makeTensorInfo(outputIndicesShape, indices.dtype, outputIndices),\n    backend.makeTensorInfo(\n        [outputIndicesShape[0]], values.dtype, outputValues),\n    backend.makeTensorInfo(\n        [emptyRowIndicator.length], 'bool',\n        new Uint8Array(\n            emptyRowIndicator.map((value: boolean) => Number(value)))),\n    backend.makeTensorInfo(\n        [reverseIndexMap.length], indices.dtype,\n        new Int32Array(reverseIndexMap)),\n  ];\n}\n\nexport const sparseFillEmptyRowsConfig: KernelConfig = {\n  kernelName: SparseFillEmptyRows,\n  backendName: 'cpu',\n  kernelFunc: sparseFillEmptyRows as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, SparseReshape, SparseReshapeInputs, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {sparseReshapeImpl} from './SparseReshape_impl';\n\nexport function sparseReshape(\n    args: {inputs: SparseReshapeInputs, backend: MathBackendCPU}):\n    [TensorInfo, TensorInfo] {\n  const {inputs, backend} = args;\n  const {inputIndices, inputShape, newShape} = inputs;\n  if (inputIndices.shape.length !== 2) {\n    throw new Error(`Input indices should be a matrix but received shape\n        ${inputIndices.shape}`);\n  }\n  if (inputShape.shape.length !== 1) {\n    throw new Error(`Input shape should be a vector but received shape\n        ${inputShape.shape}`);\n  }\n\n  if (newShape.shape.length !== 1) {\n    throw new Error(\n        `Target shape should be a vector but received shape ${newShape.shape}`);\n  }\n\n  const $inputShape =\n      Array.from(backend.data.get(inputShape.dataId).values as TypedArray);\n  const $inputIndices =\n      backend.data.get(inputIndices.dataId).values as TypedArray;\n  const targetShape =\n      Array.from(backend.data.get(newShape.dataId).values as TypedArray);\n\n  const [newIndices, indicesShape, outputShape] = sparseReshapeImpl(\n      $inputIndices, inputIndices.shape, inputIndices.dtype, $inputShape,\n      targetShape);\n  return [\n    backend.makeTensorInfo(indicesShape, inputIndices.dtype, newIndices),\n    backend.makeTensorInfo(\n        [outputShape.length], newShape.dtype, new Int32Array(outputShape)),\n  ];\n}\n\nexport const sparseReshapeConfig: KernelConfig = {\n  kernelName: SparseReshape,\n  backendName: 'cpu',\n  kernelFunc: sparseReshape,\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, SparseSegmentMean, SparseSegmentMeanInputs, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {sparseSegmentReductionImpl} from './SparseSegmentReduction_impl';\n\nexport function sparseSegmentMean(\n    args: {inputs: SparseSegmentMeanInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {data, indices, segmentIds} = inputs;\n  if (data.shape.length < 1) {\n    throw new Error(\n        `Data should be at least 1 dimensional but received scalar`);\n  }\n  if (indices.shape.length !== 1) {\n    throw new Error(`Indices should be a vector but received shape\n          ${indices.shape}`);\n  }\n  if (segmentIds.shape.length !== 1) {\n    throw new Error(`Segment ids should be a vector but received shape\n          ${segmentIds.shape}`);\n  }\n  if (indices.shape[0] !== segmentIds.shape[0]) {\n    throw new Error(`segmentIds and indices should have same size.`);\n  }\n\n  const $data = backend.data.get(data.dataId).values as TypedArray;\n  const $indices = backend.data.get(indices.dataId).values as TypedArray;\n  const $segmentIds = backend.data.get(segmentIds.dataId).values as TypedArray;\n\n  const [outputData, outputDataShape] = sparseSegmentReductionImpl(\n      $data, data.shape, data.dtype, $indices, $segmentIds, true);\n  return backend.makeTensorInfo(outputDataShape, data.dtype, outputData);\n}\n\nexport const sparseSegmentMeanConfig: KernelConfig = {\n  kernelName: SparseSegmentMean,\n  backendName: 'cpu',\n  kernelFunc: sparseSegmentMean,\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, SparseSegmentSum, SparseSegmentSumInputs, TensorInfo, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {sparseSegmentReductionImpl} from './SparseSegmentReduction_impl';\n\nexport function sparseSegmentSum(\n    args: {inputs: SparseSegmentSumInputs, backend: MathBackendCPU}):\n    TensorInfo {\n  const {inputs, backend} = args;\n  const {data, indices, segmentIds} = inputs;\n  if (data.shape.length < 1) {\n    throw new Error(\n        `Data should be at least 1 dimensional but received scalar`);\n  }\n  if (indices.shape.length !== 1) {\n    throw new Error(`Indices should be a vector but received shape\n         ${indices.shape}`);\n  }\n  if (segmentIds.shape.length !== 1) {\n    throw new Error(`Segment ids should be a vector but received shape\n         ${segmentIds.shape}`);\n  }\n  if (indices.shape[0] !== segmentIds.shape[0]) {\n    throw new Error(`segmentIds and indices should have same size.`);\n  }\n\n  const $data = backend.data.get(data.dataId).values as TypedArray;\n  const $indices = backend.data.get(indices.dataId).values as TypedArray;\n  const $segmentIds = backend.data.get(segmentIds.dataId).values as TypedArray;\n\n  const [outputData, outputDataShape] = sparseSegmentReductionImpl(\n      $data, data.shape, data.dtype, $indices, $segmentIds);\n  return backend.makeTensorInfo(outputDataShape, data.dtype, outputData);\n}\n\nexport const sparseSegmentSumConfig: KernelConfig = {\n  kernelName: SparseSegmentSum,\n  backendName: 'cpu',\n  kernelFunc: sparseSegmentSum,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, KernelConfig, KernelFunc, Rank, SparseToDense, SparseToDenseAttrs, SparseToDenseInputs, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {scatterImpl} from './Scatter_impl';\n\nexport function sparseToDense(args: {\n  inputs: SparseToDenseInputs,\n  backend: MathBackendCPU,\n  attrs: SparseToDenseAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {sparseIndices, sparseValues, defaultValue} = inputs;\n  const {outputShape} = attrs;\n\n  const {sliceRank, numUpdates, sliceSize, strides, outputSize} =\n      backend_util.calculateShapes(sparseValues, sparseIndices, outputShape);\n  const sumDupeIndices = false;\n\n  const indicesBuf = backend.bufferSync<Rank, 'int32'>(sparseIndices);\n\n  let outBuf;\n  switch (sparseValues.dtype) {\n    case 'bool': {\n      const updatesBuf = backend.bufferSync<Rank, 'bool'>(sparseValues);\n      const $defaultValue =\n          Boolean(backend.data.get(defaultValue.dataId).values[0]);\n      outBuf = scatterImpl(\n          indicesBuf, updatesBuf, outputShape, outputSize, sliceSize,\n          numUpdates, sliceRank, strides, $defaultValue, sumDupeIndices);\n      break;\n    }\n    case 'float32': {\n      const updatesBuf = backend.bufferSync<Rank, 'float32'>(sparseValues);\n      const $defaultValue =\n          backend.data.get(defaultValue.dataId).values[0] as number;\n      outBuf = scatterImpl(\n          indicesBuf, updatesBuf, outputShape, outputSize, sliceSize,\n          numUpdates, sliceRank, strides, $defaultValue, sumDupeIndices);\n      break;\n    }\n    case 'int32': {\n      const updatesBuf = backend.bufferSync<Rank, 'int32'>(sparseValues);\n      const $defaultValue =\n          backend.data.get(defaultValue.dataId).values[0] as number;\n      outBuf = scatterImpl(\n          indicesBuf, updatesBuf, outputShape, outputSize, sliceSize,\n          numUpdates, sliceRank, strides, $defaultValue, sumDupeIndices);\n      break;\n    }\n    case 'string': {\n      const updatesBuf = backend.bufferSync<Rank, 'string'>(sparseValues);\n      const $defaultValue = util.decodeString(\n          backend.data.get(defaultValue.dataId).values[0] as Uint8Array);\n      outBuf = scatterImpl(\n          indicesBuf, updatesBuf, outputShape, outputSize, sliceSize,\n          numUpdates, sliceRank, strides, $defaultValue, sumDupeIndices);\n      break;\n    }\n    default:\n      throw new Error(`Unsupported type ${sparseValues.dtype}`);\n  }\n  return backend.makeTensorInfo(outputShape, outBuf.dtype, outBuf.values);\n}\n\nexport const sparseToDenseConfig: KernelConfig = {\n  kernelName: SparseToDense,\n  backendName: 'cpu',\n  kernelFunc: sparseToDense as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, SplitVAttrs, SplitVInputs} from '@tensorflow/tfjs-core';\nimport {KernelConfig, KernelFunc, SplitV, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {slice} from './Slice';\n\nexport function splitV(\n    args: {inputs: SplitVInputs, backend: MathBackendCPU, attrs: SplitVAttrs}):\n    TensorInfo[] {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {numOrSizeSplits, axis} = attrs;\n\n  const $axis = util.parseAxisParam(axis, x.shape)[0];\n  const splitSizes = backend_util.prepareSplitSize(x, numOrSizeSplits, $axis);\n\n  const begin = new Array(x.shape.length).fill(0);\n  const size = x.shape.slice();\n  return splitSizes.map(s => {\n    const sliceSize = [...size];\n    sliceSize[$axis] = s;\n    const sliceT =\n        slice({inputs: {x}, backend, attrs: {begin, size: sliceSize}});\n    begin[$axis] += s;\n    return sliceT;\n  });\n}\n\nexport const splitVConfig: KernelConfig = {\n  kernelName: SplitV,\n  backendName: 'cpu',\n  kernelFunc: splitV as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {Square, SquareInputs} from '@tensorflow/tfjs-core';\nimport {KernelConfig} from '@tensorflow/tfjs-core';\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nexport const squareConfig: KernelConfig = {\n  kernelName: Square,\n  backendName: 'cpu',\n  kernelFunc: ({inputs, backend}) => {\n    const {x} = inputs as SquareInputs;\n    const cpuBackend = backend as MathBackendCPU;\n    assertNotComplex(x, 'square');\n\n    const values = cpuBackend.data.get(x.dataId).values as Float32Array;\n    const newValues = new Float32Array(values.length);\n    for (let i = 0; i < values.length; ++i) {\n      const value = values[i];\n      newValues[i] = value * value;\n    }\n    const dataId = cpuBackend.write(newValues, x.shape, x.dtype);\n    return {dataId, shape: x.shape, dtype: x.dtype};\n  }\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Step, StepAttrs} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const step = unaryKernelFunc(Step, (xi, attrs) => {\n  const stepAttrs = attrs as {} as StepAttrs;\n  if (isNaN(xi)) {\n    return NaN;\n  } else {\n    return xi > 0 ? 1 : stepAttrs.alpha;\n  }\n});\n\nexport const stepConfig: KernelConfig = {\n  kernelName: Step,\n  backendName: 'cpu',\n  kernelFunc: step,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, Rank, slice_util, StridedSlice, StridedSliceAttrs, StridedSliceInputs, TensorInfo, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {reshape} from './Reshape';\nimport {slice} from './Slice';\nimport {stridedSliceImpl} from './StridedSlice_impl';\n\nexport function stridedSlice(args: {\n  inputs: StridedSliceInputs,\n  backend: MathBackendCPU,\n  attrs: StridedSliceAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {\n    begin,\n    end,\n    strides,\n    beginMask,\n    endMask,\n    ellipsisMask,\n    newAxisMask,\n    shrinkAxisMask\n  } = attrs;\n\n  assertNotComplex(x, 'stridedSlice');\n\n  const {\n    finalShapeSparse,\n    finalShape,\n    isIdentity,\n    sliceDim0,\n    isSimpleSlice,\n    begin: $begin,\n    end: $end,\n    strides: $strides\n  } =\n      slice_util.sliceInfo(\n          x.shape, begin, end, strides, beginMask, endMask, ellipsisMask,\n          newAxisMask, shrinkAxisMask);\n\n  let result;\n\n  // ref:\n  // https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/strided_slice_op.cc\n  if (isIdentity) {\n    // Optimization #1, slice is a no-op plus reshape\n    result = reshape({inputs: {x}, backend, attrs: {shape: finalShape}});\n  } else if (sliceDim0 || isSimpleSlice) {\n    // Optimization #2, slice is memory contiguous (only occurs in dim 0)\n    util.assert(\n        x.shape.length >= 1,\n        () => `Input must have rank at least 1, got: ${x.shape.length}`);\n\n    const size = slice_util.computeOutShape($begin, $end, $strides);\n    // To tolerate begin[0] > end[0] (a 0-output slice), we min(begin, end).\n    const sliced = slice({inputs: {x}, backend, attrs: {begin: $begin, size}});\n    result =\n        reshape({inputs: {x: sliced}, backend, attrs: {shape: finalShape}});\n    backend.disposeIntermediateTensorInfo(sliced);\n  } else {\n    const xBuf = backend.bufferSync<Rank, 'float32'>(x);\n    const outBuf = stridedSliceImpl(finalShapeSparse, xBuf, $strides, $begin);\n\n    result = backend.makeTensorInfo(finalShape, outBuf.dtype, outBuf.values);\n  }\n\n  return result;\n}\n\nexport const stridedSliceConfig: KernelConfig = {\n  kernelName: StridedSlice,\n  backendName: 'cpu',\n  kernelFunc: stridedSlice as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, StringNGrams, StringNGramsAttrs, StringNGramsInputs, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {stringNGramsImpl} from './StringNGrams_impl';\n\nexport function stringNGrams(args: {\n  inputs: StringNGramsInputs,\n  backend: MathBackendCPU,\n  attrs: StringNGramsAttrs\n}): [TensorInfo, TensorInfo] {\n  const {inputs, backend, attrs} = args;\n  const {\n    separator,\n    nGramWidths,\n    leftPad,\n    rightPad,\n    padWidth,\n    preserveShortSequences\n  } = attrs;\n  const {data, dataSplits} = inputs;\n  const $data = backend.data.get(data.dataId).values as Uint8Array[];\n  const $dataSplits = backend.data.get(dataSplits.dataId).values as Int32Array;\n\n  const [nGrams, nGramsSplits] = stringNGramsImpl(\n      $data, $dataSplits, separator, nGramWidths, leftPad, rightPad, padWidth,\n      preserveShortSequences);\n  return [\n    backend.makeTensorInfo([nGrams.length], 'string', nGrams),\n    backend.makeTensorInfo(dataSplits.shape, 'int32', nGramsSplits),\n  ];\n}\n\nexport const stringNGramsConfig: KernelConfig = {\n  kernelName: StringNGrams,\n  backendName: 'cpu',\n  kernelFunc: stringNGrams as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, StringSplit, StringSplitAttrs, StringSplitInputs, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {stringSplitImpl} from './StringSplit_impl';\n\nexport function stringSplit(args: {\n  inputs: StringSplitInputs,\n  backend: MathBackendCPU,\n  attrs: StringSplitAttrs\n}): [TensorInfo, TensorInfo, TensorInfo] {\n  const {inputs, backend, attrs} = args;\n  const {skipEmpty} = attrs;\n  const {input, delimiter} = inputs;\n\n  if (input.dtype !== 'string') {\n    throw new Error('Input must be of datatype string');\n  }\n  if (input.shape.length !== 1) {\n    throw new Error(`Input must be a vector, got shape: ${input.shape}`);\n  }\n  if (delimiter.shape.length !== 0) {\n    throw new Error(\n        `Delimiter must be a scalar, got shape: ${delimiter.shape}`);\n  }\n\n  const $input = backend.data.get(input.dataId).values as Uint8Array[];\n  const $delimiter = backend.data.get(delimiter.dataId).values[0] as Uint8Array;\n\n  const [indices, values, shape] =\n      stringSplitImpl($input, $delimiter, skipEmpty);\n  const outputSize = values.length;\n  return [\n    backend.makeTensorInfo([outputSize, 2], 'int32', indices),\n    backend.makeTensorInfo([outputSize], 'string', values),\n    backend.makeTensorInfo([2], 'int32', new Int32Array(shape))\n  ];\n}\n\nexport const stringSplitConfig: KernelConfig = {\n  kernelName: StringSplit,\n  backendName: 'cpu',\n  kernelFunc: stringSplit as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, StringToHashBucketFast, StringToHashBucketFastAttrs, StringToHashBucketFastInputs, TensorInfo} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nimport {stringToHashBucketFastImpl} from './StringToHashBucketFast_impl';\n\nexport function stringToHashBucketFast(args: {\n  inputs: StringToHashBucketFastInputs,\n  backend: MathBackendCPU,\n  attrs: StringToHashBucketFastAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {numBuckets} = attrs;\n  const {input} = inputs;\n\n  if (input.dtype !== 'string') {\n    throw new Error('Input must be of datatype string');\n  }\n  if (numBuckets <= 0) {\n    throw new Error(`Number of buckets must be at least 1`);\n  }\n\n  const $input = backend.data.get(input.dataId).values as Uint8Array[];\n\n  const output = stringToHashBucketFastImpl($input, numBuckets);\n  return backend.makeTensorInfo(input.shape, 'int32', output);\n}\n\nexport const stringToHashBucketFastConfig: KernelConfig = {\n  kernelName: StringToHashBucketFast,\n  backendName: 'cpu',\n  kernelFunc: stringToHashBucketFast as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Tan} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const tan = unaryKernelFunc(Tan, (xi) => Math.tan(xi));\n\nexport const tanConfig: KernelConfig = {\n  kernelName: Tan,\n  backendName: 'cpu',\n  kernelFunc: tan,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, Tanh} from '@tensorflow/tfjs-core';\n\nimport {unaryKernelFunc} from '../utils/unary_utils';\n\nexport const tanh = unaryKernelFunc(Tanh, (xi) => Math.tanh(xi));\n\nexport const tanhConfig: KernelConfig = {\n  kernelName: Tanh,\n  backendName: 'cpu',\n  kernelFunc: tanh,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, TensorInfo, Tile, TileAttrs, TileInputs} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {tileImpl} from './Tile_impl';\n\nexport function tile(\n    args: {inputs: TileInputs, backend: MathBackendCPU, attrs: TileAttrs}):\n    TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {reps} = attrs;\n\n  assertNotComplex(x, 'tile');\n  const outBuf = tileImpl(backend.bufferSync(x), reps);\n\n  return backend.makeTensorInfo(outBuf.shape, outBuf.dtype, outBuf.values);\n}\n\nexport const tileConfig: KernelConfig = {\n  kernelName: Tile,\n  backendName: 'cpu',\n  kernelFunc: tile as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, NumericDataType, TensorInfo, TopK, TopKAttrs, TopKInputs, TypedArray} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {topKImpl} from './TopK_impl';\n\nexport function topK(\n    args: {inputs: TopKInputs, backend: MathBackendCPU, attrs: TopKAttrs}):\n    [TensorInfo, TensorInfo] {\n  const {inputs, backend, attrs} = args;\n  const {x} = inputs;\n  const {k, sorted} = attrs;\n\n  assertNotComplex(x, 'topk');\n\n  const xVals = backend.data.get(x.dataId).values as TypedArray;\n  const [allTopKVals, allTopKIndices] =\n      topKImpl(xVals, x.shape, x.dtype as NumericDataType, k, sorted);\n\n  return [\n    backend.makeTensorInfo(\n        allTopKVals.shape, allTopKVals.dtype, allTopKVals.values),\n    backend.makeTensorInfo(\n        allTopKIndices.shape, allTopKIndices.dtype, allTopKIndices.values)\n  ];\n}\n\nexport const topKConfig: KernelConfig = {\n  kernelName: TopK,\n  backendName: 'cpu',\n  kernelFunc: topK as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, NumericDataType, TensorInfo, Transform, TransformAttrs, TransformInputs, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\n\nexport function transform(args: {\n  inputs: TransformInputs,\n  attrs: TransformAttrs,\n  backend: MathBackendCPU\n}): TensorInfo {\n  const {inputs, attrs, backend} = args;\n  const {image, transforms} = inputs;\n  const {interpolation, fillMode, fillValue, outputShape} = attrs;\n\n  const [batch, imageHeight, imageWidth, numChannels] = image.shape;\n  const [outHeight, outWidth] =\n      outputShape != null ? outputShape : [imageHeight, imageWidth];\n  const outShape = [batch, outHeight, outWidth, numChannels];\n\n  const inStrides = util.computeStrides(image.shape);\n  const batchInStride = inStrides[0];\n  const rowInStride = inStrides[1];\n  const colInStride = inStrides[2];\n\n  const outStrides = util.computeStrides(outShape);\n  const batchOutStride = outStrides[0];\n  const rowOutStride = outStrides[1];\n  const colOutStride = outStrides[2];\n\n  const outVals = util.getTypedArrayFromDType(\n      image.dtype as NumericDataType, util.sizeFromShape(outShape));\n\n  outVals.fill(fillValue);\n\n  const imageVals = backend.data.get(image.dataId).values as TypedArray;\n  const transformVals =\n      backend.data.get(transforms.dataId).values as TypedArray;\n\n  // Ref TF implementation:\n  // https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/image/image_ops.h\n  for (let b = 0; b < batch; ++b) {\n    const transform = transforms.shape[0] === 1 ?\n        transformVals :\n        transformVals.subarray(b * 8, b * 8 + 8);\n\n    for (let outY = 0; outY < outHeight; ++outY) {\n      for (let outX = 0; outX < outWidth; ++outX) {\n        for (let channel = 0; channel < numChannels; ++channel) {\n          let val;\n\n          const projection = transform[6] * outX + transform[7] * outY + 1;\n\n          if (projection === 0) {\n            // Return the fill value for infinite coordinates,\n            // which are outside the input image\n            continue;\n          }\n\n          const inX =\n              (transform[0] * outX + transform[1] * outY + transform[2]) /\n              projection;\n          const inY =\n              (transform[3] * outX + transform[4] * outY + transform[5]) /\n              projection;\n\n          const x = mapCoord(inX, imageWidth, fillMode);\n          const y = mapCoord(inY, imageHeight, fillMode);\n\n          switch (interpolation) {\n            case 'nearest':\n              val = nearestInterpolation(\n                  imageVals, imageHeight, imageWidth, batchInStride,\n                  rowInStride, colInStride, b, y, x, channel, fillValue);\n              break;\n            case 'bilinear':\n              val = bilinearInterpolation(\n                  imageVals, imageHeight, imageWidth, batchInStride,\n                  rowInStride, colInStride, b, y, x, channel, fillValue);\n              break;\n            default:\n              throw new Error(\n                  `Error in Transform: Expect 'nearest' or ` +\n                  `'bilinear', but got ${interpolation}`);\n          }\n\n          const ind =\n              b * batchOutStride + outY * rowOutStride +\n              outX * colOutStride + channel;\n\n          outVals[ind] = val;\n        }\n      }\n    }\n\n    return backend.makeTensorInfo(outShape, image.dtype, outVals);\n  }\n\n  const dataId = backend.write(outVals, outShape, image.dtype);\n  return {dataId, shape: image.shape, dtype: image.dtype};\n}\n\nexport const transformConfig: KernelConfig = {\n  kernelName: Transform,\n  backendName: 'cpu',\n  kernelFunc: transform as {} as KernelFunc\n};\n\nfunction mapCoord(\n    outCoord: number, len: number,\n    mode: 'constant'|'reflect'|'wrap'|'nearest') {\n  switch (mode) {\n    case 'reflect':\n      return mapCoordReflect(outCoord, len);\n    case 'wrap':\n      return mapCoordWrap(outCoord, len);\n    case 'nearest':\n      return mapCoordNearest(outCoord, len);\n    case 'constant':\n    default:\n      return mapCoordConstant(outCoord, len);\n  }\n}\n\nfunction mapCoordReflect(outCoord: number, len: number): number {\n  // Reflect [abcd] to [dcba|abcd|dcba].\n  let inCoord = outCoord;\n  if (inCoord < 0) {\n    if (len <= 1) {\n      inCoord = 0;\n    } else {\n      const sz2 = 2 * len;\n      if (inCoord < sz2) {\n        inCoord = sz2 * Math.trunc(-inCoord / sz2) + inCoord;\n      }\n      inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1;\n    }\n  } else if (inCoord > len - 1) {\n    if (len <= 1) {\n      inCoord = 0;\n    } else {\n      const sz2 = 2 * len;\n      inCoord -= sz2 * Math.trunc(inCoord / sz2);\n      if (inCoord >= len) {\n        inCoord = sz2 - inCoord - 1;\n      }\n    }\n  }\n  // clamp is necessary because when outCoord = 3.5 and len = 4,\n  // inCoord = 3.5 and will be rounded to 4 in nearest interpolation.\n  return util.clamp(0, inCoord, len - 1);\n}\n\nfunction mapCoordWrap(outCoord: number, len: number): number {\n  // Wrap [abcd] to [abcd|abcd|abcd].\n  let inCoord = outCoord;\n  if (inCoord < 0) {\n    if (len <= 1) {\n      inCoord = 0;\n    } else {\n      const sz = len - 1;\n      inCoord += len * (Math.trunc(-inCoord / sz) + 1);\n    }\n  } else if (inCoord > len - 1) {\n    if (len <= 1) {\n      inCoord = 0;\n    } else {\n      const sz = len - 1;\n      inCoord -= len * Math.trunc(inCoord / sz);\n    }\n  }\n  // clamp is necessary because when outCoord = -0.5 and len = 4,\n  // inCoord = 3.5 and will be rounded to 4 in nearest interpolation.\n  return util.clamp(0, inCoord, len - 1);\n}\n\nfunction mapCoordConstant(outCoord: number, len: number): number {\n  return outCoord;\n}\n\nfunction mapCoordNearest(outCoord: number, len: number): number {\n  return util.clamp(0, outCoord, len - 1);\n}\n\nfunction readWithFillValue(\n    imageVals: TypedArray, imageHeight: number, imageWidth: number,\n    batchStride: number, rowStride: number, colStride: number, batch: number,\n    y: number, x: number, channel: number, fillValue: number): number {\n  const ind = batch * batchStride + y * rowStride + x * colStride + channel;\n  if (0 <= y && y < imageHeight && 0 <= x && x < imageWidth) {\n    return imageVals[ind];\n  } else {\n    return fillValue;\n  }\n}\n\nfunction nearestInterpolation(\n    imageVals: TypedArray, imageHeight: number, imageWidth: number,\n    batchStride: number, rowStride: number, colStride: number, batch: number,\n    y: number, x: number, channel: number, fillValue: number): number {\n  const $y = Math.round(y);\n  const $x = Math.round(x);\n\n  return readWithFillValue(\n      imageVals, imageHeight, imageWidth, batchStride, rowStride, colStride,\n      batch, $y, $x, channel, fillValue);\n}\n\nfunction bilinearInterpolation(\n    imageVals: TypedArray, imageHeight: number, imageWidth: number,\n    batchStride: number, rowStride: number, colStride: number, batch: number,\n    y: number, x: number, channel: number, fillValue: number) {\n  const yFloor = Math.floor(y);\n  const xFloor = Math.floor(x);\n  const yCeil = yFloor + 1;\n  const xCeil = xFloor + 1;\n  // f(x, yFloor) = (xCeil - x) / (xCeil - xFloor) * f(xFloor, yFloor)\n  //               + (x - xFloor) / (xCeil - xFloor) * f(xCeil, yFloor)\n  const valueYFloor =\n      (xCeil - x) *\n          readWithFillValue(\n              imageVals, imageHeight, imageWidth, batchStride, rowStride,\n              colStride, batch, yFloor, xFloor, channel, fillValue) +\n      (x - xFloor) *\n          readWithFillValue(\n              imageVals, imageHeight, imageWidth, batchStride, rowStride,\n              colStride, batch, yFloor, xCeil, channel, fillValue);\n  // f(x, yCeil) = (xCeil - x) / (xCeil - xFloor) * f(xFloor, yCeil)\n  //             + (x - xFloor) / (xCeil - xFloor) * f(xCeil, yCeil)\n  const valueYCeil =\n      (xCeil - x) *\n          readWithFillValue(\n              imageVals, imageHeight, imageWidth, batchStride, rowStride,\n              colStride, batch, yCeil, xFloor, channel, fillValue) +\n      (x - xFloor) *\n          readWithFillValue(\n              imageVals, imageHeight, imageWidth, batchStride, rowStride,\n              colStride, batch, yCeil, xCeil, channel, fillValue);\n  // f(x, y) = (yCeil - y) / (yCeil - yFloor) * f(x, yFloor)\n  //         + (y - yFloor) / (yCeil - yFloor) * f(x, yCeil)\n  return (yCeil - y) * valueYFloor + (y - yFloor) * valueYCeil;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an AS IS BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, TensorInfo, Unique, UniqueAttrs, UniqueInputs} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\n\nimport {uniqueImpl} from './Unique_impl';\n\nexport function unique(\n    args: {inputs: UniqueInputs, attrs: UniqueAttrs, backend: MathBackendCPU}):\n    TensorInfo[] {\n  const {inputs, attrs, backend} = args;\n  const {axis} = attrs;\n  const {x} = inputs;\n  assertNotComplex(x, 'unique');\n\n  const values = backend.data.get(x.dataId).values;\n  const {outputValues, outputShape, indices} =\n      uniqueImpl(values, axis, x.shape, x.dtype);\n  return [\n    backend.makeTensorInfo(outputShape, x.dtype, outputValues),\n    backend.makeTensorInfo([indices.length], 'int32', indices),\n  ];\n}\n\nexport const uniqueConfig: KernelConfig = {\n  kernelName: Unique,\n  backendName: 'cpu',\n  kernelFunc: unique as {} as KernelFunc,\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, TensorInfo, Unpack, UnpackAttrs, UnpackInputs} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {reshape} from './Reshape';\nimport {slice} from './Slice';\n\nexport function unpack(\n    args: {inputs: UnpackInputs, backend: MathBackendCPU, attrs: UnpackAttrs}):\n    TensorInfo[] {\n  const {inputs, backend, attrs} = args;\n  const {value} = inputs;\n  let {axis} = attrs;\n\n  if (axis < 0) {\n    axis += value.shape.length;\n  }\n\n  const valueRank = value.shape.length;\n\n  const num = value.shape[axis];\n  const outShape: number[] = new Array(valueRank - 1);\n  let outIndex = 0;\n  for (let i = 0; i < valueRank; i++) {\n    if (i !== axis) {\n      outShape[outIndex++] = value.shape[i];\n    }\n  }\n\n  const begin = new Array(valueRank).fill(0);\n  const size = value.shape.slice();\n  size[axis] = 1;\n  const res = new Array(num);\n  for (let i = 0; i < res.length; i++) {\n    begin[axis] = i;\n    const tempRes = slice({inputs: {x: value}, backend, attrs: {begin, size}});\n    res[i] = reshape({inputs: {x: tempRes}, backend, attrs: {shape: outShape}});\n    backend.disposeIntermediateTensorInfo(tempRes);\n  }\n\n  return res;\n}\n\nexport const unpackConfig: KernelConfig = {\n  kernelName: Unpack,\n  backendName: 'cpu',\n  kernelFunc: unpack as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {KernelConfig, KernelFunc, TensorInfo, UnsortedSegmentSum, UnsortedSegmentSumAttrs, UnsortedSegmentSumInputs, util} from '@tensorflow/tfjs-core';\n\nimport {MathBackendCPU} from '../backend_cpu';\nimport {assertNotComplex} from '../cpu_util';\nimport {cast} from './Cast';\nimport {equal} from './Equal';\nimport {expandDims} from './ExpandDims';\nimport {multiply} from './Multiply';\nimport {pack} from './Pack';\nimport {sum} from './Sum';\n\nexport function unsortedSegmentSum(args: {\n  inputs: UnsortedSegmentSumInputs,\n  backend: MathBackendCPU,\n  attrs: UnsortedSegmentSumAttrs\n}): TensorInfo {\n  const {inputs, backend, attrs} = args;\n  const {x, segmentIds} = inputs;\n  const {numSegments} = attrs;\n\n  assertNotComplex(x, 'unsortedSegmentSum');\n\n  const xRank = x.shape.length;\n  const segmentIdsRank = segmentIds.shape.length;\n  const res = [];\n  const intermediates: TensorInfo[] = [];\n\n  // Reshape the segment id's so that they can be broadcast with\n  // x. The new shape should be [segmentIds.shape, 1, ..., 1]\n  const numIters = xRank - segmentIdsRank;\n  let $segmentIds = segmentIds;\n\n  for (let i = 0; i < numIters; ++i) {\n    const expanded = expandDims(\n        {inputs: {input: $segmentIds}, backend, attrs: {dim: i + 1}});\n    $segmentIds = expanded;\n    intermediates.push(expanded);\n  }\n\n  for (let i = 0; i < numSegments; ++i) {\n    const scalarValue = util.createScalarValue(i as {} as 'int32', 'int32');\n    const segmentId = backend.makeTensorInfo([], 'int32', scalarValue);\n    const mask =\n        equal({inputs: {a: segmentId, b: $segmentIds}, backend}) as TensorInfo;\n    const maskCasted =\n        cast({inputs: {x: mask}, backend, attrs: {dtype: 'float32'}});\n    const mul =\n        multiply({inputs: {a: maskCasted, b: x}, backend}) as TensorInfo;\n    const sumTensorInfo =\n        sum({inputs: {x: mul}, backend, attrs: {axis: 0, keepDims: false}});\n    res.push(sumTensorInfo);\n    intermediates.push(segmentId);\n    intermediates.push(mask);\n    intermediates.push(maskCasted);\n    intermediates.push(mul);\n    intermediates.push(sumTensorInfo);\n  }\n\n  const result = pack({inputs: res, backend, attrs: {axis: 0}});\n\n  intermediates.forEach(t => backend.disposeIntermediateTensorInfo(t));\n\n  return result;\n}\n\nexport const unsortedSegmentSumConfig: KernelConfig = {\n  kernelName: UnsortedSegmentSum,\n  backendName: 'cpu',\n  kernelFunc: unsortedSegmentSum as {} as KernelFunc\n};\n","/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n// We explicitly import the modular kernels so they get registered in the\n// global registry when we compile the library. A modular build would replace\n// the contents of this file and import only the kernels that are needed.\nimport {KernelConfig, registerKernel} from '@tensorflow/tfjs-core';\n\nimport {_fusedMatMulConfig} from './kernels/_FusedMatMul';\nimport {absConfig} from './kernels/Abs';\nimport {acosConfig} from './kernels/Acos';\nimport {acoshConfig} from './kernels/Acosh';\nimport {addConfig} from './kernels/Add';\nimport {addNConfig} from './kernels/AddN';\nimport {allConfig} from './kernels/All';\nimport {anyConfig} from './kernels/Any';\nimport {argMaxConfig} from './kernels/ArgMax';\nimport {argMinConfig} from './kernels/ArgMin';\nimport {asinConfig} from './kernels/Asin';\nimport {asinhConfig} from './kernels/Asinh';\nimport {atanConfig} from './kernels/Atan';\nimport {atan2Config} from './kernels/Atan2';\nimport {atanhConfig} from './kernels/Atanh';\nimport {avgPoolConfig} from './kernels/AvgPool';\nimport {avgPool3DConfig} from './kernels/AvgPool3D';\nimport {avgPool3DGradConfig} from './kernels/AvgPool3DGrad';\nimport {avgPoolGradConfig} from './kernels/AvgPoolGrad';\nimport {batchMatMulConfig} from './kernels/BatchMatMul';\nimport {batchNormConfig} from './kernels/BatchNorm';\nimport {batchToSpaceNDConfig} from './kernels/BatchToSpaceND';\nimport {bincountConfig} from './kernels/Bincount';\nimport {broadcastArgsConfig} from './kernels/BroadcastArgs';\nimport {castConfig} from './kernels/Cast';\nimport {ceilConfig} from './kernels/Ceil';\nimport {clipByValueConfig} from './kernels/ClipByValue';\nimport {complexConfig} from './kernels/Complex';\nimport {complexAbsConfig} from './kernels/ComplexAbs';\nimport {concatConfig} from './kernels/Concat';\nimport {conv2DConfig} from './kernels/Conv2D';\nimport {conv2DBackpropFilterConfig} from './kernels/Conv2DBackpropFilter';\nimport {conv2DBackpropInputConfig} from './kernels/Conv2DBackpropInput';\nimport {conv3DConfig} from './kernels/Conv3D';\nimport {conv3DBackpropFilterV2Config} from './kernels/Conv3DBackpropFilterV2';\nimport {conv3DBackpropInputV2Config} from './kernels/Conv3DBackpropInputV2';\nimport {cosConfig} from './kernels/Cos';\nimport {coshConfig} from './kernels/Cosh';\nimport {cropAndResizeConfig} from './kernels/CropAndResize';\nimport {cumprodConfig} from './kernels/Cumprod';\nimport {cumsumConfig} from './kernels/Cumsum';\nimport {denseBincountConfig} from './kernels/DenseBincount';\nimport {depthToSpaceConfig} from './kernels/DepthToSpace';\nimport {depthwiseConv2dNativeConfig} from './kernels/DepthwiseConv2dNative';\nimport {depthwiseConv2dNativeBackpropFilterConfig} from './kernels/DepthwiseConv2dNativeBackpropFilter';\nimport {depthwiseConv2dNativeBackpropInputConfig} from './kernels/DepthwiseConv2dNativeBackpropInput';\nimport {diagConfig} from './kernels/Diag';\nimport {dilation2DConfig} from './kernels/Dilation2D';\nimport {dilation2DBackpropFilterConfig} from './kernels/Dilation2DBackpropFilter';\nimport {dilation2DBackpropInputConfig} from './kernels/Dilation2DBackpropInput';\nimport {einsumConfig} from './kernels/Einsum';\nimport {eluConfig} from './kernels/Elu';\nimport {eluGradConfig} from './kernels/EluGrad';\nimport {equalConfig} from './kernels/Equal';\nimport {erfConfig} from './kernels/Erf';\nimport {expConfig} from './kernels/Exp';\nimport {expandDimsConfig} from './kernels/ExpandDims';\nimport {expm1Config} from './kernels/Expm1';\nimport {fftConfig} from './kernels/FFT';\nimport {fillConfig} from './kernels/Fill';\nimport {flipLeftRightConfig} from './kernels/FlipLeftRight';\nimport {floorConfig} from './kernels/Floor';\nimport {floorDivConfig} from './kernels/FloorDiv';\nimport {fusedConv2DConfig} from './kernels/FusedConv2D';\nimport {fusedDepthwiseConv2DConfig} from './kernels/FusedDepthwiseConv2D';\nimport {gatherNdConfig} from './kernels/GatherNd';\nimport {gatherV2Config} from './kernels/GatherV2';\nimport {greaterConfig} from './kernels/Greater';\nimport {greaterEqualConfig} from './kernels/GreaterEqual';\nimport {identityConfig} from './kernels/Identity';\nimport {ifftConfig} from './kernels/IFFT';\nimport {imagConfig} from './kernels/Imag';\nimport {isFiniteConfig} from './kernels/IsFinite';\nimport {isInfConfig} from './kernels/IsInf';\nimport {isNaNConfig} from './kernels/IsNaN';\nimport {leakyReluConfig} from './kernels/LeakyRelu';\nimport {lessConfig} from './kernels/Less';\nimport {lessEqualConfig} from './kernels/LessEqual';\nimport {linSpaceConfig} from './kernels/LinSpace';\nimport {logConfig} from './kernels/Log';\nimport {log1pConfig} from './kernels/Log1p';\nimport {logicalAndConfig} from './kernels/LogicalAnd';\nimport {logicalNotConfig} from './kernels/LogicalNot';\nimport {logicalOrConfig} from './kernels/LogicalOr';\nimport {LRNConfig} from './kernels/LRN';\nimport {LRNGradConfig} from './kernels/LRNGrad';\nimport {maxConfig} from './kernels/Max';\nimport {maximumConfig} from './kernels/Maximum';\nimport {maxPoolConfig} from './kernels/MaxPool';\nimport {maxPool3DConfig} from './kernels/MaxPool3D';\nimport {maxPool3DGradConfig} from './kernels/MaxPool3DGrad';\nimport {maxPoolGradConfig} from './kernels/MaxPoolGrad';\nimport {maxPoolWithArgmaxConfig} from './kernels/MaxPoolWithArgmax';\nimport {meanConfig} from './kernels/Mean';\nimport {minConfig} from './kernels/Min';\nimport {minimumConfig} from './kernels/Minimum';\nimport {mirrorPadConfig} from './kernels/MirrorPad';\nimport {modConfig} from './kernels/Mod';\nimport {multinomialConfig} from './kernels/Multinomial';\nimport {multiplyConfig} from './kernels/Multiply';\nimport {negConfig} from './kernels/Neg';\nimport {nonMaxSuppressionV3Config} from './kernels/NonMaxSuppressionV3';\nimport {nonMaxSuppressionV4Config} from './kernels/NonMaxSuppressionV4';\nimport {nonMaxSuppressionV5Config} from './kernels/NonMaxSuppressionV5';\nimport {notEqualConfig} from './kernels/NotEqual';\nimport {oneHotConfig} from './kernels/OneHot';\nimport {onesLikeConfig} from './kernels/OnesLike';\nimport {packConfig} from './kernels/Pack';\nimport {padV2Config} from './kernels/PadV2';\nimport {powConfig} from './kernels/Pow';\nimport {preluConfig} from './kernels/Prelu';\nimport {prodConfig} from './kernels/Prod';\nimport {raggedGatherConfig} from './kernels/RaggedGather';\nimport {raggedTensorToTensorConfig} from './kernels/RaggedTensorToTensor';\nimport {rangeConfig} from './kernels/Range';\nimport {realConfig} from './kernels/Real';\nimport {realDivConfig} from './kernels/RealDiv';\nimport {reciprocalConfig} from './kernels/Reciprocal';\nimport {reluConfig} from './kernels/Relu';\nimport {relu6Config} from './kernels/Relu6';\nimport {reshapeConfig} from './kernels/Reshape';\nimport {resizeBilinearConfig} from './kernels/ResizeBilinear';\nimport {resizeBilinearGradConfig} from './kernels/ResizeBilinearGrad';\nimport {resizeNearestNeighborConfig} from './kernels/ResizeNearestNeighbor';\nimport {resizeNearestNeighborGradConfig} from './kernels/ResizeNearestNeighborGrad';\nimport {reverseConfig} from './kernels/Reverse';\nimport {rotateWithOffsetConfig} from './kernels/RotateWithOffset';\nimport {roundConfig} from './kernels/Round';\nimport {rsqrtConfig} from './kernels/Rsqrt';\nimport {scatterNdConfig} from './kernels/ScatterNd';\nimport {searchSortedConfig} from './kernels/SearchSorted';\nimport {selectConfig} from './kernels/Select';\nimport {seluConfig} from './kernels/Selu';\nimport {sigmoidConfig} from './kernels/Sigmoid';\nimport {signConfig} from './kernels/Sign';\nimport {sinConfig} from './kernels/Sin';\nimport {sinhConfig} from './kernels/Sinh';\nimport {sliceConfig} from './kernels/Slice';\nimport {softmaxConfig} from './kernels/Softmax';\nimport {softplusConfig} from './kernels/Softplus';\nimport {spaceToBatchNDConfig} from './kernels/SpaceToBatchND';\nimport {sparseFillEmptyRowsConfig} from './kernels/SparseFillEmptyRows';\nimport {sparseReshapeConfig} from './kernels/SparseReshape';\nimport {sparseSegmentMeanConfig} from './kernels/SparseSegmentMean';\nimport {sparseSegmentSumConfig} from './kernels/SparseSegmentSum';\nimport {sparseToDenseConfig} from './kernels/SparseToDense';\nimport {splitVConfig} from './kernels/SplitV';\nimport {sqrtConfig} from './kernels/Sqrt';\nimport {squareConfig} from './kernels/Square';\nimport {squaredDifferenceConfig} from './kernels/SquaredDifference';\nimport {stepConfig} from './kernels/Step';\nimport {stridedSliceConfig} from './kernels/StridedSlice';\nimport {stringNGramsConfig} from './kernels/StringNGrams';\nimport {stringSplitConfig} from './kernels/StringSplit';\nimport {stringToHashBucketFastConfig} from './kernels/StringToHashBucketFast';\nimport {subConfig} from './kernels/Sub';\nimport {sumConfig} from './kernels/Sum';\nimport {tanConfig} from './kernels/Tan';\nimport {tanhConfig} from './kernels/Tanh';\nimport {tileConfig} from './kernels/Tile';\nimport {topKConfig} from './kernels/TopK';\nimport {transformConfig} from './kernels/Transform';\nimport {transposeConfig} from './kernels/Transpose';\nimport {uniqueConfig} from './kernels/Unique';\nimport {unpackConfig} from './kernels/Unpack';\nimport {unsortedSegmentSumConfig} from './kernels/UnsortedSegmentSum';\nimport {zerosLikeConfig} from './kernels/ZerosLike';\n\n// List all kernel configs here\nconst kernelConfigs: KernelConfig[] = [\n  _fusedMatMulConfig,\n  absConfig,\n  acosConfig,\n  acoshConfig,\n  addConfig,\n  addNConfig,\n  allConfig,\n  anyConfig,\n  argMaxConfig,\n  argMinConfig,\n  asinConfig,\n  asinhConfig,\n  atanConfig,\n  atan2Config,\n  atanhConfig,\n  avgPoolConfig,\n  avgPool3DConfig,\n  avgPool3DGradConfig,\n  avgPoolGradConfig,\n  batchMatMulConfig,\n  batchNormConfig,\n  batchToSpaceNDConfig,\n  bincountConfig,\n  broadcastArgsConfig,\n  castConfig,\n  ceilConfig,\n  clipByValueConfig,\n  complexConfig,\n  complexAbsConfig,\n  concatConfig,\n  conv2DConfig,\n  conv2DBackpropFilterConfig,\n  conv2DBackpropInputConfig,\n  conv3DConfig,\n  conv3DBackpropFilterV2Config,\n  conv3DBackpropInputV2Config,\n  cosConfig,\n  coshConfig,\n  cropAndResizeConfig,\n  cumprodConfig,\n  cumsumConfig,\n  denseBincountConfig,\n  depthToSpaceConfig,\n  depthwiseConv2dNativeConfig,\n  depthwiseConv2dNativeBackpropFilterConfig,\n  depthwiseConv2dNativeBackpropInputConfig,\n  diagConfig,\n  dilation2DConfig,\n  dilation2DBackpropFilterConfig,\n  dilation2DBackpropInputConfig,\n  einsumConfig,\n  eluConfig,\n  eluGradConfig,\n  equalConfig,\n  erfConfig,\n  expConfig,\n  expandDimsConfig,\n  expm1Config,\n  fftConfig,\n  fillConfig,\n  flipLeftRightConfig,\n  floorConfig,\n  floorDivConfig,\n  fusedConv2DConfig,\n  fusedDepthwiseConv2DConfig,\n  gatherNdConfig,\n  gatherV2Config,\n  greaterConfig,\n  greaterEqualConfig,\n  identityConfig,\n  ifftConfig,\n  imagConfig,\n  isFiniteConfig,\n  isInfConfig,\n  isNaNConfig,\n  leakyReluConfig,\n  lessConfig,\n  lessEqualConfig,\n  linSpaceConfig,\n  logConfig,\n  log1pConfig,\n  logicalAndConfig,\n  logicalNotConfig,\n  logicalOrConfig,\n  LRNConfig,\n  LRNGradConfig,\n  maxConfig,\n  maximumConfig,\n  maxPoolConfig,\n  maxPool3DConfig,\n  maxPool3DGradConfig,\n  maxPoolGradConfig,\n  maxPoolWithArgmaxConfig,\n  meanConfig,\n  minConfig,\n  minimumConfig,\n  mirrorPadConfig,\n  modConfig,\n  multinomialConfig,\n  multiplyConfig,\n  negConfig,\n  nonMaxSuppressionV3Config,\n  nonMaxSuppressionV4Config,\n  nonMaxSuppressionV5Config,\n  notEqualConfig,\n  oneHotConfig,\n  onesLikeConfig,\n  packConfig,\n  padV2Config,\n  powConfig,\n  preluConfig,\n  prodConfig,\n  raggedGatherConfig,\n  raggedTensorToTensorConfig,\n  rangeConfig,\n  realConfig,\n  realDivConfig,\n  reciprocalConfig,\n  reluConfig,\n  relu6Config,\n  reshapeConfig,\n  resizeBilinearConfig,\n  resizeBilinearGradConfig,\n  resizeNearestNeighborConfig,\n  resizeNearestNeighborGradConfig,\n  reverseConfig,\n  rotateWithOffsetConfig,\n  roundConfig,\n  rsqrtConfig,\n  scatterNdConfig,\n  searchSortedConfig,\n  selectConfig,\n  seluConfig,\n  sigmoidConfig,\n  signConfig,\n  sinConfig,\n  sinhConfig,\n  sliceConfig,\n  softmaxConfig,\n  softplusConfig,\n  spaceToBatchNDConfig,\n  sparseFillEmptyRowsConfig,\n  sparseReshapeConfig,\n  sparseSegmentMeanConfig,\n  sparseSegmentSumConfig,\n  sparseToDenseConfig,\n  splitVConfig,\n  sqrtConfig,\n  squareConfig,\n  squaredDifferenceConfig,\n  stepConfig,\n  stridedSliceConfig,\n  stringNGramsConfig,\n  stringSplitConfig,\n  stringToHashBucketFastConfig,\n  subConfig,\n  sumConfig,\n  tanConfig,\n  tanhConfig,\n  tileConfig,\n  topKConfig,\n  transformConfig,\n  transposeConfig,\n  uniqueConfig,\n  unpackConfig,\n  unsortedSegmentSumConfig,\n  zerosLikeConfig\n];\n\nfor (const kernelConfig of kernelConfigs) {\n  registerKernel(kernelConfig);\n}\n","/** @license See the LICENSE file. */\n\n// This code is auto-generated, do not modify this file!\nconst version = '3.21.0';\nexport {version};\n"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","this","n","v","op","TypeError","pop","length","push","__values","o","s","m","i","__read","r","ar","error","__spread","arguments","concat","assertNotComplex","tensor","opName","isArray","forEach","util","assert","dtype","whereImpl","kernel_impls","_super","_this","data","DataStorage","engine","String","__","constructor","create","tslib_1.__extends","MathBackendCPU","nextDataId","values","shape","firstUse","env","get","backend_util","warn","dataId","id","set","refCount","outId","isString","encodedValues","map","encodeString","write","has","numDataIds","readSync","_b","complexTensorInfos","realValues","real","imagValues","imag","mergeRealAndImagArrays","strings","decodeString","buffer","Error","makeTensorFromTensorInfo","makeTensorInfo","force","disposeData","delete","tensorInfo","start","now","kernelMs","unreliable","reasons","condition","condVals","epsilon","KernelBackend","simpleAbsImpl","vals","resultValues","Float32Array","Math","abs","absConfig","kernelName","Abs","backendName","kernelFunc","args","x","cpuBackend","backend","sizeFromShape","makeOutput","createSimpleBinaryKernelImpl","aShape","bShape","aVals","bVals","newShape","assertAndGetBroadcastShape","resultRank","resultStrides","computeStrides","resultSize","getTypedArrayFromDType","aRank","bRank","aStrides","bStrides","aBroadcastDims","getBroadcastDims","bBroadcastDims","loc","indexToLoc","aLoc","slice","aIndex","locToIndex","bLoc","bIndex","complex","inputs","realVals","imagVals","complexInfo","complexConfig","Complex","zeros","makeZerosTypedArray","identity","incRef","identityConfig","Identity","input","realVal","realConfig","Real","castImpl","inputType","Int32Array","from","zero","toTypedArray","_a","resultData","cast","attrs","zerosTensorInfo","floatX","disposeIntermediateTensorInfo","realPart","hasEncodingLoss","resultShape","resultType","castConfig","Cast","binaryKernelFunc","name","simpleImpl","complexImpl","a","decodedAVals","fromUint8ToStringArray","decodedBVals","$dtype","$aComplex","$aComplexVals","aReal","aImag","aRealVals","aImagVals","$bComplex","$bComplexVals","bReal","bImag","bRealVals","bImagVals","resultRealData","resultImagData","resultReal","resultImag","_c","createComplexBinaryKernelImpl","resultRealVals","resultImagVals","aIdx","bIdx","opResult","addImpl","addComplexImpl","add","Add","addConfig","bincountImpl","xVals","weightsVals","weightsDtype","weightsShape","size","weightsSize","outVals","bincountReduceImpl","xBuf","weightsBuf","binaryOutput","numRows","numCols","outBuf","j","createSimpleUnaryImpl","newValues","unaryKernelFunc","xSize","getArrayFromDType","unaryKernelFuncFromImpl","unaryImpl","ceilImpl","xi","ceil","Ceil","ceilConfig","concatImpl","outShape","simplyConcat","offset_1","colOffset_1","decodedData","tIdx","row","resIdx","col","equalImpl","equal","Equal","equalConfig","expImpl","exp","Exp","expConfig","expm1Impl","expm1","Expm1","expm1Config","floorImpl","floor","Floor","floorConfig","gatherNdImpl","indicesData","paramsBuf","numSlices","sliceRank","sliceSize","strides","paramsShape","paramsSize","index","flattenIndex","dim","k","gatherV2Impl","indicesBuf","flattenOutputShape","originalLoc","batchIdx","indicesIdx","indicesIndex","originalIndex","greaterImpl","greater","Greater","greaterConfig","greaterEqualImpl","greaterEqual","GreaterEqual","greaterEqualConfig","lessImpl","less","Less","lessConfig","lessEqualImpl","lessEqual","LessEqual","lessEqualConfig","linSpaceImpl","stop","num","logImpl","log","Log","logConfig","maxImpl","reduceSize","offset","max","Number","isNaN","maximumImpl","aValue","bValue","maximum","Maximum","maximumConfig","minimumImpl","min","minimum","Minimum","minimumConfig","multiplyImpl","multiplyComplexImpl","multiply","Multiply","multiplyConfig","negImpl","xShape","xDtype","minusOne","createScalarValue","negConfig","Neg","res","notEqualImpl","notEqual","NotEqual","notEqualConfig","transposeImpl","perm","xRank","xStrides","newStrides","newLoc","i_1","transpose","transposeConfig","Transpose","prodImpl","reductionAxes","reduceShape","outDtype","upcastType","prod_1","prodConfig","Prod","axis","keepDims","axes","parseAxisParam","permutation","getAxesPermutation","permutedX","intermediateTensorInfos","getInnerMostAxes","expandShapeToKeepDim","makeSplits","indices","indicesShape","paramsNestedSplits","numParamsDenseValues","valueSlices","numValues","numSplits","outSplits","fill","splits","lastSplit","validateSplits","nrows","rowLength","limit","outDim","outSplitsOutDim","delta","computeFlatOuterDims","orig","numOutDims","outDims","inDim","getValues","paramsDenseValues","paramsDenseValuesShape","paramsDenseValuesDType","valuesShape","valuesOut","numElements","valueSize","denseM","valuesM","outPos","valueSlices_1","tslib_1.__values","writeValueSlices","raggedGatherImpl","paramsNestedSplitsShapes","outputRaggedRank","numParams","locString","join","validateIndices","outputNestedSplits","splitsOut","getSplits","outputDenseValues","RowPartitionType","shapeShape","valuesDType","defaultValue","defaultValueShape","rowPartitionValues","rowPartitionValuesShapes","rowPartitionTypeStrings","rowPartitionTypes","getRowPartitionTypesHelper","raggedRank","getRaggedRank","RaggedTensorToTensorOp","dimension","FIRST_DIM_SIZE","rowPartitionTensor","getRowPartitionTensor","getRowPartitionTypeByDimension","VALUE_ROWIDS","getMaxWidthValueRowID","ROW_SPLITS","getMaxWidthRowSplit","rowSplit","tensorLength","maxWidth","currentWidth","valueRowIds","indexLength","firstEqualIndex","firstEqualIndexValue","tShape","isPartial","makeShape","firstDim","valueShape","validateDefaultValueShape","tensorShapeFromTensor","combineRaggedTensorToTensorShapes","getMaxWidth","firstDimension","outputIndexMultiplier","firstDimensionOutput","minDimension","currentOutputIndex","parentOutputIndex","outputSize","rowSplitSize","realLength","parentOutputIndexCurrent","indexSize","currentOutputColumn","currentValueRowId","nextValueRowId","partitionType","calculateOutputIndexValueRowID","calculateOutputIndexRowSplit","firstPartitionTensor","firstPartitionType","getFirstDimensionSize","calculateOutputSize","multiplier","outputShape","outputTensor","outputIndex","calculateFirstParentOutputIndex","calculateOutputIndex","setOutput","valuesBase","outputBase","elementShape","valueElementSize","outputIndexSize","srcShape_1","tidy","defaultValueTensor","reshape","bCastDefault","broadcastTo","dataSync","srcStart","dstStart","dstEnd","srcI","dstI","src","subarray","copyArray","dst","out","shape_1","raggedTensorToTensorImpl","shapesShape","compute","rangeImpl","rsqrtImpl","sqrt","rsqrt","Rsqrt","rsqrtConfig","scatterImpl","updates","numUpdates","sumDupeIndices","flattenShape","updatesData","rank","sigmoidImpl","sigmoid","Sigmoid","sigmoidConfig","sliceImpl","begin","isContinous","slice_util","isSliceContinous","flatOffset","computeFlatOffset","inBuf","outLoc","inLoc","idx","fromStringArrayToUint8","$begin","$size","assertParamsValid","sliceConfig","Slice","sparseFillEmptyRowsImpl","indicesDType","denseShape","indicesCount","denseRows","emptyRowIndicator","reverseIndexMap","getSparseFillEmptyRowsIndicesDenseShapeMismatch","outputIndices","outputValues","rowsAreOrdered","lastIndicesRow","csrOffset","getSparseFillEmptyRowsNegativeIndexErrorMessage","getSparseFillEmptyRowsOutOfRangeIndexErrorMessage","allRowsFull","rowEmpty","fullIndicesCount","filledCount","outputI","startingIndex","sparseReshapeImpl","inputIndices","inputIndicesShape","inputDType","inputShape","targetShape","denseSize","nnz","outputRank","product","unknownIndex","getSparseReshapeMultipleNegativeOneOutputDimErrorMessage","getSparseReshapeNegativeOutputDimErrorMessage","getSparseReshapeEmptyTensorZeroOutputDimErrorMessage","missing","trunc","getSparseReshapeInputOutputMultipleErrorMessage","getSparseReshapeInputOutputMismatchErrorMessage","inputRank","inputStrides","outputStrides","newIndices","sparseSegmentReductionImpl","segmentIds","isMean","numIndices","inputFlat","numCol","outputRows","getSparseSegmentReductionNegativeSegmentIdsErrorMessage","outputLength","reduce","output","end","uninitializedIndex","outIndex","nextIndex","getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage","getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage","getSparseSegmentReductionIndicesOutOfRangeErrorMessage","sqrtImpl","Sqrt","sqrtConfig","squaredDifferenceImpl","diff","squaredDifference","SquaredDifference","squaredDifferenceConfig","stridedSliceImpl","separator","nGramWidths","leftPad","rightPad","padWidth","preserveShortSequences","preserveShort","StringNGramsOp","nGramWidth","getPadWidth","splitIndex","outputStartIndex","numNGrams","nGramIndex","this_1","leftPadding","rightPadding","numTokens","dataStartIndex","nGramSize","Uint8Array","nGram","nextNGramIndex","appendToNGram","str","inputDataSize","splitsSize","prevSplit","validSplits","numBatchItems","nGramsSplits","empty","this_2","getNumNGrams","nGrams","outputStartIdx","this_3","createNGrams","dataLength","stringNGramsImpl","dataSplits","split","delimiters","skipEmpty","tokenStart","indexOf","token","delimiter","stringSplitImpl","batchSize","tokens","maxNumEntries","prevTokensLength","nEntries","c","stringToHashBucketFastImpl","numBuckets","fingerPrint64","modulo","getLowBitsUnsigned","subImpl","subComplexImpl","sub","Sub","subConfig","tileImpl","reps","comparePair","valueDiff","select","array","left","right","z","sd","sign","swap","topKImpl","sorted","lastDim","batch","allTopKVals","allTopKIndices","valAndInd","sort","outOffset","topKVals","topKIndices","uniqueImpl","$axis","uniqueElements","inputBuffer","TensorBuffer","uniqueIndices","is1DTensor","element","toString","axisValues","undefined","uniqueIndex","keys","outputTmpShape","outputBuffer","uniqueElementIndex","elu","Elu","eluConfig","leakyRelu","alpha","leakyReluConfig","LeakyRelu","preluImpl","xValue","prelu","preluConfig","Prelu","relu","Relu","reluConfig","relu6","Relu6","relu6Config","applyActivation","activation","preluActivationWeights","leakyreluAlpha","$shape","inferFromImplicitShape","$xSize","xData","reshapeConfig","Reshape","batchMatMul","transposeA","transposeB","innerShapeA","innerShapeB","outerShapeA","outerShapeB","outerDimsA","outerDimsB","batchDimA","batchDimB","broadcast_util","b3dShape","a3d","b3d","sharedDim","leftDim","rightDim","batchDim","a3dValues","b3dValues","a3dStrides","b3dStrides","aBatch","aOuterStep","aInnerStep","bInnerStep","bOuterStep","bBatch","resVals","blockSize","bi","i0","j0","k0","iBlock","jBlock","kBlock","sum","batchOffsetA","batchOffsetB","batchMatMulConfig","BatchMatMul","_fusedMatMulConfig","_FusedMatMul","current","addRes","activationRes","bias","intermediates","intermediates_1","acos","Acos","acosConfig","acosh","Acosh","acoshConfig","addNConfig","AddN","tensors","currVals","allConfig","All","origAxes","permutedAxes","$x","assertAxesAreInnerMostDims","all_1","reshapedResult","anyConfig","Any","anyVal","argMaxConfig","ArgMax","outSize","maxIndex","argMinConfig","ArgMin","minIndex","asin","Asin","asinConfig","asinh","Asinh","asinhConfig","atan","Atan","atanConfig","atan2Impl","atan2","Atan2","atan2Config","atanh","Atanh","atanhConfig","pool","xValues","convInfo","poolType","strideHeight","strideWidth","dilationHeight","dilationWidth","effectiveFilterHeight","effectiveFilterWidth","padTop","padInfo","top","padLeft","initialValue","NEGATIVE_INFINITY","POSITIVE_INFINITY","outputVals","outputBatchStrides","outputRowStrides","outputColStrides","outputBatchOffset","inputBatchOffset","inChannels","yR","outHeight","xRCorner","xRMin","xRMax","inHeight","outputRowOffset","yC","outWidth","xCCorner","xCMin","xCMax","inWidth","minMaxValue","avgValue","count","xR","xROffset","xC","pixel","maxPoolPositions","flattenPositions","includeBatchInIndex","maxPositions","maxValue","maxPosition","wR","wC","pool3d","strideDepth","dilationDepth","effectiveFilterDepth","padFront","front","outputDepthStrides","channel","yDepth","outDepth","xDepthCorner","xDepthMin","xDepthMax","inDepth","outputDepthOffset","yRow","xRowCorner","xRowMin","xRowMax","yCol","xColCorner","xColMin","xColMax","outputColOffset","xDepth","xDepthOffset","xRow","xRowOffset","xCol","avgPoolConfig","AvgPool","filterSize","pad","dimRoundingMode","eitherStridesOrDilationsAreOne","computePool2DInfo","filterWidth","filterHeight","arraysEqual","inShape","strides_1","avgPool3DConfig","AvgPool3D","dataFormat","computePool3DInfo","avgPool3DGradConfig","AvgPool3DGrad","dy","filterDepth","dx","avgMultiplier","dyBuf","bufferSync","dxDepth","dxRow","dxCol","dyDepthCorner","dyRowCorner","dyColCorner","dotProd","wDepth","dyDepth","wRow","dyRow","wCol","dyCol","avgPoolGradConfig","AvgPoolGrad","dyData","dxR","dxC","dyRCorner","dyCCorner","dyR","dyC","batchNormConfig","FusedBatchNorm","scale","mean","variance","varianceEpsilon","mVals","varVals","sVals","offVals","offValsLength","sValsLength","varValsLength","mValsLength","offi","mi","si","vi","batchToSpaceNDConfig","BatchToSpaceND","blockShape","crops","prod","reshaped","getReshaped","permuted","getPermuted","reshapedPermuted","getReshapedPermuted","sliceBeginCoords","getSliceBeginCoords","getSliceSize","xReshaped","xTransposed","xTransposedReshaped","bincountConfig","Bincount","weights","broadcastArgsConfig","BroadcastArgs","s0","s1","s0Vals","s1Vals","broadcastShape","clipByValue","ClipByValue","clipAttrs","clipValueMax","clipValueMin","clipByValueConfig","complexAbsConfig","ComplexAbs","complexVals","real_1","imag_1","hypot","imagVal","imagConfig","Imag","shapes","assertParamsConsistent","computeOutShape","$inputs","filter","reals","imags","realConcated","imagConcated","inputs2D","innerSize","inputsValShapes","finalOutShape","outInfo","concatConfig","Concat","conv2D","dilations","$dataFormat","convertConv2DDataFormat","computeConv2DInfo","isChannelsLast","filterStrides","xBatchStride","xRowStride","xColStride","xChannelStride","yBatchStride","yRowStride","yColStride","yChannelStride","wVals","yVals","xOffset1","yOffset1","yOffset2","wOffset1","xOffset2","yOffset3","xOffset3","wOffset3","d1","xVal","d2","outChannels","conv2DConfig","Conv2D","conv2DBackpropFilterConfig","Conv2DBackpropFilter","filterShape","dW","topPad","dyVals","yRMin","yRMax","yCMin","yCMax","conv2DBackpropInputConfig","Conv2DBackpropInput","dyStrides","dxValues","dyValues","fltValues","fltS0","fltS1","fltS2","dyOffset","fltOffset","conv3DConfig","Conv3D","computeConv3DInfo","yF","xFCorner","wF","xF","wOffset2","yOffset4","xOffset4","wOffset4","conv3DBackpropFilterV2Config","Conv3DBackpropFilterV2","dw","dwValues","dwS0","dwS1","dwS2","dwS3","dyS0","dyS1","dyS2","dyS3","xS0","xS1","xS2","xS3","frontPad","yFMin","yFMax","conv3DBackpropInputV2Config","Conv3DBackpropInputV2","dxS0","dxS1","dxS2","dxS3","fltS3","xFMin","cos","Cos","cosConfig","cosh","Cosh","coshConfig","cropAndResizeConfig","CropAndResize","image","boxes","boxInd","cropSize","method","extrapolationValue","imageHeight","imageWidth","numChannels","numBoxes","cropHeight","cropWidth","boxVals","boxIndVals","imageVals","inStride","outStride","startInd","y1","x1","y2","x2","bInd","heightScale","widthScale","yInd","ind","topInd","bottomInd","yLerp","xInd","leftInd","rightInd","xLerp","topLeft","topRight","bottomLeft","bottom","closestX","round","closestY","inInd","outInd","cumprodConfig","Cumprod","exclusive","reverse","permutedAxis","resultDtype","makeOnesTypedArray","finalDim","indexAdjuster","prevIdx","reverseTransposedResult","getUndoAxesPermutation","cumsumConfig","Cumsum","denseBincountConfig","DenseBincount","depthToSpaceConfig","DepthToSpace","inputHeight","inputWidth","inputDepth","outputHeight","outputWidth","outputDepth","outputIdx","h","inH","offsetH","w","inW","offsetD","inputIdx","depthwiseConv2dNative","$dilations","chMul","q","depthwiseConv2dNativeConfig","DepthwiseConv2dNative","depthwiseConv2dNativeBackpropFilterConfig","DepthwiseConv2dNativeBackpropFilter","dm","depthwiseConv2dNativeBackpropInputConfig","DepthwiseConv2dNativeBackpropInput","diagConfig","Diag","dilation2DConfig","Dilation2D","filterVals","filterRank","outRank","hOut","hBeg","wOut","wBeg","curVal","MIN_SAFE_INTEGER","hIn","wIn","xIndex","filterIndex","val","dilation2DBackpropFilterConfig","Dilation2DBackpropFilter","toNestedArray","$filter","$dy","gradients","makeZerosNestedTypedArray","hMax","wMax","dilation2DBackpropInputConfig","Dilation2DBackpropInput","hInMax","wInMax","sum_1","oldResult","sumConfig","Sum","einsumConfig","Einsum","equation","allDims","summedDims","idDims","checkEinsumDimSizes","_d","path","steps","nSteps","numDimsRemaining","tensorsToDispose","_e","idTerm","_g","dimsToExpand","isIdentityPermutation","splice","tensorsToDispose_1","eluGradConfig","EluGrad","ERF_P","a1","ERF_A1","a2","ERF_A2","a3","ERF_A3","a4","ERF_A4","a5","ERF_A5","erf","Erf","erfConfig","expandDims","$dim","expandDimsConfig","ExpandDims","realDivImpl","div","RealDiv","realDivConfig","fftBatch","inverse","innerDim","inputVals","real2D","imag2D","input_1","getComplexWithIndex","$realInfo","$imagInfo","fftImpl","inputSize","fftRadix2","realInfo","imagInfo","sizeInfo","sizeInfoCopy","divRealInfo","divImagInfo","divRealVals","divImagVals","rawOutput","ret","real_2","imag_2","exponent","term","assignToTypedArray","fourierTransformByMatmul","splitRealAndImagArrays","half","evenComplex","complexWithEvenIndex","evenRealVals","evenImagVals","evenShape","evenRealInfo","evenImagInfo","evenTensorInfo","oddComplex","complexWithOddIndex","oddRealVals","oddImagVals","oddShape","oddRealInfo","oddImagInfo","oddTensorInfo","$evenComplex","$evenRealVals","$evenImagVals","$evenShape","$evenRealInfo","$evenImagInfo","$evenTensorInfo","$oddComplex","$oddRealVals","$oddImagVals","$oddShape","$oddRealInfo","$oddImagInfo","$oddTensorInfo","exponents","eShape","eRealInfo","eImagInfo","exponentInfo","addPart","subPart","addPartReal","subPartReal","addPartImag","subPartImag","$real","$imag","$realVals","$imagVals","fftConfig","FFT","innerDimensionSize","input2D","resultReshaped","inferDtype","fillValues","fillConfig","Fill","flipLeftRightConfig","FlipLeftRight","batchOffset","rowOffset","colOffset","coordX","outIdx","outputValue","floorDivImpl","floorDiv","FloorDiv","floorDivConfig","fusedConv2DConfig","FusedConv2D","resultOld","reshapedBias","reshapedAlpha","fusedDepthwiseConv2DConfig","FusedDepthwiseConv2D","gatherNdConfig","GatherNd","params","gatherV2Config","GatherV2","batchDims","parsedAxis","indicesVals","axisDim","$batchDims","indicesSize","shapeInfo","segment_util","collectGatherOpShapeInfo","flattenX","outerSize","dimSize","ifftConfig","IFFT","isFinite","IsFinite","isFiniteConfig","isInf","IsInf","Infinity","isInfConfig","IsNan","isNaNConfig","linSpaceConfig","LinSpace","log1p","Log1p","log1pConfig","logicalAndImpl","logicalAnd","LogicalAnd","logicalAndConfig","logicalNot","LogicalNot","logicalNotConfig","logicalOrImpl","logicalOr","LogicalOr","logicalOrConfig","LRNConfig","LRN","depthRadius","beta","channels","maxD","sumAcrossChannels","currentChannel","beginSumOffset","endSumOffset","pow","LRNGradConfig","LRNGrad","dySize","yValues","depthBegin","depthEnd","norm","dyi","reductionIndices","maxOutShape","maxConfig","Max","maxPoolConfig","MaxPool","maxPool3DConfig","MaxPool3D","maxPool3DGradConfig","MaxPool3DGrad","maxPosBuf","maxPool3dPositions","mask","maxPoolGradConfig","MaxPoolGrad","maxPoolWithArgmaxConfig","MaxPoolWithArgmax","maxPools","pooled","indexes","pooledDataId","indexesDataId","meanConfig","Mean","computeOutAndReduceShapes","toDispose","reduceSizeScalar","minConfig","Min","min_1","mirrorPadConfig","MirrorPad","paddings","mode","coords","inIndex","modImpl","rem","mod","Mod","modConfig","softmax","logits","logitsRank","maxLogit","expandedShape","maxLogitReshaped","sumExp","sumReshaped","softmaxConfig","Softmax","multinomialConfig","Multinomial","numSamples","seed","normalized","probabilities","numEvents","probVals","resShape","cdf","event","random","seedrandom","alea","sampleId","nonMaxSuppressionV3Impl","nonMaxSuppressionV3Config","NonMaxSuppressionV3","scores","maxOutputSize","iouThreshold","scoreThreshold","boxesVals","scoresVals","selectedIndices","nonMaxSuppressionV4Impl","nonMaxSuppressionV4Config","NonMaxSuppressionV4","padToMaxOutputSize","validOutputs","nonMaxSuppressionV5Impl","nonMaxSuppressionV5Config","NonMaxSuppressionV5","softNmsSigma","selectedScores","oneHotConfig","OneHot","depth","onValue","offValue","indicesVal","zerosLike","imagPart","zerosLikeConfig","ZerosLike","onesLikeConfig","OnesLike","onesLike","pack","assertShapesMatch","expandedT","packConfig","Pack","padV2Config","PadV2","constantValue","outCoords","powImpl","Pow","powConfig","raggedGatherConfig","RaggedGather","$paramsNestedSplits","$paramsNestedSplitsShapes","$paramsDenseValues","$indices","outputDenseValuesShape","outputNestedSplitsTensors","outputDenseValuesTensor","raggedTensorToTensorConfig","RaggedTensorToTensor","rowPartitionTensors","$values","$defaultValue","$rowPartitionValues","rangeConfig","Range","reciprocal","Reciprocal","reciprocalConfig","resizeBilinearConfig","ResizeBilinear","images","alignCorners","halfPixelCenters","imagesStrides","newHeight","newWidth","oldHeight","oldWidth","effectiveInputSize","effectiveOutputSize","effectiveRowSizeRatio","effectiveColSizeRatio","sourceFracRow","sourceRowFloor","rowFrac","sourceRowCeil","topRowOffset","botRowOffset","sourceFracCol","sourceColFloor","colFrac","sourceColCeil","topLeftOffest","botLeftOffset","topRightOffset","botRightOffest","newValue","resizeBilinearGradConfig","ResizeBilinearGrad","xHeight","xWidth","yHeight","yWidth","effectiveXSize","effectiveYSize","bOffset","topDxRIndex","bottomDxRIndex","topDxROffset","bottomDxROffset","dxRLerp","inverseDxRLerp","leftDxCIndex","rightDxCIndex","dxCLerp","inverseDxCLerp","topLeftRCOffset","topRightRCOffset","bottomLeftRCOffset","bottomRightRCOffset","inverseDxRLerpTimesInverseDxCLerp","inverseDxRLerpTimesDxCLerp","dxRLerpTimesInverseDxCLerp","dxRLerpTimesDxCLerp","dyVal","resizeNearestNeighborConfig","ResizeNearestNeighbor","outputOffset","sourceNearestRow","sourceNearestCol","newVal","resizeNearestNeighborGradConfig","ResizeNearestNeighborGrad","invHeightScale","invWidthScale","winHeight","winWidth","startRLerp","startDyR","startCLerp","startDyC","accum","dyRIndex","dyROffset","dyCIndex","dyCOffset","reverseConfig","Reverse","dims","$dims","rotateWithOffsetConfig","RotateWithOffset","radians","fillValue","center","centerX","centerY","sinFactor","sin","cosFactor","coordY","Round","base","roundConfig","scatterNdConfig","ScatterNd","lowerBound","mid","upperBound","searchSortedConfig","SearchSorted","sortedSequence","side","sortedInputs","numInputs","sortedInputsSlice","searchSortedImpl","selectConfig","Select","conditionRank","tValues","eValues","scaleAlpha","SELU_SCALEALPHA","SELU_SCALE","selu","Selu","seluConfig","Sign","signConfig","Sin","sinConfig","sinh","Sinh","sinhConfig","threshold","softplus","Softplus","tooLarge","tooSmall","expX","softplusConfig","spaceToBatchNDConfig","SpaceToBatchND","completePaddings","paddedX","reshapedPaddedShape","permutedReshapedPaddedPermutation","paddedXReshaped","paddedXT","sparseFillEmptyRowsConfig","SparseFillEmptyRows","$denseShape","outputIndicesShape","sparseReshapeConfig","SparseReshape","$inputShape","$inputIndices","sparseSegmentMeanConfig","SparseSegmentMean","$data","$segmentIds","outputData","outputDataShape","sparseSegmentSumConfig","SparseSegmentSum","sparseToDenseConfig","SparseToDense","sparseIndices","sparseValues","Boolean","splitVConfig","SplitV","numOrSizeSplits","splitSizes","prepareSplitSize","sliceT","squareConfig","Square","Step","stepAttrs","NaN","stepConfig","stridedSliceConfig","StridedSlice","beginMask","endMask","ellipsisMask","newAxisMask","shrinkAxisMask","finalShapeSparse","finalShape","isIdentity","sliceDim0","isSimpleSlice","$end","$strides","sliced","stringNGramsConfig","StringNGrams","stringSplitConfig","StringSplit","stringToHashBucketFastConfig","StringToHashBucketFast","tan","Tan","tanConfig","tanh","Tanh","tanhConfig","tileConfig","Tile","topKConfig","TopK","transformConfig","Transform","transforms","interpolation","fillMode","inStrides","batchInStride","rowInStride","colInStride","outStrides","batchOutStride","rowOutStride","colOutStride","transformVals","transform_1","outY","outX","projection","inX","inY","mapCoord","nearestInterpolation","bilinearInterpolation","outCoord","len","inCoord","sz2","clamp","mapCoordReflect","sz","mapCoordWrap","mapCoordNearest","mapCoordConstant","readWithFillValue","batchStride","rowStride","colStride","yFloor","xFloor","yCeil","xCeil","uniqueConfig","Unique","unpackConfig","Unpack","valueRank","tempRes","unsortedSegmentSumConfig","UnsortedSegmentSum","numSegments","numIters","expanded","scalarValue","segmentId","maskCasted","mul","sumTensorInfo","kernelConfigs","kernelConfigs_1","kernelConfig","registerKernel"],"mappings":"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uC,EAAG0pD,EAAYj3D,EAAG+I,GAAIE,YACvCkuD,EACF3jC,GAAI,CAACxoB,OAAQ,CAACjC,EAAGmuD,GAAMjuD,UAASwD,MAAO,CAACqM,KAAM,EAAGC,UAAU,KAC/DxB,EAAIrU,KAAKi0D,GACThjC,EAAcjxB,KAAK8zD,GACnB7iC,EAAcjxB,KAAKo8C,GACnBnrB,EAAcjxB,KAAK+zD,GACnB9iC,EAAcjxB,KAAKg0D,GACnB/iC,EAAcjxB,KAAKi0D,GAGrB,IAAM51D,EAASsjD,GAAK,CAAC75C,OAAQuM,EAAKtO,UAASwD,MAAO,CAACqM,KAAM,KAIzD,OAFAqb,EAAchwB,SAAQ,SAAApC,GAAK,OAAAkH,EAAQ2D,8BAA8B7K,MAE1DR,CACT,GC8GM61D,GAAgC,CACpCvjC,GACAprB,EACA8rB,GACAG,GACAnlB,EACAolB,GACAI,GACAQ,GACAG,GACAI,GACAK,GACAG,GACAG,GACAI,GACAG,GACAkF,GACAY,GACAI,GACAqB,GACA5K,GACAqL,GACAkB,GACAiB,GACAG,GACAr0B,EACAkE,EACA+wB,GACA92B,EACA+2B,GACAuB,GACA+B,GACAE,GACAU,GACAW,GACAW,GACAmB,GACAU,GACAG,GACAC,GACA6C,GACAY,GACAE,GACAE,GACAoB,GACAE,GACAG,GACAE,GACAE,GACAgB,GACAS,GACAQ,GACA/hB,GACAmjB,GACA1gC,EACAyhC,GACArhC,EACAwhC,GACAphC,EACAsmC,GACAO,GACAE,GACA3mC,EACAsnC,GACAC,GACAK,GACAE,GACAG,GACAxmC,GACAI,GACAhJ,EACAkwC,GACAlZ,GACAsZ,GACAI,GACAE,GACA3sB,GACA7a,GACAI,GACAqnC,GACA9mC,GACAknC,GACAI,GACAG,GACAI,GACAC,GACAW,GACAU,GACAvoC,GACAyoC,GACAE,GACAE,GACAK,GACAE,GACAO,GACAK,GACA3pC,GACA8pC,GACAU,GACAW,GACA9qC,GACAM,GACAwrC,GACAU,GACAK,GACAjsC,GACAqsC,GACAU,GACAM,GACAE,GACAM,GACAx1B,GACApX,GACA6sC,GACAS,GACAM,GACA16C,EACAooC,GACA0S,GACAx2B,GACAG,GACAS,GACA61B,GACA6B,GACA4B,GACAM,GACAe,GACAI,GACAa,GACAjqC,GACAkqC,GACAK,GACAQ,GACAU,GACA9qC,GACAgrC,GACAE,GACAG,GACArqC,GACAq9B,GACAuN,GACAC,GACAQ,GACAI,GACAI,GACAM,GACAE,GACAK,GACAzoC,GACA+oC,GACA1oC,GACA+oC,GACAC,GACAe,GACAE,GACAE,GACAjmC,GACAukB,GACA8hB,GACAG,GACAC,GACAE,GACAE,GACAv7C,GACAg+C,GACAE,GACAI,GACAlS,QAGF,IAA2B,IAAA6S,GAAAz7C,EAAAw7C,uCAAe,CAArC,IAAME,YACTC,iBAAeD,4JCtWD"}